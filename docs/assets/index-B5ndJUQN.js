var t=Object.defineProperty,e=(e,n,r)=>((e,n,r)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r)(e,"symbol"!=typeof n?n+"":n,r);function n(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();for(var r={},i={byteLength:function(t){var e=c(t),n=e[0],r=e[1];return 3*(n+r)/4-r},toByteArray:function(t){var e,n,r=c(t),i=r[0],s=r[1],l=new a(function(t,e,n){return 3*(e+n)/4-n}(0,i,s)),u=0,d=s>0?i-4:i;for(n=0;n<d;n+=4)e=o[t.charCodeAt(n)]<<18|o[t.charCodeAt(n+1)]<<12|o[t.charCodeAt(n+2)]<<6|o[t.charCodeAt(n+3)],l[u++]=e>>16&255,l[u++]=e>>8&255,l[u++]=255&e;2===s&&(e=o[t.charCodeAt(n)]<<2|o[t.charCodeAt(n+1)]>>4,l[u++]=255&e);1===s&&(e=o[t.charCodeAt(n)]<<10|o[t.charCodeAt(n+1)]<<4|o[t.charCodeAt(n+2)]>>2,l[u++]=e>>8&255,l[u++]=255&e);return l},fromByteArray:function(t){for(var e,n=t.length,r=n%3,i=[],o=16383,a=0,l=n-r;a<l;a+=o)i.push(f(t,a,a+o>l?l:a+o));1===r?(e=t[n-1],i.push(s[e>>2]+s[e<<4&63]+"==")):2===r&&(e=(t[n-2]<<8)+t[n-1],i.push(s[e>>10]+s[e>>4&63]+s[e<<2&63]+"="));return i.join("")}},s=[],o=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0;u<64;++u)s[u]=l[u],o[l.charCodeAt(u)]=u;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function d(t){return s[t>>18&63]+s[t>>12&63]+s[t>>6&63]+s[63&t]}function f(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),i.push(d(r));return i.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63;var h={read:function(t,e,n,r,i){var s,o,a=8*i-r-1,l=(1<<a)-1,u=l>>1,c=-7,d=n?i-1:0,f=n?-1:1,h=t[e+d];for(d+=f,s=h&(1<<-c)-1,h>>=-c,c+=a;c>0;s=256*s+t[e+d],d+=f,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=r;c>0;o=256*o+t[e+d],d+=f,c-=8);if(0===s)s=1-u;else{if(s===l)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),s-=u}return(h?-1:1)*o*Math.pow(2,s-r)},write:function(t,e,n,r,i,s){var o,a,l,u=8*s-i-1,c=(1<<u)-1,d=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:s-1,m=r?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+d>=1?f/l:f*Math.pow(2,1-d))*l>=2&&(o++,l/=2),o+d>=c?(a=0,o=c):o+d>=1?(a=(e*l-1)*Math.pow(2,i),o+=d):(a=e*Math.pow(2,d-1)*Math.pow(2,i),o=0));i>=8;t[n+h]=255&a,h+=m,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;t[n+h]=255&o,h+=m,o/=256,u-=8);t[n+h-m]|=128*p}};!function(t){const e=i,n=h,r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=a,t.SlowBuffer=function(t){+t!=t&&(t=0);return a.alloc(+t)},t.INSPECT_MAX_BYTES=50;const s=2147483647;function o(t){if(t>s)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,a.prototype),e}function a(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return c(t)}return l(t,e,n)}function l(t,e,n){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!a.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const n=0|p(t,e);let r=o(n);const i=r.write(t,e);i!==n&&(r=r.slice(0,i));return r}(t,e);if(ArrayBuffer.isView(t))return function(t){if(J(t,Uint8Array)){const e=new Uint8Array(t);return f(e.buffer,e.byteOffset,e.byteLength)}return d(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(J(t,ArrayBuffer)||t&&J(t.buffer,ArrayBuffer))return f(t,e,n);if("undefined"!=typeof SharedArrayBuffer&&(J(t,SharedArrayBuffer)||t&&J(t.buffer,SharedArrayBuffer)))return f(t,e,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return a.from(r,e,n);const i=function(t){if(a.isBuffer(t)){const e=0|m(t.length),n=o(e);return 0===n.length||t.copy(n,0,0,e),n}if(void 0!==t.length)return"number"!=typeof t.length||H(t.length)?o(0):d(t);if("Buffer"===t.type&&Array.isArray(t.data))return d(t.data)}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return a.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function c(t){return u(t),o(t<0?0:0|m(t))}function d(t){const e=t.length<0?0:0|m(t.length),n=o(e);for(let r=0;r<e;r+=1)n[r]=255&t[r];return n}function f(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),Object.setPrototypeOf(r,a.prototype),r}function m(t){if(t>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|t}function p(t,e){if(a.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||J(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const n=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Z(t).length;default:if(i)return r?-1:W(t).length;e=(""+e).toLowerCase(),i=!0}}function g(t,e,n){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return N(this,e,n);case"utf8":case"utf-8":return D(this,e,n);case"ascii":return O(this,e,n);case"latin1":case"binary":return C(this,e,n);case"base64":return E(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function y(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function w(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),H(n=+n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=a.from(e,r)),a.isBuffer(e))return 0===e.length?-1:v(t,e,n,r,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):v(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(t,e,n,r,i){let s,o=1,a=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,l/=2,n/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){let r=-1;for(s=n;s<a;s++)if(u(t,s)===u(e,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===l)return r*o}else-1!==r&&(s-=s-r),r=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){let n=!0;for(let r=0;r<l;r++)if(u(t,s+r)!==u(e,r)){n=!1;break}if(n)return s}return-1}function b(t,e,n,r){n=Number(n)||0;const i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;const s=e.length;let o;for(r>s/2&&(r=s/2),o=0;o<r;++o){const r=parseInt(e.substr(2*o,2),16);if(H(r))return o;t[n+o]=r}return o}function _(t,e,n,r){return Y(W(e,t.length-n),t,n,r)}function x(t,e,n,r){return Y(function(t){const e=[];for(let n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function S(t,e,n,r){return Y(Z(e),t,n,r)}function T(t,e,n,r){return Y(function(t,e){let n,r,i;const s=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)n=t.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(e,t.length-n),t,n,r)}function E(t,n,r){return 0===n&&r===t.length?e.fromByteArray(t):e.fromByteArray(t.slice(n,r))}function D(t,e,n){n=Math.min(t.length,n);const r=[];let i=e;for(;i<n;){const e=t[i];let s=null,o=e>239?4:e>223?3:e>191?2:1;if(i+o<=n){let n,r,a,l;switch(o){case 1:e<128&&(s=e);break;case 2:n=t[i+1],128==(192&n)&&(l=(31&e)<<6|63&n,l>127&&(s=l));break;case 3:n=t[i+1],r=t[i+2],128==(192&n)&&128==(192&r)&&(l=(15&e)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(s=l));break;case 4:n=t[i+1],r=t[i+2],a=t[i+3],128==(192&n)&&128==(192&r)&&128==(192&a)&&(l=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&a,l>65535&&l<1114112&&(s=l))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=o}return function(t){const e=t.length;if(e<=I)return String.fromCharCode.apply(String,t);let n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=I));return n}(r)}t.kMaxLength=s,a.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(t,e,n){return l(t,e,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(t,e,n){return function(t,e,n){return u(t),t<=0?o(t):void 0!==e?"string"==typeof n?o(t).fill(e,n):o(t).fill(e):o(t)}(t,e,n)},a.allocUnsafe=function(t){return c(t)},a.allocUnsafeSlow=function(t){return c(t)},a.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==a.prototype},a.compare=function(t,e){if(J(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),J(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,r=e.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);let n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const r=a.allocUnsafe(e);let i=0;for(n=0;n<t.length;++n){let e=t[n];if(J(e,Uint8Array))i+e.length>r.length?(a.isBuffer(e)||(e=a.from(e)),e.copy(r,i)):Uint8Array.prototype.set.call(r,e,i);else{if(!a.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,i)}i+=e.length}return r},a.byteLength=p,a.prototype._isBuffer=!0,a.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)y(this,e,e+1);return this},a.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},a.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},a.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?D(this,0,t):g.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(t,e,n,r,i){if(J(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;let s=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(e>>>=0);const l=Math.min(s,o),u=this.slice(r,i),c=t.slice(e,n);for(let a=0;a<l;++a)if(u[a]!==c[a]){s=u[a],o=c[a];break}return s<o?-1:o<s?1:0},a.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},a.prototype.indexOf=function(t,e,n){return w(this,t,e,n,!0)},a.prototype.lastIndexOf=function(t,e,n){return w(this,t,e,n,!1)},a.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let s=!1;for(;;)switch(r){case"hex":return b(this,t,e,n);case"utf8":case"utf-8":return _(this,t,e,n);case"ascii":case"latin1":case"binary":return x(this,t,e,n);case"base64":return S(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const I=4096;function O(t,e,n){let r="";n=Math.min(t.length,n);for(let i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function C(t,e,n){let r="";n=Math.min(t.length,n);for(let i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function N(t,e,n){const r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);let i="";for(let s=e;s<n;++s)i+=Q[t[s]];return i}function k(t,e,n){const r=t.slice(e,n);let i="";for(let s=0;s<r.length-1;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function M(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function B(t,e,n,r,i,s){if(!a.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function L(t,e,n,r,i){q(e,r,i,t,n,7);let s=Number(e&BigInt(4294967295));t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,n}function A(t,e,n,r,i){q(e,r,i,t,n,7);let s=Number(e&BigInt(4294967295));t[n+7]=s,s>>=8,t[n+6]=s,s>>=8,t[n+5]=s,s>>=8,t[n+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[n+3]=o,o>>=8,t[n+2]=o,o>>=8,t[n+1]=o,o>>=8,t[n]=o,n+8}function R(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(t,e,r,i,s){return e=+e,r>>>=0,s||R(t,0,r,4),n.write(t,e,r,i,23,4),r+4}function P(t,e,r,i,s){return e=+e,r>>>=0,s||R(t,0,r,8),n.write(t,e,r,i,52,8),r+8}a.prototype.slice=function(t,e){const n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,a.prototype),r},a.prototype.readUintLE=a.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||M(t,e,this.length);let r=this[t],i=1,s=0;for(;++s<e&&(i*=256);)r+=this[t+s]*i;return r},a.prototype.readUintBE=a.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||M(t,e,this.length);let r=this[t+--e],i=1;for(;e>0&&(i*=256);)r+=this[t+--e]*i;return r},a.prototype.readUint8=a.prototype.readUInt8=function(t,e){return t>>>=0,e||M(t,1,this.length),this[t]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(t,e){return t>>>=0,e||M(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(t,e){return t>>>=0,e||M(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(t,e){return t>>>=0,e||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(t,e){return t>>>=0,e||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readBigUInt64LE=K(function(t){G(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||z(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))}),a.prototype.readBigUInt64BE=K(function(t){G(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||z(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)}),a.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||M(t,e,this.length);let r=this[t],i=1,s=0;for(;++s<e&&(i*=256);)r+=this[t+s]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},a.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||M(t,e,this.length);let r=e,i=1,s=this[t+--r];for(;r>0&&(i*=256);)s+=this[t+--r]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*e)),s},a.prototype.readInt8=function(t,e){return t>>>=0,e||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function(t,e){t>>>=0,e||M(t,2,this.length);const n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(t,e){t>>>=0,e||M(t,2,this.length);const n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(t,e){return t>>>=0,e||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return t>>>=0,e||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readBigInt64LE=K(function(t){G(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||z(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)}),a.prototype.readBigInt64BE=K(function(t){G(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||z(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+n)}),a.prototype.readFloatLE=function(t,e){return t>>>=0,e||M(t,4,this.length),n.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return t>>>=0,e||M(t,4,this.length),n.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return t>>>=0,e||M(t,8,this.length),n.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return t>>>=0,e||M(t,8,this.length),n.read(this,t,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){B(this,t,e,n,Math.pow(2,8*n)-1,0)}let i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){B(this,t,e,n,Math.pow(2,8*n)-1,0)}let i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},a.prototype.writeUint8=a.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,1,255,0),this[e]=255&t,e+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeBigUInt64LE=K(function(t,e=0){return L(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=K(function(t,e=0){return A(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);B(this,t,e,n,r-1,-r)}let i=0,s=1,o=0;for(this[e]=255&t;++i<n&&(s*=256);)t<0&&0===o&&0!==this[e+i-1]&&(o=1),this[e+i]=(t/s|0)-o&255;return e+n},a.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);B(this,t,e,n,r-1,-r)}let i=n-1,s=1,o=0;for(this[e+i]=255&t;--i>=0&&(s*=256);)t<0&&0===o&&0!==this[e+i+1]&&(o=1),this[e+i]=(t/s|0)-o&255;return e+n},a.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},a.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||B(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeBigInt64LE=K(function(t,e=0){return L(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=K(function(t,e=0){return A(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeFloatLE=function(t,e,n){return F(this,t,e,!0,n)},a.prototype.writeFloatBE=function(t,e,n){return F(this,t,e,!1,n)},a.prototype.writeDoubleLE=function(t,e,n){return P(this,t,e,!0,n)},a.prototype.writeDoubleBE=function(t,e,n){return P(this,t,e,!1,n)},a.prototype.copy=function(t,e,n,r){if(!a.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);const i=r-n;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,n,r):Uint8Array.prototype.set.call(t,this.subarray(n,r),e),i},a.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;let i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{const s=a.isBuffer(t)?t:a.from(t,r),o=s.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<n-e;++i)this[i+e]=s[i%o]}return this};const $={};function U(t,e,n){$[t]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function V(t){let e="",n=t.length;const r="-"===t[0]?1:0;for(;n>=r+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function q(t,e,n,r,i,s){if(t>n||t<e){const n="bigint"==typeof e?"n":"";let r;throw r=0===e||e===BigInt(0)?`>= 0${n} and < 2${n} ** ${8*(s+1)}${n}`:`>= -(2${n} ** ${8*(s+1)-1}${n}) and < 2 ** ${8*(s+1)-1}${n}`,new $.ERR_OUT_OF_RANGE("value",r,t)}!function(t,e,n){G(e,"offset"),void 0!==t[e]&&void 0!==t[e+n]||z(e,t.length-(n+1))}(r,i,s)}function G(t,e){if("number"!=typeof t)throw new $.ERR_INVALID_ARG_TYPE(e,"number",t)}function z(t,e,n){if(Math.floor(t)!==t)throw G(t,n),new $.ERR_OUT_OF_RANGE("offset","an integer",t);if(e<0)throw new $.ERR_BUFFER_OUT_OF_BOUNDS;throw new $.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${e}`,t)}U("ERR_BUFFER_OUT_OF_BOUNDS",function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),U("ERR_INVALID_ARG_TYPE",function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`},TypeError),U("ERR_OUT_OF_RANGE",function(t,e,n){let r=`The value of "${t}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=V(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=V(i)),i+="n"),r+=` It must be ${e}. Received ${i}`,r},RangeError);const j=/[^+/0-9A-Za-z-_]/g;function W(t,e){let n;e=e||1/0;const r=t.length;let i=null;const s=[];for(let o=0;o<r;++o){if(n=t.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function Z(t){return e.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(j,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Y(t,e,n,r){let i;for(i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function J(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function H(t){return t!=t}const Q=function(){const t="0123456789abcdef",e=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)e[r+i]=t[n]+t[i]}return e}();function K(t){return"undefined"==typeof BigInt?X:t}function X(){throw new Error("BigInt not supported")}}(r);var m,p,g={exports:{}},y=g.exports={};function w(){throw new Error("setTimeout has not been defined")}function v(){throw new Error("clearTimeout has not been defined")}function b(t){if(m===setTimeout)return setTimeout(t,0);if((m===w||!m)&&setTimeout)return m=setTimeout,setTimeout(t,0);try{return m(t,0)}catch(e){try{return m.call(null,t,0)}catch(n){return m.call(this,t,0)}}}!function(){try{m="function"==typeof setTimeout?setTimeout:w}catch(t){m=w}try{p="function"==typeof clearTimeout?clearTimeout:v}catch(t){p=v}}();var _,x=[],S=!1,T=-1;function E(){S&&_&&(S=!1,_.length?x=_.concat(x):T=-1,x.length&&D())}function D(){if(!S){var t=b(E);S=!0;for(var e=x.length;e;){for(_=x,x=[];++T<e;)_&&_[T].run();T=-1,e=x.length}_=null,S=!1,function(t){if(p===clearTimeout)return clearTimeout(t);if((p===v||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(n){return p.call(this,t)}}}(t)}}function I(t,e){this.fun=t,this.array=e}function O(){}y.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];x.push(new I(t,e)),1!==x.length||S||b(D)},I.prototype.run=function(){this.fun.apply(null,this.array)},y.title="browser",y.browser=!0,y.env={},y.argv=[],y.version="",y.versions={},y.on=O,y.addListener=O,y.once=O,y.off=O,y.removeListener=O,y.removeAllListeners=O,y.emit=O,y.prependListener=O,y.prependOnceListener=O,y.listeners=function(t){return[]},y.binding=function(t){throw new Error("process.binding is not supported")},y.cwd=function(){return"/"},y.chdir=function(t){throw new Error("process.chdir is not supported")},y.umask=function(){return 0};const C=n(g.exports);function N(t,e){}let k={"2025_2026":{USD:1.2761,EUR:1.188,GBP:1},"2024_2025":{USD:1.2761,EUR:1.188,GBP:1},"2023_2024":{USD:1.2529,EUR:1.1543,GBP:1},"2022_2023":{USD:1.219267,EUR:1.166525,GBP:1},"2021_2022":{USD:1.371217,EUR:1.174183,GBP:1},"2020_2021":{USD:1.293542,EUR:1.114767,GBP:1},"2019_2020":{USD:1.279266667,EUR:1.147166667,GBP:1},"2018_2019":{USD:1.32,EUR:1.134,GBP:1},"2017_2018":{USD:1.31,EUR:1.136,GBP:1}};const M="2024_2025";function B(t,e){if("GBP"===t)return 1;const n=k,r=e?function(t){const e=new Date(t);if(isNaN(e.getTime()))return M;const n=e.getFullYear(),r=e.getMonth(),i=e.getDate();let s=n;return(r<3||3===r&&i<6)&&(s=n-1),`${s}_${s+1}`}(e):M,i=n[r];if(!i)throw new Error(`No exchange rates defined for Tax Year ${r}.\nPlease ensure configuration includes rates for "${r}".\nDate requested: ${e}`);const s=i[t];if(!s)throw new Error(`No exchange rate found for currency '${t}' in Tax Year ${r}.\nPlease add "${t}" to the "${r}" entry in configuration.`);return s}function L(t,e,n){if("GBP"===e)return t;return t/B(e,n)}function A(t,e=[]){const n=t=>t.conid?t.conid.toString():t.symbol,r={};for(const a of t){const t=n(a);r[t]||(r[t]=[]),r[t].push(a)}const i={};for(const a of e||[]){const t=n(a);i[t]||(i[t]=[]),i[t].push(a)}const s=[],o=[];for(const a in r){const t=r[a],e=i[a]||[],{disposals:n,pool:l,shorts:u}=R(t,e);s.push(...n);const c=t.length>0?t[0].assetCategory:"Unknown",d=t.length>0?t[0].symbol:a;if(l.quantity>1e-7&&o.push({symbol:d,quantity:l.quantity,cost:l.cost,currency:"GBP",assetCategory:c,originalCost:l.originalCost,originalCurrency:l.originalCurrency||void 0}),u.length>0){const t=u.reduce((t,e)=>t+e.remainingQty,0),e=u.reduce((t,e)=>t+U(e)/e.quantity*e.remainingQty,0);o.push({symbol:d,quantity:-t,cost:e,currency:"GBP",assetCategory:u[0].assetCategory})}}return s.sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime()),{disposalResults:s,openPositions:o}}function R(t,e){const n=[...t.map(t=>({...t,eventType:"TRADE"})),...e.map(t=>({...t,eventType:"SPLIT"}))].sort((t,e)=>{const n=new Date(t.date),r=new Date(e.date),i=n.getTime(),s=r.getTime();return i!==s?i-s:t.eventType!==e.eventType?"SPLIT"===t.eventType?-1:1:0}).map(t=>"TRADE"===t.eventType?{...F(t,t.date),eventType:"TRADE"}:{...t}),r=n.filter(t=>"TRADE"===t.eventType&&"BUY"===t.type),i=n.filter(t=>"TRADE"===t.eventType&&"SELL"===t.type),s=(t,e)=>{let r=1;for(const i of n)if("SPLIT"===i.eventType){const n=new Date(i.date);if(n>t&&n<=e){let t=1;if(i._derivedRatio)t=i._derivedRatio;else if(i.ratio){const[e,n]=i.ratio.split(":").map(Number);0!==n&&(t=e/n)}r*=t}}return r};let o=0;{let t=0;for(const e of n)if("TRADE"===e.eventType)"BUY"===e.type&&(t+=e.quantity),"SELL"===e.type&&(t-=e.quantity);else if("SPLIT"===e.eventType){const n=t,r=e.quantityChange,i=n+r;let s=1;if(0!==n?s=i/n:Math.abs(r)>1e-6&&(o+=r,N((e.date,V(e.symbol)),e.date)),e.ratio){const[t,n]=e.ratio.split(":").map(Number);0!==n&&(s=t/n)}e._derivedRatio=s,t=i}}const a=new Map;r.forEach(t=>a.set(t,0));const l=new Map;i.forEach(t=>l.set(t,0));const u=[];for(const f of i){let t=f.quantity;const e=new Date(f.date),n=r.filter(t=>{return n=new Date(t.date),r=e,n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()&&n.getDate()===r.getDate();var n,r});for(const r of n){if(t<=0)break;const e=a.get(r)||0,n=r.quantity-e;if(n>0){const i=Math.min(t,n),s=U(r)/r.quantity*i,o=U(f)/f.quantity*i;u.push({date:f.date,symbol:f.symbol,quantity:i,proceeds:o,allowableCost:s,gain:o-s,rule:"SAME_DAY",matchDate:r.date,assetCategory:f.assetCategory,source:f.source,matchSource:r.source,originalProceeds:U(f,!0)/f.quantity*i,originalCost:U(r,!0)/r.quantity*i,originalCurrency:f.originalCurrency,multiplier:f.multiplier,isAssignment:f.isAssignment||r.isAssignment,isExpired:f.isExpired||r.isExpired,notes:f.notes,matchNotes:r.notes}),t-=i,a.set(r,e+i),l.set(f,(l.get(f)||0)+i)}}if(t>0){const n=r.filter(t=>{const n=new Date(t.date),r=P(e,n);return r>=1&&r<=30}).sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime());for(const r of n){if(t<=0)break;const n=new Date(r.date),i=s(e,n),o=a.get(r)||0,c=(r.quantity-o)/i;if(c>1e-7){const e=Math.min(t,c),n=e*i,s=U(r)/r.quantity*n,d=U(f)/f.quantity*e;u.push({date:f.date,symbol:f.symbol,quantity:e,proceeds:d,allowableCost:s,gain:d-s,rule:"BED_AND_BREAKFAST",matchDate:r.date,assetCategory:f.assetCategory,source:f.source,matchSource:r.source,originalProceeds:U(f,!0)/f.quantity*e,originalCost:U(r,!0)/r.quantity*n,originalCurrency:f.originalCurrency,multiplier:f.multiplier,isAssignment:f.isAssignment||r.isAssignment,isExpired:f.isExpired||r.isExpired,notes:f.notes,matchNotes:r.notes+(1!==i?` (Split Adj ${i.toFixed(2)}x)`:"")}),t-=e,a.set(r,o+n),l.set(f,(l.get(f)||0)+e)}}}}const c={quantity:0,cost:0,originalCost:0,originalCurrency:void 0},d=[];for(const f of n){if("SPLIT"===f.eventType){const t=f,e=void 0!==t._derivedRatio?t._derivedRatio:1;if(1!==e){c.quantity=c.quantity*e;for(const t of d)t.quantity=t.quantity*e,t.price=t.price/e,t.remainingQty=t.remainingQty*e}else 0!==o&&(c.quantity+=o,o=0);continue}const t=f;if("BUY"===t.type){const e=a.get(t)||0;let n=t.quantity-e;if(n>1e-7){for(;n>1e-7&&d.length>0;){const e=d[0],r=Math.min(n,e.remainingQty),i=U(t)/t.quantity*r,s=U(e)/e.quantity*r;u.push({date:e.date,symbol:e.symbol,quantity:r,proceeds:s,allowableCost:i,gain:s-i,rule:"SHORT_MATCH",matchDate:t.date,assetCategory:e.assetCategory,source:e.source,matchSource:t.source,originalProceeds:U(e,!0)/e.quantity*r,originalCost:U(t,!0)/t.quantity*r,originalCurrency:e.originalCurrency,multiplier:e.multiplier,isAssignment:t.isAssignment,isExpired:t.isExpired}),e.remainingQty-=r,n-=r,e.remainingQty<=1e-7&&d.shift()}n>1e-7?$(c,n,U(t)/t.quantity*n,U(t,!0)/t.quantity*n,t.originalCurrency):0===t.quantity&&$(c,0,U(t),U(t,!0),t.originalCurrency)}else 0===t.quantity&&$(c,0,U(t),U(t,!0),t.originalCurrency)}else if("SELL"===t.type){const e=l.get(t)||0;let n=t.quantity-e;if(n>1e-7){if(c.quantity>1e-7){const e=Math.min(n,c.quantity),r=c.cost/c.quantity*e,i=U(t)/t.quantity*e;let s=0;void 0!==c.originalCost&&c.quantity>0&&(s=c.originalCost/c.quantity*e),u.push({date:t.date,symbol:t.symbol,quantity:e,proceeds:i,allowableCost:r,gain:i-r,rule:"SECTION_104",assetCategory:t.assetCategory,source:t.source,originalProceeds:U(t,!0)/t.quantity*e,originalCurrency:t.originalCurrency,multiplier:t.multiplier,isAssignment:t.isAssignment,isExpired:t.isExpired,originalCost:s,originalCostCurrency:c.originalCurrency||t.originalCurrency}),c.quantity-=e,c.cost-=r,void 0!==c.originalCost&&(c.originalCost-=s),n-=e}n>1e-7&&d.push({...t,remainingQty:n})}}}return{disposals:u,pool:c,shorts:d}}function F(t,e){const n={...t,originalPrice:t.price,originalAmount:t.amount,originalCurrency:t.currency,originalCommission:t.commission,multiplier:t.multiplier,notes:t.notes};if("GBP"===t.currency)return{...n,originalCurrency:"GBP"};const r=e||t.date;return{...n,price:L(t.price,t.currency,r),amount:L(t.amount,t.currency,r),commission:L(t.commission,t.currency,r),currency:"GBP"}}function P(t,e){const n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));return Math.round((r.getTime()-n.getTime())/864e5)}function $(t,e,n,r,i){t.quantity+=e,t.cost+=n,r&&(t.originalCost=(t.originalCost||0)+r),i&&!t.originalCurrency&&(t.originalCurrency=i)}function U(t,e=!1){const n=e?t.originalAmount||0:t.amount,r=e?t.originalCommission||0:t.commission;return"BUY"===t.type?n+r:n-r}function V(t){const e=t.match(/^([A-Z]+)\s*(\d{2})(\d{2})(\d{2})([C|P])(\d{8})$/);if(e){const[,t,n,r,i,s,o]=e,a=parseInt(o,10)/1e3;return`${t} ${`${i}${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(r,10)-1]||r}${n}`} ${a} ${s}`}return t}window.Buffer=r.Buffer,window.process=C,window.global=window,k={"2025_2026":{USD:1.2761,EUR:1.188,GBP:1},"2024_2025":{USD:1.2761,EUR:1.188,GBP:1},"2023_2024":{USD:1.2529,EUR:1.1543,GBP:1},"2022_2023":{USD:1.219267,EUR:1.166525,GBP:1},"2021_2022":{USD:1.371217,EUR:1.174183,GBP:1},"2020_2021":{USD:1.293542,EUR:1.114767,GBP:1},"2019_2020":{USD:1.279266667,EUR:1.147166667,GBP:1},"2018_2019":{USD:1.32,EUR:1.134,GBP:1},"2017_2018":{USD:1.31,EUR:1.136,GBP:1}};class q{constructor(t){e(this,"onFilesSelected"),e(this,"selectedFiles",[]),this.onFilesSelected=t}render(){return'\n      <div id="file-upload-container" class="bg-white rounded-lg shadow-md p-6 mb-8 animate-fade-in">\n        <div \n          id="drop-zone"\n          class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center\n                 hover:border-primary-500 hover:bg-primary-50 transition-all duration-200\n                 cursor-pointer"\n        >\n          <svg class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" \n                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />\n          </svg>\n          <p class="mt-4 text-lg font-medium text-gray-900">\n            Drop IBKR CSV files here\n          </p>\n          <p class="mt-2 text-sm text-gray-500">\n            or click to browse\n          </p>\n          <p class="mt-4 text-xs text-gray-400">\n            Supports IBKR Activity Flex Query CSV files\n          </p>\n          <input \n            type="file" \n            id="file-input" \n            multiple \n            accept=".csv"\n            class="hidden"\n          >\n        </div>\n        \n        <div id="file-list" class="mt-4"></div>\n      </div>\n    '}attachEventListeners(){const t=document.getElementById("drop-zone"),e=document.getElementById("file-input");t&&e&&(t.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation(),t.classList.add("drop-zone-active")}),t.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation(),t.classList.remove("drop-zone-active")}),t.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),t.classList.remove("drop-zone-active");const n=Array.from(e.dataTransfer?.files||[]);this.handleFiles(n)}),t.addEventListener("click",()=>e.click()),e.addEventListener("change",()=>{const t=Array.from(e.files||[]);this.handleFiles(t)}))}handleFiles(t){const e=t.filter(t=>t.name.toLowerCase().endsWith(".csv"));0!==e.length?(this.selectedFiles=e,this.onFilesSelected(e)):this.showError("Please select CSV files")}displayFileList(){const t=document.getElementById("file-list"),e=document.getElementById("drop-zone");if(!t||!e)return;if(0===this.selectedFiles.length)return t.innerHTML="",e.classList.remove("hidden"),void t.classList.add("mt-4");e.classList.add("hidden"),t.classList.remove("mt-4"),t.innerHTML=`\n      <h2 class="text-xl font-bold text-gray-900 mb-4">Uploaded Files</h2>\n      <div class="bg-gray-50 rounded-lg p-4">\n        <div class="flex items-center justify-between">\n            <button \n                id="toggle-files-btn"\n                class="flex items-center text-sm font-medium text-gray-900 hover:text-gray-700 focus:outline-none"\n            >\n                <svg \n                    id="files-chevron"\n                    class="h-4 w-4 mr-2 text-gray-500 transform -rotate-90 transition-transform duration-200" \n                    fill="none" \n                    viewBox="0 0 24 24" \n                    stroke="currentColor"\n                >\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />\n                </svg>\n                Selected files (${this.selectedFiles.length})\n            </button>\n            \n            <button \n              id="clear-files-btn"\n              class="inline-flex items-center px-2 py-1 border border-transparent text-xs font-medium rounded text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"\n            >\n              Clear files\n            </button>\n        </div>\n        \n        <div id="file-list-content" class="hidden mt-3 pl-6 border-l-2 border-gray-200">\n            <ul class="space-y-2">\n              ${this.selectedFiles.map(t=>`\n                <li class="text-sm text-gray-600 flex items-center">\n                  <svg class="h-4 w-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">\n                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>\n                  </svg>\n                  ${t.name} <span class="text-gray-400 ml-2">(${this.formatFileSize(t.size)})</span>\n                </li>\n              `).join("")}\n            </ul>\n        </div>\n      </div>\n    `;const n=document.getElementById("toggle-files-btn"),r=document.getElementById("file-list-content"),i=document.getElementById("files-chevron");n?.addEventListener("click",()=>{const t=r?.classList.contains("hidden");t?(r?.classList.remove("hidden"),r?.classList.add("animate-slide-down"),i?.classList.remove("-rotate-90")):(r?.classList.add("hidden"),i?.classList.add("-rotate-90"))}),document.getElementById("clear-files-btn")?.addEventListener("click",()=>{this.selectedFiles=[],this.displayFileList(),this.onFilesSelected([]).catch(console.error);const t=document.getElementById("file-input");t&&(t.value="")})}showFileList(){this.displayFileList()}hideDropZone(){const t=document.getElementById("file-upload-container");t&&t.classList.add("hidden")}showDropZone(){const t=document.getElementById("file-upload-container");t&&0===this.selectedFiles.length&&t.classList.remove("hidden")}formatFileSize(t){return t<1024?t+" B":t<1048576?(t/1024).toFixed(1)+" KB":(t/1048576).toFixed(1)+" MB"}showError(t){const e=document.getElementById("file-list");e&&(e.innerHTML=`\n      <div class="bg-red-50 border border-red-200 rounded-lg p-4">\n        <p class="text-sm text-red-800">${t}</p>\n      </div>\n    `)}}class G{constructor(){e(this,"isVisible",!1),e(this,"message",""),e(this,"progress",0)}render(){return'<div id="progress-container"></div>'}show(t="Processing..."){this.isVisible=!0,this.message=t,this.progress=0,this.update(0)}update(t,e){this.progress=Math.min(100,Math.max(0,t)),e&&(this.message=e);const n=document.getElementById("progress-container");if(!n)return;if(!this.isVisible)return void(n.innerHTML="");const r=document.getElementById("progress-bar-fill"),i=document.getElementById("progress-message"),s=document.getElementById("progress-percent");r&&i&&s?(r.style.width=`${this.progress}%`,i.textContent=this.message,s.textContent=`${Math.round(this.progress)}%`):this.renderContent(n)}renderContent(t){t.innerHTML=`\n      <div class="mb-8 bg-white rounded-lg shadow-md p-6 animate-slide-up">\n        <div class="flex items-center justify-between mb-2">\n          <span id="progress-message" class="text-sm font-medium text-gray-700">${this.message}</span>\n          <span id="progress-percent" class="text-sm text-gray-500">${Math.round(this.progress)}%</span>\n        </div>\n        <div class="w-full bg-gray-200 rounded-full h-2.5">\n          <div \n            id="progress-bar-fill"\n            class="bg-primary-600 h-2.5 rounded-full transition-all duration-300"\n            style="width: ${this.progress}%"\n          ></div>\n        </div>\n        <div class="mt-4 flex justify-center">\n          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>\n        </div>\n      </div>\n    `}hide(){this.isVisible=!1;const t=document.getElementById("progress-container");t&&(t.innerHTML="")}}class z{constructor(){e(this,"results",null)}formatCurrency(t){return("string"==typeof t?parseFloat(t):t).toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}render(){return'<div id="results-container"></div>'}display(t){this.results=t;const e=document.getElementById("results-container");e&&(e.innerHTML=`\n      <div class="mt-8 space-y-6 animate-fade-in">\n        ${this.renderSummary()}\n      </div>\n    `)}clear(){this.results=null;const t=document.getElementById("results-container");t&&(t.innerHTML="")}displayError(t){const e=document.getElementById("results-container");e&&(e.innerHTML=`\n      <div class="bg-red-50 border border-red-200 rounded-lg p-6 animate-slide-up">\n        <div class="flex items-start">\n          <svg class="h-6 w-6 text-red-600 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" \n                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n          </svg>\n          <div class="ml-3">\n            <h3 class="text-lg font-medium text-red-800">Error Processing Files</h3>\n            <p class="mt-2 text-sm text-red-700">${t.message}</p>\n            <p class="mt-2 text-xs text-red-600">\n              Please ensure you're using valid IBKR Activity Flex Query CSV files.\n            </p>\n          </div>\n        </div>\n      </div>\n    `)}renderSummary(){if(!this.results)return"";const{summary:t,dateRange:e}=this.results;return`\n      <div class="bg-white rounded-lg shadow-md p-6 mb-8">\n        <h2 class="text-2xl font-bold text-gray-900 mb-2">Summary Report</h2>\n        <p class="text-sm text-gray-500 mb-6">${e&&e.fromDate&&e.toDate?`Period: ${e.fromDate} to ${e.toDate}`:"Period: All Transactions"}</p>\n        \n        <div class="overflow-x-auto">\n          <table class="min-w-full divide-y divide-gray-200">\n            <thead class="bg-gray-50">\n              <tr>\n                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Section</th>\n                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>\n                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>\n                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Proceeds</th>\n                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Cost</th>\n                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Net</th>\n              </tr>\n            </thead>\n            <tbody class="bg-white divide-y divide-gray-200">\n              ${t.rows.map(t=>{const e=parseFloat(t["Net Gain / Income (GBP)"]),n=e>=0?"text-green-600":"text-red-600";return`\n                <tr class="hover:bg-gray-50">\n                  <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">${t.Section}</td>\n                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${t.Category}</td>\n                  <td class="px-6 py-4 text-sm text-gray-700">${t.Description}</td>\n                  <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">£${this.formatCurrency(t["Gross / Proceeds (GBP)"])}</td>\n                  <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">£${this.formatCurrency(t["Cost / Expense (GBP)"])}</td>\n                  <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-medium ${n}">\n                    £${this.formatCurrency(e)}\n                  </td>\n                </tr>\n              `}).join("")}\n            </tbody>\n          </table>\n        </div>\n\n      </div>\n    `}}class j{constructor(t){e(this,"dateRange",{fromDate:null,toDate:null,taxYear:null}),e(this,"onDateRangeChange"),this.onDateRangeChange=t}render(){return'\n      <div class="bg-white rounded-lg shadow-md p-6 mb-8 animate-fade-in">\n        <h2 class="text-xl font-bold text-gray-900 mb-4">Select Tax Period</h2>\n        \n        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">\n          \x3c!-- Tax Year Selector --\x3e\n          <div>\n            <label class="block text-sm font-medium text-gray-700 mb-2">\n              UK Tax Year\n            </label>\n            <select \n              id="tax-year-select" \n              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"\n            >\n              <option value="">All Transactions</option>\n              <option value="2025_2026">2025-2026 (6 Apr 2025 - 5 Apr 2026)</option>\n              <option value="2024_2025">2024-2025 (6 Apr 2024 - 5 Apr 2025)</option>\n              <option value="2023_2024">2023-2024 (6 Apr 2023 - 5 Apr 2024)</option>\n              <option value="2022_2023">2022-2023 (6 Apr 2022 - 5 Apr 2023)</option>\n              <option value="2021_2022">2021-2022 (6 Apr 2021 - 5 Apr 2022)</option>\n              <option value="2020_2021">2020-2021 (6 Apr 2020 - 5 Apr 2021)</option>\n              <option value="2019_2020">2019-2020 (6 Apr 2019 - 5 Apr 2020)</option>\n              <option value="2018_2019">2018-2019 (6 Apr 2018 - 5 Apr 2019)</option>\n              <option value="custom">Custom Date Range</option>\n            </select>\n          </div>\n\n          \x3c!-- Custom Date Range --\x3e\n          <div id="custom-date-range" class="hidden">\n            <label class="block text-sm font-medium text-gray-700 mb-2">\n              Custom Date Range\n            </label>\n            <div class="grid grid-cols-2 gap-2">\n              <div>\n                <label class="block text-xs text-gray-500 mb-1">From</label>\n                <input \n                  type="date" \n                  id="from-date" \n                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"\n                >\n              </div>\n              <div>\n                <label class="block text-xs text-gray-500 mb-1">To</label>\n                <input \n                  type="date" \n                  id="to-date" \n                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"\n                >\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="mt-4 p-3 bg-blue-50 rounded-lg">\n          <p class="text-sm text-blue-800">\n            <strong>Note:</strong> UK tax year runs from 6 April to 5 April of the following year.\n            Select a tax year or use custom dates to filter your transactions.\n          </p>\n        </div>\n      </div>\n    '}attachEventListeners(){const t=document.getElementById("tax-year-select"),e=document.getElementById("custom-date-range"),n=document.getElementById("from-date"),r=document.getElementById("to-date");t&&e&&n&&r&&(t.addEventListener("change",()=>{const n=t.value;if("custom"===n)e.classList.remove("hidden"),this.dateRange.taxYear=null;else{if(e.classList.add("hidden"),this.dateRange.taxYear=n||null,this.dateRange.fromDate=null,this.dateRange.toDate=null,n){const t=this.getTaxYearDates(n);this.dateRange.fromDate=t.from,this.dateRange.toDate=t.toDate}this.onDateRangeChange(this.dateRange)}}),n.addEventListener("change",()=>{this.dateRange.fromDate=n.value||null,this.dateRange.taxYear=null,this.onDateRangeChange(this.dateRange)}),r.addEventListener("change",()=>{this.dateRange.toDate=r.value||null,this.dateRange.taxYear=null,this.onDateRangeChange(this.dateRange)}))}getTaxYearDates(t){const[e]=t.split("_").map(Number);return{from:`${e}-04-06`,toDate:`${e+1}-04-05`}}getDateRange(){return this.dateRange}}class W extends Error{constructor(t,e,n,...r){Array.isArray(e)&&(e=e.join(" ").trim()),super(e),void 0!==Error.captureStackTrace&&Error.captureStackTrace(this,W),this.code=t;for(const i of r)for(const t in i){const e=i[t];this[t]=Buffer.isBuffer(e)?e.toString(n.encoding):null==e?e:JSON.parse(JSON.stringify(e))}}}const Z=function(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)},Y=function(t){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(null==r||!1===r)e[n]={disabled:!0};else if("string"==typeof r)e[n]={name:r};else{if(!Z(r))throw new W("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(r)} at position ${n}`]);if("string"!=typeof r.name)throw new W("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${n}`,"when column is an object literal"]);e[n]=r}}return e};class J{constructor(t=100){this.size=t,this.length=0,this.buf=Buffer.allocUnsafe(t)}prepend(t){if(Buffer.isBuffer(t)){const e=this.length+t.length;if(e>=this.size&&(this.resize(),e>=this.size))throw Error("INVALID_BUFFER_STATE");const n=this.buf;this.buf=Buffer.allocUnsafe(this.size),t.copy(this.buf,0),n.copy(this.buf,t.length),this.length+=t.length}else{const e=this.length++;e===this.size&&this.resize();const n=this.clone();this.buf[0]=t,n.copy(this.buf,1,0,e)}}append(t){const e=this.length++;e===this.size&&this.resize(),this.buf[e]=t}clone(){return Buffer.from(this.buf.slice(0,this.length))}resize(){const t=this.length;this.size=2*this.size;const e=Buffer.allocUnsafe(this.size);this.buf.copy(e,0,0,t),this.buf=e}toString(t){return t?this.buf.slice(0,this.length).toString(t):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const H=function(t){return{bomSkipped:!1,bufBytesStart:0,castField:t.cast_function,commenting:!1,error:void 0,enabled:1===t.from_line,escaping:!1,escapeIsQuote:Buffer.isBuffer(t.escape)&&Buffer.isBuffer(t.quote)&&0===Buffer.compare(t.escape,t.quote),expectedRecordLength:Array.isArray(t.columns)?t.columns.length:void 0,field:new J(20),firstLineToHeaders:t.cast_first_line_to_header,needMoreDataSize:Math.max(null!==t.comment?t.comment.length:0,...t.delimiter.map(t=>t.length),null!==t.quote?t.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new J(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:0===t.record_delimiter.length?0:Math.max(...t.record_delimiter.map(t=>t.length)),trimChars:[Buffer.from(" ",t.encoding)[0],Buffer.from("\t",t.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[Buffer.from(Buffer.from([13],"utf8").toString(),t.encoding),Buffer.from(Buffer.from([10],"utf8").toString(),t.encoding),Buffer.from(Buffer.from([12],"utf8").toString(),t.encoding),Buffer.from(Buffer.from([32],"utf8").toString(),t.encoding),Buffer.from(Buffer.from([9],"utf8").toString(),t.encoding)]}},Q=function(t){return t.replace(/([A-Z])/g,function(t,e){return"_"+e.toLowerCase()})},K=function(t){const e={};for(const r in t)e[Q(r)]=t[r];if(void 0===e.encoding||!0===e.encoding)e.encoding="utf8";else if(null===e.encoding||!1===e.encoding)e.encoding=null;else if("string"!=typeof e.encoding&&null!==e.encoding)throw new W("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(e.encoding)}`],e);if(void 0===e.bom||null===e.bom||!1===e.bom)e.bom=!1;else if(!0!==e.bom)throw new W("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(e.bom)}`],e);if(e.cast_function=null,void 0===e.cast||null===e.cast||!1===e.cast||""===e.cast)e.cast=void 0;else if("function"==typeof e.cast)e.cast_function=e.cast,e.cast=!0;else if(!0!==e.cast)throw new W("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(e.cast)}`],e);if(void 0===e.cast_date||null===e.cast_date||!1===e.cast_date||""===e.cast_date)e.cast_date=!1;else if(!0===e.cast_date)e.cast_date=function(t){const e=Date.parse(t);return isNaN(e)?t:new Date(e)};else if("function"!=typeof e.cast_date)throw new W("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(e.cast_date)}`],e);if(e.cast_first_line_to_header=null,!0===e.columns)e.cast_first_line_to_header=void 0;else if("function"==typeof e.columns)e.cast_first_line_to_header=e.columns,e.columns=!0;else if(Array.isArray(e.columns))e.columns=Y(e.columns);else{if(void 0!==e.columns&&null!==e.columns&&!1!==e.columns)throw new W("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(e.columns)}`],e);e.columns=!1}if(void 0===e.group_columns_by_name||null===e.group_columns_by_name||!1===e.group_columns_by_name)e.group_columns_by_name=!1;else{if(!0!==e.group_columns_by_name)throw new W("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(e.group_columns_by_name)}`],e);if(!1===e.columns)throw new W("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],e)}if(void 0===e.comment||null===e.comment||!1===e.comment||""===e.comment)e.comment=null;else if("string"==typeof e.comment&&(e.comment=Buffer.from(e.comment,e.encoding)),!Buffer.isBuffer(e.comment))throw new W("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(e.comment)}`],e);if(void 0===e.comment_no_infix||null===e.comment_no_infix||!1===e.comment_no_infix)e.comment_no_infix=!1;else if(!0!==e.comment_no_infix)throw new W("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(e.comment_no_infix)}`],e);const n=JSON.stringify(e.delimiter);if(Array.isArray(e.delimiter)||(e.delimiter=[e.delimiter]),0===e.delimiter.length)throw new W("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${n}`],e);if(e.delimiter=e.delimiter.map(function(t){if(null==t||!1===t)return Buffer.from(",",e.encoding);if("string"==typeof t&&(t=Buffer.from(t,e.encoding)),!Buffer.isBuffer(t)||0===t.length)throw new W("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${n}`],e);return t}),void 0===e.escape||!0===e.escape?e.escape=Buffer.from('"',e.encoding):"string"==typeof e.escape?e.escape=Buffer.from(e.escape,e.encoding):null!==e.escape&&!1!==e.escape||(e.escape=null),null!==e.escape&&!Buffer.isBuffer(e.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(e.escape)}`);if(void 0===e.from||null===e.from)e.from=1;else{if("string"==typeof e.from&&/\d+/.test(e.from)&&(e.from=parseInt(e.from)),!Number.isInteger(e.from))throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(e.from)}`);if(e.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(t.from)}`)}if(void 0===e.from_line||null===e.from_line)e.from_line=1;else{if("string"==typeof e.from_line&&/\d+/.test(e.from_line)&&(e.from_line=parseInt(e.from_line)),!Number.isInteger(e.from_line))throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(t.from_line)}`);if(e.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(t.from_line)}`)}if(void 0===e.ignore_last_delimiters||null===e.ignore_last_delimiters)e.ignore_last_delimiters=!1;else if("number"==typeof e.ignore_last_delimiters)e.ignore_last_delimiters=Math.floor(e.ignore_last_delimiters),0===e.ignore_last_delimiters&&(e.ignore_last_delimiters=!1);else if("boolean"!=typeof e.ignore_last_delimiters)throw new W("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(e.ignore_last_delimiters)}`],e);if(!0===e.ignore_last_delimiters&&!1===e.columns)throw new W("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],e);if(void 0===e.info||null===e.info||!1===e.info)e.info=!1;else if(!0!==e.info)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(e.info)}`);if(void 0===e.max_record_size||null===e.max_record_size||!1===e.max_record_size)e.max_record_size=0;else if(Number.isInteger(e.max_record_size)&&e.max_record_size>=0);else{if("string"!=typeof e.max_record_size||!/\d+/.test(e.max_record_size))throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(e.max_record_size)}`);e.max_record_size=parseInt(e.max_record_size)}if(void 0===e.objname||null===e.objname||!1===e.objname)e.objname=void 0;else if(Buffer.isBuffer(e.objname)){if(0===e.objname.length)throw new Error("Invalid Option: objname must be a non empty buffer");null===e.encoding||(e.objname=e.objname.toString(e.encoding))}else if("string"==typeof e.objname){if(0===e.objname.length)throw new Error("Invalid Option: objname must be a non empty string")}else if("number"!=typeof e.objname)throw new Error(`Invalid Option: objname must be a string or a buffer, got ${e.objname}`);if(void 0!==e.objname)if("number"==typeof e.objname){if(!1!==e.columns)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(!1===e.columns)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index");if(void 0===e.on_record||null===e.on_record)e.on_record=void 0;else if("function"!=typeof e.on_record)throw new W("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(e.on_record)}`],e);if(void 0!==e.on_skip&&null!==e.on_skip&&"function"!=typeof e.on_skip)throw new Error(`Invalid Option: on_skip must be a function, got ${JSON.stringify(e.on_skip)}`);if(null===e.quote||!1===e.quote||""===e.quote)e.quote=null;else if(void 0===e.quote||!0===e.quote?e.quote=Buffer.from('"',e.encoding):"string"==typeof e.quote&&(e.quote=Buffer.from(e.quote,e.encoding)),!Buffer.isBuffer(e.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(e.quote)}`);if(void 0===e.raw||null===e.raw||!1===e.raw)e.raw=!1;else if(!0!==e.raw)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(e.raw)}`);if(void 0===e.record_delimiter)e.record_delimiter=[];else if("string"==typeof e.record_delimiter||Buffer.isBuffer(e.record_delimiter)){if(0===e.record_delimiter.length)throw new W("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);e.record_delimiter=[e.record_delimiter]}else if(!Array.isArray(e.record_delimiter))throw new W("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(e.record_delimiter)}`],e);if(e.record_delimiter=e.record_delimiter.map(function(t,n){if("string"!=typeof t&&!Buffer.isBuffer(t))throw new W("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${n},`,`got ${JSON.stringify(t)}`],e);if(0===t.length)throw new W("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${n},`,`got ${JSON.stringify(t)}`],e);return"string"==typeof t&&(t=Buffer.from(t,e.encoding)),t}),"boolean"==typeof e.relax_column_count);else{if(void 0!==e.relax_column_count&&null!==e.relax_column_count)throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(e.relax_column_count)}`);e.relax_column_count=!1}if("boolean"==typeof e.relax_column_count_less);else{if(void 0!==e.relax_column_count_less&&null!==e.relax_column_count_less)throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(e.relax_column_count_less)}`);e.relax_column_count_less=!1}if("boolean"==typeof e.relax_column_count_more);else{if(void 0!==e.relax_column_count_more&&null!==e.relax_column_count_more)throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(e.relax_column_count_more)}`);e.relax_column_count_more=!1}if("boolean"==typeof e.relax_quotes);else{if(void 0!==e.relax_quotes&&null!==e.relax_quotes)throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(e.relax_quotes)}`);e.relax_quotes=!1}if("boolean"==typeof e.skip_empty_lines);else{if(void 0!==e.skip_empty_lines&&null!==e.skip_empty_lines)throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(e.skip_empty_lines)}`);e.skip_empty_lines=!1}if("boolean"==typeof e.skip_records_with_empty_values);else{if(void 0!==e.skip_records_with_empty_values&&null!==e.skip_records_with_empty_values)throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(e.skip_records_with_empty_values)}`);e.skip_records_with_empty_values=!1}if("boolean"==typeof e.skip_records_with_error);else{if(void 0!==e.skip_records_with_error&&null!==e.skip_records_with_error)throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(e.skip_records_with_error)}`);e.skip_records_with_error=!1}if(void 0===e.rtrim||null===e.rtrim||!1===e.rtrim)e.rtrim=!1;else if(!0!==e.rtrim)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(e.rtrim)}`);if(void 0===e.ltrim||null===e.ltrim||!1===e.ltrim)e.ltrim=!1;else if(!0!==e.ltrim)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(e.ltrim)}`);if(void 0===e.trim||null===e.trim||!1===e.trim)e.trim=!1;else if(!0!==e.trim)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(e.trim)}`);if(!0===e.trim&&!1!==t.ltrim?e.ltrim=!0:!0!==e.ltrim&&(e.ltrim=!1),!0===e.trim&&!1!==t.rtrim?e.rtrim=!0:!0!==e.rtrim&&(e.rtrim=!1),void 0===e.to||null===e.to)e.to=-1;else{if("string"==typeof e.to&&/\d+/.test(e.to)&&(e.to=parseInt(e.to)),!Number.isInteger(e.to))throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(t.to)}`);if(e.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(t.to)}`)}if(void 0===e.to_line||null===e.to_line)e.to_line=-1;else{if("string"==typeof e.to_line&&/\d+/.test(e.to_line)&&(e.to_line=parseInt(e.to_line)),!Number.isInteger(e.to_line))throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(t.to_line)}`);if(e.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(t.to_line)}`)}return e},X=function(t){return t.every(t=>null==t||t.toString&&""===t.toString().trim())},tt={utf8:Buffer.from([239,187,191]),utf16le:Buffer.from([255,254])},et=function(t,e={}){"string"==typeof t&&(t=Buffer.from(t));const n=e&&e.objname?{}:[],r=function(t={}){const e=K(t);return{info:{bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},original_options:t,options:e,state:H(e),__needMoreData:function(t,e,n){if(n)return!1;const{encoding:r,escape:i,quote:s}=this.options,{quoting:o,needMoreDataSize:a,recordDelimiterMaxLength:l}=this.state;return e-t-1<Math.max(a,0===l?Buffer.from("\r\n",r).length:l,o?(null===i?0:i.length)+s.length:0,o?s.length+l:0)},parse:function(t,e,n,r){const{bom:i,comment_no_infix:s,encoding:o,from_line:a,ltrim:l,max_record_size:u,raw:c,relax_quotes:d,rtrim:f,skip_empty_lines:h,to:m,to_line:p}=this.options;let{comment:g,escape:y,quote:w,record_delimiter:v}=this.options;const{bomSkipped:b,previousBuf:_,rawBuffer:x,escapeIsQuote:S}=this.state;let T;if(void 0===_){if(void 0===t)return void r();T=t}else T=void 0!==_&&void 0===t?_:Buffer.concat([_,t]);if(!1===b)if(!1===i)this.state.bomSkipped=!0;else if(T.length<3){if(!1===e)return void(this.state.previousBuf=T)}else{for(const t in tt)if(0===tt[t].compare(T,0,tt[t].length)){const e=tt[t].length;this.state.bufBytesStart+=e,T=T.slice(e),this.options=K({...this.original_options,encoding:t}),({comment:g,escape:y,quote:w}=this.options);break}this.state.bomSkipped=!0}const E=T.length;let D;for(D=0;D<E&&!this.__needMoreData(D,E,e);D++){if(!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1),-1!==p&&this.info.lines>p)return this.state.stop=!0,void r();!1===this.state.quoting&&0===v.length&&this.__autoDiscoverRecordDelimiter(T,D)&&(v=this.options.record_delimiter);const t=T[D];if(!0===c&&x.append(t),13!==t&&10!==t||!1!==this.state.wasRowDelimiter||(this.state.wasRowDelimiter=!0),!0===this.state.escaping)this.state.escaping=!1;else{if(null!==y&&!0===this.state.quoting&&this.__isEscape(T,D,t)&&D+y.length<E){if(!S){this.state.escaping=!0,D+=y.length-1;continue}if(this.__isQuote(T,D+y.length)){this.state.escaping=!0,D+=y.length-1;continue}}if(!1===this.state.commenting&&this.__isQuote(T,D))if(!0===this.state.quoting){const e=T[D+w.length],n=f&&this.__isCharTrimable(T,D+w.length),r=null!==g&&this.__compareBytes(g,T,D+w.length,e),i=this.__isDelimiter(T,D+w.length,e),s=0===v.length?this.__autoDiscoverRecordDelimiter(T,D+w.length):this.__isRecordDelimiter(e,T,D+w.length);if(null!==y&&this.__isEscape(T,D,t)&&this.__isQuote(T,D+y.length))D+=y.length-1;else{if(!e||i||s||r||n){this.state.quoting=!1,this.state.wasQuoting=!0,D+=w.length-1;continue}if(!1===d){const t=this.__error(new W("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(e)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(void 0!==t)return t}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(w),D+=w.length-1}}else{if(0===this.state.field.length){this.state.quoting=!0,D+=w.length-1;continue}if(!1===d){const t=this.__infoField(),e=Object.keys(tt).map(t=>!!tt[t].equals(this.state.field.toString())&&t).filter(Boolean)[0],n=this.__error(new W("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(t.column)} at line ${t.lines}, value is ${JSON.stringify(this.state.field.toString(o))}`,e?`(${e} bom)`:void 0],this.options,t,{field:this.state.field}));if(void 0!==n)return n}}if(!1===this.state.quoting){const e=this.__isRecordDelimiter(t,T,D);if(0!==e){if(this.state.commenting&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length)this.info.comment_lines++;else{if(!1===this.state.enabled&&this.info.lines+(!0===this.state.wasRowDelimiter?1:0)>=a){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),D+=e-1;continue}if(!0===h&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length){this.info.empty_lines++,D+=e-1;continue}this.info.bytes=this.state.bufBytesStart+D;const t=this.__onField();if(void 0!==t)return t;this.info.bytes=this.state.bufBytesStart+D+e;const i=this.__onRecord(n);if(void 0!==i)return i;if(-1!==m&&this.info.records>=m)return this.state.stop=!0,void r()}this.state.commenting=!1,D+=e-1;continue}if(this.state.commenting)continue;if(null!==g&&(!1===s||0===this.state.record.length&&0===this.state.field.length)&&0!==this.__compareBytes(g,T,D,t)){this.state.commenting=!0;continue}const i=this.__isDelimiter(T,D,t);if(0!==i){this.info.bytes=this.state.bufBytesStart+D;const t=this.__onField();if(void 0!==t)return t;D+=i-1;continue}}}if(!1===this.state.commenting&&0!==u&&this.state.record_length+this.state.field.length>u)return this.__error(new W("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${u}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const e=!1===l||!0===this.state.quoting||0!==this.state.field.length||!this.__isCharTrimable(T,D),i=!1===f||!1===this.state.wasQuoting;if(!0!==e||!0!==i){if(!0!==f||this.__isCharTrimable(T,D)){!1===e&&(D+=this.__isCharTrimable(T,D)-1);continue}return this.__error(new W("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()))}this.state.field.append(t)}if(!0===e)if(!0===this.state.quoting){const t=this.__error(new W("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(void 0!==t)return t}else if(!0===this.state.wasQuoting||0!==this.state.record.length||0!==this.state.field.length){this.info.bytes=this.state.bufBytesStart+D;const t=this.__onField();if(void 0!==t)return t;const e=this.__onRecord(n);if(void 0!==e)return e}else!0===this.state.wasRowDelimiter?this.info.empty_lines++:!0===this.state.commenting&&this.info.comment_lines++;else this.state.bufBytesStart+=D,this.state.previousBuf=T.slice(D);!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(t){const{columns:e,group_columns_by_name:n,encoding:r,info:i,from:s,relax_column_count:o,relax_column_count_less:a,relax_column_count_more:l,raw:u,skip_records_with_empty_values:c}=this.options,{enabled:d,record:f}=this.state;if(!1===d)return this.__resetRecord();const h=f.length;if(!0===e)return!0===c&&X(f)?void this.__resetRecord():this.__firstLineToColumns(f);if(!1===e&&0===this.info.records&&(this.state.expectedRecordLength=h),h!==this.state.expectedRecordLength){const t=!1===e?new W("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${h} on line ${this.info.lines}`],this.options,this.__infoField(),{record:f}):new W("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${e.length},`,`got ${h} on line ${this.info.lines}`],this.options,this.__infoField(),{record:f});if(!0===o||!0===a&&h<this.state.expectedRecordLength||!0===l&&h>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=t;else{const e=this.__error(t);if(e)return e}}if(!0===c&&X(f))this.__resetRecord();else{if(!0===this.state.recordHasError)return this.__resetRecord(),void(this.state.recordHasError=!1);if(this.info.records++,1===s||this.info.records>=s){const{objname:s}=this.options;if(!1!==e){const o={};for(let t=0,r=f.length;t<r;t++)void 0===e[t]||e[t].disabled||(!0===n&&void 0!==o[e[t].name]?Array.isArray(o[e[t].name])?o[e[t].name]=o[e[t].name].concat(f[t]):o[e[t].name]=[o[e[t].name],f[t]]:o[e[t].name]=f[t]);if(!0===u||!0===i){const e=Object.assign({record:o},!0===u?{raw:this.state.rawBuffer.toString(r)}:{},!0===i?{info:this.__infoRecord()}:{}),n=this.__push(void 0===s?e:[o[s],e],t);if(n)return n}else{const e=this.__push(void 0===s?o:[o[s],o],t);if(e)return e}}else if(!0===u||!0===i){const e=Object.assign({record:f},!0===u?{raw:this.state.rawBuffer.toString(r)}:{},!0===i?{info:this.__infoRecord()}:{}),n=this.__push(void 0===s?e:[f[s],e],t);if(n)return n}else{const e=this.__push(void 0===s?f:[f[s],f],t);if(e)return e}}this.__resetRecord()}},__firstLineToColumns:function(t){const{firstLineToHeaders:e}=this.state;try{const n=void 0===e?t:e.call(null,t);if(!Array.isArray(n))return this.__error(new W("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(n)}`],this.options,this.__infoField(),{headers:n}));const r=Y(n);return this.state.expectedRecordLength=r.length,this.options.columns=r,void this.__resetRecord()}catch(n){return n}},__resetRecord:function(){!0===this.options.raw&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:t,encoding:e,rtrim:n,max_record_size:r}=this.options,{enabled:i,wasQuoting:s}=this.state;if(!1===i)return this.__resetField();let o=this.state.field.toString(e);if(!0===n&&!1===s&&(o=o.trimRight()),!0===t){const[t,e]=this.__cast(o);if(void 0!==t)return t;o=e}this.state.record.push(o),0!==r&&"string"==typeof o&&(this.state.record_length+=o.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(t,e){const{on_record:n}=this.options;if(void 0!==n){const e=this.__infoRecord();try{t=n.call(null,t,e)}catch(r){return r}if(null==t)return}e(t)},__cast:function(t){const{columns:e,relax_column_count:n}=this.options;if(!0===Array.isArray(e)&&n&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(null!==this.state.castField)try{const e=this.__infoField();return[void 0,this.state.castField.call(null,t,e)]}catch(r){return[r]}if(this.__isFloat(t))return[void 0,parseFloat(t)];if(!1!==this.options.cast_date){const e=this.__infoField();return[void 0,this.options.cast_date.call(null,t,e)]}return[void 0,t]},__isCharTrimable:function(t,e){return((t,e)=>{const{timchars:n}=this.state;t:for(let r=0;r<n.length;r++){const i=n[r];for(let n=0;n<i.length;n++)if(i[n]!==t[e+n])continue t;return i.length}return 0})(t,e)},__isFloat:function(t){return t-parseFloat(t)+1>=0},__compareBytes:function(t,e,n,r){if(t[0]!==r)return 0;const i=t.length;for(let s=1;s<i;s++)if(t[s]!==e[n+s])return 0;return i},__isDelimiter:function(t,e,n){const{delimiter:r,ignore_last_delimiters:i}=this.options;if(!0===i&&this.state.record.length===this.options.columns.length-1)return 0;if(!1!==i&&"number"==typeof i&&this.state.record.length===i-1)return 0;t:for(let s=0;s<r.length;s++){const i=r[s];if(i[0]===n){for(let n=1;n<i.length;n++)if(i[n]!==t[e+n])continue t;return i.length}}return 0},__isRecordDelimiter:function(t,e,n){const{record_delimiter:r}=this.options,i=r.length;t:for(let s=0;s<i;s++){const i=r[s],o=i.length;if(i[0]===t){for(let t=1;t<o;t++)if(i[t]!==e[n+t])continue t;return i.length}}return 0},__isEscape:function(t,e,n){const{escape:r}=this.options;if(null===r)return!1;const i=r.length;if(r[0]===n){for(let n=0;n<i;n++)if(r[n]!==t[e+n])return!1;return!0}return!1},__isQuote:function(t,e){const{quote:n}=this.options;if(null===n)return!1;const r=n.length;for(let i=0;i<r;i++)if(n[i]!==t[e+i])return!1;return!0},__autoDiscoverRecordDelimiter:function(t,e){const{encoding:n}=this.options,r=[Buffer.from("\r\n",n),Buffer.from("\n",n),Buffer.from("\r",n)];t:for(let i=0;i<r.length;i++){const n=r[i].length;for(let s=0;s<n;s++)if(r[i][s]!==t[e+s])continue t;return this.options.record_delimiter.push(r[i]),this.state.recordDelimiterMaxLength=r[i].length,r[i].length}return 0},__error:function(t){const{encoding:e,raw:n,skip_records_with_error:r}=this.options,i="string"==typeof t?new Error(t):t;return r?(this.state.recordHasError=!0,void(void 0!==this.options.on_skip&&this.options.on_skip(i,n?this.state.rawBuffer.toString(e):void 0))):i},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:t,raw:e,encoding:n}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:!0===t,index:this.state.record.length,raw:e?this.state.rawBuffer.toString(n):void 0}},__infoField:function(){const{columns:t}=this.options,e=Array.isArray(t);return{...this.__infoRecord(),column:!0===e?t.length>this.state.record.length?t[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}}(e),i=t=>{void 0===r.options.objname?n.push(t):n[t[0]]=t[1]},s=()=>{},o=r.parse(t,!1,i,s);if(void 0!==o)throw o;const a=r.parse(void 0,!0,i,s);if(void 0!==a)throw a;return n};class nt extends Error{}class rt extends nt{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class it extends nt{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class st extends nt{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class ot extends nt{}class at extends nt{constructor(t){super(`Invalid unit ${t}`)}}class lt extends nt{}class ut extends nt{constructor(){super("Zone is an abstract class")}}const ct="numeric",dt="short",ft="long",ht={year:ct,month:ct,day:ct},mt={year:ct,month:dt,day:ct},pt={year:ct,month:dt,day:ct,weekday:dt},gt={year:ct,month:ft,day:ct},yt={year:ct,month:ft,day:ct,weekday:ft},wt={hour:ct,minute:ct},vt={hour:ct,minute:ct,second:ct},bt={hour:ct,minute:ct,second:ct,timeZoneName:dt},_t={hour:ct,minute:ct,second:ct,timeZoneName:ft},xt={hour:ct,minute:ct,hourCycle:"h23"},St={hour:ct,minute:ct,second:ct,hourCycle:"h23"},Tt={hour:ct,minute:ct,second:ct,hourCycle:"h23",timeZoneName:dt},Et={hour:ct,minute:ct,second:ct,hourCycle:"h23",timeZoneName:ft},Dt={year:ct,month:ct,day:ct,hour:ct,minute:ct},It={year:ct,month:ct,day:ct,hour:ct,minute:ct,second:ct},Ot={year:ct,month:dt,day:ct,hour:ct,minute:ct},Ct={year:ct,month:dt,day:ct,hour:ct,minute:ct,second:ct},Nt={year:ct,month:dt,day:ct,weekday:dt,hour:ct,minute:ct},kt={year:ct,month:ft,day:ct,hour:ct,minute:ct,timeZoneName:dt},Mt={year:ct,month:ft,day:ct,hour:ct,minute:ct,second:ct,timeZoneName:dt},Bt={year:ct,month:ft,day:ct,weekday:ft,hour:ct,minute:ct,timeZoneName:ft},Lt={year:ct,month:ft,day:ct,weekday:ft,hour:ct,minute:ct,second:ct,timeZoneName:ft};class At{get type(){throw new ut}get name(){throw new ut}get ianaName(){return this.name}get isUniversal(){throw new ut}offsetName(t,e){throw new ut}formatOffset(t,e){throw new ut}offset(t){throw new ut}equals(t){throw new ut}get isValid(){throw new ut}}let Rt=null;class Ft extends At{static get instance(){return null===Rt&&(Rt=new Ft),Rt}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:e,locale:n}){return rn(t,e,n)}formatOffset(t,e){return ln(this.offset(t),e)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return"system"===t.type}get isValid(){return!0}}const Pt=new Map;const $t={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};const Ut=new Map;class Vt extends At{static create(t){let e=Ut.get(t);return void 0===e&&Ut.set(t,e=new Vt(t)),e}static resetCache(){Ut.clear(),Pt.clear()}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch(e){return!1}}constructor(t){super(),this.zoneName=t,this.valid=Vt.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:e,locale:n}){return rn(t,e,n,this.name)}formatOffset(t,e){return ln(this.offset(t),e)}offset(t){if(!this.valid)return NaN;const e=new Date(t);if(isNaN(e))return NaN;const n=function(t){let e=Pt.get(t);return void 0===e&&(e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),Pt.set(t,e)),e}(this.name);let[r,i,s,o,a,l,u]=n.formatToParts?function(t,e){const n=t.formatToParts(e),r=[];for(let i=0;i<n.length;i++){const{type:t,value:e}=n[i],s=$t[t];"era"===t?r[s]=e:Re(s)||(r[s]=parseInt(e,10))}return r}(n,e):function(t,e){const n=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,i,s,o,a,l,u,c]=r;return[o,i,s,a,l,u,c]}(n,e);"BC"===o&&(r=1-Math.abs(r));let c=+e;const d=c%1e3;return c-=d>=0?d:1e3+d,(Xe({year:r,month:i,day:s,hour:24===a?0:a,minute:l,second:u,millisecond:0})-c)/6e4}equals(t){return"iana"===t.type&&t.name===this.name}get isValid(){return this.valid}}let qt={};const Gt=new Map;function zt(t,e={}){const n=JSON.stringify([t,e]);let r=Gt.get(n);return void 0===r&&(r=new Intl.DateTimeFormat(t,e),Gt.set(n,r)),r}const jt=new Map;const Wt=new Map;let Zt=null;const Yt=new Map;function Jt(t){let e=Yt.get(t);return void 0===e&&(e=new Intl.DateTimeFormat(t).resolvedOptions(),Yt.set(t,e)),e}const Ht=new Map;function Qt(t,e,n,r){const i=t.listingMode();return"error"===i?null:"en"===i?n(e):r(e)}class Kt{constructor(t,e,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:r,floor:i,...s}=n;if(!e||Object.keys(s).length>0){const e={useGrouping:!1,...n};n.padTo>0&&(e.minimumIntegerDigits=n.padTo),this.inf=function(t,e={}){const n=JSON.stringify([t,e]);let r=jt.get(n);return void 0===r&&(r=new Intl.NumberFormat(t,e),jt.set(n,r)),r}(t,e)}}format(t){if(this.inf){const e=this.floor?Math.floor(t):t;return this.inf.format(e)}return je(this.floor?Math.floor(t):Je(t,3),this.padTo)}}class Xt{constructor(t,e,n){let r;if(this.opts=n,this.originalZone=void 0,this.opts.timeZone)this.dt=t;else if("fixed"===t.zone.type){const e=t.offset/60*-1,n=e>=0?`Etc/GMT+${e}`:`Etc/GMT${e}`;0!==t.offset&&Vt.create(n).valid?(r=n,this.dt=t):(r="UTC",this.dt=0===t.offset?t:t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone)}else"system"===t.zone.type?this.dt=t:"iana"===t.zone.type?(this.dt=t,r=t.zone.name):(r="UTC",this.dt=t.setZone("UTC").plus({minutes:t.offset}),this.originalZone=t.zone);const i={...this.opts};i.timeZone=i.timeZone||r,this.dtf=zt(e,i)}format(){return this.originalZone?this.formatToParts().map(({value:t})=>t).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const t=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?t.map(t=>{if("timeZoneName"===t.type){const e=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...t,value:e}}return t}):t}resolvedOptions(){return this.dtf.resolvedOptions()}}class te{constructor(t,e,n){this.opts={style:"long",...n},!e&&$e()&&(this.rtf=function(t,e={}){const{base:n,...r}=e,i=JSON.stringify([t,r]);let s=Wt.get(i);return void 0===s&&(s=new Intl.RelativeTimeFormat(t,e),Wt.set(i,s)),s}(t,n))}format(t,e){return this.rtf?this.rtf.format(t,e):function(t,e,n="always",r=!1){const i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=-1===["hours","minutes","seconds"].indexOf(t);if("auto"===n&&s){const n="days"===t;switch(e){case 1:return n?"tomorrow":`next ${i[t][0]}`;case-1:return n?"yesterday":`last ${i[t][0]}`;case 0:return n?"today":`this ${i[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=1===a,u=i[t],c=r?l?u[1]:u[2]||u[1]:l?i[t][0]:t;return o?`${a} ${c} ago`:`in ${a} ${c}`}(e,t,this.opts.numeric,"long"!==this.opts.style)}formatToParts(t,e){return this.rtf?this.rtf.formatToParts(t,e):[]}}const ee={firstDay:1,minimalDays:4,weekend:[6,7]};class ne{static fromOpts(t){return ne.create(t.locale,t.numberingSystem,t.outputCalendar,t.weekSettings,t.defaultToEN)}static create(t,e,n,r,i=!1){const s=t||be.defaultLocale,o=s||(i?"en-US":Zt||(Zt=(new Intl.DateTimeFormat).resolvedOptions().locale,Zt)),a=e||be.defaultNumberingSystem,l=n||be.defaultOutputCalendar,u=Ge(r)||be.defaultWeekSettings;return new ne(o,a,l,u,s)}static resetCache(){Zt=null,Gt.clear(),jt.clear(),Wt.clear(),Yt.clear(),Ht.clear()}static fromObject({locale:t,numberingSystem:e,outputCalendar:n,weekSettings:r}={}){return ne.create(t,e,n,r)}constructor(t,e,n,r,i){const[s,o,a]=function(t){const e=t.indexOf("-x-");-1!==e&&(t=t.substring(0,e));const n=t.indexOf("-u-");if(-1===n)return[t];{let e,i;try{e=zt(t).resolvedOptions(),i=t}catch(r){const s=t.substring(0,n);e=zt(s).resolvedOptions(),i=s}const{numberingSystem:s,calendar:o}=e;return[i,s,o]}}(t);this.locale=s,this.numberingSystem=e||o||null,this.outputCalendar=n||a||null,this.weekSettings=r,this.intl=function(t,e,n){return n||e?(t.includes("-u-")||(t+="-u"),n&&(t+=`-ca-${n}`),e&&(t+=`-nu-${e}`),t):t}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=i,this.fastNumbersCached=null}get fastNumbers(){var t;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(t=this).numberingSystem||"latn"===t.numberingSystem)&&("latn"===t.numberingSystem||!t.locale||t.locale.startsWith("en")||"latn"===Jt(t.locale).numberingSystem)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),e=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return t&&e?"en":"intl"}clone(t){return t&&0!==Object.getOwnPropertyNames(t).length?ne.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,Ge(t.weekSettings)||this.weekSettings,t.defaultToEN||!1):this}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,e=!1){return Qt(this,t,hn,()=>{const n="ja"===this.intl||this.intl.startsWith("ja-"),r=(e&=!n)?{month:t,day:"numeric"}:{month:t},i=e?"format":"standalone";if(!this.monthsCache[i][t]){const e=n?t=>this.dtFormatter(t,r).format():t=>this.extract(t,r,"month");this.monthsCache[i][t]=function(t){const e=[];for(let n=1;n<=12;n++){const r=wi.utc(2009,n,1);e.push(t(r))}return e}(e)}return this.monthsCache[i][t]})}weekdays(t,e=!1){return Qt(this,t,yn,()=>{const n=e?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},r=e?"format":"standalone";return this.weekdaysCache[r][t]||(this.weekdaysCache[r][t]=function(t){const e=[];for(let n=1;n<=7;n++){const r=wi.utc(2016,11,13+n);e.push(t(r))}return e}(t=>this.extract(t,n,"weekday"))),this.weekdaysCache[r][t]})}meridiems(){return Qt(this,void 0,()=>wn,()=>{if(!this.meridiemCache){const t={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[wi.utc(2016,11,13,9),wi.utc(2016,11,13,19)].map(e=>this.extract(e,t,"dayperiod"))}return this.meridiemCache})}eras(t){return Qt(this,t,xn,()=>{const e={era:t};return this.eraCache[t]||(this.eraCache[t]=[wi.utc(-40,1,1),wi.utc(2017,1,1)].map(t=>this.extract(t,e,"era"))),this.eraCache[t]})}extract(t,e,n){const r=this.dtFormatter(t,e).formatToParts().find(t=>t.type.toLowerCase()===n);return r?r.value:null}numberFormatter(t={}){return new Kt(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,e={}){return new Xt(t,this.intl,e)}relFormatter(t={}){return new te(this.intl,this.isEnglish(),t)}listFormatter(t={}){return function(t,e={}){const n=JSON.stringify([t,e]);let r=qt[n];return r||(r=new Intl.ListFormat(t,e),qt[n]=r),r}(this.intl,t)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||Jt(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:Ue()?function(t){let e=Ht.get(t);if(!e){const n=new Intl.Locale(t);e="getWeekInfo"in n?n.getWeekInfo():n.weekInfo,"minimalDays"in e||(e={...ee,...e}),Ht.set(t,e)}return e}(this.locale):ee}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let re=null;class ie extends At{static get utcInstance(){return null===re&&(re=new ie(0)),re}static instance(t){return 0===t?ie.utcInstance:new ie(t)}static parseSpecifier(t){if(t){const e=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(e)return new ie(sn(e[1],e[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${ln(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${ln(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,e){return ln(this.fixed,e)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return"fixed"===t.type&&t.fixed===this.fixed}get isValid(){return!0}}class se extends At{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function oe(t,e){if(Re(t)||null===t)return e;if(t instanceof At)return t;if("string"==typeof t){const n=t.toLowerCase();return"default"===n?e:"local"===n||"system"===n?Ft.instance:"utc"===n||"gmt"===n?ie.utcInstance:ie.parseSpecifier(n)||Vt.create(t)}return Fe(t)?ie.instance(t):"object"==typeof t&&"offset"in t&&"function"==typeof t.offset?t:new se(t)}const ae={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},le={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},ue=ae.hanidec.replace(/[\[|\]]/g,"").split("");const ce=new Map;function de({numberingSystem:t},e=""){const n=t||"latn";let r=ce.get(n);void 0===r&&(r=new Map,ce.set(n,r));let i=r.get(e);return void 0===i&&(i=new RegExp(`${ae[n]}${e}`),r.set(e,i)),i}let fe,he=()=>Date.now(),me="system",pe=null,ge=null,ye=null,we=60,ve=null;class be{static get now(){return he}static set now(t){he=t}static set defaultZone(t){me=t}static get defaultZone(){return oe(me,Ft.instance)}static get defaultLocale(){return pe}static set defaultLocale(t){pe=t}static get defaultNumberingSystem(){return ge}static set defaultNumberingSystem(t){ge=t}static get defaultOutputCalendar(){return ye}static set defaultOutputCalendar(t){ye=t}static get defaultWeekSettings(){return ve}static set defaultWeekSettings(t){ve=Ge(t)}static get twoDigitCutoffYear(){return we}static set twoDigitCutoffYear(t){we=t%100}static get throwOnInvalid(){return fe}static set throwOnInvalid(t){fe=t}static resetCaches(){ne.resetCache(),Vt.resetCache(),wi.resetCache(),ce.clear()}}class _e{constructor(t,e){this.reason=t,this.explanation=e}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const xe=[0,31,59,90,120,151,181,212,243,273,304,334],Se=[0,31,60,91,121,152,182,213,244,274,305,335];function Te(t,e){return new _e("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function Ee(t,e,n){const r=new Date(Date.UTC(t,e-1,n));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const i=r.getUTCDay();return 0===i?7:i}function De(t,e,n){return n+(He(t)?Se:xe)[e-1]}function Ie(t,e){const n=He(t)?Se:xe,r=n.findIndex(t=>t<e);return{month:r+1,day:e-n[r]}}function Oe(t,e){return(t-e+7)%7+1}function Ce(t,e=4,n=1){const{year:r,month:i,day:s}=t,o=De(r,i,s),a=Oe(Ee(r,i,s),n);let l,u=Math.floor((o-a+14-e)/7);return u<1?(l=r-1,u=en(l,e,n)):u>en(r,e,n)?(l=r+1,u=1):l=r,{weekYear:l,weekNumber:u,weekday:a,...un(t)}}function Ne(t,e=4,n=1){const{weekYear:r,weekNumber:i,weekday:s}=t,o=Oe(Ee(r,1,e),n),a=Qe(r);let l,u=7*i+s-o-7+e;u<1?(l=r-1,u+=Qe(l)):u>a?(l=r+1,u-=Qe(r)):l=r;const{month:c,day:d}=Ie(l,u);return{year:l,month:c,day:d,...un(t)}}function ke(t){const{year:e,month:n,day:r}=t;return{year:e,ordinal:De(e,n,r),...un(t)}}function Me(t){const{year:e,ordinal:n}=t,{month:r,day:i}=Ie(e,n);return{year:e,month:r,day:i,...un(t)}}function Be(t,e){if(!Re(t.localWeekday)||!Re(t.localWeekNumber)||!Re(t.localWeekYear)){if(!Re(t.weekday)||!Re(t.weekNumber)||!Re(t.weekYear))throw new ot("Cannot mix locale-based week fields with ISO-based week fields");return Re(t.localWeekday)||(t.weekday=t.localWeekday),Re(t.localWeekNumber)||(t.weekNumber=t.localWeekNumber),Re(t.localWeekYear)||(t.weekYear=t.localWeekYear),delete t.localWeekday,delete t.localWeekNumber,delete t.localWeekYear,{minDaysInFirstWeek:e.getMinDaysInFirstWeek(),startOfWeek:e.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function Le(t){const e=Pe(t.year),n=ze(t.month,1,12),r=ze(t.day,1,Ke(t.year,t.month));return e?n?!r&&Te("day",t.day):Te("month",t.month):Te("year",t.year)}function Ae(t){const{hour:e,minute:n,second:r,millisecond:i}=t,s=ze(e,0,23)||24===e&&0===n&&0===r&&0===i,o=ze(n,0,59),a=ze(r,0,59),l=ze(i,0,999);return s?o?a?!l&&Te("millisecond",i):Te("second",r):Te("minute",n):Te("hour",e)}function Re(t){return void 0===t}function Fe(t){return"number"==typeof t}function Pe(t){return"number"==typeof t&&t%1==0}function $e(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(t){return!1}}function Ue(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(t){return!1}}function Ve(t,e,n){if(0!==t.length)return t.reduce((t,r)=>{const i=[e(r),r];return t&&n(t[0],i[0])===t[0]?t:i},null)[1]}function qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ge(t){if(null==t)return null;if("object"!=typeof t)throw new lt("Week settings must be an object");if(!ze(t.firstDay,1,7)||!ze(t.minimalDays,1,7)||!Array.isArray(t.weekend)||t.weekend.some(t=>!ze(t,1,7)))throw new lt("Invalid week settings");return{firstDay:t.firstDay,minimalDays:t.minimalDays,weekend:Array.from(t.weekend)}}function ze(t,e,n){return Pe(t)&&t>=e&&t<=n}function je(t,e=2){let n;return n=t<0?"-"+(""+-t).padStart(e,"0"):(""+t).padStart(e,"0"),n}function We(t){return Re(t)||null===t||""===t?void 0:parseInt(t,10)}function Ze(t){return Re(t)||null===t||""===t?void 0:parseFloat(t)}function Ye(t){if(!Re(t)&&null!==t&&""!==t){const e=1e3*parseFloat("0."+t);return Math.floor(e)}}function Je(t,e,n="round"){const r=10**e;switch(n){case"expand":return t>0?Math.ceil(t*r)/r:Math.floor(t*r)/r;case"trunc":return Math.trunc(t*r)/r;case"round":return Math.round(t*r)/r;case"floor":return Math.floor(t*r)/r;case"ceil":return Math.ceil(t*r)/r;default:throw new RangeError(`Value rounding ${n} is out of range`)}}function He(t){return t%4==0&&(t%100!=0||t%400==0)}function Qe(t){return He(t)?366:365}function Ke(t,e){const n=(r=e-1)-(i=12)*Math.floor(r/i)+1;var r,i;return 2===n?He(t+(e-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function Xe(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function tn(t,e,n){return-Oe(Ee(t,1,e),n)+e-1}function en(t,e=4,n=1){const r=tn(t,e,n),i=tn(t+1,e,n);return(Qe(t)-r+i)/7}function nn(t){return t>99?t:t>be.twoDigitCutoffYear?1900+t:2e3+t}function rn(t,e,n,r=null){const i=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(n,o).formatToParts(i).find(t=>"timezonename"===t.type.toLowerCase());return a?a.value:null}function sn(t,e){let n=parseInt(t,10);Number.isNaN(n)&&(n=0);const r=parseInt(e,10)||0;return 60*n+(n<0||Object.is(n,-0)?-r:r)}function on(t){const e=Number(t);if("boolean"==typeof t||""===t||!Number.isFinite(e))throw new lt(`Invalid unit value ${t}`);return e}function an(t,e){const n={};for(const r in t)if(qe(t,r)){const i=t[r];if(null==i)continue;n[e(r)]=on(i)}return n}function ln(t,e){const n=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),i=t>=0?"+":"-";switch(e){case"short":return`${i}${je(n,2)}:${je(r,2)}`;case"narrow":return`${i}${n}${r>0?`:${r}`:""}`;case"techie":return`${i}${je(n,2)}${je(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function un(t){return function(t,e){return e.reduce((e,n)=>(e[n]=t[n],e),{})}(t,["hour","minute","second","millisecond"])}const cn=["January","February","March","April","May","June","July","August","September","October","November","December"],dn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fn=["J","F","M","A","M","J","J","A","S","O","N","D"];function hn(t){switch(t){case"narrow":return[...fn];case"short":return[...dn];case"long":return[...cn];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const mn=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],pn=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],gn=["M","T","W","T","F","S","S"];function yn(t){switch(t){case"narrow":return[...gn];case"short":return[...pn];case"long":return[...mn];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const wn=["AM","PM"],vn=["Before Christ","Anno Domini"],bn=["BC","AD"],_n=["B","A"];function xn(t){switch(t){case"narrow":return[..._n];case"short":return[...bn];case"long":return[...vn];default:return null}}function Sn(t,e){let n="";for(const r of t)r.literal?n+=r.val:n+=e(r.val);return n}const Tn={D:ht,DD:mt,DDD:gt,DDDD:yt,t:wt,tt:vt,ttt:bt,tttt:_t,T:xt,TT:St,TTT:Tt,TTTT:Et,f:Dt,ff:Ot,fff:kt,ffff:Bt,F:It,FF:Ct,FFF:Mt,FFFF:Lt};class En{static create(t,e={}){return new En(t,e)}static parseFormat(t){let e=null,n="",r=!1;const i=[];for(let s=0;s<t.length;s++){const o=t.charAt(s);"'"===o?((n.length>0||r)&&i.push({literal:r||/^\s+$/.test(n),val:""===n?"'":n}),e=null,n="",r=!r):r||o===e?n+=o:(n.length>0&&i.push({literal:/^\s+$/.test(n),val:n}),n=o,e=o)}return n.length>0&&i.push({literal:r||/^\s+$/.test(n),val:n}),i}static macroTokenToFormatOpts(t){return Tn[t]}constructor(t,e){this.opts=e,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,e){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(t,{...this.opts,...e}).format()}dtFormatter(t,e={}){return this.loc.dtFormatter(t,{...this.opts,...e})}formatDateTime(t,e){return this.dtFormatter(t,e).format()}formatDateTimeParts(t,e){return this.dtFormatter(t,e).formatToParts()}formatInterval(t,e){return this.dtFormatter(t.start,e).dtf.formatRange(t.start.toJSDate(),t.end.toJSDate())}resolvedOptions(t,e){return this.dtFormatter(t,e).resolvedOptions()}num(t,e=0,n=void 0){if(this.opts.forceSimple)return je(t,e);const r={...this.opts};return e>0&&(r.padTo=e),n&&(r.signDisplay=n),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,e){const n="en"===this.loc.listingMode(),r=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,i=(e,n)=>this.loc.extract(t,e,n),s=e=>t.isOffsetFixed&&0===t.offset&&e.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,e.format):"",o=()=>n?function(t){return wn[t.hour<12?0:1]}(t):i({hour:"numeric",hourCycle:"h12"},"dayperiod"),a=(e,r)=>n?function(t,e){return hn(e)[t.month-1]}(t,e):i(r?{month:e}:{month:e,day:"numeric"},"month"),l=(e,r)=>n?function(t,e){return yn(e)[t.weekday-1]}(t,e):i(r?{weekday:e}:{weekday:e,month:"long",day:"numeric"},"weekday"),u=e=>{const n=En.macroTokenToFormatOpts(e);return n?this.formatWithSystemDefault(t,n):e},c=e=>n?function(t,e){return xn(e)[t.year<0?0:1]}(t,e):i({era:e},"era");return Sn(En.parseFormat(e),e=>{switch(e){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12==0?12:t.hour%12);case"hh":return this.num(t.hour%12==0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return s({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return s({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return s({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return o();case"d":return r?i({day:"numeric"},"day"):this.num(t.day);case"dd":return r?i({day:"2-digit"},"day"):this.num(t.day,2);case"c":case"E":return this.num(t.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return r?i({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return r?i({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return a("short",!0);case"LLLL":return a("long",!0);case"LLLLL":return a("narrow",!0);case"M":return r?i({month:"numeric"},"month"):this.num(t.month);case"MM":return r?i({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return a("short",!1);case"MMMM":return a("long",!1);case"MMMMM":return a("narrow",!1);case"y":return r?i({year:"numeric"},"year"):this.num(t.year);case"yy":return r?i({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return r?i({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return r?i({year:"numeric"},"year"):this.num(t.year,6);case"G":return c("short");case"GG":return c("long");case"GGGGG":return c("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"n":return this.num(t.localWeekNumber);case"nn":return this.num(t.localWeekNumber,2);case"ii":return this.num(t.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(t.localWeekYear,4);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return u(e)}})}formatDurationFromString(t,e){const n="negativeLargestOnly"===this.opts.signMode?-1:1,r=t=>{switch(t[0]){case"S":return"milliseconds";case"s":return"seconds";case"m":return"minutes";case"h":return"hours";case"d":return"days";case"w":return"weeks";case"M":return"months";case"y":return"years";default:return null}},i=En.parseFormat(e),s=i.reduce((t,{literal:e,val:n})=>e?t:t.concat(n),[]),o=t.shiftTo(...s.map(r).filter(t=>t));return Sn(i,((t,e)=>i=>{const s=r(i);if(s){const r=e.isNegativeDuration&&s!==e.largestUnit?n:1;let o;return o="negativeLargestOnly"===this.opts.signMode&&s!==e.largestUnit?"never":"all"===this.opts.signMode?"always":"auto",this.num(t.get(s)*r,i.length,o)}return i})(o,{isNegativeDuration:o<0,largestUnit:Object.keys(o.values)[0]}))}}const Dn=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function In(...t){const e=t.reduce((t,e)=>t+e.source,"");return RegExp(`^${e}$`)}function On(...t){return e=>t.reduce(([t,n,r],i)=>{const[s,o,a]=i(e,r);return[{...t,...s},o||n,a]},[{},null,1]).slice(0,2)}function Cn(t,...e){if(null==t)return[null,null];for(const[n,r]of e){const e=n.exec(t);if(e)return r(e)}return[null,null]}function Nn(...t){return(e,n)=>{const r={};let i;for(i=0;i<t.length;i++)r[t[i]]=We(e[n+i]);return[r,null,n+i]}}const kn=/(?:([Zz])|([+-]\d\d)(?::?(\d\d))?)/,Mn=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Bn=RegExp(`${Mn.source}${`(?:${kn.source}?(?:\\[(${Dn.source})\\])?)?`}`),Ln=RegExp(`(?:[Tt]${Bn.source})?`),An=Nn("weekYear","weekNumber","weekDay"),Rn=Nn("year","ordinal"),Fn=RegExp(`${Mn.source} ?(?:${kn.source}|(${Dn.source}))?`),Pn=RegExp(`(?: ${Fn.source})?`);function $n(t,e,n){const r=t[e];return Re(r)?n:We(r)}function Un(t,e){return[{hours:$n(t,e,0),minutes:$n(t,e+1,0),seconds:$n(t,e+2,0),milliseconds:Ye(t[e+3])},null,e+4]}function Vn(t,e){const n=!t[e]&&!t[e+1],r=sn(t[e+1],t[e+2]);return[{},n?null:ie.instance(r),e+3]}function qn(t,e){return[{},t[e]?Vt.create(t[e]):null,e+1]}const Gn=RegExp(`^T?${Mn.source}$`),zn=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function jn(t){const[e,n,r,i,s,o,a,l,u]=t,c="-"===e[0],d=l&&"-"===l[0],f=(t,e=!1)=>void 0!==t&&(e||t&&c)?-t:t;return[{years:f(Ze(n)),months:f(Ze(r)),weeks:f(Ze(i)),days:f(Ze(s)),hours:f(Ze(o)),minutes:f(Ze(a)),seconds:f(Ze(l),"-0"===l),milliseconds:f(Ye(u),d)}]}const Wn={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Zn(t,e,n,r,i,s,o){const a={year:2===e.length?nn(We(e)):We(e),month:dn.indexOf(n)+1,day:We(r),hour:We(i),minute:We(s)};return o&&(a.second=We(o)),t&&(a.weekday=t.length>3?mn.indexOf(t)+1:pn.indexOf(t)+1),a}const Yn=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Jn(t){const[,e,n,r,i,s,o,a,l,u,c,d]=t,f=Zn(e,i,r,n,s,o,a);let h;return h=l?Wn[l]:u?0:sn(c,d),[f,new ie(h)]}const Hn=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Qn=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Kn=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Xn(t){const[,e,n,r,i,s,o,a]=t;return[Zn(e,i,r,n,s,o,a),ie.utcInstance]}function tr(t){const[,e,n,r,i,s,o,a]=t;return[Zn(e,a,n,r,i,s,o),ie.utcInstance]}const er=In(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Ln),nr=In(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Ln),rr=In(/(\d{4})-?(\d{3})/,Ln),ir=In(Bn),sr=On(function(t,e){return[{year:$n(t,e),month:$n(t,e+1,1),day:$n(t,e+2,1)},null,e+3]},Un,Vn,qn),or=On(An,Un,Vn,qn),ar=On(Rn,Un,Vn,qn),lr=On(Un,Vn,qn);const ur=On(Un);const cr=In(/(\d{4})-(\d\d)-(\d\d)/,Pn),dr=In(Fn),fr=On(Un,Vn,qn);const hr="Invalid Duration",mr={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},pr={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...mr},gr=365.2425,yr=30.436875,wr={years:{quarters:4,months:12,weeks:52.1775,days:gr,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:yr,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...mr},vr=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],br=vr.slice(0).reverse();function _r(t,e,n=!1){const r={values:n?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Er(r)}function xr(t,e){let n=e.milliseconds??0;for(const r of br.slice(1))e[r]&&(n+=e[r]*t[r].milliseconds);return n}function Sr(t,e){const n=xr(t,e)<0?-1:1;vr.reduceRight((r,i)=>{if(Re(e[i]))return r;if(r){const s=e[r]*n,o=t[i][r],a=Math.floor(s/o);e[i]+=a*n,e[r]-=a*o*n}return i},null),vr.reduce((n,r)=>{if(Re(e[r]))return n;if(n){const i=e[n]%1;e[n]-=i,e[r]+=i*t[n][r]}return r},null)}function Tr(t){const e={};for(const[n,r]of Object.entries(t))0!==r&&(e[n]=r);return e}class Er{constructor(t){const e="longterm"===t.conversionAccuracy||!1;let n=e?wr:pr;t.matrix&&(n=t.matrix),this.values=t.values,this.loc=t.loc||ne.create(),this.conversionAccuracy=e?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=n,this.isLuxonDuration=!0}static fromMillis(t,e){return Er.fromObject({milliseconds:t},e)}static fromObject(t,e={}){if(null==t||"object"!=typeof t)throw new lt("Duration.fromObject: argument expected to be an object, got "+(null===t?"null":typeof t));return new Er({values:an(t,Er.normalizeUnit),loc:ne.fromObject(e),conversionAccuracy:e.conversionAccuracy,matrix:e.matrix})}static fromDurationLike(t){if(Fe(t))return Er.fromMillis(t);if(Er.isDuration(t))return t;if("object"==typeof t)return Er.fromObject(t);throw new lt(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,e){const[n]=Cn(t,[zn,jn]);return n?Er.fromObject(n,e):Er.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,e){const[n]=Cn(t,[Gn,ur]);return n?Er.fromObject(n,e):Er.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,e=null){if(!t)throw new lt("need to specify a reason the Duration is invalid");const n=t instanceof _e?t:new _e(t,e);if(be.throwOnInvalid)throw new st(n);return new Er({invalid:n})}static normalizeUnit(t){const e={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t?t.toLowerCase():t];if(!e)throw new at(t);return e}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,e={}){const n={...e,floor:!1!==e.round&&!1!==e.floor};return this.isValid?En.create(this.loc,n).formatDurationFromString(this,t):hr}toHuman(t={}){if(!this.isValid)return hr;const e=!1!==t.showZeros,n=vr.map(n=>{const r=this.values[n];return Re(r)||0===r&&!e?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:n.slice(0,-1)}).format(r)}).filter(t=>t);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(n)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return 0!==this.years&&(t+=this.years+"Y"),0===this.months&&0===this.quarters||(t+=this.months+3*this.quarters+"M"),0!==this.weeks&&(t+=this.weeks+"W"),0!==this.days&&(t+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(t+="T"),0!==this.hours&&(t+=this.hours+"H"),0!==this.minutes&&(t+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(t+=Je(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===t&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const e=this.toMillis();if(e<0||e>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t,includeOffset:!1};return wi.fromMillis(e,{zone:"UTC"}).toISOTime(t)}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?xr(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const e=Er.fromDurationLike(t),n={};for(const r of vr)(qe(e.values,r)||qe(this.values,r))&&(n[r]=e.get(r)+this.get(r));return _r(this,{values:n},!0)}minus(t){if(!this.isValid)return this;const e=Er.fromDurationLike(t);return this.plus(e.negate())}mapUnits(t){if(!this.isValid)return this;const e={};for(const n of Object.keys(this.values))e[n]=on(t(this.values[n],n));return _r(this,{values:e},!0)}get(t){return this[Er.normalizeUnit(t)]}set(t){if(!this.isValid)return this;return _r(this,{values:{...this.values,...an(t,Er.normalizeUnit)}})}reconfigure({locale:t,numberingSystem:e,conversionAccuracy:n,matrix:r}={}){return _r(this,{loc:this.loc.clone({locale:t,numberingSystem:e}),matrix:r,conversionAccuracy:n})}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return Sr(this.matrix,t),_r(this,{values:t},!0)}rescale(){if(!this.isValid)return this;return _r(this,{values:Tr(this.normalize().shiftToAll().toObject())},!0)}shiftTo(...t){if(!this.isValid)return this;if(0===t.length)return this;t=t.map(t=>Er.normalizeUnit(t));const e={},n={},r=this.toObject();let i;for(const s of vr)if(t.indexOf(s)>=0){i=s;let t=0;for(const e in n)t+=this.matrix[e][s]*n[e],n[e]=0;Fe(r[s])&&(t+=r[s]);const o=Math.trunc(t);e[s]=o,n[s]=(1e3*t-1e3*o)/1e3}else Fe(r[s])&&(n[s]=r[s]);for(const s in n)0!==n[s]&&(e[i]+=s===i?n[s]:n[s]/this.matrix[i][s]);return Sr(this.matrix,e),_r(this,{values:e},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const t={};for(const e of Object.keys(this.values))t[e]=0===this.values[e]?0:-this.values[e];return _r(this,{values:t},!0)}removeZeros(){if(!this.isValid)return this;return _r(this,{values:Tr(this.values)},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid)return!1;if(!this.loc.equals(t.loc))return!1;function e(t,e){return void 0===t||0===t?void 0===e||0===e:t===e}for(const n of vr)if(!e(this.values[n],t.values[n]))return!1;return!0}}const Dr="Invalid Interval";class Ir{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,e=null){if(!t)throw new lt("need to specify a reason the Interval is invalid");const n=t instanceof _e?t:new _e(t,e);if(be.throwOnInvalid)throw new it(n);return new Ir({invalid:n})}static fromDateTimes(t,e){const n=vi(t),r=vi(e),i=function(t,e){return t&&t.isValid?e&&e.isValid?e<t?Ir.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null:Ir.invalid("missing or invalid end"):Ir.invalid("missing or invalid start")}(n,r);return null==i?new Ir({start:n,end:r}):i}static after(t,e){const n=Er.fromDurationLike(e),r=vi(t);return Ir.fromDateTimes(r,r.plus(n))}static before(t,e){const n=Er.fromDurationLike(e),r=vi(t);return Ir.fromDateTimes(r.minus(n),r)}static fromISO(t,e){const[n,r]=(t||"").split("/",2);if(n&&r){let t,s,o,a;try{t=wi.fromISO(n,e),s=t.isValid}catch(i){s=!1}try{o=wi.fromISO(r,e),a=o.isValid}catch(i){a=!1}if(s&&a)return Ir.fromDateTimes(t,o);if(s){const n=Er.fromISO(r,e);if(n.isValid)return Ir.after(t,n)}else if(a){const t=Er.fromISO(n,e);if(t.isValid)return Ir.before(o,t)}}return Ir.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds",e){if(!this.isValid)return NaN;const n=this.start.startOf(t,e);let r;return r=e?.useLocaleWeeks?this.end.reconfigure({locale:n.locale}):this.end,r=r.startOf(t,e),Math.floor(r.diff(n,t).get(t))+(r.valueOf()!==this.end.valueOf())}hasSame(t){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,t))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return!!this.isValid&&this.s>t}isBefore(t){return!!this.isValid&&this.e<=t}contains(t){return!!this.isValid&&(this.s<=t&&this.e>t)}set({start:t,end:e}={}){return this.isValid?Ir.fromDateTimes(t||this.s,e||this.e):this}splitAt(...t){if(!this.isValid)return[];const e=t.map(vi).filter(t=>this.contains(t)).sort((t,e)=>t.toMillis()-e.toMillis()),n=[];let{s:r}=this,i=0;for(;r<this.e;){const t=e[i]||this.e,s=+t>+this.e?this.e:t;n.push(Ir.fromDateTimes(r,s)),r=s,i+=1}return n}splitBy(t){const e=Er.fromDurationLike(t);if(!this.isValid||!e.isValid||0===e.as("milliseconds"))return[];let n,{s:r}=this,i=1;const s=[];for(;r<this.e;){const t=this.start.plus(e.mapUnits(t=>t*i));n=+t>+this.e?this.e:t,s.push(Ir.fromDateTimes(r,n)),r=n,i+=1}return s}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return!!this.isValid&&+this.e===+t.s}abutsEnd(t){return!!this.isValid&&+t.e===+this.s}engulfs(t){return!!this.isValid&&(this.s<=t.s&&this.e>=t.e)}equals(t){return!(!this.isValid||!t.isValid)&&(this.s.equals(t.s)&&this.e.equals(t.e))}intersection(t){if(!this.isValid)return this;const e=this.s>t.s?this.s:t.s,n=this.e<t.e?this.e:t.e;return e>=n?null:Ir.fromDateTimes(e,n)}union(t){if(!this.isValid)return this;const e=this.s<t.s?this.s:t.s,n=this.e>t.e?this.e:t.e;return Ir.fromDateTimes(e,n)}static merge(t){const[e,n]=t.sort((t,e)=>t.s-e.s).reduce(([t,e],n)=>e?e.overlaps(n)||e.abutsStart(n)?[t,e.union(n)]:[t.concat([e]),n]:[t,n],[[],null]);return n&&e.push(n),e}static xor(t){let e=null,n=0;const r=[],i=t.map(t=>[{time:t.s,type:"s"},{time:t.e,type:"e"}]),s=Array.prototype.concat(...i).sort((t,e)=>t.time-e.time);for(const o of s)n+="s"===o.type?1:-1,1===n?e=o.time:(e&&+e!==+o.time&&r.push(Ir.fromDateTimes(e,o.time)),e=null);return Ir.merge(r)}difference(...t){return Ir.xor([this].concat(t)).map(t=>this.intersection(t)).filter(t=>t&&!t.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Dr}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(t=ht,e={}){return this.isValid?En.create(this.s.loc.clone(e),t).formatInterval(this):Dr}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:Dr}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Dr}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:Dr}toFormat(t,{separator:e=" – "}={}){return this.isValid?`${this.s.toFormat(t)}${e}${this.e.toFormat(t)}`:Dr}toDuration(t,e){return this.isValid?this.e.diff(this.s,t,e):Er.invalid(this.invalidReason)}mapEndpoints(t){return Ir.fromDateTimes(t(this.s),t(this.e))}}class Or{static hasDST(t=be.defaultZone){const e=wi.now().setZone(t).set({month:12});return!t.isUniversal&&e.offset!==e.set({month:6}).offset}static isValidIANAZone(t){return Vt.isValidZone(t)}static normalizeZone(t){return oe(t,be.defaultZone)}static getStartOfWeek({locale:t=null,locObj:e=null}={}){return(e||ne.create(t)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:t=null,locObj:e=null}={}){return(e||ne.create(t)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:t=null,locObj:e=null}={}){return(e||ne.create(t)).getWeekendDays().slice()}static months(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null,outputCalendar:i="gregory"}={}){return(r||ne.create(e,n,i)).months(t)}static monthsFormat(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null,outputCalendar:i="gregory"}={}){return(r||ne.create(e,n,i)).months(t,!0)}static weekdays(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null}={}){return(r||ne.create(e,n,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:e=null,numberingSystem:n=null,locObj:r=null}={}){return(r||ne.create(e,n,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return ne.create(t).meridiems()}static eras(t="short",{locale:e=null}={}){return ne.create(e,null,"gregory").eras(t)}static features(){return{relative:$e(),localeWeek:Ue()}}}function Cr(t,e){const n=t=>t.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=n(e)-n(t);return Math.floor(Er.fromMillis(r).as("days"))}function Nr(t,e,n,r){let[i,s,o,a]=function(t,e,n){const r=[["years",(t,e)=>e.year-t.year],["quarters",(t,e)=>e.quarter-t.quarter+4*(e.year-t.year)],["months",(t,e)=>e.month-t.month+12*(e.year-t.year)],["weeks",(t,e)=>{const n=Cr(t,e);return(n-n%7)/7}],["days",Cr]],i={},s=t;let o,a;for(const[l,u]of r)n.indexOf(l)>=0&&(o=l,i[l]=u(t,e),a=s.plus(i),a>e?(i[l]--,(t=s.plus(i))>e&&(a=t,i[l]--,t=s.plus(i))):t=a);return[t,i,a,o]}(t,e,n);const l=e-i,u=n.filter(t=>["hours","minutes","seconds","milliseconds"].indexOf(t)>=0);0===u.length&&(o<e&&(o=i.plus({[a]:1})),o!==i&&(s[a]=(s[a]||0)+l/(o-i)));const c=Er.fromObject(s,r);return u.length>0?Er.fromMillis(l,r).shiftTo(...u).plus(c):c}function kr(t,e=t=>t){return{regex:t,deser:([t])=>e(function(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);if(-1!==t[n].search(ae.hanidec))e+=ue.indexOf(t[n]);else for(const t in le){const[n,i]=le[t];r>=n&&r<=i&&(e+=r-n)}}return parseInt(e,10)}return e}(t))}}const Mr=`[ ${String.fromCharCode(160)}]`,Br=new RegExp(Mr,"g");function Lr(t){return t.replace(/\./g,"\\.?").replace(Br,Mr)}function Ar(t){return t.replace(/\./g,"").replace(Br," ").toLowerCase()}function Rr(t,e){return null===t?null:{regex:RegExp(t.map(Lr).join("|")),deser:([n])=>t.findIndex(t=>Ar(n)===Ar(t))+e}}function Fr(t,e){return{regex:t,deser:([,t,e])=>sn(t,e),groups:e}}function Pr(t){return{regex:t,deser:([t])=>t}}const $r={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let Ur=null;function Vr(t,e){return Array.prototype.concat(...t.map(t=>function(t,e){if(t.literal)return t;const n=zr(En.macroTokenToFormatOpts(t.val),e);return null==n||n.includes(void 0)?t:n}(t,e)))}class qr{constructor(t,e){if(this.locale=t,this.format=e,this.tokens=Vr(En.parseFormat(e),t),this.units=this.tokens.map(e=>function(t,e){const n=de(e),r=de(e,"{2}"),i=de(e,"{3}"),s=de(e,"{4}"),o=de(e,"{6}"),a=de(e,"{1,2}"),l=de(e,"{1,3}"),u=de(e,"{1,6}"),c=de(e,"{1,9}"),d=de(e,"{2,4}"),f=de(e,"{4,6}"),h=t=>{return{regex:RegExp((e=t.val,e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([t])=>t,literal:!0};var e},m=(m=>{if(t.literal)return h(m);switch(m.val){case"G":return Rr(e.eras("short"),0);case"GG":return Rr(e.eras("long"),0);case"y":return kr(u);case"yy":case"kk":return kr(d,nn);case"yyyy":case"kkkk":return kr(s);case"yyyyy":return kr(f);case"yyyyyy":return kr(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return kr(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return kr(r);case"MMM":return Rr(e.months("short",!0),1);case"MMMM":return Rr(e.months("long",!0),1);case"LLL":return Rr(e.months("short",!1),1);case"LLLL":return Rr(e.months("long",!1),1);case"o":case"S":return kr(l);case"ooo":case"SSS":return kr(i);case"u":return Pr(c);case"uu":return Pr(a);case"uuu":case"E":case"c":return kr(n);case"a":return Rr(e.meridiems(),0);case"EEE":return Rr(e.weekdays("short",!1),1);case"EEEE":return Rr(e.weekdays("long",!1),1);case"ccc":return Rr(e.weekdays("short",!0),1);case"cccc":return Rr(e.weekdays("long",!0),1);case"Z":case"ZZ":return Fr(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Fr(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return Pr(/[a-z_+-/]{1,256}?/i);case" ":return Pr(/[^\S\n\r]/);default:return h(m)}})(t)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return m.token=t,m}(e,t)),this.disqualifyingUnit=this.units.find(t=>t.invalidReason),!this.disqualifyingUnit){const[t,e]=[`^${(n=this.units).map(t=>t.regex).reduce((t,e)=>`${t}(${e.source})`,"")}$`,n];this.regex=RegExp(t,"i"),this.handlers=e}var n}explainFromTokens(t){if(this.isValid){const[e,n]=function(t,e,n){const r=t.match(e);if(r){const t={};let e=1;for(const i in n)if(qe(n,i)){const s=n[i],o=s.groups?s.groups+1:1;!s.literal&&s.token&&(t[s.token.val[0]]=s.deser(r.slice(e,e+o))),e+=o}return[r,t]}return[r,{}]}(t,this.regex,this.handlers),[r,i,s]=n?function(t){let e,n=null;return Re(t.z)||(n=Vt.create(t.z)),Re(t.Z)||(n||(n=new ie(t.Z)),e=t.Z),Re(t.q)||(t.M=3*(t.q-1)+1),Re(t.h)||(t.h<12&&1===t.a?t.h+=12:12===t.h&&0===t.a&&(t.h=0)),0===t.G&&t.y&&(t.y=-t.y),Re(t.u)||(t.S=Ye(t.u)),[Object.keys(t).reduce((e,n)=>{const r=(t=>{switch(t){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return r&&(e[r]=t[n]),e},{}),n,e]}(n):[null,null,void 0];if(qe(n,"a")&&qe(n,"H"))throw new ot("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:this.tokens,regex:this.regex,rawMatches:e,matches:n,result:r,zone:i,specificOffset:s}}return{input:t,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function Gr(t,e,n){return new qr(t,n).explainFromTokens(e)}function zr(t,e){if(!t)return null;const n=En.create(e,t).dtFormatter((Ur||(Ur=wi.fromMillis(1555555555555)),Ur)),r=n.formatToParts(),i=n.resolvedOptions();return r.map(e=>function(t,e,n){const{type:r,value:i}=t;if("literal"===r){const t=/^\s+$/.test(i);return{literal:!t,val:t?" ":i}}const s=e[r];let o=r;"hour"===r&&(o=null!=e.hour12?e.hour12?"hour12":"hour24":null!=e.hourCycle?"h11"===e.hourCycle||"h12"===e.hourCycle?"hour12":"hour24":n.hour12?"hour12":"hour24");let a=$r[o];if("object"==typeof a&&(a=a[s]),a)return{literal:!1,val:a}}(e,t,i))}const jr="Invalid DateTime",Wr=864e13;function Zr(t){return new _e("unsupported zone",`the zone "${t.name}" is not supported`)}function Yr(t){return null===t.weekData&&(t.weekData=Ce(t.c)),t.weekData}function Jr(t){return null===t.localWeekData&&(t.localWeekData=Ce(t.c,t.loc.getMinDaysInFirstWeek(),t.loc.getStartOfWeek())),t.localWeekData}function Hr(t,e){const n={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new wi({...n,...e,old:n})}function Qr(t,e,n){let r=t-60*e*1e3;const i=n.offset(r);if(e===i)return[r,e];r-=60*(i-e)*1e3;const s=n.offset(r);return i===s?[r,i]:[t-60*Math.min(i,s)*1e3,Math.max(i,s)]}function Kr(t,e){const n=new Date(t+=60*e*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function Xr(t,e,n){return Qr(Xe(t),e,n)}function ti(t,e){const n=t.o,r=t.c.year+Math.trunc(e.years),i=t.c.month+Math.trunc(e.months)+3*Math.trunc(e.quarters),s={...t.c,year:r,month:i,day:Math.min(t.c.day,Ke(r,i))+Math.trunc(e.days)+7*Math.trunc(e.weeks)},o=Er.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Xe(s);let[l,u]=Qr(a,n,t.zone);return 0!==o&&(l+=o,u=t.zone.offset(l)),{ts:l,o:u}}function ei(t,e,n,r,i,s){const{setZone:o,zone:a}=n;if(t&&0!==Object.keys(t).length||e){const r=e||a,i=wi.fromObject(t,{...n,zone:r,specificOffset:s});return o?i:i.setZone(a)}return wi.invalid(new _e("unparsable",`the input "${i}" can't be parsed as ${r}`))}function ni(t,e,n=!0){return t.isValid?En.create(ne.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(t,e):null}function ri(t,e,n){const r=t.c.year>9999||t.c.year<0;let i="";if(r&&t.c.year>=0&&(i+="+"),i+=je(t.c.year,r?6:4),"year"===n)return i;if(e){if(i+="-",i+=je(t.c.month),"month"===n)return i;i+="-"}else if(i+=je(t.c.month),"month"===n)return i;return i+=je(t.c.day),i}function ii(t,e,n,r,i,s,o){let a=!n||0!==t.c.millisecond||0!==t.c.second,l="";switch(o){case"day":case"month":case"year":break;default:if(l+=je(t.c.hour),"hour"===o)break;if(e){if(l+=":",l+=je(t.c.minute),"minute"===o)break;a&&(l+=":",l+=je(t.c.second))}else{if(l+=je(t.c.minute),"minute"===o)break;a&&(l+=je(t.c.second))}if("second"===o)break;!a||r&&0===t.c.millisecond||(l+=".",l+=je(t.c.millisecond,3))}return i&&(t.isOffsetFixed&&0===t.offset&&!s?l+="Z":t.o<0?(l+="-",l+=je(Math.trunc(-t.o/60)),l+=":",l+=je(Math.trunc(-t.o%60))):(l+="+",l+=je(Math.trunc(t.o/60)),l+=":",l+=je(Math.trunc(t.o%60)))),s&&(l+="["+t.zone.ianaName+"]"),l}const si={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},oi={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},ai={ordinal:1,hour:0,minute:0,second:0,millisecond:0},li=["year","month","day","hour","minute","second","millisecond"],ui=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],ci=["year","ordinal","hour","minute","second","millisecond"];function di(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new at(t);return e}function fi(t){switch(t.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return di(t)}}function hi(t,e){const n=oe(e.zone,be.defaultZone);if(!n.isValid)return wi.invalid(Zr(n));const r=ne.fromObject(e);let i,s;if(Re(t.year))i=be.now();else{for(const n of li)Re(t[n])&&(t[n]=si[n]);const e=Le(t)||Ae(t);if(e)return wi.invalid(e);const r=function(t){if(void 0===gi&&(gi=be.now()),"iana"!==t.type)return t.offset(gi);const e=t.name;let n=yi.get(e);return void 0===n&&(n=t.offset(gi),yi.set(e,n)),n}(n);[i,s]=Xr(t,r,n)}return new wi({ts:i,zone:n,loc:r,o:s})}function mi(t,e,n){const r=!!Re(n.round)||n.round,i=Re(n.rounding)?"trunc":n.rounding,s=(t,s)=>{t=Je(t,r||n.calendary?0:2,n.calendary?"round":i);return e.loc.clone(n).relFormatter(n).format(t,s)},o=r=>n.calendary?e.hasSame(t,r)?0:e.startOf(r).diff(t.startOf(r),r).get(r):e.diff(t,r).get(r);if(n.unit)return s(o(n.unit),n.unit);for(const a of n.units){const t=o(a);if(Math.abs(t)>=1)return s(t,a)}return s(t>e?-0:0,n.units[n.units.length-1])}function pi(t){let e,n={};return t.length>0&&"object"==typeof t[t.length-1]?(n=t[t.length-1],e=Array.from(t).slice(0,t.length-1)):e=Array.from(t),[n,e]}let gi;const yi=new Map;class wi{constructor(t){const e=t.zone||be.defaultZone;let n=t.invalid||(Number.isNaN(t.ts)?new _e("invalid input"):null)||(e.isValid?null:Zr(e));this.ts=Re(t.ts)?be.now():t.ts;let r=null,i=null;if(!n){if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(e))[r,i]=[t.old.c,t.old.o];else{const s=Fe(t.o)&&!t.old?t.o:e.offset(this.ts);r=Kr(this.ts,s),n=Number.isNaN(r.year)?new _e("invalid input"):null,r=n?null:r,i=n?null:s}}this._zone=e,this.loc=t.loc||ne.create(),this.invalid=n,this.weekData=null,this.localWeekData=null,this.c=r,this.o=i,this.isLuxonDateTime=!0}static now(){return new wi({})}static local(){const[t,e]=pi(arguments),[n,r,i,s,o,a,l]=e;return hi({year:n,month:r,day:i,hour:s,minute:o,second:a,millisecond:l},t)}static utc(){const[t,e]=pi(arguments),[n,r,i,s,o,a,l]=e;return t.zone=ie.utcInstance,hi({year:n,month:r,day:i,hour:s,minute:o,second:a,millisecond:l},t)}static fromJSDate(t,e={}){const n=(r=t,"[object Date]"===Object.prototype.toString.call(r)?t.valueOf():NaN);var r;if(Number.isNaN(n))return wi.invalid("invalid input");const i=oe(e.zone,be.defaultZone);return i.isValid?new wi({ts:n,zone:i,loc:ne.fromObject(e)}):wi.invalid(Zr(i))}static fromMillis(t,e={}){if(Fe(t))return t<-Wr||t>Wr?wi.invalid("Timestamp out of range"):new wi({ts:t,zone:oe(e.zone,be.defaultZone),loc:ne.fromObject(e)});throw new lt(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,e={}){if(Fe(t))return new wi({ts:1e3*t,zone:oe(e.zone,be.defaultZone),loc:ne.fromObject(e)});throw new lt("fromSeconds requires a numerical input")}static fromObject(t,e={}){t=t||{};const n=oe(e.zone,be.defaultZone);if(!n.isValid)return wi.invalid(Zr(n));const r=ne.fromObject(e),i=an(t,fi),{minDaysInFirstWeek:s,startOfWeek:o}=Be(i,r),a=be.now(),l=Re(e.specificOffset)?n.offset(a):e.specificOffset,u=!Re(i.ordinal),c=!Re(i.year),d=!Re(i.month)||!Re(i.day),f=c||d,h=i.weekYear||i.weekNumber;if((f||u)&&h)throw new ot("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(d&&u)throw new ot("Can't mix ordinal dates with month/day");const m=h||i.weekday&&!f;let p,g,y=Kr(a,l);m?(p=ui,g=oi,y=Ce(y,s,o)):u?(p=ci,g=ai,y=ke(y)):(p=li,g=si);let w=!1;for(const E of p){Re(i[E])?i[E]=w?g[E]:y[E]:w=!0}const v=m?function(t,e=4,n=1){const r=Pe(t.weekYear),i=ze(t.weekNumber,1,en(t.weekYear,e,n)),s=ze(t.weekday,1,7);return r?i?!s&&Te("weekday",t.weekday):Te("week",t.weekNumber):Te("weekYear",t.weekYear)}(i,s,o):u?function(t){const e=Pe(t.year),n=ze(t.ordinal,1,Qe(t.year));return e?!n&&Te("ordinal",t.ordinal):Te("year",t.year)}(i):Le(i),b=v||Ae(i);if(b)return wi.invalid(b);const _=m?Ne(i,s,o):u?Me(i):i,[x,S]=Xr(_,l,n),T=new wi({ts:x,zone:n,o:S,loc:r});return i.weekday&&f&&t.weekday!==T.weekday?wi.invalid("mismatched weekday",`you can't specify both a weekday of ${i.weekday} and a date of ${T.toISO()}`):T.isValid?T:wi.invalid(T.invalid)}static fromISO(t,e={}){const[n,r]=Cn(t,[er,sr],[nr,or],[rr,ar],[ir,lr]);return ei(n,r,e,"ISO 8601",t)}static fromRFC2822(t,e={}){const[n,r]=Cn(function(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(t),[Yn,Jn]);return ei(n,r,e,"RFC 2822",t)}static fromHTTP(t,e={}){const[n,r]=Cn(t,[Hn,Xn],[Qn,Xn],[Kn,tr]);return ei(n,r,e,"HTTP",e)}static fromFormat(t,e,n={}){if(Re(t)||Re(e))throw new lt("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:i=null}=n,s=ne.fromOpts({locale:r,numberingSystem:i,defaultToEN:!0}),[o,a,l,u]=function(t,e,n){const{result:r,zone:i,specificOffset:s,invalidReason:o}=Gr(t,e,n);return[r,i,s,o]}(s,t,e);return u?wi.invalid(u):ei(o,a,n,`format ${e}`,t,l)}static fromString(t,e,n={}){return wi.fromFormat(t,e,n)}static fromSQL(t,e={}){const[n,r]=Cn(t,[cr,sr],[dr,fr]);return ei(n,r,e,"SQL",t)}static invalid(t,e=null){if(!t)throw new lt("need to specify a reason the DateTime is invalid");const n=t instanceof _e?t:new _e(t,e);if(be.throwOnInvalid)throw new rt(n);return new wi({invalid:n})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}static parseFormatForOpts(t,e={}){const n=zr(t,ne.fromObject(e));return n?n.map(t=>t?t.val:null).join(""):null}static expandFormat(t,e={}){return Vr(En.parseFormat(t),ne.fromObject(e)).map(t=>t.val).join("")}static resetCache(){gi=void 0,yi.clear()}get(t){return this[t]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?Yr(this).weekYear:NaN}get weekNumber(){return this.isValid?Yr(this).weekNumber:NaN}get weekday(){return this.isValid?Yr(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?Jr(this).weekday:NaN}get localWeekNumber(){return this.isValid?Jr(this).weekNumber:NaN}get localWeekYear(){return this.isValid?Jr(this).weekYear:NaN}get ordinal(){return this.isValid?ke(this.c).ordinal:NaN}get monthShort(){return this.isValid?Or.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Or.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Or.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Or.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const t=864e5,e=6e4,n=Xe(this.c),r=this.zone.offset(n-t),i=this.zone.offset(n+t),s=this.zone.offset(n-r*e),o=this.zone.offset(n-i*e);if(s===o)return[this];const a=n-s*e,l=n-o*e,u=Kr(a,s),c=Kr(l,o);return u.hour===c.hour&&u.minute===c.minute&&u.second===c.second&&u.millisecond===c.millisecond?[Hr(this,{ts:a}),Hr(this,{ts:l})]:[this]}get isInLeapYear(){return He(this.year)}get daysInMonth(){return Ke(this.year,this.month)}get daysInYear(){return this.isValid?Qe(this.year):NaN}get weeksInWeekYear(){return this.isValid?en(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?en(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(t={}){const{locale:e,numberingSystem:n,calendar:r}=En.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:e,numberingSystem:n,outputCalendar:r}}toUTC(t=0,e={}){return this.setZone(ie.instance(t),e)}toLocal(){return this.setZone(be.defaultZone)}setZone(t,{keepLocalTime:e=!1,keepCalendarTime:n=!1}={}){if((t=oe(t,be.defaultZone)).equals(this.zone))return this;if(t.isValid){let r=this.ts;if(e||n){const e=t.offset(this.ts),n=this.toObject();[r]=Xr(n,e,t)}return Hr(this,{ts:r,zone:t})}return wi.invalid(Zr(t))}reconfigure({locale:t,numberingSystem:e,outputCalendar:n}={}){return Hr(this,{loc:this.loc.clone({locale:t,numberingSystem:e,outputCalendar:n})})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const e=an(t,fi),{minDaysInFirstWeek:n,startOfWeek:r}=Be(e,this.loc),i=!Re(e.weekYear)||!Re(e.weekNumber)||!Re(e.weekday),s=!Re(e.ordinal),o=!Re(e.year),a=!Re(e.month)||!Re(e.day),l=o||a,u=e.weekYear||e.weekNumber;if((l||s)&&u)throw new ot("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&s)throw new ot("Can't mix ordinal dates with month/day");let c;i?c=Ne({...Ce(this.c,n,r),...e},n,r):Re(e.ordinal)?(c={...this.toObject(),...e},Re(e.day)&&(c.day=Math.min(Ke(c.year,c.month),c.day))):c=Me({...ke(this.c),...e});const[d,f]=Xr(c,this.o,this.zone);return Hr(this,{ts:d,o:f})}plus(t){if(!this.isValid)return this;return Hr(this,ti(this,Er.fromDurationLike(t)))}minus(t){if(!this.isValid)return this;return Hr(this,ti(this,Er.fromDurationLike(t).negate()))}startOf(t,{useLocaleWeeks:e=!1}={}){if(!this.isValid)return this;const n={},r=Er.normalizeUnit(t);switch(r){case"years":n.month=1;case"quarters":case"months":n.day=1;case"weeks":case"days":n.hour=0;case"hours":n.minute=0;case"minutes":n.second=0;case"seconds":n.millisecond=0}if("weeks"===r)if(e){const t=this.loc.getStartOfWeek(),{weekday:e}=this;e<t&&(n.weekNumber=this.weekNumber-1),n.weekday=t}else n.weekday=1;if("quarters"===r){const t=Math.ceil(this.month/3);n.month=3*(t-1)+1}return this.set(n)}endOf(t,e){return this.isValid?this.plus({[t]:1}).startOf(t,e).minus(1):this}toFormat(t,e={}){return this.isValid?En.create(this.loc.redefaultToEN(e)).formatDateTimeFromString(this,t):jr}toLocaleString(t=ht,e={}){return this.isValid?En.create(this.loc.clone(e),t).formatDateTime(this):jr}toLocaleParts(t={}){return this.isValid?En.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:e=!1,suppressMilliseconds:n=!1,includeOffset:r=!0,extendedZone:i=!1,precision:s="milliseconds"}={}){if(!this.isValid)return null;const o="extended"===t;let a=ri(this,o,s=di(s));return li.indexOf(s)>=3&&(a+="T"),a+=ii(this,o,e,n,r,i,s),a}toISODate({format:t="extended",precision:e="day"}={}){return this.isValid?ri(this,"extended"===t,di(e)):null}toISOWeekDate(){return ni(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:e=!1,includeOffset:n=!0,includePrefix:r=!1,extendedZone:i=!1,format:s="extended",precision:o="milliseconds"}={}){if(!this.isValid)return null;return o=di(o),(r&&li.indexOf(o)>=3?"T":"")+ii(this,"extended"===s,e,t,n,i,o)}toRFC2822(){return ni(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ni(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?ri(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:e=!1,includeOffsetSpace:n=!0}={}){let r="HH:mm:ss.SSS";return(e||t)&&(n&&(r+=" "),e?r+="z":t&&(r+="ZZ")),ni(this,r,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():jr}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const e={...this.c};return t.includeConfig&&(e.outputCalendar=this.outputCalendar,e.numberingSystem=this.loc.numberingSystem,e.locale=this.loc.locale),e}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,e="milliseconds",n={}){if(!this.isValid||!t.isValid)return Er.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...n},i=(a=e,Array.isArray(a)?a:[a]).map(Er.normalizeUnit),s=t.valueOf()>this.valueOf(),o=Nr(s?this:t,s?t:this,i,r);var a;return s?o.negate():o}diffNow(t="milliseconds",e={}){return this.diff(wi.now(),t,e)}until(t){return this.isValid?Ir.fromDateTimes(this,t):this}hasSame(t,e,n){if(!this.isValid)return!1;const r=t.valueOf(),i=this.setZone(t.zone,{keepLocalTime:!0});return i.startOf(e,n)<=r&&r<=i.endOf(e,n)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const e=t.base||wi.fromObject({},{zone:this.zone}),n=t.padding?this<e?-t.padding:t.padding:0;let r=["years","months","days","hours","minutes","seconds"],i=t.unit;return Array.isArray(t.unit)&&(r=t.unit,i=void 0),mi(e,this.plus(n),{...t,numeric:"always",units:r,unit:i})}toRelativeCalendar(t={}){return this.isValid?mi(t.base||wi.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(wi.isDateTime))throw new lt("min requires all arguments be DateTimes");return Ve(t,t=>t.valueOf(),Math.min)}static max(...t){if(!t.every(wi.isDateTime))throw new lt("max requires all arguments be DateTimes");return Ve(t,t=>t.valueOf(),Math.max)}static fromFormatExplain(t,e,n={}){const{locale:r=null,numberingSystem:i=null}=n;return Gr(ne.fromOpts({locale:r,numberingSystem:i,defaultToEN:!0}),t,e)}static fromStringExplain(t,e,n={}){return wi.fromFormatExplain(t,e,n)}static buildFormatParser(t,e={}){const{locale:n=null,numberingSystem:r=null}=e,i=ne.fromOpts({locale:n,numberingSystem:r,defaultToEN:!0});return new qr(i,t)}static fromFormatParser(t,e,n={}){if(Re(t)||Re(e))throw new lt("fromFormatParser requires an input string and a format parser");const{locale:r=null,numberingSystem:i=null}=n,s=ne.fromOpts({locale:r,numberingSystem:i,defaultToEN:!0});if(!s.equals(e.locale))throw new lt(`fromFormatParser called with a locale of ${s}, but the format parser was created for ${e.locale}`);const{result:o,zone:a,specificOffset:l,invalidReason:u}=e.explainFromTokens(t);return u?wi.invalid(u):ei(o,a,n,`format ${e.format}`,t,l)}static get DATE_SHORT(){return ht}static get DATE_MED(){return mt}static get DATE_MED_WITH_WEEKDAY(){return pt}static get DATE_FULL(){return gt}static get DATE_HUGE(){return yt}static get TIME_SIMPLE(){return wt}static get TIME_WITH_SECONDS(){return vt}static get TIME_WITH_SHORT_OFFSET(){return bt}static get TIME_WITH_LONG_OFFSET(){return _t}static get TIME_24_SIMPLE(){return xt}static get TIME_24_WITH_SECONDS(){return St}static get TIME_24_WITH_SHORT_OFFSET(){return Tt}static get TIME_24_WITH_LONG_OFFSET(){return Et}static get DATETIME_SHORT(){return Dt}static get DATETIME_SHORT_WITH_SECONDS(){return It}static get DATETIME_MED(){return Ot}static get DATETIME_MED_WITH_SECONDS(){return Ct}static get DATETIME_MED_WITH_WEEKDAY(){return Nt}static get DATETIME_FULL(){return kt}static get DATETIME_FULL_WITH_SECONDS(){return Mt}static get DATETIME_HUGE(){return Bt}static get DATETIME_HUGE_WITH_SECONDS(){return Lt}}function vi(t){if(wi.isDateTime(t))return t;if(t&&t.valueOf&&Fe(t.valueOf()))return wi.fromJSDate(t);if(t&&"object"==typeof t)return wi.fromObject(t);throw new lt(`Unknown datetime argument: ${t}, of type ${typeof t}`)}async function bi(t,e="memory"){if(t.trim().startsWith('"ClientAccountID"'))return async function(t,e){const n=[],r=[],i=[],s=[],o=[],a=[],l=[],u=[],c=[],d=[],f=[],h=[],m=[],p=[],g=et(t,{relax_column_count:!0,skip_empty_lines:!0,trim:!0,info:!0});let y="UNKNOWN",w={};for(const{record:v,info:b}of g)if("ClientAccountID"!==v[0]){if("TRADES"===y){const t=v[w.Quantity],r=t?parseFloat(t.replace(/,/g,"")):0,i=v[w.Proceeds],s=i?parseFloat(i.replace(/,/g,"")):0,o=void 0!==w.Code?"Code":void 0!==w["Notes/Codes"]?"Notes/Codes":"",a=o&&void 0!==w[o]?v[w[o]]:"",l=a.split(";").map(t=>t.trim()),u=void 0!==w.TransactionType?"TransactionType":void 0!==w["Transaction Type"]?"Transaction Type":"",c=u&&void 0!==w[u]?v[w[u]]:"",d=l.includes("A")||l.includes("Ex")||l.includes("Ep")||"Assignment"===c||"Exercise"===c||"Expiration"===c||l.includes("IA");if(0===r&&0===s&&!d)continue;const f=_i(v[w[void 0!==w.DateTime?"DateTime":void 0!==w.TradeDate?"TradeDate":"Date/Time"]].trim()),h=v[w.Symbol],m=v[w["Buy/Sell"]]||v[w.Side],p=Math.abs(parseFloat(t.replace(/,/g,""))),g=void 0!==w.TradePrice?"TradePrice":"Trade Price",y=void 0!==w[g]?Math.abs(parseFloat(v[w[g]].replace(/,/g,""))):0,_=v[w.Proceeds],x=_?parseFloat(_.replace(/,/g,"")):0,S="BUY"===("BUY"===m||"BOT"===m?"BUY":"SELL")?-x:x,T=void 0!==w.IBCommission?w.IBCommission:w["Comm/Fee"],E=void 0!==T?Math.abs(parseFloat(v[T].replace(/,/g,""))):0;let D="USD";void 0!==w.IBCommissionCurrency&&v[w.IBCommissionCurrency]?D=v[w.IBCommissionCurrency]:void 0!==w.Currency&&v[w.Currency]?D=v[w.Currency]:void 0!==w.CurrencyPrimary&&v[w.CurrencyPrimary]&&(D=v[w.CurrencyPrimary]);const I=Ti(v[w["Asset Category"]]||v[w.AssetClass]),O=v[w.Description],C=w["Open/CloseIndicator"],N=void 0!==C?v[C]:"",k=void 0!==w.Conid?v[w.Conid]:void 0;n.push({date:f,type:"BUY"===m||"BOT"===m?"BUY":"SELL",symbol:h,quantity:p,price:y,amount:S,currency:D,commission:E,description:O,conid:k,multiplier:void 0!==w.Multiplier&&v[w.Multiplier]?parseFloat(v[w.Multiplier].replace(/,/g,"")):1,assetCategory:I,code:a,codes:l,isOpen:l.includes("O")||"O"===N,isClose:l.includes("C")||"C"===N,isAssignment:l.includes("A")||"Assignment"===c,isExercise:l.includes("Ex")||"Exercise"===c,isExpired:l.includes("Ep")||"Expiration"===c,source:{file:e,line:b.lines}})}else if("CORP"===y){if(void 0!==w.LevelOfDetail){if("SUMMARY"===v[w.LevelOfDetail])continue}const t=v[w.Quantity],i=t?parseFloat(t.replace(/,/g,"")):0,u=_i(v[w[void 0!==w["Date/Time"]?"Date/Time":void 0!==w["Report Date"]?"Report Date":"Date"]]),c=v[w.ActionDescription]||v[w.Description],d=v[w.Symbol],f=void 0!==w.Conid?v[w.Conid]:void 0,h=v[w.Proceeds]||"0",m=v[w.Amount]||"0",p=Math.abs(parseFloat(h.replace(/,/g,""))),g=Math.abs(parseFloat(m.replace(/,/g,""))),y=0!==p?p:g,_=(c||"").toLowerCase().includes("split"),x=(c||"").toLowerCase().includes("spinoff")||(c||"").toLowerCase().includes("spin-off"),S=0===i&&((c||"").toLowerCase().includes("dividend")||(c||"").toLowerCase().includes("interest")||(c||"").toLowerCase().includes("borrow fee")||(c||"").toLowerCase().includes("tax")||(c||"").toLowerCase().includes("withholding")||(c||"").toLowerCase().includes("forex")||(c||"").toLowerCase().includes("fx")||(c||"").toLowerCase().includes("translation")||(c||"").toLowerCase().includes("conversion"));if(_&&0===y)r.push({date:u,symbol:d,quantityChange:i,type:"SPLIT",description:c,conid:f,source:{file:e,line:b.lines},eventType:"SPLIT"});else if(!d||0===i&&!x&&0===y||isNaN(i)||S){const t=void 0!==w.Amount&&v[w.Amount]?parseFloat(v[w.Amount].replace(/,/g,"")):0,n=void 0!==w.Proceeds&&v[w.Proceeds]?parseFloat(v[w.Proceeds].replace(/,/g,"")):0,r=0!==t?t:n;if(0!==r){const t=void 0!==w.CurrencyPrimary?v[w.CurrencyPrimary]:"USD",n=(c||"").toLowerCase();n.includes("dividend")?(n.includes("lie"),o.push({date:_i(u),description:c,amount:r,currency:t})):n.includes("interest")||n.includes("borrow fee")||n.includes("credit int")||n.includes("debit int")?s.push({date:_i(u),description:c,amount:r,currency:t}):n.includes("tax")||n.includes("withholding")?a.push({date:_i(u),description:c,amount:r,currency:t}):(n.includes("forex")||n.includes("fx")||n.includes("translation")||n.includes("conversion"))&&l.push({date:_i(u),description:c,amount:r,currency:t,code:"FX",assetCategory:"Forex",source:{file:e,line:b.lines}})}}else n.push({date:u,type:i>=0?"BUY":"SELL",symbol:d,quantity:Math.abs(i),price:0!==i?y/Math.abs(i):0,amount:y,currency:void 0!==w.CurrencyPrimary&&v[w.CurrencyPrimary]?v[w.CurrencyPrimary]:"USD",commission:0,description:c,conid:f,multiplier:1,assetCategory:Ti(void 0!==w.AssetClass?v[w.AssetClass]:"Unknown"),code:x?"SO":"CA",codes:x?["SO"]:[],source:{file:e,line:b.lines},isAssignment:!1,isExercise:!1,isExpired:!1,isOpen:i>=0,isClose:i<0})}else if("OPEN_POS"===y){const t=_i(v[w[void 0!==w.ReportDate?"ReportDate":"Report Date"]]),n=v[w.Symbol],r=void 0!==w.Conid?v[w.Conid]:void 0,i=v[w.Quantity],s=i?parseFloat(i.replace(/,/g,"")):0,o=v[w.MarkPrice]||v[w["Mark Price"]],a=o?parseFloat(o.replace(/,/g,"")):0,l=v[w.PositionValue]||v[w["Position Value"]],u=l?parseFloat(l.replace(/,/g,"")):0,d=v[w.CostBasisPrice]||v[w["Cost Basis Price"]],f=d?parseFloat(d.replace(/,/g,"")):0,h=v[w.CostBasisMoney]||v[w["Cost Basis Money"]],m=h?parseFloat(h.replace(/,/g,"")):0,p=v[w.FifoPnlUnrealized]||v[w["Unrealized P/L"]],g=p?parseFloat(p.replace(/,/g,"")):0,y=v[w.CurrencyPrimary]||v[w.Currency]||"USD",_=Ti(v[w.AssetClass]||v[w["Asset Class"]]),x=v[w.Multiplier],S=x?parseFloat(x.replace(/,/g,"")):1,T=v[w.Description];n&&0!==s&&c.push({date:t,symbol:n,conid:r,quantity:s,markPrice:a,positionValue:u,costBasisPrice:f,costBasisMoney:m,unrealizedPnL:g,currency:y,assetCategory:_,multiplier:S,description:T,source:{file:e,line:b.lines}})}else if("COMPLEX_POS"===y){const t=_i(v[w[void 0!==w.ReportDate?"ReportDate":"Report Date"]]),n=v[w.Symbol],r=void 0!==w.Conid?v[w.Conid]:void 0,i=v[w.Quantity],s=i?parseFloat(i.replace(/,/g,"")):0,o=v[w.ClosePrice]||v[w["Close Price"]],a=o?parseFloat(o.replace(/,/g,"")):0,l=v[w.Value],u=l?parseFloat(l.replace(/,/g,"")):0,c=v[w.MtmPnl]||v[w["MTM PNL"]],f=c?parseFloat(c.replace(/,/g,"")):0,h=v[w.CurrencyPrimary]||v[w.Currency]||"USD",m=Ti(v[w.AssetClass]||v[w["Asset Class"]]),p=v[w.Description];n&&d.push({date:t,symbol:n,conid:r,quantity:s,closePrice:a,value:u,mtmPnL:f,currency:h,assetCategory:m,description:p,source:{file:e,line:b.lines}})}else if("OPTION_EVENTS"===y){const t=_i(v[w[void 0!==w.Date?"Date":"Date/Time"]]),n=v[w.Symbol],r=void 0!==w.Conid?v[w.Conid]:void 0,i=v[w.TransactionType]||v[w["Transaction Type"]],s=v[w.Quantity],o=s?Math.abs(parseFloat(s.replace(/,/g,""))):0,a=v[w.TradePrice]||v[w["Trade Price"]],l=a?parseFloat(a.replace(/,/g,"")):0,u=v[w.Proceeds],c=u?parseFloat(u.replace(/,/g,"")):0,d=v[w["Comm/Tax"]],h=d?Math.abs(parseFloat(d.replace(/,/g,""))):0,m=v[w.Basis],p=m?parseFloat(m.replace(/,/g,"")):0,g=v[w.FifoPnlRealized]||v[w["Realized P/L"]],y=g?parseFloat(g.replace(/,/g,"")):0,_=v[w.CurrencyPrimary]||v[w.Currency]||"USD",x=Ti(v[w.AssetClass]||v[w["Asset Class"]]),S=v[w.Description];n&&i&&("Assignment"===i||"Exercise"===i||"Expiration"===i)&&f.push({date:t,symbol:n,conid:r,transactionType:i,quantity:o,tradePrice:l,proceeds:c,commTax:h,basis:p,realizedPnL:y,currency:_,assetCategory:x,description:S,source:{file:e,line:b.lines}})}else if("PENDING_EX"===y){const t=_i(v[w.ReportDate]||v[w["Report Date"]]),n=_i(v[w.TradeDate]||v[w["Trade Date"]]),r=v[w.Symbol],i=void 0!==w.Conid?v[w.Conid]:void 0,s=v[w.Quantity],o=s?parseFloat(s.replace(/,/g,"")):0,a=v[w.Type],l=v[w.CurrencyPrimary]||v[w.Currency]||"USD",u=Ti(v[w.AssetClass]||v[w["Asset Class"]]),c=v[w.Description];r&&h.push({reportDate:t,tradeDate:n,symbol:r,conid:i,quantity:o,type:a,currency:l,assetCategory:u,description:c,source:{file:e,line:b.lines}})}else if("TX_FEES"===y){const t=_i(v[w[void 0!==w.Date?"Date":"Date/Time"]]),n=void 0!==w.Symbol?v[w.Symbol]:void 0,r=void 0!==w.Conid?v[w.Conid]:void 0,i=v[w.TaxDescription]||v[w["Tax Description"]],s=v[w.TaxAmount]||v[w["Tax Amount"]],o=s?parseFloat(s.replace(/,/g,"")):0,a=v[w.CurrencyPrimary]||v[w.Currency]||"USD",l=void 0!==w.AssetClass?Ti(v[w.AssetClass]):void 0,u=void 0!==w.TradeID?v[w.TradeID]:void 0!==w["Trade ID"]?v[w["Trade ID"]]:void 0;i&&0!==o&&m.push({date:t,symbol:n,conid:r,taxDescription:i,taxAmount:o,currency:a,assetCategory:l,tradeId:u,source:{file:e,line:b.lines}})}else if("CASH_TX"===y){const t=_i(v[w[void 0!==w["Date/Time"]?"Date/Time":"Date"]]),n=void 0!==w.SettleDate?_i(v[w.SettleDate]):void 0,r=void 0!==w.Symbol?v[w.Symbol]:void 0,i=void 0!==w.Conid?v[w.Conid]:void 0,s=v[w.Type],o=v[w.Amount],a=o?parseFloat(o.replace(/,/g,"")):0,l=v[w.CurrencyPrimary]||v[w.Currency]||"USD",u=v[w.Description],c=void 0!==w.TransactionID?v[w.TransactionID]:void 0!==w["Transaction ID"]?v[w["Transaction ID"]]:void 0;s&&0!==a&&p.push({date:t,settleDate:n,symbol:r,conid:i,type:s,amount:a,currency:l,description:u,transactionId:c,source:{file:e,line:b.lines}})}else if("FOREX_PL"===y){const t=_i(v[w[void 0!==w.DateTime?"DateTime":"Date"]]),n=v[w.FXCurrency],r=v[w.ActivityDescription],i=v[w.Quantity],s=i?parseFloat(i.replace(/,/g,"")):0,o=v[w.Proceeds],a=o?parseFloat(o.replace(/,/g,"")):0,l=v[w.Cost],c=l?parseFloat(l.replace(/,/g,"")):0,d=v[w["RealizedP/L"]],f=d?parseFloat(d.replace(/,/g,"")):0,h=v[w.Code];!n||0===a&&0===f&&0===c||u.push({date:t,description:r,fxCurrency:n,quantity:s,proceeds:a,cost:c,realizedPnL:f,code:h,source:{file:e,line:b.lines}})}}else w=v.reduce((t,e,n)=>(t[e]=n,t),{}),y=void 0!==w["Buy/Sell"]&&void 0!==w.TransactionType?"TRADES":void 0!==w.ActionID||void 0!==w.ActionDescription&&void 0!==w.Type?"CORP":void 0!==w.MarkPrice&&void 0!==w.CostBasisPrice?"OPEN_POS":void 0!==w.ClosePrice&&void 0!==w.MtmPnl&&void 0===w.MarkPrice?"COMPLEX_POS":void 0!==w.Basis&&void 0!==w["Comm/Tax"]?"OPTION_EVENTS":void 0!==w.Type&&void 0!==w.TradeDate&&void 0!==w.Quantity&&void 0===w.ActionID&&void 0===w["Buy/Sell"]?"PENDING_EX":void 0!==w.TaxDescription&&void 0!==w.TaxAmount?"TX_FEES":void 0!==w.SettleDate&&void 0!==w.Amount&&void 0!==w.Type&&void 0===w["Buy/Sell"]&&void 0===w.ActionID?"CASH_TX":void 0!==w.FXCurrency&&void 0!==w.ActivityDescription&&void 0!==w["RealizedP/L"]?"FOREX_PL":"UNKNOWN";if(p.length>0){o.length=0,s.length=0,a.length=0;for(const t of p){const e=t.type;"Dividends"===e||"Payment In Lieu Of Dividends"===e?o.push({date:t.settleDate||t.date,description:t.description,amount:t.amount,currency:t.currency}):"Withholding Tax"===e||e.includes("Withholding")?a.push({date:t.date,description:t.description,amount:t.amount,currency:t.currency}):"Broker Interest Paid"!==e&&"Broker Interest Received"!==e&&"Bond Interest Paid"!==e&&"Bond Interest Received"!==e||s.push({date:t.date,description:t.description,amount:t.amount,currency:t.currency})}}return{transactions:n,forexSummaries:i,reportPeriod:null,interestRecords:s,dividendRecords:o,withholdingTaxRecords:a,corporateActionRecords:r,forexDetailRecords:l,forexPLDetailRecords:u,openPositions:c,complexPositions:d,optionEvents:f,pendingExercises:h,transactionFees:m,cashTransactions:p}}(t,e);throw new Error('Unsupported CSV format. Please use an IBKR Activity Flex Query (starting with "ClientAccountID"). Standard "Activity Statements" are no longer supported.')}function _i(t){return function(t){if(!t)return"";if(t.includes(";")){const e=t.split(";");let n=e[0].trim();const r=e[1].trim(),i=Si(n);i&&(n=i);const s=r.split(" "),o=s[0],a=s[1];if(a&&xi[a]){const t=xi[a],e=`${n} ${o}`,r=wi.fromFormat(e,"yyyy-MM-dd HH:mm:ss",{zone:t});if(r.isValid)return r.setZone("Europe/London").toFormat("yyyy-MM-dd HH:mm:ss ZZZZ")}return n}if(/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const e=Si(t);return e||t}(t)}const xi={EDT:"UTC-4",EST:"UTC-5",BST:"Europe/London",GMT:"Europe/London",UTC:"UTC",JST:"Asia/Tokyo",CET:"Europe/Paris",CEST:"Europe/Paris",HKT:"Asia/Hong_Kong",AEST:"Australia/Sydney",AEDT:"Australia/Sydney",SGT:"Asia/Singapore",ET:"America/New_York"};function Si(t){const e=t.split("-");if(3===e.length){const t=e[0],n=e[1],r=e[2],i={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"}[n];if(i){return`${2===r.length?`20${r}`:r}-${i}-${t}`}}return null}function Ti(t){return t?"STK"===t?"Stocks":"OPT"===t?"Equity and Index Options":"WAR"===t?"Warrants":"CASH"===t||"CUR"===t?"Forex":t:"Unknown"}function Ei(t){const e=t.match(/\b(\d{1,2})([A-Z]{3})(\d{2})\b/);if(e){const[,t,n,r]=e,i={JAN:0,FEB:1,MAR:2,APR:3,MAY:4,JUN:5,JUL:6,AUG:7,SEP:8,OCT:9,NOV:10,DEC:11}[n.toUpperCase()];if(void 0!==i){const e=2e3+parseInt(r,10);return new Date(Date.UTC(e,i,parseInt(t,10)))}}const n=t.match(/(\d{2})(\d{2})(\d{2})([CP])\d{8}/);if(n){const[,t,e,r]=n,i=2e3+parseInt(t,10),s=parseInt(e,10)-1,o=parseInt(r,10);if(s>=0&&s<=11&&o>=1&&o<=31){return new Date(Date.UTC(i,s,o))}}return null}const Di=(t,e)=>t.toLocaleString("en-US",{style:"currency",currency:e});function Ii(t,e){const n=new Date(e);if(isNaN(n.getTime()))return t;const r=new Date(n);return r.setDate(r.getDate()+1),t.filter(t=>new Date(t.date)<r)}function Oi(t,e,n,r){const{fromDate:i,toDate:s}=r,o=function(t,e=[]){const n=t.filter(t=>"Stocks"===t.assetCategory).map(t=>({transaction:t,originalQty:Math.abs(t.quantity),remainingQty:Math.abs(t.quantity)})),r=t=>{const e=wi.fromISO(t);return e.isValid?e:t.length>=10&&"-"===t.charAt(4)&&"-"===t.charAt(7)?wi.fromISO(t.substring(0,10)):e},i=new Set,s=(e,s,o,a,l,u,c)=>{const d=100*Math.abs(a),f=r(e),h=n.filter(t=>{if(t.remainingQty<=0)return!1;const n=r(t.transaction.date);if(!f.isValid||!n.isValid)return t.transaction.date===e&&Math.abs(t.transaction.quantity)===d;const i=n.diff(f,"days").days,o=i>=-.1&&i<=7,a=t=>(t||"").replace(/[\s.]/g,""),l=a(t.transaction.symbol),u=a(s),c=u.startsWith(l)||u.includes(l);return o&&c});if(0===h.length)return;const m=t.filter(t=>t!==c&&(t.assetCategory.includes("Option")||t.assetCategory.includes("Future"))&&(o?t.conid===o:t.symbol===s)&&new Date(t.date)<=new Date(e)&&0!==t.amount);let p=m.reduce((t,e)=>t+e.amount,0),g=m.reduce((t,e)=>t+e.commission,0);c&&void 0!==c.amount&&(p+=c.amount,g+=c.commission);let y=d;for(const t of h){if(y<=0)break;const e=Math.min(t.remainingQty,y),n=e/d,r=p*n,i=g*n,s=t.transaction;s.commission+=i,l?"BUY"===s.type?(s.amount-=r,s.notes=(s.notes||"")+` (Assigned Put: ${e} shares, -${r.toFixed(2)} Premium)`):"SELL"===s.type&&(s.amount+=r,s.notes=(s.notes||"")+` (Assigned Call: ${e} shares, +${r.toFixed(2)} Premium)`):u&&("BUY"===s.type?(s.amount+=r,s.notes=(s.notes||"")+` (Exercised Call: ${e} shares, +${r.toFixed(2)} Premium)`):"SELL"===s.type&&(s.amount-=r,s.notes=(s.notes||"")+` (Exercised Put: ${e} shares, -${r.toFixed(2)} Premium)`)),t.remainingQty-=e,y-=e}for(const t of m)t.amount=0,t.commission=0,t.notes=(t.notes||"")+" [Premium moved to Stock via Assignment]";if(c&&void 0!==c.amount){const t=c;t.amount=0,t.commission=0,t.notes=(t.notes||"")+" [Linked to Stock]",i.add(t)}};if(e.length>0)for(const o of e){if("Expiration"===o.transactionType)continue;const t="Assignment"===o.transactionType,e="Exercise"===o.transactionType;s(o.date,o.symbol,o.conid?String(o.conid):void 0,o.quantity,t,e,o)}else{const e=t.filter(t=>(t.assetCategory.includes("Option")||t.assetCategory.includes("Future"))&&(t.isAssignment||t.isExercise||t.code&&(t.code.includes("A")||t.code.includes("Ex"))));for(const t of e){if(i.has(t))continue;const e=t.isAssignment||t.code&&t.code.includes("A"),n=t.isExercise||t.code&&t.code.includes("Ex");s(t.date,t.symbol,t.conid?String(t.conid):void 0,t.quantity,!!e,!!n,t)}}return t}(t,e),a=function(t,e,n){const r=[],i=new Date(n),s=new Map;for(const o of t){if(!o.assetCategory||!o.assetCategory.includes("Option")&&!o.assetCategory.includes("OPT"))continue;const t=o.conid?o.conid.toString():o.symbol;if(!s.has(t)){const e=Ei(o.symbol);if(!e)continue;s.set(t,{symbol:o.symbol,netQuantity:0,expirationDate:e,latestTransaction:o,currency:o.currency,multiplier:o.multiplier||100,assetCategory:o.assetCategory})}const e=s.get(t);"BUY"===o.type?e.netQuantity+=o.quantity:e.netQuantity-=o.quantity,e.currency=o.currency,e.multiplier=o.multiplier||100,e.assetCategory=o.assetCategory,new Date(o.date)>new Date(e.latestTransaction.date)&&(e.latestTransaction=o)}for(const o of e){const t=o.conid?o.conid.toString():o.symbol;if(s.has(t)){const e=s.get(t);e.netQuantity+=o.quantityChange,new Date(o.date)>new Date(e.latestTransaction.date)&&(e.latestTransaction=o)}}for(const[o,a]of s)Math.abs(a.netQuantity)<1e-4||a.expirationDate&&(a.expirationDate>i||r.push({date:a.expirationDate.toISOString().split("T")[0],type:a.netQuantity>0?"SELL":"BUY",symbol:o,quantity:Math.abs(a.netQuantity),price:0,amount:0,commission:0,currency:a.currency,description:"Option expired or assigned, but no completion record found in CSV",assetCategory:a.assetCategory,code:"Ep",multiplier:a.multiplier,isExpired:!0,isClose:!0,source:{file:"Synthetic Generator",line:0}}));return r}(o,n,s||(new Date).toISOString().split("T")[0]),l=[...o];a.length>0&&(l.push(...a),l.sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime()));let u=l,c=n;s&&(u=Ii(l,s),c=Ii(n,s));const d=function(t,e=[]){return A(t,e).disposalResults}(u,c),{openPositions:f}=A(u,c);let h=d;if(i||s){const t=i?new Date(i):new Date("1900-01-01"),e=s?new Date(s):new Date("2100-01-01");h=d.filter(n=>{const r=new Date(n.date);return r>=t&&r<=e})}return{disposalResults:h,openPositions:f,transactionsForCalculator:u}}function Ci(t,e,n,r,i,s,o,a,l,u=!1){const c=[],d=t.reduce((t,e)=>{const n=e.assetCategory||"Unknown";return t[n]=t[n]||{count:0,proceeds:0,cost:0,gain:0},t[n].count++,t[n].proceeds+=e.proceeds,t[n].cost+=e.allowableCost,t[n].gain+=e.gain,t},{}),f=[],h=Object.keys(d).sort();for(const _ of h){const t=d[_];f.push({Section:"CGT",Category:_,Description:`${t.count} Trades`,"Gross / Proceeds (GBP)":t.proceeds.toFixed(2),"Cost / Expense (GBP)":t.cost.toFixed(2),"Net Gain / Income (GBP)":t.gain.toFixed(2),Notes:""})}let m=0,p=0,g=0,y="";if(r&&r.length>0){const t=function(t,e,n){let r=0,i=0;return t.forEach(t=>{const s=new Date(t.date);if(e&&s<e)return;if(n&&s>n)return;const o=t.realizedPnL;o>0?r+=o:i+=Math.abs(o)}),{totalGain:r,totalLoss:i,netResult:r-i}}(r,a,l);m=t.totalGain,p=t.totalLoss,g=t.netResult,y="From Forex P/L Details (Realized FX on Trades)"}else if(n.length>0){const t=function(t,e,n){const r=t.filter(t=>{if(t.date){const r=t.date.split(",")[0],i=new Date(r);if(e&&i<e)return!1;if(n&&i>n)return!1}return!("Total"===t.assetCategory||!t.code||""===t.code.trim()||t.description.startsWith("Stock ")||t.description.startsWith("Option ")||t.description.startsWith("Closed Lot: Stock")||t.description.startsWith("Closed Lot: Option")||Math.abs(t.amount)<.01)});r.sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime());let i=0,s=0;return{details:r.map(t=>{const e=t.amount;return e>=0?i+=e:s+=Math.abs(e),{...t,profitLoss:e}}),totalGain:i,totalLoss:s,netResult:i-s}}(n,a,l);m=t.totalGain,p=t.totalLoss,g=t.netResult,y="From Detailed Records (Filtered stocks/options)"}else if(e.length>0){const t=function(t,e,n){let r=0,i=0;const s=[],o=t=>t?new Date(t.trim()):null;return t.filter(t=>{let r=!0;if(t.reportPeriod&&e&&n){const i=t.reportPeriod.split("-");if(2===i.length){const t=o(i[0]),s=o(i[1]);t&&s&&!isNaN(t.getTime())&&!isNaN(s.getTime())&&(s<e&&(r=!1),t>n&&(r=!1))}}return r}).forEach(t=>{const e=t.realizedGBP||0;"Total"!==t.code&&(Math.abs(e)<.01&&(void 0===t.unrealizedGBP||Math.abs(t.unrealizedGBP)<.01)||(e>0?r+=e:i+=Math.abs(e),s.push({...t,realizedGBP:e,originalAmount:void 0,originalCurrency:void 0,isConverted:!1})))}),{summaries:s,totalGain:r,totalLoss:i,netResult:r-i}}(e,a,l);m=t.totalGain,p=t.totalLoss,g=t.netResult,y="From IBKR Summary (May include stock/option P/L conversion)"}0===m&&0===p||f.push({Section:"CGT",Category:"Forex",Description:"Forex P/L","Gross / Proceeds (GBP)":m.toFixed(2),"Cost / Expense (GBP)":p.toFixed(2),"Net Gain / Income (GBP)":g.toFixed(2),Notes:y});const w=["Stocks","Equity and Index Options","Forex"];f.sort((t,e)=>{const n=w.indexOf(t.Category),r=w.indexOf(e.Category);return-1!==n&&-1!==r?n-r:-1!==n?-1:-1!==r?1:t.Category.localeCompare(e.Category)}),c.push(...f);const v=function(t,e,n){const r=t.filter(t=>{const r=new Date(t.date);return!(e&&r<e||n&&r>n)});let i=0,s=0;const o=[];return r.forEach(t=>{let e=t.amount,n=!1;"GBP"!==t.currency&&(e=L(t.amount,t.currency),n=!0),e>=0?i+=e:s+=Math.abs(e),o.push({...t,amountGBP:e,isConverted:n})}),{summaries:o,totalIncome:i,totalExpense:s,netResult:i-s}}(i,a,l);if(v.summaries.length>0){const t=v.summaries.reduce((t,e)=>{const n=e.currency||"Unknown";return t[n]=t[n]||{income:0,expense:0,incomeOriginal:0,expenseOriginal:0},e.amountGBP>=0?(t[n].income+=e.amountGBP,t[n].incomeOriginal+=e.amount):(t[n].expense+=Math.abs(e.amountGBP),t[n].expenseOriginal+=Math.abs(e.amount)),t},{}),e=Object.keys(t).sort();for(const n of e){const e=t[n],r="GBP"!==n,i=`Interest (${n})`;let s=r?"Foreign Interest":"UK Interest";if(e.income>0){let t="Gross Interest Received";if(r&&e.incomeOriginal>0){t+=` (${n} ${u?Di(e.incomeOriginal,n):e.incomeOriginal.toFixed(2)})`;s+=` @ ${(e.incomeOriginal/e.income).toFixed(4)} ${n}/GBP`}c.push({Section:"INCOME",Category:i,Description:t,"Gross / Proceeds (GBP)":e.income.toFixed(2),"Cost / Expense (GBP)":"0.00","Net Gain / Income (GBP)":e.income.toFixed(2),Notes:s})}if(e.expense>0){let t="Margin Interest Paid";if(r&&e.expenseOriginal>0){t+=` (${n} ${u?Di(e.expenseOriginal,n):e.expenseOriginal.toFixed(2)})`}c.push({Section:"INCOME",Category:`${i} Expense`,Description:t,"Gross / Proceeds (GBP)":"0.00","Cost / Expense (GBP)":e.expense.toFixed(2),"Net Gain / Income (GBP)":(-e.expense).toFixed(2),Notes:"Non-Deductible usually"})}}}const b=function(t,e,n,r){const i=t=>t.filter(t=>{const e=new Date(t.date);return!(n&&e<n||r&&e>r)}),s=i(t),o=i(e);let a=0,l=0;const u=s.map(t=>{let e=t.amount,n=!1;return"GBP"!==t.currency&&(e=L(t.amount,t.currency),n=!0),e>=0?(a+=e,{...t,type:"DIVIDEND_INCOME",amountGBP:e,isConverted:n}):(l+=Math.abs(e),{...t,type:"PAYMENT_IN_LIEU",amountGBP:e,isConverted:n})});let c=0;const d=o.map(t=>{let e=t.amount,n=!1;return"GBP"!==t.currency&&(e=L(t.amount,t.currency),n=!0),c+=Math.abs(e),{...t,type:"WITHHOLDING_TAX",amountGBP:e,isConverted:n}});return{summaries:[...u,...d].sort((t,e)=>new Date(t.date).getTime()-new Date(e.date).getTime()),dividendSummaries:u,taxSummaries:d,totalGross:a,totalExpense:l,totalTax:c,netResult:a-l-c}}(s,o,a,l);if(b.summaries.length>0){const t=b.dividendSummaries.reduce((t,e)=>{const n=e.currency||"Unknown";t[n]=t[n]||{gross:0,grossOriginal:0,expense:0,expenseOriginal:0};const r=e.amountGBP||0;return"DIVIDEND_INCOME"===e.type?(t[n].gross+=r,t[n].grossOriginal+=e.amount):"PAYMENT_IN_LIEU"===e.type&&(t[n].expense+=Math.abs(r),t[n].expenseOriginal+=Math.abs(e.amount)),t},{}),e=Object.keys(t).sort();for(const i of e){const e=t[i],n="GBP"!==i,r=`Dividends (${i})`;if(e.gross>0){let t="Gross Dividends",s="";if(n&&e.grossOriginal>0){t+=` (${i} ${u?Di(e.grossOriginal,i):e.grossOriginal.toFixed(2)})`;s=`Foreign Income @ ${(e.grossOriginal/e.gross).toFixed(4)} ${i}/GBP`}c.push({Section:"INCOME",Category:r,Description:t,"Gross / Proceeds (GBP)":e.gross.toFixed(2),"Cost / Expense (GBP)":"0.00","Net Gain / Income (GBP)":e.gross.toFixed(2),Notes:s})}if(e.expense>0){let t="Payments in Lieu (PIL)";if(n&&e.expenseOriginal>0){t+=` (${i} ${u?Di(e.expenseOriginal,i):e.expenseOriginal.toFixed(2)})`}c.push({Section:"INCOME",Category:r,Description:t,"Gross / Proceeds (GBP)":"0.00","Cost / Expense (GBP)":e.expense.toFixed(2),"Net Gain / Income (GBP)":(-e.expense).toFixed(2),Notes:"Expense"})}}const n=b.taxSummaries.reduce((t,e)=>{const n=e.currency||"Unknown";t[n]=t[n]||{tax:0,taxOriginal:0};const r=e.amountGBP||0;return t[n].tax+=Math.abs(r),t[n].taxOriginal+=Math.abs(e.amount),t},{}),r=Object.keys(n).sort();for(const i of r){const t=n[i],e="GBP"!==i,r=`Dividends (${i})`;if(t.tax>0){let n="Withholding Tax",s="Foreign Tax Credit Relief";if(e&&t.taxOriginal>0){n+=` (${i} ${u?Di(t.taxOriginal,i):t.taxOriginal.toFixed(2)})`;s+=` @ ${(t.taxOriginal/t.tax).toFixed(4)} ${i}/GBP`}c.push({Section:"INCOME",Category:r,Description:n,"Gross / Proceeds (GBP)":"0.00","Cost / Expense (GBP)":t.tax.toFixed(2),"Net Gain / Income (GBP)":(-t.tax).toFixed(2),Notes:s})}}}return c}function Ni(t){return new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{e(r.result)},r.onerror=()=>{n(new Error(`Failed to read file: ${t.name}`))},r.readAsText(t)})}function ki(t,e){const{disposalResults:n}=Oi(t.transactions,t.optionEvents,t.corporateActions,{fromDate:e?.fromDate??void 0,toDate:e?.toDate??void 0}),r=function(t,e,n){const r=n?.fromDate?new Date(n.fromDate):void 0,i=n?.toDate?new Date(n.toDate):void 0,s=Ci(t,e.forexSummaries,e.forexDetailRecords,e.forexPLDetailRecords,e.interestRecords,e.dividendRecords,e.withholdingTaxRecords,r,i,!1);let o=0,a=0;for(const l of s)if("CGT"===l.Section){const t=parseFloat(l["Net Gain / Income (GBP)"]);t>0?o+=t:a+=Math.abs(t)}return{totalGains:o,totalLosses:a,netCGT:o-a,rows:s}}(n,t,e);return{summary:r,disposals:n.map(t=>({date:t.date,symbol:t.symbol,assetCategory:t.assetCategory||"Unknown",quantity:t.quantity,proceeds:t.proceeds,cost:t.allowableCost,gainLoss:t.proceeds-t.allowableCost,matchingRule:t.rule})),dateRange:e}}const Mi=new class{constructor(){e(this,"fileUpload"),e(this,"progress"),e(this,"results"),e(this,"dateRangeSelector"),e(this,"container",null),e(this,"currentFiles",null),e(this,"currentDateRange",{fromDate:null,toDate:null,taxYear:null}),this.fileUpload=new q(this.handleFiles.bind(this)),this.progress=new G,this.results=new z,this.dateRangeSelector=new j(this.handleDateRangeChange.bind(this))}mount(t){if(this.container=document.querySelector(t),!this.container)throw new Error(`App container not found: ${t}`);this.container.innerHTML=this.render(),this.attachComponents()}async handleFiles(t){if(this.currentFiles=t,0===t.length)return void this.results.clear();await this.processAndCalculate();const e=document.getElementById("date-range");e&&e.classList.remove("hidden")}handleDateRangeChange(t){this.currentDateRange=t,this.currentFiles&&this.processAndCalculate()}async processAndCalculate(){if(this.currentFiles)try{this.fileUpload.hideDropZone(),this.progress.show("Processing CSV files...");const t=await async function(t,e){const n=[],r=[],i=[],s=[],o=[],a=[],l=[],u=[],c=[],d=[],f=[],h=t.length;for(let p=0;p<t.length;p++){const g=t[p];e&&e(p/h*100);try{const t=await Ni(g),e=await bi(t,g.name);n.push(...e.transactions),e.optionEvents&&r.push(...e.optionEvents),e.corporateActionRecords&&i.push(...e.corporateActionRecords),e.forexSummaries&&s.push(...e.forexSummaries),e.interestRecords&&o.push(...e.interestRecords),e.dividendRecords&&a.push(...e.dividendRecords),e.withholdingTaxRecords&&l.push(...e.withholdingTaxRecords),e.forexDetailRecords&&u.push(...e.forexDetailRecords),e.forexPLDetailRecords&&c.push(...e.forexPLDetailRecords),e.transactionFees&&d.push(...e.transactionFees),e.cashTransactions&&f.push(...e.cashTransactions)}catch(m){throw new Error(`Error processing ${g.name}: ${m.message}`)}}return e&&e(100),n.sort((t,e)=>{const n=new Date(t.date),r=new Date(e.date);return n.getTime()-r.getTime()}),console.log(`[FileProcessor] Parsed ${n.length} transactions, ${r.length} option events, ${i.length} corporate actions`),{transactions:n,optionEvents:r,corporateActions:i,forexSummaries:s,interestRecords:o,dividendRecords:a,withholdingTaxRecords:l,forexDetailRecords:u,forexPLDetailRecords:c,transactionFees:d,cashTransactions:f}}(this.currentFiles,t=>{this.progress.update(t)});this.progress.show("Calculating tax...");const e=await ki(t,this.currentDateRange);this.progress.hide(),this.results.display(e),this.fileUpload.showFileList()}catch(t){this.progress.hide(),this.results.displayError(t),this.fileUpload.showFileList(),this.fileUpload.showDropZone()}}attachComponents(){const t=document.getElementById("date-range"),e=document.getElementById("file-upload"),n=document.getElementById("progress"),r=document.getElementById("results");t&&(t.innerHTML=this.dateRangeSelector.render(),this.dateRangeSelector.attachEventListeners()),e&&(e.innerHTML=this.fileUpload.render(),this.fileUpload.attachEventListeners()),n&&(n.innerHTML=this.progress.render()),r&&(r.innerHTML=this.results.render())}render(){return'\n      <header class="bg-white shadow-sm">\n        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">\n          <h1 class="text-3xl font-bold text-gray-900">\n            UK Tax Calculator for Interactive Brokers (IBKR)\n          </h1>\n          <p class="mt-2 text-gray-600">\n            Calculate Capital Gains Tax & Income for HMRC Self Assessment\n          </p>\n        </div>\n      </header>\n      \n      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8">\n        <div id="date-range" class="hidden"></div>\n        <div id="progress"></div>\n        <div id="file-upload"></div>\n        <div id="results"></div>\n      </main>\n      \n      <footer class="bg-gray-100 py-8">\n        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">\n          <div class="text-center max-w-4xl mx-auto">\n            <p class="text-lg font-semibold text-gray-900">⚠️ Use at your own risk</p>\n            <p class="mt-3 text-sm text-gray-600">\n              This tool is provided for informational purposes only and does not constitute professional tax, legal, or financial advice. \n              The calculations and reports generated by this tool should not be relied upon as the sole basis for filing your tax return.\n            </p>\n            <p class="mt-2 text-sm text-gray-600">\n              <strong>Important:</strong> You are solely responsible for verifying all calculations, ensuring accuracy, and complying with HMRC regulations. \n              Tax laws are complex and subject to change. We strongly recommend consulting with a qualified tax professional or accountant \n              before submitting any tax returns to HMRC.\n            </p>\n            <p class="mt-2 text-sm text-gray-600">\n              All calculations are performed locally in your browser - your data never leaves your device and is not stored or transmitted anywhere.\n            </p>\n            <p class="mt-3 text-sm text-gray-600">\n              By using this tool, you acknowledge that you understand these limitations and accept full responsibility for your tax filings. \n              The developers and contributors of this tool accept no liability for any errors, omissions, or consequences arising from its use.\n            </p>\n            <p class="mt-3 text-sm text-gray-600">\n              IBKR is a trademark of Interactive Brokers LLC. This tool is not affiliated with, sponsored by, or endorsed by Interactive Brokers.\n            </p>\n            <p class="mt-3 text-sm text-gray-600">\n              © 2025 Simple Capital Gains. All rights reserved.\n            </p>\n            <p class="mt-3 text-sm text-gray-600">\n              Contact: <a href="mailto:contact@brokertaxcalculator.com">contact@brokertaxcalculator.com</a>\n            </p>\n          </div>\n        </div>\n      </footer>\n    '}};Mi.mount("#app");
