var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s);import{B as n,p as s,g as i,c as r}from"./vendor-u2UGDc_C.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class o extends Error{constructor(e,t,s,...i){Array.isArray(t)&&(t=t.join(" ").trim()),super(t),void 0!==Error.captureStackTrace&&Error.captureStackTrace(this,o),this.code=e;for(const r of i)for(const e in r){const t=r[e];this[e]=n.isBuffer(t)?t.toString(s.encoding):null==t?t:JSON.parse(JSON.stringify(t))}}}const a=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},l=function(e){const t=[];for(let n=0,s=e.length;n<s;n++){const s=e[n];if(null==s||!1===s)t[n]={disabled:!0};else if("string"==typeof s)t[n]={name:s};else{if(!a(s))throw new o("CSV_INVALID_COLUMN_DEFINITION",["Invalid column definition:","expect a string or a literal object,",`got ${JSON.stringify(s)} at position ${n}`]);if("string"!=typeof s.name)throw new o("CSV_OPTION_COLUMNS_MISSING_NAME",["Option columns missing name:",`property "name" is required at position ${n}`,"when column is an object literal"]);t[n]=s}}return t};class c{constructor(e=100){this.size=e,this.length=0,this.buf=n.allocUnsafe(e)}prepend(e){if(n.isBuffer(e)){const t=this.length+e.length;if(t>=this.size&&(this.resize(),t>=this.size))throw Error("INVALID_BUFFER_STATE");const s=this.buf;this.buf=n.allocUnsafe(this.size),e.copy(this.buf,0),s.copy(this.buf,e.length),this.length+=e.length}else{const t=this.length++;t===this.size&&this.resize();const n=this.clone();this.buf[0]=e,n.copy(this.buf,1,0,t)}}append(e){const t=this.length++;t===this.size&&this.resize(),this.buf[t]=e}clone(){return n.from(this.buf.slice(0,this.length))}resize(){const e=this.length;this.size=2*this.size;const t=n.allocUnsafe(this.size);this.buf.copy(t,0,0,e),this.buf=t}toString(e){return e?this.buf.slice(0,this.length).toString(e):Uint8Array.prototype.slice.call(this.buf.slice(0,this.length))}toJSON(){return this.toString("utf8")}reset(){this.length=0}}const d=function(e){return{bomSkipped:!1,bufBytesStart:0,castField:e.cast_function,commenting:!1,error:void 0,enabled:1===e.from_line,escaping:!1,escapeIsQuote:n.isBuffer(e.escape)&&n.isBuffer(e.quote)&&0===n.compare(e.escape,e.quote),expectedRecordLength:Array.isArray(e.columns)?e.columns.length:void 0,field:new c(20),firstLineToHeaders:e.cast_first_line_to_header,needMoreDataSize:Math.max(null!==e.comment?e.comment.length:0,...e.delimiter.map(e=>e.length),null!==e.quote?e.quote.length:0),previousBuf:void 0,quoting:!1,stop:!1,rawBuffer:new c(100),record:[],recordHasError:!1,record_length:0,recordDelimiterMaxLength:0===e.record_delimiter.length?0:Math.max(...e.record_delimiter.map(e=>e.length)),trimChars:[n.from(" ",e.encoding)[0],n.from("\t",e.encoding)[0]],wasQuoting:!1,wasRowDelimiter:!1,timchars:[n.from(n.from([13],"utf8").toString(),e.encoding),n.from(n.from([10],"utf8").toString(),e.encoding),n.from(n.from([12],"utf8").toString(),e.encoding),n.from(n.from([32],"utf8").toString(),e.encoding),n.from(n.from([9],"utf8").toString(),e.encoding)]}},u=function(e){return e.replace(/([A-Z])/g,function(e,t){return"_"+t.toLowerCase()})},m=function(e){const t={};for(const n in e)t[u(n)]=e[n];if(void 0===t.encoding||!0===t.encoding)t.encoding="utf8";else if(null===t.encoding||!1===t.encoding)t.encoding=null;else if("string"!=typeof t.encoding&&null!==t.encoding)throw new o("CSV_INVALID_OPTION_ENCODING",["Invalid option encoding:","encoding must be a string or null to return a buffer,",`got ${JSON.stringify(t.encoding)}`],t);if(void 0===t.bom||null===t.bom||!1===t.bom)t.bom=!1;else if(!0!==t.bom)throw new o("CSV_INVALID_OPTION_BOM",["Invalid option bom:","bom must be true,",`got ${JSON.stringify(t.bom)}`],t);if(t.cast_function=null,void 0===t.cast||null===t.cast||!1===t.cast||""===t.cast)t.cast=void 0;else if("function"==typeof t.cast)t.cast_function=t.cast,t.cast=!0;else if(!0!==t.cast)throw new o("CSV_INVALID_OPTION_CAST",["Invalid option cast:","cast must be true or a function,",`got ${JSON.stringify(t.cast)}`],t);if(void 0===t.cast_date||null===t.cast_date||!1===t.cast_date||""===t.cast_date)t.cast_date=!1;else if(!0===t.cast_date)t.cast_date=function(e){const t=Date.parse(e);return isNaN(t)?e:new Date(t)};else if("function"!=typeof t.cast_date)throw new o("CSV_INVALID_OPTION_CAST_DATE",["Invalid option cast_date:","cast_date must be true or a function,",`got ${JSON.stringify(t.cast_date)}`],t);if(t.cast_first_line_to_header=null,!0===t.columns)t.cast_first_line_to_header=void 0;else if("function"==typeof t.columns)t.cast_first_line_to_header=t.columns,t.columns=!0;else if(Array.isArray(t.columns))t.columns=l(t.columns);else{if(void 0!==t.columns&&null!==t.columns&&!1!==t.columns)throw new o("CSV_INVALID_OPTION_COLUMNS",["Invalid option columns:","expect an array, a function or true,",`got ${JSON.stringify(t.columns)}`],t);t.columns=!1}if(void 0===t.group_columns_by_name||null===t.group_columns_by_name||!1===t.group_columns_by_name)t.group_columns_by_name=!1;else{if(!0!==t.group_columns_by_name)throw new o("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","expect an boolean,",`got ${JSON.stringify(t.group_columns_by_name)}`],t);if(!1===t.columns)throw new o("CSV_INVALID_OPTION_GROUP_COLUMNS_BY_NAME",["Invalid option group_columns_by_name:","the `columns` mode must be activated."],t)}if(void 0===t.comment||null===t.comment||!1===t.comment||""===t.comment)t.comment=null;else if("string"==typeof t.comment&&(t.comment=n.from(t.comment,t.encoding)),!n.isBuffer(t.comment))throw new o("CSV_INVALID_OPTION_COMMENT",["Invalid option comment:","comment must be a buffer or a string,",`got ${JSON.stringify(t.comment)}`],t);if(void 0===t.comment_no_infix||null===t.comment_no_infix||!1===t.comment_no_infix)t.comment_no_infix=!1;else if(!0!==t.comment_no_infix)throw new o("CSV_INVALID_OPTION_COMMENT",["Invalid option comment_no_infix:","value must be a boolean,",`got ${JSON.stringify(t.comment_no_infix)}`],t);const s=JSON.stringify(t.delimiter);if(Array.isArray(t.delimiter)||(t.delimiter=[t.delimiter]),0===t.delimiter.length)throw new o("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${s}`],t);if(t.delimiter=t.delimiter.map(function(e){if(null==e||!1===e)return n.from(",",t.encoding);if("string"==typeof e&&(e=n.from(e,t.encoding)),!n.isBuffer(e)||0===e.length)throw new o("CSV_INVALID_OPTION_DELIMITER",["Invalid option delimiter:","delimiter must be a non empty string or buffer or array of string|buffer,",`got ${s}`],t);return e}),void 0===t.escape||!0===t.escape?t.escape=n.from('"',t.encoding):"string"==typeof t.escape?t.escape=n.from(t.escape,t.encoding):null!==t.escape&&!1!==t.escape||(t.escape=null),null!==t.escape&&!n.isBuffer(t.escape))throw new Error(`Invalid Option: escape must be a buffer, a string or a boolean, got ${JSON.stringify(t.escape)}`);if(void 0===t.from||null===t.from)t.from=1;else{if("string"==typeof t.from&&/\d+/.test(t.from)&&(t.from=parseInt(t.from)),!Number.isInteger(t.from))throw new Error(`Invalid Option: from must be an integer, got ${JSON.stringify(t.from)}`);if(t.from<0)throw new Error(`Invalid Option: from must be a positive integer, got ${JSON.stringify(e.from)}`)}if(void 0===t.from_line||null===t.from_line)t.from_line=1;else{if("string"==typeof t.from_line&&/\d+/.test(t.from_line)&&(t.from_line=parseInt(t.from_line)),!Number.isInteger(t.from_line))throw new Error(`Invalid Option: from_line must be an integer, got ${JSON.stringify(e.from_line)}`);if(t.from_line<=0)throw new Error(`Invalid Option: from_line must be a positive integer greater than 0, got ${JSON.stringify(e.from_line)}`)}if(void 0===t.ignore_last_delimiters||null===t.ignore_last_delimiters)t.ignore_last_delimiters=!1;else if("number"==typeof t.ignore_last_delimiters)t.ignore_last_delimiters=Math.floor(t.ignore_last_delimiters),0===t.ignore_last_delimiters&&(t.ignore_last_delimiters=!1);else if("boolean"!=typeof t.ignore_last_delimiters)throw new o("CSV_INVALID_OPTION_IGNORE_LAST_DELIMITERS",["Invalid option `ignore_last_delimiters`:","the value must be a boolean value or an integer,",`got ${JSON.stringify(t.ignore_last_delimiters)}`],t);if(!0===t.ignore_last_delimiters&&!1===t.columns)throw new o("CSV_IGNORE_LAST_DELIMITERS_REQUIRES_COLUMNS",["The option `ignore_last_delimiters`","requires the activation of the `columns` option"],t);if(void 0===t.info||null===t.info||!1===t.info)t.info=!1;else if(!0!==t.info)throw new Error(`Invalid Option: info must be true, got ${JSON.stringify(t.info)}`);if(void 0===t.max_record_size||null===t.max_record_size||!1===t.max_record_size)t.max_record_size=0;else if(Number.isInteger(t.max_record_size)&&t.max_record_size>=0);else{if("string"!=typeof t.max_record_size||!/\d+/.test(t.max_record_size))throw new Error(`Invalid Option: max_record_size must be a positive integer, got ${JSON.stringify(t.max_record_size)}`);t.max_record_size=parseInt(t.max_record_size)}if(void 0===t.objname||null===t.objname||!1===t.objname)t.objname=void 0;else if(n.isBuffer(t.objname)){if(0===t.objname.length)throw new Error("Invalid Option: objname must be a non empty buffer");null===t.encoding||(t.objname=t.objname.toString(t.encoding))}else if("string"==typeof t.objname){if(0===t.objname.length)throw new Error("Invalid Option: objname must be a non empty string")}else if("number"!=typeof t.objname)throw new Error(`Invalid Option: objname must be a string or a buffer, got ${t.objname}`);if(void 0!==t.objname)if("number"==typeof t.objname){if(!1!==t.columns)throw Error("Invalid Option: objname index cannot be combined with columns or be defined as a field")}else if(!1===t.columns)throw Error("Invalid Option: objname field must be combined with columns or be defined as an index");if(void 0===t.on_record||null===t.on_record)t.on_record=void 0;else if("function"!=typeof t.on_record)throw new o("CSV_INVALID_OPTION_ON_RECORD",["Invalid option `on_record`:","expect a function,",`got ${JSON.stringify(t.on_record)}`],t);if(void 0!==t.on_skip&&null!==t.on_skip&&"function"!=typeof t.on_skip)throw new Error(`Invalid Option: on_skip must be a function, got ${JSON.stringify(t.on_skip)}`);if(null===t.quote||!1===t.quote||""===t.quote)t.quote=null;else if(void 0===t.quote||!0===t.quote?t.quote=n.from('"',t.encoding):"string"==typeof t.quote&&(t.quote=n.from(t.quote,t.encoding)),!n.isBuffer(t.quote))throw new Error(`Invalid Option: quote must be a buffer or a string, got ${JSON.stringify(t.quote)}`);if(void 0===t.raw||null===t.raw||!1===t.raw)t.raw=!1;else if(!0!==t.raw)throw new Error(`Invalid Option: raw must be true, got ${JSON.stringify(t.raw)}`);if(void 0===t.record_delimiter)t.record_delimiter=[];else if("string"==typeof t.record_delimiter||n.isBuffer(t.record_delimiter)){if(0===t.record_delimiter.length)throw new o("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer,",`got ${JSON.stringify(t.record_delimiter)}`],t);t.record_delimiter=[t.record_delimiter]}else if(!Array.isArray(t.record_delimiter))throw new o("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer,",`got ${JSON.stringify(t.record_delimiter)}`],t);if(t.record_delimiter=t.record_delimiter.map(function(e,s){if("string"!=typeof e&&!n.isBuffer(e))throw new o("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a string, a buffer or array of string|buffer",`at index ${s},`,`got ${JSON.stringify(e)}`],t);if(0===e.length)throw new o("CSV_INVALID_OPTION_RECORD_DELIMITER",["Invalid option `record_delimiter`:","value must be a non empty string or buffer",`at index ${s},`,`got ${JSON.stringify(e)}`],t);return"string"==typeof e&&(e=n.from(e,t.encoding)),e}),"boolean"==typeof t.relax_column_count);else{if(void 0!==t.relax_column_count&&null!==t.relax_column_count)throw new Error(`Invalid Option: relax_column_count must be a boolean, got ${JSON.stringify(t.relax_column_count)}`);t.relax_column_count=!1}if("boolean"==typeof t.relax_column_count_less);else{if(void 0!==t.relax_column_count_less&&null!==t.relax_column_count_less)throw new Error(`Invalid Option: relax_column_count_less must be a boolean, got ${JSON.stringify(t.relax_column_count_less)}`);t.relax_column_count_less=!1}if("boolean"==typeof t.relax_column_count_more);else{if(void 0!==t.relax_column_count_more&&null!==t.relax_column_count_more)throw new Error(`Invalid Option: relax_column_count_more must be a boolean, got ${JSON.stringify(t.relax_column_count_more)}`);t.relax_column_count_more=!1}if("boolean"==typeof t.relax_quotes);else{if(void 0!==t.relax_quotes&&null!==t.relax_quotes)throw new Error(`Invalid Option: relax_quotes must be a boolean, got ${JSON.stringify(t.relax_quotes)}`);t.relax_quotes=!1}if("boolean"==typeof t.skip_empty_lines);else{if(void 0!==t.skip_empty_lines&&null!==t.skip_empty_lines)throw new Error(`Invalid Option: skip_empty_lines must be a boolean, got ${JSON.stringify(t.skip_empty_lines)}`);t.skip_empty_lines=!1}if("boolean"==typeof t.skip_records_with_empty_values);else{if(void 0!==t.skip_records_with_empty_values&&null!==t.skip_records_with_empty_values)throw new Error(`Invalid Option: skip_records_with_empty_values must be a boolean, got ${JSON.stringify(t.skip_records_with_empty_values)}`);t.skip_records_with_empty_values=!1}if("boolean"==typeof t.skip_records_with_error);else{if(void 0!==t.skip_records_with_error&&null!==t.skip_records_with_error)throw new Error(`Invalid Option: skip_records_with_error must be a boolean, got ${JSON.stringify(t.skip_records_with_error)}`);t.skip_records_with_error=!1}if(void 0===t.rtrim||null===t.rtrim||!1===t.rtrim)t.rtrim=!1;else if(!0!==t.rtrim)throw new Error(`Invalid Option: rtrim must be a boolean, got ${JSON.stringify(t.rtrim)}`);if(void 0===t.ltrim||null===t.ltrim||!1===t.ltrim)t.ltrim=!1;else if(!0!==t.ltrim)throw new Error(`Invalid Option: ltrim must be a boolean, got ${JSON.stringify(t.ltrim)}`);if(void 0===t.trim||null===t.trim||!1===t.trim)t.trim=!1;else if(!0!==t.trim)throw new Error(`Invalid Option: trim must be a boolean, got ${JSON.stringify(t.trim)}`);if(!0===t.trim&&!1!==e.ltrim?t.ltrim=!0:!0!==t.ltrim&&(t.ltrim=!1),!0===t.trim&&!1!==e.rtrim?t.rtrim=!0:!0!==t.rtrim&&(t.rtrim=!1),void 0===t.to||null===t.to)t.to=-1;else{if("string"==typeof t.to&&/\d+/.test(t.to)&&(t.to=parseInt(t.to)),!Number.isInteger(t.to))throw new Error(`Invalid Option: to must be an integer, got ${JSON.stringify(e.to)}`);if(t.to<=0)throw new Error(`Invalid Option: to must be a positive integer greater than 0, got ${JSON.stringify(e.to)}`)}if(void 0===t.to_line||null===t.to_line)t.to_line=-1;else{if("string"==typeof t.to_line&&/\d+/.test(t.to_line)&&(t.to_line=parseInt(t.to_line)),!Number.isInteger(t.to_line))throw new Error(`Invalid Option: to_line must be an integer, got ${JSON.stringify(e.to_line)}`);if(t.to_line<=0)throw new Error(`Invalid Option: to_line must be a positive integer greater than 0, got ${JSON.stringify(e.to_line)}`)}return t},h=function(e){return e.every(e=>null==e||e.toString&&""===e.toString().trim())},g={utf8:n.from([239,187,191]),utf16le:n.from([255,254])},f=function(e,t={}){"string"==typeof e&&(e=n.from(e));const s=t&&t.objname?{}:[],i=function(e={}){const t=m(e);return{info:{bytes:0,comment_lines:0,empty_lines:0,invalid_field_length:0,lines:1,records:0},original_options:e,options:t,state:d(t),__needMoreData:function(e,t,s){if(s)return!1;const{encoding:i,escape:r,quote:o}=this.options,{quoting:a,needMoreDataSize:l,recordDelimiterMaxLength:c}=this.state;return t-e-1<Math.max(l,0===c?n.from("\r\n",i).length:c,a?(null===r?0:r.length)+o.length:0,a?o.length+c:0)},parse:function(e,t,s,i){const{bom:r,comment_no_infix:a,encoding:l,from_line:c,ltrim:d,max_record_size:u,raw:h,relax_quotes:f,rtrim:p,skip_empty_lines:y,to:b,to_line:x}=this.options;let{comment:v,escape:w,quote:C,record_delimiter:S}=this.options;const{bomSkipped:T,previousBuf:I,rawBuffer:D,escapeIsQuote:E}=this.state;let _;if(void 0===I){if(void 0===e)return void i();_=e}else _=void 0!==I&&void 0===e?I:n.concat([I,e]);if(!1===T)if(!1===r)this.state.bomSkipped=!0;else if(_.length<3){if(!1===t)return void(this.state.previousBuf=_)}else{for(const e in g)if(0===g[e].compare(_,0,g[e].length)){const t=g[e].length;this.state.bufBytesStart+=t,_=_.slice(t),this.options=m({...this.original_options,encoding:e}),({comment:v,escape:w,quote:C}=this.options);break}this.state.bomSkipped=!0}const R=_.length;let k;for(k=0;k<R&&!this.__needMoreData(k,R,t);k++){if(!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1),-1!==x&&this.info.lines>x)return this.state.stop=!0,void i();!1===this.state.quoting&&0===S.length&&this.__autoDiscoverRecordDelimiter(_,k)&&(S=this.options.record_delimiter);const e=_[k];if(!0===h&&D.append(e),13!==e&&10!==e||!1!==this.state.wasRowDelimiter||(this.state.wasRowDelimiter=!0),!0===this.state.escaping)this.state.escaping=!1;else{if(null!==w&&!0===this.state.quoting&&this.__isEscape(_,k,e)&&k+w.length<R){if(!E){this.state.escaping=!0,k+=w.length-1;continue}if(this.__isQuote(_,k+w.length)){this.state.escaping=!0,k+=w.length-1;continue}}if(!1===this.state.commenting&&this.__isQuote(_,k))if(!0===this.state.quoting){const t=_[k+C.length],n=p&&this.__isCharTrimable(_,k+C.length),s=null!==v&&this.__compareBytes(v,_,k+C.length,t),i=this.__isDelimiter(_,k+C.length,t),r=0===S.length?this.__autoDiscoverRecordDelimiter(_,k+C.length):this.__isRecordDelimiter(t,_,k+C.length);if(null!==w&&this.__isEscape(_,k,e)&&this.__isQuote(_,k+w.length))k+=w.length-1;else{if(!t||i||r||s||n){this.state.quoting=!1,this.state.wasQuoting=!0,k+=C.length-1;continue}if(!1===f){const e=this.__error(new o("CSV_INVALID_CLOSING_QUOTE",["Invalid Closing Quote:",`got "${String.fromCharCode(t)}"`,`at line ${this.info.lines}`,"instead of delimiter, record delimiter, trimable character","(if activated) or comment"],this.options,this.__infoField()));if(void 0!==e)return e}else this.state.quoting=!1,this.state.wasQuoting=!0,this.state.field.prepend(C),k+=C.length-1}}else{if(0===this.state.field.length){this.state.quoting=!0,k+=C.length-1;continue}if(!1===f){const e=this.__infoField(),t=Object.keys(g).map(e=>!!g[e].equals(this.state.field.toString())&&e).filter(Boolean)[0],n=this.__error(new o("INVALID_OPENING_QUOTE",["Invalid Opening Quote:",`a quote is found on field ${JSON.stringify(e.column)} at line ${e.lines}, value is ${JSON.stringify(this.state.field.toString(l))}`,t?`(${t} bom)`:void 0],this.options,e,{field:this.state.field}));if(void 0!==n)return n}}if(!1===this.state.quoting){const t=this.__isRecordDelimiter(e,_,k);if(0!==t){if(this.state.commenting&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length)this.info.comment_lines++;else{if(!1===this.state.enabled&&this.info.lines+(!0===this.state.wasRowDelimiter?1:0)>=c){this.state.enabled=!0,this.__resetField(),this.__resetRecord(),k+=t-1;continue}if(!0===y&&!1===this.state.wasQuoting&&0===this.state.record.length&&0===this.state.field.length){this.info.empty_lines++,k+=t-1;continue}this.info.bytes=this.state.bufBytesStart+k;const e=this.__onField();if(void 0!==e)return e;this.info.bytes=this.state.bufBytesStart+k+t;const n=this.__onRecord(s);if(void 0!==n)return n;if(-1!==b&&this.info.records>=b)return this.state.stop=!0,void i()}this.state.commenting=!1,k+=t-1;continue}if(this.state.commenting)continue;if(null!==v&&(!1===a||0===this.state.record.length&&0===this.state.field.length)&&0!==this.__compareBytes(v,_,k,e)){this.state.commenting=!0;continue}const n=this.__isDelimiter(_,k,e);if(0!==n){this.info.bytes=this.state.bufBytesStart+k;const e=this.__onField();if(void 0!==e)return e;k+=n-1;continue}}}if(!1===this.state.commenting&&0!==u&&this.state.record_length+this.state.field.length>u)return this.__error(new o("CSV_MAX_RECORD_SIZE",["Max Record Size:","record exceed the maximum number of tolerated bytes",`of ${u}`,`at line ${this.info.lines}`],this.options,this.__infoField()));const t=!1===d||!0===this.state.quoting||0!==this.state.field.length||!this.__isCharTrimable(_,k),n=!1===p||!1===this.state.wasQuoting;if(!0!==t||!0!==n){if(!0!==p||this.__isCharTrimable(_,k)){!1===t&&(k+=this.__isCharTrimable(_,k)-1);continue}return this.__error(new o("CSV_NON_TRIMABLE_CHAR_AFTER_CLOSING_QUOTE",["Invalid Closing Quote:","found non trimable byte after quote",`at line ${this.info.lines}`],this.options,this.__infoField()))}this.state.field.append(e)}if(!0===t)if(!0===this.state.quoting){const e=this.__error(new o("CSV_QUOTE_NOT_CLOSED",["Quote Not Closed:",`the parsing is finished with an opening quote at line ${this.info.lines}`],this.options,this.__infoField()));if(void 0!==e)return e}else if(!0===this.state.wasQuoting||0!==this.state.record.length||0!==this.state.field.length){this.info.bytes=this.state.bufBytesStart+k;const e=this.__onField();if(void 0!==e)return e;const t=this.__onRecord(s);if(void 0!==t)return t}else!0===this.state.wasRowDelimiter?this.info.empty_lines++:!0===this.state.commenting&&this.info.comment_lines++;else this.state.bufBytesStart+=k,this.state.previousBuf=_.slice(k);!0===this.state.wasRowDelimiter&&(this.info.lines++,this.state.wasRowDelimiter=!1)},__onRecord:function(e){const{columns:t,group_columns_by_name:n,encoding:s,info:i,from:r,relax_column_count:a,relax_column_count_less:l,relax_column_count_more:c,raw:d,skip_records_with_empty_values:u}=this.options,{enabled:m,record:g}=this.state;if(!1===m)return this.__resetRecord();const f=g.length;if(!0===t)return!0===u&&h(g)?void this.__resetRecord():this.__firstLineToColumns(g);if(!1===t&&0===this.info.records&&(this.state.expectedRecordLength=f),f!==this.state.expectedRecordLength){const e=!1===t?new o("CSV_RECORD_INCONSISTENT_FIELDS_LENGTH",["Invalid Record Length:",`expect ${this.state.expectedRecordLength},`,`got ${f} on line ${this.info.lines}`],this.options,this.__infoField(),{record:g}):new o("CSV_RECORD_INCONSISTENT_COLUMNS",["Invalid Record Length:",`columns length is ${t.length},`,`got ${f} on line ${this.info.lines}`],this.options,this.__infoField(),{record:g});if(!0===a||!0===l&&f<this.state.expectedRecordLength||!0===c&&f>this.state.expectedRecordLength)this.info.invalid_field_length++,this.state.error=e;else{const t=this.__error(e);if(t)return t}}if(!0===u&&h(g))this.__resetRecord();else{if(!0===this.state.recordHasError)return this.__resetRecord(),void(this.state.recordHasError=!1);if(this.info.records++,1===r||this.info.records>=r){const{objname:r}=this.options;if(!1!==t){const o={};for(let e=0,s=g.length;e<s;e++)void 0===t[e]||t[e].disabled||(!0===n&&void 0!==o[t[e].name]?Array.isArray(o[t[e].name])?o[t[e].name]=o[t[e].name].concat(g[e]):o[t[e].name]=[o[t[e].name],g[e]]:o[t[e].name]=g[e]);if(!0===d||!0===i){const t=Object.assign({record:o},!0===d?{raw:this.state.rawBuffer.toString(s)}:{},!0===i?{info:this.__infoRecord()}:{}),n=this.__push(void 0===r?t:[o[r],t],e);if(n)return n}else{const t=this.__push(void 0===r?o:[o[r],o],e);if(t)return t}}else if(!0===d||!0===i){const t=Object.assign({record:g},!0===d?{raw:this.state.rawBuffer.toString(s)}:{},!0===i?{info:this.__infoRecord()}:{}),n=this.__push(void 0===r?t:[g[r],t],e);if(n)return n}else{const t=this.__push(void 0===r?g:[g[r],g],e);if(t)return t}}this.__resetRecord()}},__firstLineToColumns:function(e){const{firstLineToHeaders:t}=this.state;try{const n=void 0===t?e:t.call(null,e);if(!Array.isArray(n))return this.__error(new o("CSV_INVALID_COLUMN_MAPPING",["Invalid Column Mapping:","expect an array from column function,",`got ${JSON.stringify(n)}`],this.options,this.__infoField(),{headers:n}));const s=l(n);return this.state.expectedRecordLength=s.length,this.options.columns=s,void this.__resetRecord()}catch(n){return n}},__resetRecord:function(){!0===this.options.raw&&this.state.rawBuffer.reset(),this.state.error=void 0,this.state.record=[],this.state.record_length=0},__onField:function(){const{cast:e,encoding:t,rtrim:n,max_record_size:s}=this.options,{enabled:i,wasQuoting:r}=this.state;if(!1===i)return this.__resetField();let o=this.state.field.toString(t);if(!0===n&&!1===r&&(o=o.trimRight()),!0===e){const[e,t]=this.__cast(o);if(void 0!==e)return e;o=t}this.state.record.push(o),0!==s&&"string"==typeof o&&(this.state.record_length+=o.length),this.__resetField()},__resetField:function(){this.state.field.reset(),this.state.wasQuoting=!1},__push:function(e,t){const{on_record:n}=this.options;if(void 0!==n){const t=this.__infoRecord();try{e=n.call(null,e,t)}catch(s){return s}if(null==e)return}t(e)},__cast:function(e){const{columns:t,relax_column_count:n}=this.options;if(!0===Array.isArray(t)&&n&&this.options.columns.length<=this.state.record.length)return[void 0,void 0];if(null!==this.state.castField)try{const t=this.__infoField();return[void 0,this.state.castField.call(null,e,t)]}catch(s){return[s]}if(this.__isFloat(e))return[void 0,parseFloat(e)];if(!1!==this.options.cast_date){const t=this.__infoField();return[void 0,this.options.cast_date.call(null,e,t)]}return[void 0,e]},__isCharTrimable:function(e,t){return((e,t)=>{const{timchars:n}=this.state;e:for(let s=0;s<n.length;s++){const i=n[s];for(let n=0;n<i.length;n++)if(i[n]!==e[t+n])continue e;return i.length}return 0})(e,t)},__isFloat:function(e){return e-parseFloat(e)+1>=0},__compareBytes:function(e,t,n,s){if(e[0]!==s)return 0;const i=e.length;for(let r=1;r<i;r++)if(e[r]!==t[n+r])return 0;return i},__isDelimiter:function(e,t,n){const{delimiter:s,ignore_last_delimiters:i}=this.options;if(!0===i&&this.state.record.length===this.options.columns.length-1)return 0;if(!1!==i&&"number"==typeof i&&this.state.record.length===i-1)return 0;e:for(let r=0;r<s.length;r++){const i=s[r];if(i[0]===n){for(let n=1;n<i.length;n++)if(i[n]!==e[t+n])continue e;return i.length}}return 0},__isRecordDelimiter:function(e,t,n){const{record_delimiter:s}=this.options,i=s.length;e:for(let r=0;r<i;r++){const i=s[r],o=i.length;if(i[0]===e){for(let e=1;e<o;e++)if(i[e]!==t[n+e])continue e;return i.length}}return 0},__isEscape:function(e,t,n){const{escape:s}=this.options;if(null===s)return!1;const i=s.length;if(s[0]===n){for(let n=0;n<i;n++)if(s[n]!==e[t+n])return!1;return!0}return!1},__isQuote:function(e,t){const{quote:n}=this.options;if(null===n)return!1;const s=n.length;for(let i=0;i<s;i++)if(n[i]!==e[t+i])return!1;return!0},__autoDiscoverRecordDelimiter:function(e,t){const{encoding:s}=this.options,i=[n.from("\r\n",s),n.from("\n",s),n.from("\r",s)];e:for(let n=0;n<i.length;n++){const s=i[n].length;for(let r=0;r<s;r++)if(i[n][r]!==e[t+r])continue e;return this.options.record_delimiter.push(i[n]),this.state.recordDelimiterMaxLength=i[n].length,i[n].length}return 0},__error:function(e){const{encoding:t,raw:n,skip_records_with_error:s}=this.options,i="string"==typeof e?new Error(e):e;return s?(this.state.recordHasError=!0,void(void 0!==this.options.on_skip&&this.options.on_skip(i,n?this.state.rawBuffer.toString(t):void 0))):i},__infoDataSet:function(){return{...this.info,columns:this.options.columns}},__infoRecord:function(){const{columns:e,raw:t,encoding:n}=this.options;return{...this.__infoDataSet(),error:this.state.error,header:!0===e,index:this.state.record.length,raw:t?this.state.rawBuffer.toString(n):void 0}},__infoField:function(){const{columns:e}=this.options,t=Array.isArray(e);return{...this.__infoRecord(),column:!0===t?e.length>this.state.record.length?e[this.state.record.length].name:null:this.state.record.length,quoting:this.state.wasQuoting}}}}(t),r=e=>{void 0===i.options.objname?s.push(e):s[e[0]]=e[1]},a=()=>{},c=i.parse(e,!1,r,a);if(void 0!==c)throw c;const u=i.parse(void 0,!0,r,a);if(void 0!==u)throw u;return s};class p extends Error{}class y extends p{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class b extends p{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class x extends p{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class v extends p{}class w extends p{constructor(e){super(`Invalid unit ${e}`)}}class C extends p{}class S extends p{constructor(){super("Zone is an abstract class")}}const T="numeric",I="short",D="long",E={year:T,month:T,day:T},_={year:T,month:I,day:T},R={year:T,month:I,day:T,weekday:I},k={year:T,month:D,day:T},O={year:T,month:D,day:T,weekday:D},A={hour:T,minute:T},M={hour:T,minute:T,second:T},N={hour:T,minute:T,second:T,timeZoneName:I},P={hour:T,minute:T,second:T,timeZoneName:D},$={hour:T,minute:T,hourCycle:"h23"},F={hour:T,minute:T,second:T,hourCycle:"h23"},L={hour:T,minute:T,second:T,hourCycle:"h23",timeZoneName:I},B={hour:T,minute:T,second:T,hourCycle:"h23",timeZoneName:D},U={year:T,month:T,day:T,hour:T,minute:T},G={year:T,month:T,day:T,hour:T,minute:T,second:T},q={year:T,month:I,day:T,hour:T,minute:T},V={year:T,month:I,day:T,hour:T,minute:T,second:T},W={year:T,month:I,day:T,weekday:I,hour:T,minute:T},j={year:T,month:D,day:T,hour:T,minute:T,timeZoneName:I},z={year:T,month:D,day:T,hour:T,minute:T,second:T,timeZoneName:I},H={year:T,month:D,day:T,weekday:D,hour:T,minute:T,timeZoneName:D},Y={year:T,month:D,day:T,weekday:D,hour:T,minute:T,second:T,timeZoneName:D};class Q{get type(){throw new S}get name(){throw new S}get ianaName(){return this.name}get isUniversal(){throw new S}offsetName(e,t){throw new S}formatOffset(e,t){throw new S}offset(e){throw new S}equals(e){throw new S}get isValid(){throw new S}}let Z=null;class J extends Q{static get instance(){return null===Z&&(Z=new J),Z}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return yt(e,t,n)}formatOffset(e,t){return wt(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}const X=new Map;const K={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};const ee=new Map;class te extends Q{static create(e){let t=ee.get(e);return void 0===t&&ee.set(e,t=new te(e)),t}static resetCache(){ee.clear(),X.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(t){return!1}}constructor(e){super(),this.zoneName=e,this.valid=te.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return yt(e,t,n,this.name)}formatOffset(e,t){return wt(this.offset(e),t)}offset(e){if(!this.valid)return NaN;const t=new Date(e);if(isNaN(t))return NaN;const n=function(e){let t=X.get(e);return void 0===t&&(t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),X.set(e,t)),t}(this.name);let[s,i,r,o,a,l,c]=n.formatToParts?function(e,t){const n=e.formatToParts(t),s=[];for(let i=0;i<n.length;i++){const{type:e,value:t}=n[i],r=K[e];"era"===e?s[r]=t:Ze(r)||(s[r]=parseInt(t,10))}return s}(n,t):function(e,t){const n=e.format(t).replace(/\u200E/g,""),s=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,i,r,o,a,l,c,d]=s;return[o,i,r,a,l,c,d]}(n,t);"BC"===o&&(s=1-Math.abs(s));let d=+t;const u=d%1e3;return d-=u>=0?u:1e3+u,(ht({year:s,month:i,day:r,hour:24===a?0:a,minute:l,second:c,millisecond:0})-d)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let ne={};const se=new Map;function ie(e,t={}){const n=JSON.stringify([e,t]);let s=se.get(n);return void 0===s&&(s=new Intl.DateTimeFormat(e,t),se.set(n,s)),s}const re=new Map;const oe=new Map;let ae=null;const le=new Map;function ce(e){let t=le.get(e);return void 0===t&&(t=new Intl.DateTimeFormat(e).resolvedOptions(),le.set(e,t)),t}const de=new Map;function ue(e,t,n,s){const i=e.listingMode();return"error"===i?null:"en"===i?n(t):s(t)}class me{constructor(e,t,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:s,floor:i,...r}=n;if(!t||Object.keys(r).length>0){const t={useGrouping:!1,...n};n.padTo>0&&(t.minimumIntegerDigits=n.padTo),this.inf=function(e,t={}){const n=JSON.stringify([e,t]);let s=re.get(n);return void 0===s&&(s=new Intl.NumberFormat(e,t),re.set(n,s)),s}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return rt(this.floor?Math.floor(e):ct(e,3),this.padTo)}}class he{constructor(e,t,n){let s;if(this.opts=n,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,n=t>=0?`Etc/GMT+${t}`:`Etc/GMT${t}`;0!==e.offset&&te.create(n).valid?(s=n,this.dt=e):(s="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,s=e.zone.name):(s="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const i={...this.opts};i.timeZone=i.timeZone||s,this.dtf=ie(t,i)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...e,value:t}}return e}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class ge{constructor(e,t,n){this.opts={style:"long",...n},!t&&Ke()&&(this.rtf=function(e,t={}){const{base:n,...s}=t,i=JSON.stringify([e,s]);let r=oe.get(i);return void 0===r&&(r=new Intl.RelativeTimeFormat(e,t),oe.set(i,r)),r}(e,n))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,n="always",s=!1){const i={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},r=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===n&&r){const n="days"===e;switch(t){case 1:return n?"tomorrow":`next ${i[e][0]}`;case-1:return n?"yesterday":`last ${i[e][0]}`;case 0:return n?"today":`this ${i[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=1===a,c=i[e],d=s?l?c[1]:c[2]||c[1]:l?i[e][0]:e;return o?`${a} ${d} ago`:`in ${a} ${d}`}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const fe={firstDay:1,minimalDays:4,weekend:[6,7]};class pe{static fromOpts(e){return pe.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,n,s,i=!1){const r=e||Ne.defaultLocale,o=r||(i?"en-US":ae||(ae=(new Intl.DateTimeFormat).resolvedOptions().locale,ae)),a=t||Ne.defaultNumberingSystem,l=n||Ne.defaultOutputCalendar,c=st(s)||Ne.defaultWeekSettings;return new pe(o,a,l,c,r)}static resetCache(){ae=null,se.clear(),re.clear(),oe.clear(),le.clear(),de.clear()}static fromObject({locale:e,numberingSystem:t,outputCalendar:n,weekSettings:s}={}){return pe.create(e,t,n,s)}constructor(e,t,n,s,i){const[r,o,a]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const n=e.indexOf("-u-");if(-1===n)return[e];{let t,i;try{t=ie(e).resolvedOptions(),i=e}catch(s){const r=e.substring(0,n);t=ie(r).resolvedOptions(),i=r}const{numberingSystem:r,calendar:o}=t;return[i,r,o]}}(e);this.locale=r,this.numberingSystem=t||o||null,this.outputCalendar=n||a||null,this.weekSettings=s,this.intl=function(e,t,n){return n||t?(e.includes("-u-")||(e+="-u"),n&&(e+=`-ca-${n}`),t&&(e+=`-nu-${t}`),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=i,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===ce(e.locale).numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?pe.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,st(e.weekSettings)||this.weekSettings,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return ue(this,e,Dt,()=>{const n="ja"===this.intl||this.intl.startsWith("ja-"),s=(t&=!n)?{month:e,day:"numeric"}:{month:e},i=t?"format":"standalone";if(!this.monthsCache[i][e]){const t=n?e=>this.dtFormatter(e,s).format():e=>this.extract(e,s,"month");this.monthsCache[i][e]=function(e){const t=[];for(let n=1;n<=12;n++){const s=As.utc(2009,n,1);t.push(e(s))}return t}(t)}return this.monthsCache[i][e]})}weekdays(e,t=!1){return ue(this,e,kt,()=>{const n=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=t?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=function(e){const t=[];for(let n=1;n<=7;n++){const s=As.utc(2016,11,13+n);t.push(e(s))}return t}(e=>this.extract(e,n,"weekday"))),this.weekdaysCache[s][e]})}meridiems(){return ue(this,void 0,()=>Ot,()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[As.utc(2016,11,13,9),As.utc(2016,11,13,19)].map(t=>this.extract(t,e,"dayperiod"))}return this.meridiemCache})}eras(e){return ue(this,e,Pt,()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[As.utc(-40,1,1),As.utc(2017,1,1)].map(e=>this.extract(e,t,"era"))),this.eraCache[e]})}extract(e,t,n){const s=this.dtFormatter(e,t).formatToParts().find(e=>e.type.toLowerCase()===n);return s?s.value:null}numberFormatter(e={}){return new me(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new he(e,this.intl,t)}relFormatter(e={}){return new ge(this.intl,this.isEnglish(),e)}listFormatter(e={}){return function(e,t={}){const n=JSON.stringify([e,t]);let s=ne[n];return s||(s=new Intl.ListFormat(e,t),ne[n]=s),s}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||ce(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:et()?function(e){let t=de.get(e);if(!t){const n=new Intl.Locale(e);t="getWeekInfo"in n?n.getWeekInfo():n.weekInfo,"minimalDays"in t||(t={...fe,...t}),de.set(e,t)}return t}(this.locale):fe}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let ye=null;class be extends Q{static get utcInstance(){return null===ye&&(ye=new be(0)),ye}static instance(e){return 0===e?be.utcInstance:new be(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new be(bt(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${wt(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${wt(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return wt(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class xe extends Q{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function ve(e,t){if(Ze(e)||null===e)return t;if(e instanceof Q)return e;if("string"==typeof e){const n=e.toLowerCase();return"default"===n?t:"local"===n||"system"===n?J.instance:"utc"===n||"gmt"===n?be.utcInstance:be.parseSpecifier(n)||te.create(e)}return Je(e)?be.instance(e):"object"==typeof e&&"offset"in e&&"function"==typeof e.offset?e:new xe(e)}const we={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},Ce={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Se=we.hanidec.replace(/[\[|\]]/g,"").split("");const Te=new Map;function Ie({numberingSystem:e},t=""){const n=e||"latn";let s=Te.get(n);void 0===s&&(s=new Map,Te.set(n,s));let i=s.get(t);return void 0===i&&(i=new RegExp(`${we[n]}${t}`),s.set(t,i)),i}let De,Ee=()=>Date.now(),_e="system",Re=null,ke=null,Oe=null,Ae=60,Me=null;class Ne{static get now(){return Ee}static set now(e){Ee=e}static set defaultZone(e){_e=e}static get defaultZone(){return ve(_e,J.instance)}static get defaultLocale(){return Re}static set defaultLocale(e){Re=e}static get defaultNumberingSystem(){return ke}static set defaultNumberingSystem(e){ke=e}static get defaultOutputCalendar(){return Oe}static set defaultOutputCalendar(e){Oe=e}static get defaultWeekSettings(){return Me}static set defaultWeekSettings(e){Me=st(e)}static get twoDigitCutoffYear(){return Ae}static set twoDigitCutoffYear(e){Ae=e%100}static get throwOnInvalid(){return De}static set throwOnInvalid(e){De=e}static resetCaches(){pe.resetCache(),te.resetCache(),As.resetCache(),Te.clear()}}class Pe{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const $e=[0,31,59,90,120,151,181,212,243,273,304,334],Fe=[0,31,60,91,121,152,182,213,244,274,305,335];function Le(e,t){return new Pe("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function Be(e,t,n){const s=new Date(Date.UTC(e,t-1,n));e<100&&e>=0&&s.setUTCFullYear(s.getUTCFullYear()-1900);const i=s.getUTCDay();return 0===i?7:i}function Ue(e,t,n){return n+(dt(e)?Fe:$e)[t-1]}function Ge(e,t){const n=dt(e)?Fe:$e,s=n.findIndex(e=>e<t);return{month:s+1,day:t-n[s]}}function qe(e,t){return(e-t+7)%7+1}function Ve(e,t=4,n=1){const{year:s,month:i,day:r}=e,o=Ue(s,i,r),a=qe(Be(s,i,r),n);let l,c=Math.floor((o-a+14-t)/7);return c<1?(l=s-1,c=ft(l,t,n)):c>ft(s,t,n)?(l=s+1,c=1):l=s,{weekYear:l,weekNumber:c,weekday:a,...Ct(e)}}function We(e,t=4,n=1){const{weekYear:s,weekNumber:i,weekday:r}=e,o=qe(Be(s,1,t),n),a=ut(s);let l,c=7*i+r-o-7+t;c<1?(l=s-1,c+=ut(l)):c>a?(l=s+1,c-=ut(s)):l=s;const{month:d,day:u}=Ge(l,c);return{year:l,month:d,day:u,...Ct(e)}}function je(e){const{year:t,month:n,day:s}=e;return{year:t,ordinal:Ue(t,n,s),...Ct(e)}}function ze(e){const{year:t,ordinal:n}=e,{month:s,day:i}=Ge(t,n);return{year:t,month:s,day:i,...Ct(e)}}function He(e,t){if(!Ze(e.localWeekday)||!Ze(e.localWeekNumber)||!Ze(e.localWeekYear)){if(!Ze(e.weekday)||!Ze(e.weekNumber)||!Ze(e.weekYear))throw new v("Cannot mix locale-based week fields with ISO-based week fields");return Ze(e.localWeekday)||(e.weekday=e.localWeekday),Ze(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),Ze(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function Ye(e){const t=Xe(e.year),n=it(e.month,1,12),s=it(e.day,1,mt(e.year,e.month));return t?n?!s&&Le("day",e.day):Le("month",e.month):Le("year",e.year)}function Qe(e){const{hour:t,minute:n,second:s,millisecond:i}=e,r=it(t,0,23)||24===t&&0===n&&0===s&&0===i,o=it(n,0,59),a=it(s,0,59),l=it(i,0,999);return r?o?a?!l&&Le("millisecond",i):Le("second",s):Le("minute",n):Le("hour",t)}function Ze(e){return void 0===e}function Je(e){return"number"==typeof e}function Xe(e){return"number"==typeof e&&e%1==0}function Ke(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function et(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(e){return!1}}function tt(e,t,n){if(0!==e.length)return e.reduce((e,s)=>{const i=[t(s),s];return e&&n(e[0],i[0])===e[0]?e:i},null)[1]}function nt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function st(e){if(null==e)return null;if("object"!=typeof e)throw new C("Week settings must be an object");if(!it(e.firstDay,1,7)||!it(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some(e=>!it(e,1,7)))throw new C("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function it(e,t,n){return Xe(e)&&e>=t&&e<=n}function rt(e,t=2){let n;return n=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),n}function ot(e){return Ze(e)||null===e||""===e?void 0:parseInt(e,10)}function at(e){return Ze(e)||null===e||""===e?void 0:parseFloat(e)}function lt(e){if(!Ze(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function ct(e,t,n="round"){const s=10**t;switch(n){case"expand":return e>0?Math.ceil(e*s)/s:Math.floor(e*s)/s;case"trunc":return Math.trunc(e*s)/s;case"round":return Math.round(e*s)/s;case"floor":return Math.floor(e*s)/s;case"ceil":return Math.ceil(e*s)/s;default:throw new RangeError(`Value rounding ${n} is out of range`)}}function dt(e){return e%4==0&&(e%100!=0||e%400==0)}function ut(e){return dt(e)?366:365}function mt(e,t){const n=(s=t-1)-(i=12)*Math.floor(s/i)+1;var s,i;return 2===n?dt(e+(t-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function ht(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function gt(e,t,n){return-qe(Be(e,1,t),n)+t-1}function ft(e,t=4,n=1){const s=gt(e,t,n),i=gt(e+1,t,n);return(ut(e)-s+i)/7}function pt(e){return e>99?e:e>Ne.twoDigitCutoffYear?1900+e:2e3+e}function yt(e,t,n,s=null){const i=new Date(e),r={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};s&&(r.timeZone=s);const o={timeZoneName:t,...r},a=new Intl.DateTimeFormat(n,o).formatToParts(i).find(e=>"timezonename"===e.type.toLowerCase());return a?a.value:null}function bt(e,t){let n=parseInt(e,10);Number.isNaN(n)&&(n=0);const s=parseInt(t,10)||0;return 60*n+(n<0||Object.is(n,-0)?-s:s)}function xt(e){const t=Number(e);if("boolean"==typeof e||""===e||!Number.isFinite(t))throw new C(`Invalid unit value ${e}`);return t}function vt(e,t){const n={};for(const s in e)if(nt(e,s)){const i=e[s];if(null==i)continue;n[t(s)]=xt(i)}return n}function wt(e,t){const n=Math.trunc(Math.abs(e/60)),s=Math.trunc(Math.abs(e%60)),i=e>=0?"+":"-";switch(t){case"short":return`${i}${rt(n,2)}:${rt(s,2)}`;case"narrow":return`${i}${n}${s>0?`:${s}`:""}`;case"techie":return`${i}${rt(n,2)}${rt(s,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function Ct(e){return function(e,t){return t.reduce((t,n)=>(t[n]=e[n],t),{})}(e,["hour","minute","second","millisecond"])}const St=["January","February","March","April","May","June","July","August","September","October","November","December"],Tt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],It=["J","F","M","A","M","J","J","A","S","O","N","D"];function Dt(e){switch(e){case"narrow":return[...It];case"short":return[...Tt];case"long":return[...St];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Et=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],_t=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],Rt=["M","T","W","T","F","S","S"];function kt(e){switch(e){case"narrow":return[...Rt];case"short":return[..._t];case"long":return[...Et];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Ot=["AM","PM"],At=["Before Christ","Anno Domini"],Mt=["BC","AD"],Nt=["B","A"];function Pt(e){switch(e){case"narrow":return[...Nt];case"short":return[...Mt];case"long":return[...At];default:return null}}function $t(e,t){let n="";for(const s of e)s.literal?n+=s.val:n+=t(s.val);return n}const Ft={D:E,DD:_,DDD:k,DDDD:O,t:A,tt:M,ttt:N,tttt:P,T:$,TT:F,TTT:L,TTTT:B,f:U,ff:q,fff:j,ffff:H,F:G,FF:V,FFF:z,FFFF:Y};class Lt{static create(e,t={}){return new Lt(e,t)}static parseFormat(e){let t=null,n="",s=!1;const i=[];for(let r=0;r<e.length;r++){const o=e.charAt(r);"'"===o?((n.length>0||s)&&i.push({literal:s||/^\s+$/.test(n),val:""===n?"'":n}),t=null,n="",s=!s):s||o===t?n+=o:(n.length>0&&i.push({literal:/^\s+$/.test(n),val:n}),n=o,t=o)}return n.length>0&&i.push({literal:s||/^\s+$/.test(n),val:n}),i}static macroTokenToFormatOpts(e){return Ft[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0,n=void 0){if(this.opts.forceSimple)return rt(e,t);const s={...this.opts};return t>0&&(s.padTo=t),n&&(s.signDisplay=n),this.loc.numberFormatter(s).format(e)}formatDateTimeFromString(e,t){const n="en"===this.loc.listingMode(),s=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,i=(t,n)=>this.loc.extract(e,t,n),r=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",o=()=>n?function(e){return Ot[e.hour<12?0:1]}(e):i({hour:"numeric",hourCycle:"h12"},"dayperiod"),a=(t,s)=>n?function(e,t){return Dt(t)[e.month-1]}(e,t):i(s?{month:t}:{month:t,day:"numeric"},"month"),l=(t,s)=>n?function(e,t){return kt(t)[e.weekday-1]}(e,t):i(s?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),c=t=>{const n=Lt.macroTokenToFormatOpts(t);return n?this.formatWithSystemDefault(e,n):t},d=t=>n?function(e,t){return Pt(t)[e.year<0?0:1]}(e,t):i({era:t},"era");return $t(Lt.parseFormat(t),t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return r({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return r({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return r({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return s?i({day:"numeric"},"day"):this.num(e.day);case"dd":return s?i({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return s?i({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return s?i({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return a("short",!0);case"LLLL":return a("long",!0);case"LLLLL":return a("narrow",!0);case"M":return s?i({month:"numeric"},"month"):this.num(e.month);case"MM":return s?i({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return a("short",!1);case"MMMM":return a("long",!1);case"MMMMM":return a("narrow",!1);case"y":return s?i({year:"numeric"},"year"):this.num(e.year);case"yy":return s?i({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return s?i({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return s?i({year:"numeric"},"year"):this.num(e.year,6);case"G":return d("short");case"GG":return d("long");case"GGGGG":return d("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return c(t)}})}formatDurationFromString(e,t){const n="negativeLargestOnly"===this.opts.signMode?-1:1,s=e=>{switch(e[0]){case"S":return"milliseconds";case"s":return"seconds";case"m":return"minutes";case"h":return"hours";case"d":return"days";case"w":return"weeks";case"M":return"months";case"y":return"years";default:return null}},i=Lt.parseFormat(t),r=i.reduce((e,{literal:t,val:n})=>t?e:e.concat(n),[]),o=e.shiftTo(...r.map(s).filter(e=>e));return $t(i,((e,t)=>i=>{const r=s(i);if(r){const s=t.isNegativeDuration&&r!==t.largestUnit?n:1;let o;return o="negativeLargestOnly"===this.opts.signMode&&r!==t.largestUnit?"never":"all"===this.opts.signMode?"always":"auto",this.num(e.get(r)*s,i.length,o)}return i})(o,{isNegativeDuration:o<0,largestUnit:Object.keys(o.values)[0]}))}}const Bt=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function Ut(...e){const t=e.reduce((e,t)=>e+t.source,"");return RegExp(`^${t}$`)}function Gt(...e){return t=>e.reduce(([e,n,s],i)=>{const[r,o,a]=i(t,s);return[{...e,...r},o||n,a]},[{},null,1]).slice(0,2)}function qt(e,...t){if(null==e)return[null,null];for(const[n,s]of t){const t=n.exec(e);if(t)return s(t)}return[null,null]}function Vt(...e){return(t,n)=>{const s={};let i;for(i=0;i<e.length;i++)s[e[i]]=ot(t[n+i]);return[s,null,n+i]}}const Wt=/(?:([Zz])|([+-]\d\d)(?::?(\d\d))?)/,jt=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,zt=RegExp(`${jt.source}${`(?:${Wt.source}?(?:\\[(${Bt.source})\\])?)?`}`),Ht=RegExp(`(?:[Tt]${zt.source})?`),Yt=Vt("weekYear","weekNumber","weekDay"),Qt=Vt("year","ordinal"),Zt=RegExp(`${jt.source} ?(?:${Wt.source}|(${Bt.source}))?`),Jt=RegExp(`(?: ${Zt.source})?`);function Xt(e,t,n){const s=e[t];return Ze(s)?n:ot(s)}function Kt(e,t){return[{hours:Xt(e,t,0),minutes:Xt(e,t+1,0),seconds:Xt(e,t+2,0),milliseconds:lt(e[t+3])},null,t+4]}function en(e,t){const n=!e[t]&&!e[t+1],s=bt(e[t+1],e[t+2]);return[{},n?null:be.instance(s),t+3]}function tn(e,t){return[{},e[t]?te.create(e[t]):null,t+1]}const nn=RegExp(`^T?${jt.source}$`),sn=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function rn(e){const[t,n,s,i,r,o,a,l,c]=e,d="-"===t[0],u=l&&"-"===l[0],m=(e,t=!1)=>void 0!==e&&(t||e&&d)?-e:e;return[{years:m(at(n)),months:m(at(s)),weeks:m(at(i)),days:m(at(r)),hours:m(at(o)),minutes:m(at(a)),seconds:m(at(l),"-0"===l),milliseconds:m(lt(c),u)}]}const on={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function an(e,t,n,s,i,r,o){const a={year:2===t.length?pt(ot(t)):ot(t),month:Tt.indexOf(n)+1,day:ot(s),hour:ot(i),minute:ot(r)};return o&&(a.second=ot(o)),e&&(a.weekday=e.length>3?Et.indexOf(e)+1:_t.indexOf(e)+1),a}const ln=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function cn(e){const[,t,n,s,i,r,o,a,l,c,d,u]=e,m=an(t,i,s,n,r,o,a);let h;return h=l?on[l]:c?0:bt(d,u),[m,new be(h)]}const dn=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,un=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,mn=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function hn(e){const[,t,n,s,i,r,o,a]=e;return[an(t,i,s,n,r,o,a),be.utcInstance]}function gn(e){const[,t,n,s,i,r,o,a]=e;return[an(t,a,n,s,i,r,o),be.utcInstance]}const fn=Ut(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Ht),pn=Ut(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Ht),yn=Ut(/(\d{4})-?(\d{3})/,Ht),bn=Ut(zt),xn=Gt(function(e,t){return[{year:Xt(e,t),month:Xt(e,t+1,1),day:Xt(e,t+2,1)},null,t+3]},Kt,en,tn),vn=Gt(Yt,Kt,en,tn),wn=Gt(Qt,Kt,en,tn),Cn=Gt(Kt,en,tn);const Sn=Gt(Kt);const Tn=Ut(/(\d{4})-(\d\d)-(\d\d)/,Jt),In=Ut(Zt),Dn=Gt(Kt,en,tn);const En="Invalid Duration",_n={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},Rn={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},..._n},kn=365.2425,On=30.436875,An={years:{quarters:4,months:12,weeks:52.1775,days:kn,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:4.3481250000000005,days:On,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},..._n},Mn=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Nn=Mn.slice(0).reverse();function Pn(e,t,n=!1){const s={values:n?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new Bn(s)}function $n(e,t){let n=t.milliseconds??0;for(const s of Nn.slice(1))t[s]&&(n+=t[s]*e[s].milliseconds);return n}function Fn(e,t){const n=$n(e,t)<0?-1:1;Mn.reduceRight((s,i)=>{if(Ze(t[i]))return s;if(s){const r=t[s]*n,o=e[i][s],a=Math.floor(r/o);t[i]+=a*n,t[s]-=a*o*n}return i},null),Mn.reduce((n,s)=>{if(Ze(t[s]))return n;if(n){const i=t[n]%1;t[n]-=i,t[s]+=i*e[n][s]}return s},null)}function Ln(e){const t={};for(const[n,s]of Object.entries(e))0!==s&&(t[n]=s);return t}class Bn{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let n=t?An:Rn;e.matrix&&(n=e.matrix),this.values=e.values,this.loc=e.loc||pe.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=n,this.isLuxonDuration=!0}static fromMillis(e,t){return Bn.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(null==e||"object"!=typeof e)throw new C("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new Bn({values:vt(e,Bn.normalizeUnit),loc:pe.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(Je(e))return Bn.fromMillis(e);if(Bn.isDuration(e))return e;if("object"==typeof e)return Bn.fromObject(e);throw new C(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[n]=qt(e,[sn,rn]);return n?Bn.fromObject(n,t):Bn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[n]=qt(e,[nn,Sn]);return n?Bn.fromObject(n,t):Bn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new C("need to specify a reason the Duration is invalid");const n=e instanceof Pe?e:new Pe(e,t);if(Ne.throwOnInvalid)throw new x(n);return new Bn({invalid:n})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new w(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const n={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?Lt.create(this.loc,n).formatDurationFromString(this,e):En}toHuman(e={}){if(!this.isValid)return En;const t=!1!==e.showZeros,n=Mn.map(n=>{const s=this.values[n];return Ze(s)||0===s&&!t?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:n.slice(0,-1)}).format(s)}).filter(e=>e);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(n)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=ct(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1};return As.fromMillis(t,{zone:"UTC"}).toISOTime(e)}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?$n(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=Bn.fromDurationLike(e),n={};for(const s of Mn)(nt(t.values,s)||nt(this.values,s))&&(n[s]=t.get(s)+this.get(s));return Pn(this,{values:n},!0)}minus(e){if(!this.isValid)return this;const t=Bn.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const n of Object.keys(this.values))t[n]=xt(e(this.values[n],n));return Pn(this,{values:t},!0)}get(e){return this[Bn.normalizeUnit(e)]}set(e){if(!this.isValid)return this;return Pn(this,{values:{...this.values,...vt(e,Bn.normalizeUnit)}})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:n,matrix:s}={}){return Pn(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:s,conversionAccuracy:n})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return Fn(this.matrix,e),Pn(this,{values:e},!0)}rescale(){if(!this.isValid)return this;return Pn(this,{values:Ln(this.normalize().shiftToAll().toObject())},!0)}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map(e=>Bn.normalizeUnit(e));const t={},n={},s=this.toObject();let i;for(const r of Mn)if(e.indexOf(r)>=0){i=r;let e=0;for(const t in n)e+=this.matrix[t][r]*n[t],n[t]=0;Je(s[r])&&(e+=s[r]);const o=Math.trunc(e);t[r]=o,n[r]=(1e3*e-1e3*o)/1e3}else Je(s[r])&&(n[r]=s[r]);for(const r in n)0!==n[r]&&(t[i]+=r===i?n[r]:n[r]/this.matrix[i][r]);return Fn(this.matrix,t),Pn(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return Pn(this,{values:e},!0)}removeZeros(){if(!this.isValid)return this;return Pn(this,{values:Ln(this.values)},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;function t(e,t){return void 0===e||0===e?void 0===t||0===t:e===t}for(const n of Mn)if(!t(this.values[n],e.values[n]))return!1;return!0}}const Un="Invalid Interval";class Gn{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new C("need to specify a reason the Interval is invalid");const n=e instanceof Pe?e:new Pe(e,t);if(Ne.throwOnInvalid)throw new b(n);return new Gn({invalid:n})}static fromDateTimes(e,t){const n=Ms(e),s=Ms(t),i=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?Gn.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null:Gn.invalid("missing or invalid end"):Gn.invalid("missing or invalid start")}(n,s);return null==i?new Gn({start:n,end:s}):i}static after(e,t){const n=Bn.fromDurationLike(t),s=Ms(e);return Gn.fromDateTimes(s,s.plus(n))}static before(e,t){const n=Bn.fromDurationLike(t),s=Ms(e);return Gn.fromDateTimes(s.minus(n),s)}static fromISO(e,t){const[n,s]=(e||"").split("/",2);if(n&&s){let e,r,o,a;try{e=As.fromISO(n,t),r=e.isValid}catch(i){r=!1}try{o=As.fromISO(s,t),a=o.isValid}catch(i){a=!1}if(r&&a)return Gn.fromDateTimes(e,o);if(r){const n=Bn.fromISO(s,t);if(n.isValid)return Gn.after(e,n)}else if(a){const e=Bn.fromISO(n,t);if(e.isValid)return Gn.before(o,e)}}return Gn.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const n=this.start.startOf(e,t);let s;return s=t?.useLocaleWeeks?this.end.reconfigure({locale:n.locale}):this.end,s=s.startOf(e,t),Math.floor(s.diff(n,e).get(e))+(s.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&(this.s<=e&&this.e>e)}set({start:e,end:t}={}){return this.isValid?Gn.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(Ms).filter(e=>this.contains(e)).sort((e,t)=>e.toMillis()-t.toMillis()),n=[];let{s:s}=this,i=0;for(;s<this.e;){const e=t[i]||this.e,r=+e>+this.e?this.e:e;n.push(Gn.fromDateTimes(s,r)),s=r,i+=1}return n}splitBy(e){const t=Bn.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let n,{s:s}=this,i=1;const r=[];for(;s<this.e;){const e=this.start.plus(t.mapUnits(e=>e*i));n=+e>+this.e?this.e:e,r.push(Gn.fromDateTimes(s,n)),s=n,i+=1}return r}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e===+e.s}abutsEnd(e){return!!this.isValid&&+e.e===+this.s}engulfs(e){return!!this.isValid&&(this.s<=e.s&&this.e>=e.e)}equals(e){return!(!this.isValid||!e.isValid)&&(this.s.equals(e.s)&&this.e.equals(e.e))}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,n=this.e<e.e?this.e:e.e;return t>=n?null:Gn.fromDateTimes(t,n)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,n=this.e>e.e?this.e:e.e;return Gn.fromDateTimes(t,n)}static merge(e){const[t,n]=e.sort((e,t)=>e.s-t.s).reduce(([e,t],n)=>t?t.overlaps(n)||t.abutsStart(n)?[e,t.union(n)]:[e.concat([t]),n]:[e,n],[[],null]);return n&&t.push(n),t}static xor(e){let t=null,n=0;const s=[],i=e.map(e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}]),r=Array.prototype.concat(...i).sort((e,t)=>e.time-t.time);for(const o of r)n+="s"===o.type?1:-1,1===n?t=o.time:(t&&+t!==+o.time&&s.push(Gn.fromDateTimes(t,o.time)),t=null);return Gn.merge(s)}difference(...e){return Gn.xor([this].concat(e)).map(e=>this.intersection(e)).filter(e=>e&&!e.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:Un}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=E,t={}){return this.isValid?Lt.create(this.s.loc.clone(t),e).formatInterval(this):Un}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Un}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Un}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Un}toFormat(e,{separator:t=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:Un}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):Bn.invalid(this.invalidReason)}mapEndpoints(e){return Gn.fromDateTimes(e(this.s),e(this.e))}}class qn{static hasDST(e=Ne.defaultZone){const t=As.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return te.isValidZone(e)}static normalizeZone(e){return ve(e,Ne.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||pe.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||pe.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||pe.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:n=null,locObj:s=null,outputCalendar:i="gregory"}={}){return(s||pe.create(t,n,i)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:s=null,outputCalendar:i="gregory"}={}){return(s||pe.create(t,n,i)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:n=null,locObj:s=null}={}){return(s||pe.create(t,n,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:s=null}={}){return(s||pe.create(t,n,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return pe.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return pe.create(t,null,"gregory").eras(e)}static features(){return{relative:Ke(),localeWeek:et()}}}function Vn(e,t){const n=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),s=n(t)-n(e);return Math.floor(Bn.fromMillis(s).as("days"))}function Wn(e,t,n,s){let[i,r,o,a]=function(e,t,n){const s=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const n=Vn(e,t);return(n-n%7)/7}],["days",Vn]],i={},r=e;let o,a;for(const[l,c]of s)n.indexOf(l)>=0&&(o=l,i[l]=c(e,t),a=r.plus(i),a>t?(i[l]--,(e=r.plus(i))>t&&(a=e,i[l]--,e=r.plus(i))):e=a);return[e,i,a,o]}(e,t,n);const l=t-i,c=n.filter(e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0);0===c.length&&(o<t&&(o=i.plus({[a]:1})),o!==i&&(r[a]=(r[a]||0)+l/(o-i)));const d=Bn.fromObject(r,s);return c.length>0?Bn.fromMillis(l,s).shiftTo(...c).plus(d):d}function jn(e,t=e=>e){return{regex:e,deser:([e])=>t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);if(-1!==e[n].search(we.hanidec))t+=Se.indexOf(e[n]);else for(const e in Ce){const[n,i]=Ce[e];s>=n&&s<=i&&(t+=s-n)}}return parseInt(t,10)}return t}(e))}}const zn=`[ ${String.fromCharCode(160)}]`,Hn=new RegExp(zn,"g");function Yn(e){return e.replace(/\./g,"\\.?").replace(Hn,zn)}function Qn(e){return e.replace(/\./g,"").replace(Hn," ").toLowerCase()}function Zn(e,t){return null===e?null:{regex:RegExp(e.map(Yn).join("|")),deser:([n])=>e.findIndex(e=>Qn(n)===Qn(e))+t}}function Jn(e,t){return{regex:e,deser:([,e,t])=>bt(e,t),groups:t}}function Xn(e){return{regex:e,deser:([e])=>e}}const Kn={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let es=null;function ts(e,t){return Array.prototype.concat(...e.map(e=>function(e,t){if(e.literal)return e;const n=is(Lt.macroTokenToFormatOpts(e.val),t);return null==n||n.includes(void 0)?e:n}(e,t)))}class ns{constructor(e,t){if(this.locale=e,this.format=t,this.tokens=ts(Lt.parseFormat(t),e),this.units=this.tokens.map(t=>function(e,t){const n=Ie(t),s=Ie(t,"{2}"),i=Ie(t,"{3}"),r=Ie(t,"{4}"),o=Ie(t,"{6}"),a=Ie(t,"{1,2}"),l=Ie(t,"{1,3}"),c=Ie(t,"{1,6}"),d=Ie(t,"{1,9}"),u=Ie(t,"{2,4}"),m=Ie(t,"{4,6}"),h=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([e])=>e,literal:!0};var t},g=(g=>{if(e.literal)return h(g);switch(g.val){case"G":return Zn(t.eras("short"),0);case"GG":return Zn(t.eras("long"),0);case"y":return jn(c);case"yy":case"kk":return jn(u,pt);case"yyyy":case"kkkk":return jn(r);case"yyyyy":return jn(m);case"yyyyyy":return jn(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return jn(a);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return jn(s);case"MMM":return Zn(t.months("short",!0),1);case"MMMM":return Zn(t.months("long",!0),1);case"LLL":return Zn(t.months("short",!1),1);case"LLLL":return Zn(t.months("long",!1),1);case"o":case"S":return jn(l);case"ooo":case"SSS":return jn(i);case"u":return Xn(d);case"uu":return Xn(a);case"uuu":case"E":case"c":return jn(n);case"a":return Zn(t.meridiems(),0);case"EEE":return Zn(t.weekdays("short",!1),1);case"EEEE":return Zn(t.weekdays("long",!1),1);case"ccc":return Zn(t.weekdays("short",!0),1);case"cccc":return Zn(t.weekdays("long",!0),1);case"Z":case"ZZ":return Jn(new RegExp(`([+-]${a.source})(?::(${s.source}))?`),2);case"ZZZ":return Jn(new RegExp(`([+-]${a.source})(${s.source})?`),2);case"z":return Xn(/[a-z_+-/]{1,256}?/i);case" ":return Xn(/[^\S\n\r]/);default:return h(g)}})(e)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return g.token=e,g}(t,e)),this.disqualifyingUnit=this.units.find(e=>e.invalidReason),!this.disqualifyingUnit){const[e,t]=[`^${(n=this.units).map(e=>e.regex).reduce((e,t)=>`${e}(${t.source})`,"")}$`,n];this.regex=RegExp(e,"i"),this.handlers=t}var n}explainFromTokens(e){if(this.isValid){const[t,n]=function(e,t,n){const s=e.match(t);if(s){const e={};let t=1;for(const i in n)if(nt(n,i)){const r=n[i],o=r.groups?r.groups+1:1;!r.literal&&r.token&&(e[r.token.val[0]]=r.deser(s.slice(t,t+o))),t+=o}return[s,e]}return[s,{}]}(e,this.regex,this.handlers),[s,i,r]=n?function(e){let t,n=null;return Ze(e.z)||(n=te.create(e.z)),Ze(e.Z)||(n||(n=new be(e.Z)),t=e.Z),Ze(e.q)||(e.M=3*(e.q-1)+1),Ze(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),Ze(e.u)||(e.S=lt(e.u)),[Object.keys(e).reduce((t,n)=>{const s=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return s&&(t[s]=e[n]),t},{}),n,t]}(n):[null,null,void 0];if(nt(n,"a")&&nt(n,"H"))throw new v("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:t,matches:n,result:s,zone:i,specificOffset:r}}return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function ss(e,t,n){return new ns(e,n).explainFromTokens(t)}function is(e,t){if(!e)return null;const n=Lt.create(t,e).dtFormatter((es||(es=As.fromMillis(1555555555555)),es)),s=n.formatToParts(),i=n.resolvedOptions();return s.map(t=>function(e,t,n){const{type:s,value:i}=e;if("literal"===s){const e=/^\s+$/.test(i);return{literal:!e,val:e?" ":i}}const r=t[s];let o=s;"hour"===s&&(o=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":n.hour12?"hour12":"hour24");let a=Kn[o];if("object"==typeof a&&(a=a[r]),a)return{literal:!1,val:a}}(t,e,i))}const rs="Invalid DateTime",os=864e13;function as(e){return new Pe("unsupported zone",`the zone "${e.name}" is not supported`)}function ls(e){return null===e.weekData&&(e.weekData=Ve(e.c)),e.weekData}function cs(e){return null===e.localWeekData&&(e.localWeekData=Ve(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function ds(e,t){const n={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new As({...n,...t,old:n})}function us(e,t,n){let s=e-60*t*1e3;const i=n.offset(s);if(t===i)return[s,t];s-=60*(i-t)*1e3;const r=n.offset(s);return i===r?[s,i]:[e-60*Math.min(i,r)*1e3,Math.max(i,r)]}function ms(e,t){const n=new Date(e+=60*t*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function hs(e,t,n){return us(ht(e),t,n)}function gs(e,t){const n=e.o,s=e.c.year+Math.trunc(t.years),i=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),r={...e.c,year:s,month:i,day:Math.min(e.c.day,mt(s,i))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},o=Bn.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=ht(r);let[l,c]=us(a,n,e.zone);return 0!==o&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function fs(e,t,n,s,i,r){const{setZone:o,zone:a}=n;if(e&&0!==Object.keys(e).length||t){const s=t||a,i=As.fromObject(e,{...n,zone:s,specificOffset:r});return o?i:i.setZone(a)}return As.invalid(new Pe("unparsable",`the input "${i}" can't be parsed as ${s}`))}function ps(e,t,n=!0){return e.isValid?Lt.create(pe.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(e,t):null}function ys(e,t,n){const s=e.c.year>9999||e.c.year<0;let i="";if(s&&e.c.year>=0&&(i+="+"),i+=rt(e.c.year,s?6:4),"year"===n)return i;if(t){if(i+="-",i+=rt(e.c.month),"month"===n)return i;i+="-"}else if(i+=rt(e.c.month),"month"===n)return i;return i+=rt(e.c.day),i}function bs(e,t,n,s,i,r,o){let a=!n||0!==e.c.millisecond||0!==e.c.second,l="";switch(o){case"day":case"month":case"year":break;default:if(l+=rt(e.c.hour),"hour"===o)break;if(t){if(l+=":",l+=rt(e.c.minute),"minute"===o)break;a&&(l+=":",l+=rt(e.c.second))}else{if(l+=rt(e.c.minute),"minute"===o)break;a&&(l+=rt(e.c.second))}if("second"===o)break;!a||s&&0===e.c.millisecond||(l+=".",l+=rt(e.c.millisecond,3))}return i&&(e.isOffsetFixed&&0===e.offset&&!r?l+="Z":e.o<0?(l+="-",l+=rt(Math.trunc(-e.o/60)),l+=":",l+=rt(Math.trunc(-e.o%60))):(l+="+",l+=rt(Math.trunc(e.o/60)),l+=":",l+=rt(Math.trunc(e.o%60)))),r&&(l+="["+e.zone.ianaName+"]"),l}const xs={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},vs={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},ws={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Cs=["year","month","day","hour","minute","second","millisecond"],Ss=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Ts=["year","ordinal","hour","minute","second","millisecond"];function Is(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new w(e);return t}function Ds(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return Is(e)}}function Es(e,t){const n=ve(t.zone,Ne.defaultZone);if(!n.isValid)return As.invalid(as(n));const s=pe.fromObject(t);let i,r;if(Ze(e.year))i=Ne.now();else{for(const n of Cs)Ze(e[n])&&(e[n]=xs[n]);const t=Ye(e)||Qe(e);if(t)return As.invalid(t);const s=function(e){if(void 0===ks&&(ks=Ne.now()),"iana"!==e.type)return e.offset(ks);const t=e.name;let n=Os.get(t);return void 0===n&&(n=e.offset(ks),Os.set(t,n)),n}(n);[i,r]=hs(e,s,n)}return new As({ts:i,zone:n,loc:s,o:r})}function _s(e,t,n){const s=!!Ze(n.round)||n.round,i=Ze(n.rounding)?"trunc":n.rounding,r=(e,r)=>{e=ct(e,s||n.calendary?0:2,n.calendary?"round":i);return t.loc.clone(n).relFormatter(n).format(e,r)},o=s=>n.calendary?t.hasSame(e,s)?0:t.startOf(s).diff(e.startOf(s),s).get(s):t.diff(e,s).get(s);if(n.unit)return r(o(n.unit),n.unit);for(const a of n.units){const e=o(a);if(Math.abs(e)>=1)return r(e,a)}return r(e>t?-0:0,n.units[n.units.length-1])}function Rs(e){let t,n={};return e.length>0&&"object"==typeof e[e.length-1]?(n=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[n,t]}let ks;const Os=new Map;class As{constructor(e){const t=e.zone||Ne.defaultZone;let n=e.invalid||(Number.isNaN(e.ts)?new Pe("invalid input"):null)||(t.isValid?null:as(t));this.ts=Ze(e.ts)?Ne.now():e.ts;let s=null,i=null;if(!n){if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[s,i]=[e.old.c,e.old.o];else{const r=Je(e.o)&&!e.old?e.o:t.offset(this.ts);s=ms(this.ts,r),n=Number.isNaN(s.year)?new Pe("invalid input"):null,s=n?null:s,i=n?null:r}}this._zone=t,this.loc=e.loc||pe.create(),this.invalid=n,this.weekData=null,this.localWeekData=null,this.c=s,this.o=i,this.isLuxonDateTime=!0}static now(){return new As({})}static local(){const[e,t]=Rs(arguments),[n,s,i,r,o,a,l]=t;return Es({year:n,month:s,day:i,hour:r,minute:o,second:a,millisecond:l},e)}static utc(){const[e,t]=Rs(arguments),[n,s,i,r,o,a,l]=t;return e.zone=be.utcInstance,Es({year:n,month:s,day:i,hour:r,minute:o,second:a,millisecond:l},e)}static fromJSDate(e,t={}){const n=(s=e,"[object Date]"===Object.prototype.toString.call(s)?e.valueOf():NaN);var s;if(Number.isNaN(n))return As.invalid("invalid input");const i=ve(t.zone,Ne.defaultZone);return i.isValid?new As({ts:n,zone:i,loc:pe.fromObject(t)}):As.invalid(as(i))}static fromMillis(e,t={}){if(Je(e))return e<-os||e>os?As.invalid("Timestamp out of range"):new As({ts:e,zone:ve(t.zone,Ne.defaultZone),loc:pe.fromObject(t)});throw new C(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(Je(e))return new As({ts:1e3*e,zone:ve(t.zone,Ne.defaultZone),loc:pe.fromObject(t)});throw new C("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const n=ve(t.zone,Ne.defaultZone);if(!n.isValid)return As.invalid(as(n));const s=pe.fromObject(t),i=vt(e,Ds),{minDaysInFirstWeek:r,startOfWeek:o}=He(i,s),a=Ne.now(),l=Ze(t.specificOffset)?n.offset(a):t.specificOffset,c=!Ze(i.ordinal),d=!Ze(i.year),u=!Ze(i.month)||!Ze(i.day),m=d||u,h=i.weekYear||i.weekNumber;if((m||c)&&h)throw new v("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(u&&c)throw new v("Can't mix ordinal dates with month/day");const g=h||i.weekday&&!m;let f,p,y=ms(a,l);g?(f=Ss,p=vs,y=Ve(y,r,o)):c?(f=Ts,p=ws,y=je(y)):(f=Cs,p=xs);let b=!1;for(const v of f){Ze(i[v])?i[v]=b?p[v]:y[v]:b=!0}const x=g?function(e,t=4,n=1){const s=Xe(e.weekYear),i=it(e.weekNumber,1,ft(e.weekYear,t,n)),r=it(e.weekday,1,7);return s?i?!r&&Le("weekday",e.weekday):Le("week",e.weekNumber):Le("weekYear",e.weekYear)}(i,r,o):c?function(e){const t=Xe(e.year),n=it(e.ordinal,1,ut(e.year));return t?!n&&Le("ordinal",e.ordinal):Le("year",e.year)}(i):Ye(i),w=x||Qe(i);if(w)return As.invalid(w);const C=g?We(i,r,o):c?ze(i):i,[S,T]=hs(C,l,n),I=new As({ts:S,zone:n,o:T,loc:s});return i.weekday&&m&&e.weekday!==I.weekday?As.invalid("mismatched weekday",`you can't specify both a weekday of ${i.weekday} and a date of ${I.toISO()}`):I.isValid?I:As.invalid(I.invalid)}static fromISO(e,t={}){const[n,s]=qt(e,[fn,xn],[pn,vn],[yn,wn],[bn,Cn]);return fs(n,s,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[n,s]=qt(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[ln,cn]);return fs(n,s,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[n,s]=qt(e,[dn,hn],[un,hn],[mn,gn]);return fs(n,s,t,"HTTP",t)}static fromFormat(e,t,n={}){if(Ze(e)||Ze(t))throw new C("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:i=null}=n,r=pe.fromOpts({locale:s,numberingSystem:i,defaultToEN:!0}),[o,a,l,c]=function(e,t,n){const{result:s,zone:i,specificOffset:r,invalidReason:o}=ss(e,t,n);return[s,i,r,o]}(r,e,t);return c?As.invalid(c):fs(o,a,n,`format ${t}`,e,l)}static fromString(e,t,n={}){return As.fromFormat(e,t,n)}static fromSQL(e,t={}){const[n,s]=qt(e,[Tn,xn],[In,Dn]);return fs(n,s,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new C("need to specify a reason the DateTime is invalid");const n=e instanceof Pe?e:new Pe(e,t);if(Ne.throwOnInvalid)throw new y(n);return new As({invalid:n})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const n=is(e,pe.fromObject(t));return n?n.map(e=>e?e.val:null).join(""):null}static expandFormat(e,t={}){return ts(Lt.parseFormat(e),pe.fromObject(t)).map(e=>e.val).join("")}static resetCache(){ks=void 0,Os.clear()}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?ls(this).weekYear:NaN}get weekNumber(){return this.isValid?ls(this).weekNumber:NaN}get weekday(){return this.isValid?ls(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?cs(this).weekday:NaN}get localWeekNumber(){return this.isValid?cs(this).weekNumber:NaN}get localWeekYear(){return this.isValid?cs(this).weekYear:NaN}get ordinal(){return this.isValid?je(this.c).ordinal:NaN}get monthShort(){return this.isValid?qn.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?qn.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?qn.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?qn.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,n=ht(this.c),s=this.zone.offset(n-e),i=this.zone.offset(n+e),r=this.zone.offset(n-s*t),o=this.zone.offset(n-i*t);if(r===o)return[this];const a=n-r*t,l=n-o*t,c=ms(a,r),d=ms(l,o);return c.hour===d.hour&&c.minute===d.minute&&c.second===d.second&&c.millisecond===d.millisecond?[ds(this,{ts:a}),ds(this,{ts:l})]:[this]}get isInLeapYear(){return dt(this.year)}get daysInMonth(){return mt(this.year,this.month)}get daysInYear(){return this.isValid?ut(this.year):NaN}get weeksInWeekYear(){return this.isValid?ft(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?ft(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:n,calendar:s}=Lt.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:n,outputCalendar:s}}toUTC(e=0,t={}){return this.setZone(be.instance(e),t)}toLocal(){return this.setZone(Ne.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:n=!1}={}){if((e=ve(e,Ne.defaultZone)).equals(this.zone))return this;if(e.isValid){let s=this.ts;if(t||n){const t=e.offset(this.ts),n=this.toObject();[s]=hs(n,t,e)}return ds(this,{ts:s,zone:e})}return As.invalid(as(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:n}={}){return ds(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:n})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=vt(e,Ds),{minDaysInFirstWeek:n,startOfWeek:s}=He(t,this.loc),i=!Ze(t.weekYear)||!Ze(t.weekNumber)||!Ze(t.weekday),r=!Ze(t.ordinal),o=!Ze(t.year),a=!Ze(t.month)||!Ze(t.day),l=o||a,c=t.weekYear||t.weekNumber;if((l||r)&&c)throw new v("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(a&&r)throw new v("Can't mix ordinal dates with month/day");let d;i?d=We({...Ve(this.c,n,s),...t},n,s):Ze(t.ordinal)?(d={...this.toObject(),...t},Ze(t.day)&&(d.day=Math.min(mt(d.year,d.month),d.day))):d=ze({...je(this.c),...t});const[u,m]=hs(d,this.o,this.zone);return ds(this,{ts:u,o:m})}plus(e){if(!this.isValid)return this;return ds(this,gs(this,Bn.fromDurationLike(e)))}minus(e){if(!this.isValid)return this;return ds(this,gs(this,Bn.fromDurationLike(e).negate()))}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const n={},s=Bn.normalizeUnit(e);switch(s){case"years":n.month=1;case"quarters":case"months":n.day=1;case"weeks":case"days":n.hour=0;case"hours":n.minute=0;case"minutes":n.second=0;case"seconds":n.millisecond=0}if("weeks"===s)if(t){const e=this.loc.getStartOfWeek(),{weekday:t}=this;t<e&&(n.weekNumber=this.weekNumber-1),n.weekday=e}else n.weekday=1;if("quarters"===s){const e=Math.ceil(this.month/3);n.month=3*(e-1)+1}return this.set(n)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?Lt.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):rs}toLocaleString(e=E,t={}){return this.isValid?Lt.create(this.loc.clone(t),e).formatDateTime(this):rs}toLocaleParts(e={}){return this.isValid?Lt.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:n=!1,includeOffset:s=!0,extendedZone:i=!1,precision:r="milliseconds"}={}){if(!this.isValid)return null;const o="extended"===e;let a=ys(this,o,r=Is(r));return Cs.indexOf(r)>=3&&(a+="T"),a+=bs(this,o,t,n,s,i,r),a}toISODate({format:e="extended",precision:t="day"}={}){return this.isValid?ys(this,"extended"===e,Is(t)):null}toISOWeekDate(){return ps(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:n=!0,includePrefix:s=!1,extendedZone:i=!1,format:r="extended",precision:o="milliseconds"}={}){if(!this.isValid)return null;return o=Is(o),(s&&Cs.indexOf(o)>=3?"T":"")+bs(this,"extended"===r,t,e,n,i,o)}toRFC2822(){return ps(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ps(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?ys(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:n=!0}={}){let s="HH:mm:ss.SSS";return(t||e)&&(n&&(s+=" "),t?s+="z":e&&(s+="ZZ")),ps(this,s,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():rs}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",n={}){if(!this.isValid||!e.isValid)return Bn.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...n},i=(a=t,Array.isArray(a)?a:[a]).map(Bn.normalizeUnit),r=e.valueOf()>this.valueOf(),o=Wn(r?this:e,r?e:this,i,s);var a;return r?o.negate():o}diffNow(e="milliseconds",t={}){return this.diff(As.now(),e,t)}until(e){return this.isValid?Gn.fromDateTimes(this,e):this}hasSame(e,t,n){if(!this.isValid)return!1;const s=e.valueOf(),i=this.setZone(e.zone,{keepLocalTime:!0});return i.startOf(t,n)<=s&&s<=i.endOf(t,n)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||As.fromObject({},{zone:this.zone}),n=e.padding?this<t?-e.padding:e.padding:0;let s=["years","months","days","hours","minutes","seconds"],i=e.unit;return Array.isArray(e.unit)&&(s=e.unit,i=void 0),_s(t,this.plus(n),{...e,numeric:"always",units:s,unit:i})}toRelativeCalendar(e={}){return this.isValid?_s(e.base||As.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(As.isDateTime))throw new C("min requires all arguments be DateTimes");return tt(e,e=>e.valueOf(),Math.min)}static max(...e){if(!e.every(As.isDateTime))throw new C("max requires all arguments be DateTimes");return tt(e,e=>e.valueOf(),Math.max)}static fromFormatExplain(e,t,n={}){const{locale:s=null,numberingSystem:i=null}=n;return ss(pe.fromOpts({locale:s,numberingSystem:i,defaultToEN:!0}),e,t)}static fromStringExplain(e,t,n={}){return As.fromFormatExplain(e,t,n)}static buildFormatParser(e,t={}){const{locale:n=null,numberingSystem:s=null}=t,i=pe.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return new ns(i,e)}static fromFormatParser(e,t,n={}){if(Ze(e)||Ze(t))throw new C("fromFormatParser requires an input string and a format parser");const{locale:s=null,numberingSystem:i=null}=n,r=pe.fromOpts({locale:s,numberingSystem:i,defaultToEN:!0});if(!r.equals(t.locale))throw new C(`fromFormatParser called with a locale of ${r}, but the format parser was created for ${t.locale}`);const{result:o,zone:a,specificOffset:l,invalidReason:c}=t.explainFromTokens(e);return c?As.invalid(c):fs(o,a,n,`format ${t.format}`,e,l)}static get DATE_SHORT(){return E}static get DATE_MED(){return _}static get DATE_MED_WITH_WEEKDAY(){return R}static get DATE_FULL(){return k}static get DATE_HUGE(){return O}static get TIME_SIMPLE(){return A}static get TIME_WITH_SECONDS(){return M}static get TIME_WITH_SHORT_OFFSET(){return N}static get TIME_WITH_LONG_OFFSET(){return P}static get TIME_24_SIMPLE(){return $}static get TIME_24_WITH_SECONDS(){return F}static get TIME_24_WITH_SHORT_OFFSET(){return L}static get TIME_24_WITH_LONG_OFFSET(){return B}static get DATETIME_SHORT(){return U}static get DATETIME_SHORT_WITH_SECONDS(){return G}static get DATETIME_MED(){return q}static get DATETIME_MED_WITH_SECONDS(){return V}static get DATETIME_MED_WITH_WEEKDAY(){return W}static get DATETIME_FULL(){return j}static get DATETIME_FULL_WITH_SECONDS(){return z}static get DATETIME_HUGE(){return H}static get DATETIME_HUGE_WITH_SECONDS(){return Y}}function Ms(e){if(As.isDateTime(e))return e;if(e&&e.valueOf&&Je(e.valueOf()))return As.fromJSDate(e);if(e&&"object"==typeof e)return As.fromObject(e);throw new C(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const Ns={EDT:"UTC-4",EST:"UTC-5",PST:"UTC-8",PDT:"UTC-7",CST:"UTC-6",CDT:"UTC-5",MST:"UTC-7",MDT:"UTC-6",BST:"UTC+1",GMT:"UTC",UTC:"UTC",JST:"UTC+9",CET:"UTC+1",CEST:"UTC+2",HKT:"UTC+8",AEST:"UTC+10",AEDT:"UTC+11",SGT:"UTC+8",ET:"America/New_York"};function Ps(e){if(!/^\d{1,2}-[A-Za-z]{3}-\d{2,4}$/.test(e))return null;const t=e.split("-");if(3===t.length){const e=t[0],n=t[1],s=t[2],i={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"}[n];if(i){return`${2===s.length?`20${s}`:s}-${i}-${1===e.length?`0${e}`:e}`}}return null}function $s(e){if(!e)return"";if(e.includes("T")&&(e.includes("+")||e.includes("Z")))return e;if(e.includes(";")){const t=e.split(";");let n=t[0].trim();const s=t[1].trim(),i=Ps(n);i&&(n=i);const r=s.split(/\s+/),o=r[0],a=r[1];if(a){if(Ns[a]){const t=Ns[a],s=`${n} ${o}`,i=As.fromFormat(s,"yyyy-MM-dd HH:mm:ss",{zone:t});if(i.isValid)return i.setZone("Europe/London").toISO({includeOffset:!0,suppressMilliseconds:!0})||n;throw new Error(`CRITICAL COMPLIANCE ERROR: Malformed date/time string "${e}" (Reason: ${i.invalidReason}). Transaction dating must be precise for HMRC compliance.`)}throw new Error(`CRITICAL COMPLIANCE ERROR: Unknown timezone "${a}" in date "${e}". This can shift transactions across UK tax days, affecting same-day and 30-day matching rules. Please add this timezone abbreviation to TIMEZONE_IANA_MAP in parsing_utils.ts or contact support.`)}throw new Error(`CRITICAL COMPLIANCE ERROR: Missing timezone in date "${e}". Transaction dating must be precise for HMRC compliance.`)}if(/^\d{4}-\d{2}-\d{2}$/.test(e))return $s(`${e};12:00:00 UTC`);const t=Ps(e);if(t)return $s(`${t};12:00:00 UTC`);throw new Error(`CRITICAL COMPLIANCE ERROR: Malformed date/time string "${e}". Transaction dating must be precise for HMRC compliance.`)}function Fs(e){if(!e)return"Stocks";const t=e.toUpperCase().trim();return"STK"===t||"STOCKS"===t||"EQUITY"===t?"Stocks":"OPT"===t||"EQUITY AND INDEX OPTIONS"===t||"OPTIONS"===t?"Equity and Index Options":"WAR"===t||"WARRANTS"===t?"Warrants":"CASH"===t||"CUR"===t||"FOREX"===t||"CURRENCY"===t?"Forex":e}function Ls(e,t,n){const s=(e||"").toLowerCase();return!(!s.includes("spinoff")&&!s.includes("spin-off"))||(!(!t||"SO"!==t.trim().toUpperCase())||!(!n||!n.some(e=>"SO"===e.trim().toUpperCase())))}function Bs(e,t,n,s,i){const r=[],o=function(e){const t=e.match(/\(([A-Z0-9.]+),/i);return t?t[1].trim():void 0}(e);let a=function(e){const t=e.trim().match(/^([A-Z0-9.]+)\s*(?:\(|\s)/i);return t?t[1].trim():void 0}(e);!a&&t&&o&&t!==o&&(a=t);const l=o||t;return a&&r.push({date:s,symbol:a,quantityChange:0,type:"SPINOFF",description:e,code:"SO",source:i,eventType:"SPINOFF"}),l&&l!==a&&r.push({date:s,symbol:l,quantityChange:0,type:"SPINOFF",description:e,code:"SO",conid:n,source:i,eventType:"SPINOFF"}),r}function Us(e,t,n){if(void 0===n[e])return;const s=t[n[e]];if(null==s)return;const i=String(s).trim();return""===i?void 0:i}function Gs(e){if(!e)return 0;const t=parseFloat(e.replace(/,/g,""));return isNaN(t)?0:t}function qs(e,t){}let Vs={actions:[]};function Ws(e){Vs=e}const js=new Map;function zs(e,t){const n=js.get(e)||0;js.set(e,n+t)}function Hs(e){const t=js.get(e)||0;return js.set(e,0),t}function Ys(e,t){return{parentAdj:-(e-e*t.parentRatio),childBasis:e*t.childRatio}}var Qs=null;function Zs(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function Js(e,t){for(var n,s="",i=0,r=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)n=e.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(r===a-1||1===o);else if(r!==a-1&&2===o){if(s.length<2||2!==i||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){var l=s.lastIndexOf("/");if(l!==s.length-1){-1===l?(s="",i=0):i=(s=s.slice(0,l)).length-1-s.lastIndexOf("/"),r=a,o=0;continue}}else if(2===s.length||1===s.length){s="",i=0,r=a,o=0;continue}t&&(s.length>0?s+="/..":s="..",i=2)}else s.length>0?s+="/"+e.slice(r+1,a):s=e.slice(r+1,a),i=a-r-1;r=a,o=0}else 46===n&&-1!==o?++o:o=-1}return s}var Xs={resolve:function(){for(var e,t="",n=!1,i=arguments.length-1;i>=-1&&!n;i--){var r;i>=0?r=arguments[i]:(void 0===e&&(e=s.cwd()),r=e),Zs(r),0!==r.length&&(t=r+"/"+t,n=47===r.charCodeAt(0))}return t=Js(t,!n),n?t.length>0?"/"+t:"/":t.length>0?t:"."},normalize:function(e){if(Zs(e),0===e.length)return".";var t=47===e.charCodeAt(0),n=47===e.charCodeAt(e.length-1);return 0!==(e=Js(e,!t)).length||t||(e="."),e.length>0&&n&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Zs(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];Zs(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":Xs.normalize(e)},relative:function(e,t){if(Zs(e),Zs(t),e===t)return"";if((e=Xs.resolve(e))===(t=Xs.resolve(t)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var s=e.length,i=s-n,r=1;r<t.length&&47===t.charCodeAt(r);++r);for(var o=t.length-r,a=i<o?i:o,l=-1,c=0;c<=a;++c){if(c===a){if(o>a){if(47===t.charCodeAt(r+c))return t.slice(r+c+1);if(0===c)return t.slice(r+c)}else i>a&&(47===e.charCodeAt(n+c)?l=c:0===c&&(l=0));break}var d=e.charCodeAt(n+c);if(d!==t.charCodeAt(r+c))break;47===d&&(l=c)}var u="";for(c=n+l+1;c<=s;++c)c!==s&&47!==e.charCodeAt(c)||(0===u.length?u+="..":u+="/..");return u.length>0?u+t.slice(r+l):(r+=l,47===t.charCodeAt(r)&&++r,t.slice(r))},_makeLong:function(e){return e},dirname:function(e){if(Zs(e),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,s=-1,i=!0,r=e.length-1;r>=1;--r)if(47===(t=e.charCodeAt(r))){if(!i){s=r;break}}else i=!1;return-1===s?n?"/":".":n&&1===s?"//":e.slice(0,s)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');Zs(e);var n,s=0,i=-1,r=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var o=t.length-1,a=-1;for(n=e.length-1;n>=0;--n){var l=e.charCodeAt(n);if(47===l){if(!r){s=n+1;break}}else-1===a&&(r=!1,a=n+1),o>=0&&(l===t.charCodeAt(o)?-1===--o&&(i=n):(o=-1,i=a))}return s===i?i=a:-1===i&&(i=e.length),e.slice(s,i)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!r){s=n+1;break}}else-1===i&&(r=!1,i=n+1);return-1===i?"":e.slice(s,i)},extname:function(e){Zs(e);for(var t=-1,n=0,s=-1,i=!0,r=0,o=e.length-1;o>=0;--o){var a=e.charCodeAt(o);if(47!==a)-1===s&&(i=!1,s=o+1),46===a?-1===t?t=o:1!==r&&(r=1):-1!==t&&(r=-1);else if(!i){n=o+1;break}}return-1===t||-1===s||0===r||1===r&&t===s-1&&t===n+1?"":e.slice(t,s)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,s=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+s:n+e+s:s}("/",e)},parse:function(e){Zs(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var n,s=e.charCodeAt(0),i=47===s;i?(t.root="/",n=1):n=0;for(var r=-1,o=0,a=-1,l=!0,c=e.length-1,d=0;c>=n;--c)if(47!==(s=e.charCodeAt(c)))-1===a&&(l=!1,a=c+1),46===s?-1===r?r=c:1!==d&&(d=1):-1!==r&&(d=-1);else if(!l){o=c+1;break}return-1===r||-1===a||0===d||1===d&&r===a-1&&r===o+1?-1!==a&&(t.base=t.name=0===o&&i?e.slice(1,a):e.slice(o,a)):(0===o&&i?(t.name=e.slice(1,r),t.base=e.slice(1,a)):(t.name=e.slice(o,r),t.base=e.slice(o,a)),t.ext=e.slice(r,a)),o>0?t.dir=e.slice(0,o-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Xs.posix=Xs;const Ks=i(Xs);var ei,ti,ni={exports:{}};ei=ni,ti=ni.exports,function(e){var t=ti&&!ti.nodeType&&ti,n=ei&&!ei.nodeType&&ei,s="object"==typeof r&&r;s.global!==s&&s.window!==s&&s.self!==s||(e=s);var i,o,a=2147483647,l=36,c=/^xn--/,d=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},h=Math.floor,g=String.fromCharCode;function f(e){throw new RangeError(m[e])}function p(e,t){for(var n=e.length,s=[];n--;)s[n]=t(e[n]);return s}function y(e,t){var n=e.split("@"),s="";return n.length>1&&(s=n[0]+"@",e=n[1]),s+p((e=e.replace(u,".")).split("."),t).join(".")}function b(e){for(var t,n,s=[],i=0,r=e.length;i<r;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<r?56320==(64512&(n=e.charCodeAt(i++)))?s.push(((1023&t)<<10)+(1023&n)+65536):(s.push(t),i--):s.push(t);return s}function x(e){return p(e,function(e){var t="";return e>65535&&(t+=g((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=g(e)}).join("")}function v(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:l}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function C(e,t,n){var s=0;for(e=n?h(e/700):e>>1,e+=h(e/t);e>455;s+=l)e=h(e/35);return h(s+36*e/(e+38))}function S(e){var t,n,s,i,r,o,c,d,u,m,g=[],p=e.length,y=0,b=128,w=72;for((n=e.lastIndexOf("-"))<0&&(n=0),s=0;s<n;++s)e.charCodeAt(s)>=128&&f("not-basic"),g.push(e.charCodeAt(s));for(i=n>0?n+1:0;i<p;){for(r=y,o=1,c=l;i>=p&&f("invalid-input"),((d=v(e.charCodeAt(i++)))>=l||d>h((a-y)/o))&&f("overflow"),y+=d*o,!(d<(u=c<=w?1:c>=w+26?26:c-w));c+=l)o>h(a/(m=l-u))&&f("overflow"),o*=m;w=C(y-r,t=g.length+1,0==r),h(y/t)>a-b&&f("overflow"),b+=h(y/t),y%=t,g.splice(y++,0,b)}return x(g)}function T(e){var t,n,s,i,r,o,c,d,u,m,p,y,x,v,S,T=[];for(y=(e=b(e)).length,t=128,n=0,r=72,o=0;o<y;++o)(p=e[o])<128&&T.push(g(p));for(s=i=T.length,i&&T.push("-");s<y;){for(c=a,o=0;o<y;++o)(p=e[o])>=t&&p<c&&(c=p);for(c-t>h((a-n)/(x=s+1))&&f("overflow"),n+=(c-t)*x,t=c,o=0;o<y;++o)if((p=e[o])<t&&++n>a&&f("overflow"),p==t){for(d=n,u=l;!(d<(m=u<=r?1:u>=r+26?26:u-r));u+=l)S=d-m,v=l-m,T.push(g(w(m+S%v,0))),d=h(S/v);T.push(g(w(d,0))),r=C(n,x,s==i),n=0,++s}++n,++t}return T.join("")}if(i={version:"1.4.1",ucs2:{decode:b,encode:x},decode:S,encode:T,toASCII:function(e){return y(e,function(e){return d.test(e)?"xn--"+T(e):e})},toUnicode:function(e){return y(e,function(e){return c.test(e)?S(e.slice(4).toLowerCase()):e})}},t&&n)if(ei.exports==t)n.exports=i;else for(o in i)i.hasOwnProperty(o)&&(t[o]=i[o]);else e.punycode=i}(r);var si=function(e){function t(){var t=this||self;return delete e.prototype.__magic__,t}return"object"==typeof globalThis?globalThis:this?t():(e.defineProperty(e.prototype,"__magic__",{configurable:!0,get:t}),__magic__)}(Object),ii=si.URL;si.URLSearchParams;var ri=function(e){if(!function(e){var t=null!=e?e:null;return Boolean(null!==t&&(null==t?void 0:t.href)&&(null==t?void 0:t.origin))}(e)&&"string"!=typeof e)throw new TypeError('The "path" argument must be of type string or an instance of URL. Received type '+typeof e+" ("+e+")");var t=new ii(e);if("file:"!==t.protocol)throw new TypeError("The URL must be of scheme file");return function(e){if(""!==e.hostname)throw new TypeError('File URL host must be "localhost" or empty on browser');for(var t=e.pathname,n=0;n<t.length;n++)if("%"===t[n]){var s=32|t.codePointAt(n+2);if("2"===t[n+1]&&102===s)throw new TypeError("File URL path must not include encoded / characters")}return decodeURIComponent(t)}(t)};const oi=new Map;let ai=!1,li=!1,ci={};const di=Ks.join("exchange_rates","usd_into_gbp","Bank of England Database.csv");function ui(e={}){e.yearlyAverages&&(ci=e.yearlyAverages),oi.clear(),ai=!1,li=!1,e.dailyRatesPath||(li=!0),e.dailyRatesPath&&pi(e.dailyRatesPath)}const mi=new Intl.DateTimeFormat("en-CA",{timeZone:"Europe/London",year:"numeric",month:"2-digit",day:"2-digit"});function hi(e){if("string"==typeof e){if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const t=new Date(e);return isNaN(t.getTime())?null:mi.format(t)}return isNaN(e.getTime())?null:mi.format(e)}function gi(e){const t=hi(e);if(!t)return"2024_2025";const[n,s,i]=t.split("-"),r=Number(n),o=Number(s),a=Number(i);if(!r||!o||!a)return"2024_2025";let l=r;return(o<4||4===o&&a<6)&&(l=r-1),`${l}_${l+1}`}function fi(e){const t=e.trim().split(/\s+/);if(3!==t.length)return null;const[n,s,i]=t,r=Number(n);if(!r)return null;const o={Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12}[s];if(!o)return null;let a=Number(i);if(!a)return null;2===i.length&&(a+=a>=70?1900:2e3);return`${a}-${String(o).padStart(2,"0")}-${String(r).padStart(2,"0")}`}function pi(e){if(!ai&&!li)if(li=!0,Qs.existsSync(e))try{const t=Qs.readFileSync(e,"utf8").split(/\r?\n/);let n=0;for(let e=0;e<t.length;e++){const s=t[e].trim();if(!s||0===e)continue;const i=s.match(/^"([^"]*)","([^"]*)"$/);if(!i)continue;const[,r,o]=i,a=fi(r),l=Number(o);if(!a||!l||isNaN(l))continue;const c=`${a}:USD`;oi.set(c,l),n++}ai=!0,n>0&&(new Date).toISOString()}catch(t){(new Date).toISOString()}else(new Date).toISOString()}function yi(e,t){if("GBP"===e)return 1;"USD"!==e||li||function(){if(ai||li)return;const e=Ks.resolve(s.cwd(),di),t=Ks.dirname(ri(import.meta.url)),n=Ks.resolve(t,"..","..",di);pi(Qs.existsSync(e)?e:n)}();const n=hi(t);if(!n)return null;const i=`${n}:${e}`,r=oi.get(i);if(void 0!==r)return r;const o=new Date(n);if(isNaN(o.getTime()))return null;o.getUTCDay();for(let s=1;s<=5;s++){const n=new Date(o);n.setDate(n.getDate()-s);const i=mi.format(n),r=`${i}:${e}`,a=oi.get(r);if(void 0!==a){return qs(0,t instanceof Date&&t.toISOString()),a}}return null}function bi(e,t){if("GBP"===e)return 1;const n=ci[t];return n?n[e]??null:null}function xi(e,t,n="DAILY_PREFERRED",s){if("GBP"===e)return 1;const i=yi(e,t);if(null!==i&&"YEARLY_PREFERRED"!==n)return i;const r=gi(t),o=bi(e,r);if(null!==o){if("YEARLY_PREFERRED"===n)return o;if("DAILY_REQUIRED"!==n&&null===i)return hi(t),t instanceof Date&&t.toISOString(),o}if("YEARLY_PREFERRED"===n&&null!==i)return i;const a=hi(t)||"unknown date",l="USD"!==e&&"GBP"!==e?` Note: The bundled daily spot-rate dataset in this package is USD/GBP-only. For ${e} spot conversions, you must provide a broker spot rate (FxRateToBase) on each transaction, or extend/configure daily-rate data for ${e}.`:"";throw new Error("DAILY_REQUIRED"===n?`CRITICAL COMPLIANCE ERROR (CG78310): No daily exchange rate available for ${e} on ${a} (tax year ${r}). Checked up to 5 days back. HMRC requires spot exchange rates for capital transactions (CG78310). Provide a broker spot rate (FxRateToBase) or ensure Bank of England daily rates are available.`+l+" This may indicate: (1) Missing data in the Bank of England CSV, (2) Date is outside CSV coverage (currently 2015-2026), or (3) CSV file was not loaded.":`[CRITICAL ERROR] No daily exchange rate available for ${e} on ${a} (tax year ${r}). Checked up to 5 days back. Yearly average also missing.`+l+" This may indicate: (1) Missing data in the Bank of England CSV, (2) Date is outside CSV coverage (currently 2015-2026), or (3) CSV file was not loaded.")}function vi(e,t,n,s="DAILY_PREFERRED",i){if("GBP"===t)return e;if(void 0!==i&&0!==i){const s=yi(t,n);if(null!==s){const e=.05,r=1/i,o=Math.abs(s-r)/s,a=Math.abs(s-i)/s;if(a<e&&a<o){const e=hi(n)||"unknown date";throw new Error(`CRITICAL COMPLIANCE ERROR: Likely inverted FX rate detected for ${t} on ${e}. Broker provided ${i.toFixed(4)} (looks like ${t}/GBP), but expected GBP/${t} (approx ${(1/s).toFixed(4)}). HMRC requires transactions to be converted using GBP per 1 foreign unit.`)}}else{const e=gi(n),s=bi(t,e);if(null!==s){const r=.1,o=.25,a=s,l=1/a,c=1/i,d=Math.abs(a-c)/a,u=Math.abs(a-i)/a;if(u<r&&u<d){const s=hi(n)||"unknown date";throw new Error(`CRITICAL COMPLIANCE ERROR: Likely inverted FX rate detected for ${t} on ${s}. Broker provided ${i.toFixed(6)} (looks like ${t}/GBP), but expected GBP/${t} (approx ${l.toFixed(6)} from HMRC yearly average for ${e}). HMRC requires transactions to be converted using GBP per 1 foreign unit.`)}d>o&&(i.toFixed(6),l.toFixed(6),hi(n),n instanceof Date&&n.toISOString())}}return e*i}const r=xi(t,n,s);return 0===r?0:e/r}function wi(e,t,n){const s=`${e}:${t}`;oi.set(s,n)}function Ci(e,t=[],n){js.clear();const s=e=>e.conid?e.conid.toString():e.symbol,i=(e,t)=>t.length>0?t[0].symbol:e,r={};for(const h of e){const e=s(h);r[e]||(r[e]=[]),r[e].push(h)}const o={};for(const h of t||[]){const e=s(h);o[e]||(o[e]=[]),o[e].push(h)}const a=[],l=[],c=function(){const e=new Map;for(const t of Vs.actions)e.set(t.childSymbol,t.parentSymbol);return e}(),d=/spinoff|spin-off/i,u=new Map;for(const h of t||[]){const e=h.description||"";if(!d.test(e))continue;const t=e.match(/\(([A-Z0-9.]+),/i),n=t?t[1].trim():void 0;n&&n!==h.symbol&&c.set(n,h.symbol);const s=`${h.date}|${e}`,i=u.get(s)||{parent:void 0,symbols:new Set};if(i.symbols.add(h.symbol),!i.parent){const t=e.trim().match(/^([A-Z0-9.]+)\s*(?:\(|\s)/i);t&&(i.parent=t[1].trim())}u.set(s,i)}for(const h of u.values())if(h.parent)for(const e of h.symbols)e!==h.parent&&c.set(e,h.parent);const m=Object.keys(r);for(const h in o)m.includes(h)||m.push(h);m.sort((e,t)=>{const n=i(e,r[e]||o[e]),s=i(t,r[t]||o[t]);if(c.get(n)===s)return 1;return c.get(s)===n?-1:0});for(const h of m){const e=r[h]||[],t=o[h]||[],{disposals:s,pool:i,shorts:c}=Si(e,t,n);a.push(...s);const d=e.length>0?e[0].assetCategory:"Unknown",u=e.length>0?e[0].symbol:h;if(i.quantity>1e-7&&l.push({symbol:u,quantity:i.quantity,cost:i.cost,currency:"GBP",assetCategory:d,originalCost:i.originalCost,originalCurrency:i.originalCurrency||void 0}),c.length>0){const e=c.reduce((e,t)=>e+t.remainingQty,0);if(e>1e-7){const t=c.reduce((e,t)=>e+Oi(t)/t.quantity*t.remainingQty,0);l.push({symbol:u,quantity:-e,cost:t,currency:"GBP",assetCategory:c[0].assetCategory})}}}return a.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),{disposalResults:a,openPositions:l}}function Si(e,t,n){const s=[...e.map(e=>({...e,eventType:"TRADE"})),...t.map(e=>({...e,eventType:e.eventType||"SPLIT"}))].sort((e,t)=>{const n=new Date(e.date),s=new Date(t.date),i=n.getTime(),r=s.getTime();return i!==r?i-r:e.eventType!==t.eventType?"SPLIT"===e.eventType||"COST_BASIS_ADJUSTMENT"===e.eventType||"SPINOFF"===e.eventType?1:-1:0}).map(e=>{if("TRADE"===e.eventType)return{...Ti(e,e.date),eventType:"TRADE"};if("COST_BASIS_ADJUSTMENT"===e.eventType&&void 0!==e.amountChange&&e.currency){const n=e,s=n.amountChange,i=n.currency;let r;try{r="GBP"===i?s:void 0===n.fxRateToBase||0===n.fxRateToBase?vi(s,i,n.date,"DAILY_REQUIRED"):vi(s,i,n.date,"DAILY_REQUIRED",n.fxRateToBase)}catch(t){const e=Di(n.date);throw new Error(`CRITICAL COMPLIANCE ERROR (CG78310): Failed GBP conversion for corporate action ${n.symbol} on ${e} (${i}). Cause: ${t.message}`)}return{...n,amountChange:r}}return{...e}});let i=0;{let e=0;for(const t of s)if("TRADE"===t.eventType)"BUY"===t.type&&(e+=t.quantity),"SELL"===t.type&&(e-=t.quantity);else if("SPLIT"===t.eventType){const n=e,s=t.quantityChange,r=n+s;let o=1;if(0!==n?o=r/n:Math.abs(s)>1e-6&&(i+=s,qs((t.date,Ai(t.symbol)),t.date)),t.ratio){const[e,n]=t.ratio.split(":").map(Number);0!==n&&(o=e/n)}t._derivedRatio=o,e=r}}const r=(e,t)=>{let n=1;for(const i of s)if("SPLIT"===i.eventType){const s=new Date(i.date);if(s>e&&s<=t){let e=1;if(void 0!==i._derivedRatio)e=i._derivedRatio;else if(i.ratio){const[t,n]=i.ratio.split(":").map(Number);0!==n&&(e=t/n)}n*=e}}return n},o=new Map,a=[],l={quantity:0,cost:0,originalCost:0,originalCurrency:void 0},c=[],d=[],u=e=>({transaction:e,currentQty:e.quantity,originalQtyForCost:e.quantity,costBasis:Oi(e),originalCostBasis:Oi(e,!0),date:new Date(e.date),consumed:!1,splitRatioAccumulator:1}),m=t=>{const s=(r=t.symbol,o=t.date,Vs.actions.filter(e=>e.parentSymbol===r&&e.date===o));var r,o;const u=t.description||"",m=/SPIN[- ]?OFF/i.test(u);if(0===s.length&&n&&m){const e=u.match(/\(([A-Z0-9.]+),/i);if(e&&e[1]!==t.symbol){const i=function(e,t,n){const s=e.description.match(/SPIN[- ]?OFF\s+(\d+(?:\.\d+)?)\s+FOR\s+(\d+(?:\.\d+)?)\s+\(/i);if(!s)return e.description,e.date,null;const i=parseFloat(s[1]),r=parseFloat(s[2]);if(0===r)return null;const o=i/r,a=n.getPrice(e.symbol,e.date),l=n.getPrice(t,e.date);if(!a||!l)return null;let c=a.price,d=l.price,u=a.date;if(a.date!==l.date){const s=n.getPrice(e.symbol,l.date);if(s&&s.date===l.date)c=s.price,u=l.date;else{const s=n.getPrice(t,a.date);if(!s||s.date!==a.date)return e.symbol,a.date,l.date,e.date,null;d=s.price,u=a.date}}const m=c,h=d;u!==e.date&&a.date!==l.date&&(a.date,l.date,e.date);const g=h*o,f=m+g;if(0===f)return null;const p=m/f,y=g/f;return e.symbol,a.date,p.toFixed(4),y.toFixed(4),e.date,{date:e.date,parentSymbol:e.symbol,childSymbol:t,parentRatio:p,childRatio:y}}(t,e[1],n);i&&(h=i,Vs.actions.some(e=>e.parentSymbol===h.parentSymbol&&e.childSymbol===h.childSymbol&&e.date===h.date)||Vs.actions.push(h),s.push(i))}}var h;if(s.length>0)for(const e of s){const{parentAdj:n,childBasis:s}=Ys(l.cost,e);l.cost+=n,zs(e.childSymbol,s),qs((e.parentSymbol,e.childSymbol),t.date);for(const t of d){if(t.consumed)continue;const{parentAdj:n,childBasis:s}=Ys(t.costBasis,e);t.costBasis+=n,zs(e.childSymbol,s)}}else{const e=u.match(/\(([A-Z0-9.]+),/i),n=e?e[1].trim():void 0;if(m&&n&&n!==t.symbol)throw new Error(`CRITICAL COMPLIANCE ERROR: Spin-off detected for ${t.symbol} -> ${n} on ${t.date}. Auto-calculation failed because prices for BOTH assets (Parent & Child) could not be found in your CSVs, and no manual rule was provided. HMRC requires cost apportionment between Parent and Child shares (CG51830). FIX: Either (1) Ensure your Flex Query includes the "Open Positions" section with MarkPrice for the spinoff date, or (2) provide a manual apportionment rule in config.`)}const g=Hs(t.symbol);g>0&&(l.cost+=g,g.toFixed(2),t.date);let f=1;if(t.ratio){const[e,n]=t.ratio.split(":").map(Number);0!==n&&(f=e/n)}else void 0!==t._derivedRatio&&(f=t._derivedRatio);if(1!==f){l.quantity*=f;for(const e of d)e.consumed||(e.currentQty*=f,e.splitRatioAccumulator*=f);for(const e of c)e.quantity*=f,e.remainingQty*=f,e.price/=f}else 0!==i&&(l.quantity+=i,i=0);if("COST_BASIS_ADJUSTMENT"===t.eventType&&t.amountChange){const s=Math.abs(t.amountChange),i=l.quantity,r=d.reduce((e,t)=>t.consumed?e:e+t.currentQty,0),o=i+r,c=s<=3e3;let u,m,h;if(o>0&&n){const e=n.getPrice(t.symbol,t.date,{strict:!0});if(e){m=o*e.price,u=m>0?s/m:void 0,h=void 0!==u?u<=.05:void 0;if(!(c&&!0===h))throw new Error(`CRITICAL COMPLIANCE ERROR: Capital distribution of £${s.toFixed(2)} for ${t.symbol} on ${t.date} fails the Small Capital Distribution test (CG57835). HMRC accept treatment as a cost reduction if the distribution is <= 5% of market value AND <= £3,000. Current: Amount £${s.toFixed(2)} (${c?"Pass":"Fail"}), Ratio ${void 0!==u?`${(100*u).toFixed(2)}%`:"Unknown"} (${void 0===h?"Unknown":h?"Pass":"Fail"}). Please calculate the gain manually as a part-disposal.`);s.toFixed(2),void 0!==u&&(100*u).toFixed(2),t.date}else{if(!c)throw new Error(`CRITICAL COMPLIANCE ERROR: Capital distribution of £${s.toFixed(2)} for ${t.symbol} on ${t.date} exceeds £3,000 and market value could not be determined to check the 5% test (CG57835). HMRC requires a part-disposal computation unless it qualifies as "small". Please calculate the gain manually as a part-disposal.`);s>0&&(s.toFixed(2),t.symbol,t.date)}}else{if(!c)throw new Error(`CRITICAL COMPLIANCE ERROR: Capital distribution of £${s.toFixed(2)} for ${t.symbol} on ${t.date} exceeds £3,000 and there is no holding or price data to verify the 5% test (CG57835). Please calculate the gain manually as a part-disposal.`);s>0&&(s.toFixed(2),t.symbol,t.date)}let g=t.amountChange;if(o>0&&Math.abs(i)>1e-7){const n=i/o*t.amountChange,s=l.cost+n;if(g-=n,s<-1e-7){const n=Math.abs(s),i=e.length>0?e[0].assetCategory:"Stocks";a.push({date:t.date,symbol:t.symbol,quantity:0,proceeds:n,allowableCost:0,gain:n,rule:"SECTION_104",assetCategory:i,source:t.source,notes:`Excess Capital Distribution (Gain) from ${t.description} (Pool Share)`,matchNotes:"Automatic gain triggered by zero cost basis"}),l.cost=0,t.symbol,n.toFixed(2),t.date}else l.cost=s}else if(o<=0){if(l.cost+=t.amountChange,l.cost<0){const n=Math.abs(l.cost);a.push({date:t.date,symbol:t.symbol,quantity:0,proceeds:n,allowableCost:0,gain:n,rule:"SECTION_104",assetCategory:e.length>0?e[0].assetCategory:"Stocks",source:t.source,notes:`Excess Capital Distribution (Gain) from ${t.description} (No Position)`,matchNotes:"Automatic gain triggered by zero cost basis"}),l.cost=0}g=0}if(Math.abs(g)>1e-7&&r>1e-7)for(const e of d){if(e.consumed)continue;const n=e.currentQty/r*g,s=e.costBasis+n;if(s<-1e-7){const n=Math.abs(s);a.push({date:t.date,symbol:t.symbol,quantity:0,proceeds:n,allowableCost:0,gain:n,rule:"SECTION_104",assetCategory:e.transaction.assetCategory,source:t.source,notes:`Excess Capital Distribution (Gain) from ${t.description} (Unmatched Buy)`,matchNotes:"Automatic gain triggered by zero cost basis"}),e.costBasis=0,e.originalCostBasis=0}else if(e.costBasis=s,e.costBasis>0){const t=s/(s-n);e.originalCostBasis*=t}else e.originalCostBasis=0}}},h=(e,t)=>{const n=t/e.currentQty,s=e.costBasis*n,i=e.originalCostBasis*n;e.currentQty-=t,e.costBasis-=s,e.originalCostBasis-=i,e.currentQty<1e-7&&(e.consumed=!0);let r=e.transaction.notes||"";return 1!==e.splitRatioAccumulator&&(r+=` (Split Adj ${e.splitRatioAccumulator.toFixed(2)}x)`),{cost:s,originalCost:i,notes:r}},g=new Map;for(const f of s){const e=Di(f.date);g.has(e)||g.set(e,[]),g.get(e).push(f)}for(const[f,p]of g){const e=[],t=[];for(const n of p)if("SPLIT"===n.eventType||"COST_BASIS_ADJUSTMENT"===n.eventType||"SPINOFF"===n.eventType)m(n);else{const s=n;if("BUY"===s.type){const t=Hs(s.symbol),n=u(s);t>0&&(n.costBasis+=t,n.originalCostBasis+=t,qs((t.toFixed(2),s.symbol),s.date)),e.push(s),d.push(n)}else"SELL"===s.type&&t.push(s)}for(const n of e){const e=d.find(e=>e.transaction===n);if(!e)continue;const t=o.get(n)||0;if(t>0){const s=Math.min(t,e.currentQty);h(e,s),o.delete(n)}}for(const n of t){let t=n.quantity;const i=d.filter(t=>!t.consumed&&e.includes(t.transaction));if(i.length>0&&t>0){const e=i.reduce((e,t)=>e+t.currentQty,0),s=i.reduce((e,t)=>e+t.costBasis,0),r=i.reduce((e,t)=>e+t.originalCostBasis,0),o=s/e,l=r/e,c=Math.min(t,e);i.forEach(t=>{const n=t.currentQty/e*c;h(t,n)});const d=o*c,u=l*c,m=Oi(n)/n.quantity*c;a.push({date:n.date,symbol:n.symbol,quantity:c,proceeds:m,allowableCost:d,gain:m-d,rule:"SAME_DAY",matchDate:f,assetCategory:n.assetCategory,source:n.source,matchSource:{file:"Same Day Pool",line:0},originalProceeds:Oi(n,!0)/n.quantity*c,originalCost:u,originalCurrency:n.originalCurrency,multiplier:n.multiplier,isAssignment:n.isAssignment,isExpired:n.isExpired,notes:n.notes,matchNotes:"Pooled Same Day Match"}),t-=c}if(t>0){const e=new Date(n.date),i=Di(n.date),l=s.filter(e=>{return"TRADE"===e.eventType&&"BUY"===e.type&&Ri(e.date,i)&&_i(i,e.date)<=30&&(t=i,n=e.date,!(Di(t)===Di(n)));var t,n});for(const s of l){if(t<=0)break;const i=o.get(s)||0,l=r(e,new Date(s.date)),c=(s.quantity-i)/l;if(c>1e-7){const e=Math.min(t,c),r=e*l,d=Oi(s)/s.quantity*r,u=Oi(n)/n.quantity*e;a.push({date:n.date,symbol:n.symbol,quantity:e,proceeds:u,allowableCost:d,gain:u-d,rule:"BED_AND_BREAKFAST",matchDate:s.date,assetCategory:n.assetCategory,source:n.source,matchSource:s.source,originalProceeds:Oi(n,!0)/n.quantity*e,originalCost:Oi(s,!0)/s.quantity*r,originalCurrency:n.originalCurrency,multiplier:n.multiplier,isAssignment:n.isAssignment||s.isAssignment,isExpired:n.isExpired||s.isExpired,notes:n.notes,matchNotes:s.notes+(1!==l?" (Split Adj)":"")}),t-=e,o.set(s,i+r)}}}if(t>1e-7){if(l.quantity>1e-7){const e=Math.min(t,l.quantity),s=l.cost/l.quantity*e,i=Oi(n)/n.quantity*e;let r=0;void 0!==l.originalCost&&l.quantity>0&&(r=l.originalCost/l.quantity*e),a.push({date:n.date,symbol:n.symbol,quantity:e,proceeds:i,allowableCost:s,gain:i-s,rule:"SECTION_104",assetCategory:n.assetCategory,source:n.source,originalProceeds:Oi(n,!0)/n.quantity*e,originalCurrency:n.originalCurrency,multiplier:n.multiplier,isAssignment:n.isAssignment,isExpired:n.isExpired,originalCost:r,originalCostCurrency:l.originalCurrency||n.originalCurrency}),l.quantity-=e,l.cost-=s,void 0!==l.originalCost&&(l.originalCost-=r),t-=e}t>1e-7&&c.push({...n,remainingQty:t})}}for(const n of e){const e=d.find(e=>e.transaction===n);if(e&&(!e.consumed&&(e.currentQty>1e-7||Math.abs(e.costBasis)>1e-9))){for(;e.currentQty>1e-7&&c.length>0;){const t=c[0],s=Math.min(e.currentQty,t.remainingQty),{cost:i,originalCost:r}=h(e,s),o=Oi(t)/t.quantity*s;a.push({date:t.date,symbol:t.symbol,quantity:s,proceeds:o,allowableCost:i,gain:o-i,rule:"SHORT_MATCH",matchDate:n.date,assetCategory:t.assetCategory,source:t.source,matchSource:n.source,originalProceeds:Oi(t,!0)/t.quantity*s,originalCost:r,originalCurrency:t.originalCurrency,multiplier:t.multiplier,isAssignment:n.isAssignment,isExpired:n.isExpired}),t.remainingQty-=s,t.remainingQty<=1e-7&&c.shift()}(Math.abs(e.currentQty)>1e-9||Math.abs(e.costBasis)>1e-9)&&(ki(l,e.currentQty,e.costBasis,e.originalCostBasis,e.transaction.originalCurrency),e.consumed=!0)}}}return{disposals:a,pool:l,shorts:c}}function Ti(e,t){const n={...e,originalPrice:e.price,originalAmount:e.amount,originalCurrency:e.currency,originalCommission:e.commission,multiplier:e.multiplier,notes:e.notes};if("GBP"===e.currency)return{...n,originalCurrency:"GBP"};const s=t||e.date;try{return{...n,price:vi(e.price,e.currency,s,"DAILY_REQUIRED",e.fxRateToBase),amount:vi(e.amount,e.currency,s,"DAILY_REQUIRED",e.fxRateToBase),commission:vi(e.commission,e.currency,s,"DAILY_REQUIRED",e.fxRateToBase),currency:"GBP"}}catch(i){const t=Di(s);throw new Error(`CRITICAL COMPLIANCE ERROR (CG78310): Failed GBP conversion for transaction ${e.symbol} on ${t} (${e.currency}). Cause: ${i.message}`)}}const Ii=new Intl.DateTimeFormat("en-CA",{timeZone:"Europe/London",year:"numeric",month:"2-digit",day:"2-digit"});function Di(e){if("string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if("string"==typeof e&&/^\d{4}-\d{2}-\d{2}[ T]\d{2}:\d{2}:\d{2}$/.test(e)&&!/[Zz]|[+-]\d{2}:?\d{2}$/.test(e))return e.substring(0,10);const t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?"string"==typeof e&&e.length>=10?e.substring(0,10):"":Ii.format(t)}function Ei(e){const[t,n,s]=e.split("-").map(Number);return t&&n&&s?Date.UTC(t,n-1,s):NaN}function _i(e,t){const n=Di(e),s=Di(t),i=Ei(n),r=Ei(s);return isNaN(i)||isNaN(r)?NaN:Math.round((r-i)/864e5)}function Ri(e,t){const n=Ei(Di(e)),s=Ei(t);return!isNaN(n)&&!isNaN(s)&&n>s}function ki(e,t,n,s,i){e.quantity+=t,e.cost+=n,s&&(e.originalCost=(e.originalCost||0)+s),i&&!e.originalCurrency&&(e.originalCurrency=i)}function Oi(e,t=!1){const n=t?e.originalAmount||0:e.amount,s=t?e.originalCommission||0:e.commission;return"BUY"===e.type?n+s:n-s}function Ai(e){const t=e.match(/^([A-Z]+)\s*(\d{2})(\d{2})(\d{2})([C|P])(\d{8})$/);if(t){const[,e,n,s,i,r,o]=t,a=parseInt(o,10)/1e3;return`${e} ${`${i}${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(s,10)-1]||s}${n}`} ${a} ${r}`}return e}function Mi(e,t,n="DAILY_REQUIRED"){if(!t)throw new Error(`[Compliance Error] Date is required for exchange rate lookup of ${e}. HMRC requires using the spot rate on the date of the transaction (CG78310).`);return xi(e,t,n)}function Ni(e,t,n,s,i="DAILY_REQUIRED"){if("GBP"===t)return e;if(!n)throw new Error(`[Compliance Error] Date is required for currency conversion of ${e} ${t}. HMRC requires using the spot rate on the date of the transaction (CG78310).`);return vi(e,t,n,i,s)}ui({yearlyAverages:{"2025_2026":{USD:1.2761,GBP:1},"2024_2025":{USD:1.2761,GBP:1},"2023_2024":{USD:1.2529,GBP:1},"2022_2023":{USD:1.219267,GBP:1},"2021_2022":{USD:1.371217,GBP:1},"2020_2021":{USD:1.293542,GBP:1},"2019_2020":{USD:1.279266667,GBP:1},"2018_2019":{USD:1.32,GBP:1},"2017_2018":{USD:1.31,GBP:1}}});class Pi{parseRecord(e,t,n,s){const i=n=>void 0!==t[n]?e[t[n]]:void 0,r=(...n)=>{for(const s of n)if(void 0!==t[s])return e[t[s]]},o=Gs(i("Quantity")),a=Gs(i("Proceeds")),l=r("Code","Notes/Codes")||"",c=l.split(";").map(e=>e.trim()).filter(e=>""!==e),d=r("TransactionType","Transaction Type")||"",u=$s((r("DateTime","TradeDate","Date/Time")||"").trim()),m=(i("Symbol")||"").trim(),h=(d||"").toUpperCase();if(h.includes("TRANSFER")||"DEPOSIT"===h||"WITHDRAWAL"===h||"DEP"===h||"WITH"===h)return;const g=r("IBCommission","Comm/Fee"),f=g?-Gs(g):0,p=c.includes("A")||c.includes("Ex")||c.includes("Ep")||"Assignment"===d||"Exercise"===d||"Expiration"===d||c.includes("IA");if(0===o&&0===a&&0===f&&!p)return;const y=(r("Buy/Sell","Side")||"").trim(),b=Math.abs(o),x=r("TradePrice","Trade Price"),v=x?Math.abs(Gs(x)):0;let w;w="BUY"===y||"BOT"===y?"BUY":"SELL"===y||"SLD"===y?"SELL":o>=0?"BUY":"SELL";let C="BUY"===w?-a:a;if("BUY"===w&&0===Math.abs(C)){const e=r("Amount","NetCash");if(e){const t=Gs(e);0!==t&&(C=-t)}if(0===C){const e=r("CostBasis","Cost Basis");if(e){const t=Gs(e);0!==t&&(C="BUY"===w?-Math.abs(t):Math.abs(t))}}}const S=r("Currency","CurrencyPrimary"),T=i("IBCommissionCurrency");let I;if(S){if(I=S,T&&T!==S&&0!==f)throw new Error(`CRITICAL COMPLIANCE ERROR: Mixed currencies on ${u} (Trade: ${S}, Commission: ${T}). HMRC rules (CG78310) require specific spot rates for each component. Mixed-currency transactions are not currently supported for safety.`)}else if(T){if(0!==o||0!==a)throw new Error(`CRITICAL COMPLIANCE ERROR: Trade on ${u} is missing Currency field. Falling back to IBCommissionCurrency (${T}) is prohibited under CG78310 to prevent incorrect FX conversion of trade amounts.`);I=T}else{if(0!==o||0!==a||0!==f)throw new Error(`CRITICAL COMPLIANCE ERROR: No currency found for transaction on ${u}. HMRC compliance requires explicit currency for accurate FX conversion.`);I="USD"}const D=Fs(i("Asset Category")||i("AssetClass")),E=i("Description"),_=i("Open/CloseIndicator")||"",R=Us("Conid",e,t),k=Us("TradeID",e,t),O=Us("TransactionID",e,t),A=i("Multiplier"),M=A?Gs(A):1,N=r("FxRateToBase","FXRateToBase"),P=N?Math.abs(Gs(N)):void 0;if(n.transactions.push({date:u,type:w,symbol:m,quantity:b,price:v,amount:C,currency:I,commission:f,description:E,conid:R,tradeId:k,transactionId:O,multiplier:M,assetCategory:D,fxRateToBase:P,code:l,codes:c,isOpen:c.includes("O")||"O"===_,isClose:c.includes("C")||"C"===_,isAssignment:c.includes("A")||"Assignment"===d,isExercise:c.includes("Ex")||"Exercise"===d,isExpired:c.includes("Ep")||"Expiration"===d,source:s}),Ls(E,l,c)){const e=Bs(E||"",m,R,u,s);n.corporateActionRecords.push(...e)}}}class $i{parseRecord(e,t,n,s){const i=n=>void 0!==t[n]?e[t[n]]:void 0,r=(...n)=>{for(const s of n)if(void 0!==t[s])return e[t[s]]};if(void 0!==t.LevelOfDetail){if("SUMMARY"===e[t.LevelOfDetail])return}const o=Gs(i("Quantity")),a=$s(i(void 0!==t["Date/Time"]?"Date/Time":void 0!==t["Report Date"]?"Report Date":"Date")),l=r("ActionDescription","Description"),c=(i("Symbol")||"").trim(),d=Us("Conid",e,t),u=i("Proceeds")||"0",m=i("Amount")||"0",h=Math.abs(Gs(u)),g=Math.abs(Gs(m)),f=(l||"").toUpperCase();if(0===o&&(f.includes("RETURN OF CAPITAL")||f.includes("EQUALISATION")||f.includes("CASH LIQUIDATION"))){const e=0!==h?h:g,t=r("CurrencyPrimary","Currency")||"USD",i=r("FxRateToBase","FXRateToBase")?Math.abs(Gs(r("FxRateToBase","FXRateToBase"))):void 0;return void n.corporateActionRecords.push({date:a,symbol:c||"",quantityChange:0,type:"COST_REDUCTION",description:l||"",conid:d,eventType:"COST_BASIS_ADJUSTMENT",amountChange:-e,currency:t,fxRateToBase:i,source:s})}const p=0!==h?h:g,y=(l||"").toLowerCase().includes("split"),b=Ls(l),x=(l||"").toLowerCase(),v=x.includes("interest")||x.includes("debit int")||x.includes("credit int")||/\bint\b/.test(x),w=0===o&&(x.includes("dividend")||x.includes("pid")||v||x.includes("borrow fee")||x.includes("tax")||x.includes("withholding")||x.includes("forex")||x.includes("fx")||x.includes("translation")||x.includes("conversion"));if(0===o&&0!==p&&!w)throw new Error(`CRITICAL HMRC COMPLIANCE ERROR: Zero-quantity corporate action with cash amount detected for ${c||"UNKNOWN"} on ${a}. This is a part-disposal event (e.g. cash-in-lieu) and requires a market value election or explicit treatment. No compliant method can be inferred from the CSV.`);if(y&&0===p)n.corporateActionRecords.push({date:a,symbol:c,quantityChange:o,type:"SPLIT",description:l,conid:d,source:s,eventType:"SPLIT"});else if(!c||0===o&&!b&&0===p||isNaN(o)||w){const e=Gs(i("Amount")),t=Gs(i("Proceeds")),o=0!==e?e:t;if(0!==o){const e=i("CurrencyPrimary")||"USD";if(x.includes("dividend")||x.includes("pid")||x.includes("property income"))x.includes("lieu")?n.dividendRecords.push({date:a,description:l,amount:o,currency:e,type:"PAYMENT_IN_LIEU"}):x.includes("pid")||x.includes("property income")?n.dividendRecords.push({date:a,description:l,amount:o,currency:e,type:"PROPERTY_INCOME_DIVIDEND"}):n.dividendRecords.push({date:a,description:l,amount:o,currency:e,type:"DIVIDEND_INCOME"});else if(x.includes("interest")||x.includes("borrow fee")||x.includes("credit int")||x.includes("debit int"))n.interestRecords.push({date:a,description:l,amount:o,currency:e});else if(x.includes("tax")||x.includes("withholding"))n.withholdingTaxRecords.push({date:a,description:l,amount:o,currency:e});else if(x.includes("forex")||x.includes("fx")||x.includes("translation")||x.includes("conversion")){const t=r("FxRateToBase","FXRateToBase")?Math.abs(Gs(r("FxRateToBase","FXRateToBase"))):void 0;let i=o,c=e;"GBP"!==e&&t&&t>0&&(i=o*t,c="GBP"),n.forexDetailRecords.push({date:a,description:l,amount:i,currency:c,code:"FX",assetCategory:"Forex",source:s})}}}else{if(b){const e=Bs(l||"",c,d,a,s);n.corporateActionRecords.push(...e)}n.transactions.push({date:a,type:o>=0?"BUY":"SELL",symbol:c,quantity:Math.abs(o),price:0!==o?p/Math.abs(o):0,amount:p,currency:i("CurrencyPrimary")||"USD",commission:0,description:l,conid:d,multiplier:1,assetCategory:Fs(i("AssetClass")||"Unknown"),fxRateToBase:r("FxRateToBase","FXRateToBase")?Math.abs(Gs(r("FxRateToBase","FXRateToBase"))):void 0,code:b?"SO":"CA",codes:b?["SO"]:[],source:s,isAssignment:!1,isExercise:!1,isExpired:!1,isOpen:o>=0,isClose:o<0})}}}class Fi{parseRecord(e,t,n,s){const i=n=>void 0!==t[n]?e[t[n]]:void 0,r=(...n)=>{for(const s of n)if(void 0!==t[s])return e[t[s]]},o=void 0!==t.ReportDate?"ReportDate":"Report Date",a=i(o);if(!a||a===o||!/^(\d|[A-Z][a-z]{2})/.test(a))return;const l=$s(a),c=(i("Symbol")||"").trim(),d=Us("Conid",e,t),u=Gs(i("Quantity")),m=Gs(r("MarkPrice","Mark Price","ClosePrice","Close Price")),h=Gs(r("PositionValue","Position Value","Value")),g=Gs(r("CostBasisPrice","Cost Basis Price")),f=Gs(r("CostBasisMoney","Cost Basis Money")),p=Gs(r("FifoPnlUnrealized","Unrealized P/L")),y=r("CurrencyPrimary","Currency")||"USD",b=Fs(r("AssetClass","Asset Class")),x=i("Multiplier"),v=x?Gs(x):1,w=i("Description");c&&0!==u&&n.openPositions.push({date:l,symbol:c,conid:d,quantity:u,markPrice:m,positionValue:h,costBasisPrice:g,costBasisMoney:f,unrealizedPnL:p,currency:y,assetCategory:b,multiplier:v,description:w,source:{file:s.file,line:"object"==typeof s.line?s.line[0]:s.line}})}}class Li{parseRecord(e,t,n,s){const i=n=>void 0!==t[n]?e[t[n]]:void 0,r=(...n)=>{for(const s of n)if(void 0!==t[s])return e[t[s]]},o=$s(i(void 0!==t.Date?"Date":"Date/Time")),a=(i("Symbol")||"").trim(),l=Us("Conid",e,t),c=Us("TradeID",e,t),d=Us("TransactionID",e,t),u=r("TransactionType","Transaction Type"),m=Gs(i("Quantity")),h=Gs(r("TradePrice","Trade Price")),g=Gs(i("Proceeds")),f=Math.abs(Gs(i("Comm/Tax"))),p=Gs(i("Basis")),y=Gs(r("FifoPnlRealized","Realized P/L")),b=r("CurrencyPrimary","Currency")||"USD",x=Fs(r("AssetClass","Asset Class")),v=i("Description"),w=Gs(i("Multiplier"))||void 0;a&&u&&("Assignment"===u||"Exercise"===u||"Expiration"===u||"Delivery"===u)&&n.optionEvents.push({date:o,symbol:a,conid:l,transactionType:u,quantity:m,tradePrice:h,proceeds:g,commTax:f,basis:p,realizedPnL:y,currency:b,assetCategory:x,description:v,multiplier:w,tradeId:c,transactionId:d,source:{file:s.file,line:"object"==typeof s.line?s.line[0]:s.line}})}}class Bi{parseRecord(e,t,n,s){const i=n=>void 0!==t[n]?e[t[n]]:void 0,r=(...n)=>{for(const s of n)if(void 0!==t[s])return e[t[s]]},o=void 0!==t["Date/Time"]?"Date/Time":"Date",a=i(o);if(!a||a===o||!/^(\d|[A-Z][a-z]{2})/.test(a))return;const l=$s(a),c=i("SettleDate"),d=c?$s(c):void 0,u=i("Symbol"),m=Us("Conid",e,t),h=i("Type"),g=Gs(i("Amount")),f=r("CurrencyPrimary","Currency")||"USD",p=i("Description"),y=r("TransactionID","Transaction ID"),b=i("TradeID");h&&0!==g&&n.cashTransactions.push({date:l,settleDate:d,symbol:u,conid:m,type:h,amount:g,currency:f,description:p,tradeId:b,transactionId:y,source:{file:s.file,line:"object"==typeof s.line?s.line[0]:s.line}})}}class Ui{parseRecord(e,t,n,s){const i=n=>void 0!==t[n]?e[t[n]]:void 0,r=$s(i(void 0!==t.DateTime?"DateTime":"Date")),o=i("FXCurrency"),a=i("ActivityDescription"),l=Gs(i("Quantity")),c=Gs(i("Proceeds")),d=Gs(i("Cost")),u=Gs(i("RealizedP/L")),m=i("Code"),h=i("LevelOfDetail");h&&("SUMMARY"===h.toUpperCase()||"TOTAL"===h.toUpperCase())||!o||0===c&&0===u&&0===d||n.forexPLDetailRecords.push({date:r,description:a,fxCurrency:o,quantity:l,proceeds:c,cost:d,realizedPnL:u,code:m,source:{file:s.file,line:"object"==typeof s.line?s.line[0]:s.line}})}}class Gi{parseRecord(e,t,n,s){const i=n=>void 0!==t[n]?e[t[n]]:void 0,r=(...n)=>{for(const s of n)if(void 0!==t[s])return e[t[s]]},o=$s(i(void 0!==t.Date?"Date":"Date/Time")),a=i("Symbol"),l=Us("Conid",e,t),c=r("TaxDescription","Tax Description"),d=Gs(r("TaxAmount","Tax Amount")),u=r("CurrencyPrimary","Currency")||"USD",m=i("AssetClass")?Fs(i("AssetClass")):void 0,h=r("TradeID","Trade ID")?.trim();c&&0!==d&&n.transactionFees.push({date:o,symbol:a,conid:l,taxDescription:c,taxAmount:d,currency:u,assetCategory:m,tradeId:h,source:{file:s.file,line:"object"==typeof s.line?s.line[0]:s.line}})}}class qi{parseRecord(e,t,n,s){const i=n=>void 0!==t[n]?e[t[n]]:void 0,r=(...n)=>{for(const s of n)if(void 0!==t[s])return e[t[s]]},o=$s(r("ReportDate","Report Date")),a=$s(r("TradeDate","Trade Date")),l=(i("Symbol")||"").trim(),c=Us("Conid",e,t),d=Gs(i("Quantity")),u=i("Type"),m=r("CurrencyPrimary","Currency")||"USD",h=Fs(r("AssetClass","Asset Class")),g=i("Description");l&&n.pendingExercises.push({reportDate:o,tradeDate:a,symbol:l,conid:c,quantity:d,type:u,currency:m,assetCategory:h,description:g,source:{file:s.file,line:"object"==typeof s.line?s.line[0]:s.line}})}}class Vi{constructor(){t(this,"parsers",{}),this.parsers.TRADES=new Pi,this.parsers.CORP=new $i,this.parsers.OPEN_POS=new Fi,this.parsers.OPTION_EVENTS=new Li,this.parsers.CASH_TX=new Bi,this.parsers.FOREX_PL=new Ui,this.parsers.TX_FEES=new Gi,this.parsers.PENDING_EX=new qi}parse(e,t){const n={transactions:[],forexSummaries:[],reportPeriod:null,interestRecords:[],dividendRecords:[],withholdingTaxRecords:[],corporateActionRecords:[],forexDetailRecords:[],forexPLDetailRecords:[],openPositions:[],complexPositions:[],optionEvents:[],pendingExercises:[],transactionFees:[],cashTransactions:[]},s=f(e,{relax_column_count:!0,skip_empty_lines:!0,trim:!0,info:!0});let i="UNKNOWN",r={},o="",a=!1,l=!1;for(const{record:c,info:d}of s){if(1===c.length&&String(c[0]).startsWith("!")){o=String(c[0]).substring(1).trim().toUpperCase();continue}const e=String(c[0]);if("ClientAccountID"===e||"CurrencyPrimary"===e||"AccountAlias"===e){r=c.reduce((e,t,n)=>(e[t]=n,e),{});const e={};for(const n in r){e[n.toLowerCase().replace(/\s+/g,"").replace(/\//g,"")]=r[n]}const t=this.detectSection(o,e);"UNKNOWN"!==t&&(i=t),void 0!==e.fxratetobase&&(l=!0),void 0!==e.functionalcurrency&&(a=!0,void 0===r.FunctionalCurrency&&(r.FunctionalCurrency=e.functionalcurrency));continue}if(void 0!==r.FunctionalCurrency){const e=Us("FunctionalCurrency",c,r);if(!e)throw new Error(`CRITICAL COMPLIANCE ERROR: Missing FunctionalCurrency value in ${t} (section ${i}). This calculator requires GBP base currency accounts and must verify the FunctionalCurrency column to interpret FxRateToBase correctly.`);if("GBP"!==e)throw new Error(`CRITICAL COMPLIANCE ERROR: Functional currency is reported as ${e}. This calculator expects GBP base currency accounts. Reporting gains in ${e} for a UK tax return is NON-COMPLIANT.`)}if(this.parsers[i]){const e={file:t,line:d.lines};this.parsers[i].parseRecord(c,r,n,e)}}if(this.postProcess(n),l&&!a)throw new Error(`CRITICAL COMPLIANCE ERROR: Missing required FunctionalCurrency column in ${t}. Cannot verify that the IBKR account base currency is GBP, which is required for HMRC-compliant reporting.`);return n}detectSection(e,t){return"TRADES"===e||void 0!==t.buysell&&void 0!==t.transactiontype?"TRADES":"OPTION_EVENTS"===e||void 0!==t.basis&&void 0!==t.commtax?"OPTION_EVENTS":"STMT_CASH_TRANSACTIONS"===e||void 0!==t.settledate&&void 0!==t.amount&&void 0!==t.type&&void 0===t.buysell?"CASH_TX":"CORPORATE_ACTIONS"===e||void 0!==t.actionid||void 0!==t.actiondescription&&void 0!==t.type?"CORP":"OPEN_POSITIONS"===e||"OPEN_POS"===e||"COMPLEX_POSITIONS"===e||"COMPLEX_POS"===e||void 0!==t.markprice&&void 0!==t.costbasisprice&&void 0!==t.reportdate&&void 0===t.changeinpositionvalue&&void 0===t.realizedpnl&&void 0===t.unrealizedpnl&&void 0===t.totalpnl||void 0!==t.closeprice&&(void 0!==t.mtmpnl||void 0!==t.value)&&void 0===t.markprice?"OPEN_POS":"PENDING_EXERCISES"===e||void 0!==t.type&&void 0!==t.tradedate&&void 0!==t.quantity&&void 0===t.actionid&&void 0===t.buysell?"PENDING_EX":"TRANS_TAX_DETAILS"===e||void 0!==t.taxdescription&&void 0!==t.taxamount?"TX_FEES":"FOREX_PL"===e||void 0!==t.fxcurrency&&void 0!==t.activitydescription&&void 0!==t.realizedpl?"FOREX_PL":"UNKNOWN"}postProcess(e){if(e.transactionFees&&e.transactionFees.length>0&&this.applyTransactionFees(e.transactions,e.transactionFees),e.cashTransactions&&e.cashTransactions.length>0){const t=e.dividendRecords.length,n=e.interestRecords.length,s=e.withholdingTaxRecords.length;e.dividendRecords=[],e.interestRecords=[],e.withholdingTaxRecords=[];for(const l of e.cashTransactions){const t=l.type,n=(l.description||"").toLowerCase();if("Dividends"===t||"Payment In Lieu Of Dividends"===t){const s=n.includes("pid")||n.includes("property income"),i="Payment In Lieu Of Dividends"===t||n.includes("lieu");e.dividendRecords.push({date:l.date,description:l.description,amount:l.amount,currency:l.currency,type:i?"PAYMENT_IN_LIEU":s?"PROPERTY_INCOME_DIVIDEND":"DIVIDEND_INCOME"})}else"Withholding Tax"===t||t.includes("Withholding")?e.withholdingTaxRecords.push({date:l.date,description:l.description,amount:l.amount,currency:l.currency,type:"WITHHOLDING_TAX"}):"Broker Interest Paid"!==t&&"Broker Interest Received"!==t&&"Bond Interest Paid"!==t&&"Bond Interest Received"!==t||e.interestRecords.push({date:l.date,description:l.description,amount:l.amount,currency:l.currency})}const i=e.dividendRecords.length,r=e.interestRecords.length,o=e.withholdingTaxRecords.length,a=[];if(t>0&&i<t&&a.push(`Dividend records: Corporate Actions had ${t} records, but Cash Transactions only has ${i}. Missing ${t-i} dividend record(s).`),n>0&&r<n&&a.push(`Interest records: Corporate Actions had ${n} records, but Cash Transactions only has ${r}. Missing ${n-r} interest record(s).`),s>0&&o<s&&a.push(`Withholding Tax records: Corporate Actions had ${s} records, but Cash Transactions only has ${o}. Missing ${s-o} withholding tax record(s).`),a.length>0)throw new Error("CRITICAL HMRC COMPLIANCE ERROR: Incomplete Cash Transaction data detected. When Cash Transactions exist, they replace Corporate Action income records, but the Cash Transaction section appears incomplete:\n\n"+a.map(e=>`  - ${e}`).join("\n")+'\n\nThis would lead to under-reporting of income to HMRC. Please ensure your Flex Query includes the complete "Cash Transactions" section or remove it to fall back to Corporate Actions data.')}}applyTransactionFees(e,t){const n=new Map,s=[];for(const o of t)if(o.tradeId){const e=n.get(o.tradeId)||[];e.push(o),n.set(o.tradeId,e)}else s.push(o);const i=(e,t)=>{const n=e.taxAmount;if(0===n)return 0;if(e.currency===t.currency)return n;if("GBP"===e.currency&&"GBP"!==t.currency){if(!t.fxRateToBase||0===t.fxRateToBase)throw new Error(`CRITICAL HMRC COMPLIANCE ERROR: Missing FxRateToBase for ${t.symbol||"UNKNOWN"} on ${t.date}.`);return n/t.fxRateToBase}throw new Error(`CRITICAL HMRC COMPLIANCE ERROR: Fee currency ${e.currency} does not match trade currency ${t.currency}.`)};for(const o of e){if(!o.tradeId)continue;const e=n.get(o.tradeId);if(!e)continue;const t=e.reduce((e,t)=>e+i(t,o),0);0!==t&&(o.commission+=t,o.notes=(o.notes||"")+` (Fees applied: ${o.currency} ${t>=0?"+":""}${t.toFixed(2)})`)}const r=(e,t)=>e.substring(0,10)===t.substring(0,10);for(const o of s){const t=e.filter(e=>(o.conid&&e.conid&&String(o.conid)===String(e.conid)||!(!o.symbol||!e.symbol||o.symbol!==e.symbol))&&r(e.date,o.date));if(1===t.length){const e=t[0],n=i(o,e);if(0!==n){e.commission+=n;const t=n>=0?`+${n.toFixed(2)}`:n.toFixed(2);e.notes=(e.notes||"")+` (Fees applied: ${e.currency} ${t})`}}}}}async function Wi(e,t="memory"){const n=e.trim();if(n.startsWith('"ClientAccountID"')||n.startsWith("!")||n.startsWith('"!')){return(new Vi).parse(e,t)}throw new Error('Unsupported CSV format. Please use an IBKR Activity Flex Query (starting with "ClientAccountID"). Standard "Activity Statements" are no longer supported.')}function ji(e,t,n,s,i){if("GBP"===t)return e;if(s&&0!==s)return Ni(e,t,n,s,"DAILY_REQUIRED");try{return Ni(e,t,n,void 0,"DAILY_REQUIRED")}catch(r){throw new Error(`CRITICAL HMRC COMPLIANCE ERROR: Could not determine exchange rate for ${i||"transaction"} on ${n}.\nIssue: ${r.message}\nHMRC requires spot exchange rates (Daily rates) for CGT calculations (CG78310). Ensure your IBKR CSV includes 'FxRateToBase' OR the core Bank of England database contains a rate for this date.`)}}function zi(e){return As.fromJSDate(e,{zone:"UTC"}).setZone("Europe/London").toISODate()||e.toISOString().split("T")[0]}function Hi(e){const t=e.getUTCDay();if(6===t){const t=new Date(e);return t.setUTCDate(e.getUTCDate()-1),{adjustedDate:t,didAdjust:!0}}if(0===t){const t=new Date(e);return t.setUTCDate(e.getUTCDate()-2),{adjustedDate:t,didAdjust:!0}}return{adjustedDate:e,didAdjust:!1}}function Yi(e){const t=e.match(/\b(\d{1,2})([A-Z]{3})(\d{2})\b/);if(t){const[,e,n,s]=t,i={JAN:0,FEB:1,MAR:2,APR:3,MAY:4,JUN:5,JUL:6,AUG:7,SEP:8,OCT:9,NOV:10,DEC:11}[n.toUpperCase()];if(void 0!==i){const t=2e3+parseInt(s,10);return new Date(Date.UTC(t,i,parseInt(e,10)))}}const n=e.match(/(\d{2})(\d{2})(\d{2})([CP])\d{8}/);if(n){const[,e,t,s]=n,i=2e3+parseInt(e,10),r=parseInt(t,10)-1,o=parseInt(s,10);if(r>=0&&r<=11&&o>=1&&o<=31)return new Date(Date.UTC(i,r,o))}return null}const Qi=(e,t)=>e.toLocaleString("en-US",{style:"currency",currency:t});function Zi(e,t){const n=Ji(t);return/^\d{4}-\d{2}-\d{2}$/.test(n)?e.filter(e=>{const t=Ji(e.date);return!/^\d{4}-\d{2}-\d{2}$/.test(t)||t<=n}):e}function Ji(e){return!e||e.length<10?e:e.substring(0,10)}function Xi(e){return`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`}function Ki(e,t,n,s){const{fromDate:i,toDate:r}=s;!function(e,t,n,s){const i=new Map,r=[...e,...t,...n,...s];for(const o of r){const e=o.conid,t=(o.symbol||"").trim().replace(/\s+/g," ");e&&t&&i.set(t,String(e).trim())}for(const o of r){const e=(o.symbol||"").trim().replace(/\s+/g," ");if(o.symbol=e,!o.conid&&e){const t=i.get(e);t&&(o.conid=t)}else o.conid&&(o.conid=String(o.conid).trim())}}(e,n,t,s.openPositions||[]);const o=function(e){const t=new Map,n=new Set;let s=0;const i=new Map;for(const r of e){const e=r,o=r.source?.file||"unknown",a=r.date,l=r.type,c=(r.symbol||"").trim(),d=r.quantity,u=r.price||0,m=(r.currency||"").trim(),h=(e.conid||"").toString().trim(),g=(e.transactionId||"").toString().trim(),f=(e.tradeId||"").toString().trim(),p=`${a}|${l}|${c}|${d.toFixed(4)}|${u.toFixed(6)}|${m}|${h}`;let y;if(g)y=`ID:${g}`;else if(f)y=`TR:${f}`;else{i.has(o)||i.set(o,new Map);const e=i.get(o),t=(e.get(p)||0)+1;e.set(p,t),y=`BASE:${p}|SEQ:${t}`}if(t.has(y)){s++,r.source?.file&&n.add(r.source.file);const e=t.get(y);e.source?.file&&n.add(e.source.file)}else t.set(y,r)}return{items:Array.from(t.values()),duplicatesRemoved:s,overlappingFiles:n}}(e).items,a=function(e){const t=new Map,n=new Set;let s=0;const i=new Map;for(const r of e){const e=r.source?.file||"unknown",o=r.transactionId||r.tradeId||"",a=`${r.date}|${r.transactionType}|${r.symbol}|${r.quantity}|${r.tradePrice}`;let l;if(o)l=`ID:${o}`;else{i.has(e)||i.set(e,new Map);const t=i.get(e),n=(t.get(a)||0)+1;t.set(a,n),l=`COMP:${a}|SEQ:${n}`}if(t.has(l)){s++,r.source?.file&&n.add(r.source.file);const e=t.get(l);e.source?.file&&n.add(e.source.file)}else t.set(l,r)}return{items:Array.from(t.values()),duplicatesRemoved:s,overlappingFiles:n}}(t).items,l=function(e){const t=new Map,n=new Set;let s=0;const i=new Map;for(const r of e){const e=r.source?.file||"unknown",o=`${r.date}|${r.symbol}|${r.quantityChange}|${r.type}|${r.description}`;i.has(e)||i.set(e,new Map);const a=i.get(e),l=(a.get(o)||0)+1;a.set(o,l);const c=`${o}|SEQ:${l}`;t.has(c)?(s++,r.source?.file&&n.add(r.source.file)):t.set(c,r)}return{items:Array.from(t.values()),duplicatesRemoved:s,overlappingFiles:n}}(n).items,c=function(e,t=[]){const n=e.filter(e=>"Stocks"===e.assetCategory),s=e=>e.assetCategory.includes("Option")||e.assetCategory.includes("Future"),i=e=>!!e.isAssignment||!!e.isExercise||e.code&&(e.code.includes("A")||e.code.includes("Ex"))||e.codes&&e.codes.some(e=>"A"===e||"Ex"===e),r=new Map,o=(e,t)=>{const n=((e,t)=>t?`C:${t}`:`S:${e}`)(e,t),s=r.get(n);if(s)return s;const i={trades:[],index:0,openLong:[],openShort:[]};return r.set(n,i),i},a=e.filter(e=>s(e)&&!i(e)).sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime());for(const b of a){const e=b.conid?String(b.conid):void 0;o(b.symbol,e).trades.push(b)}const l=(e,t)=>e?t?new Date(`${e.substring(0,10)}T23:59:59`):e.includes(":")?new Date(e):new Date(`${e}T23:59:59`):new Date(0),c=(e,t)=>{for(;e.index<e.trades.length;){const n=e.trades[e.index];if(new Date(n.date)>t)break;let s=Math.abs(n.quantity);if("BUY"===n.type){for(;s>1e-7&&e.openShort.length>0;){const t=e.openShort[0],n=Math.min(t.remainingContracts,s);t.remainingContracts-=n,s-=n,t.remainingContracts<=1e-7&&e.openShort.shift()}s>1e-7&&e.openLong.push({transaction:n,remainingContracts:s})}else{for(;s>1e-7&&e.openLong.length>0;){const t=e.openLong[0],n=Math.min(t.remainingContracts,s);t.remainingContracts-=n,s-=n,t.remainingContracts<=1e-7&&e.openLong.shift()}s>1e-7&&e.openShort.push({transaction:n,remainingContracts:s})}e.index++}},d=e=>{const t=e.openLong.reduce((e,t)=>e+t.remainingContracts,0),n=e.openShort.reduce((e,t)=>e+t.remainingContracts,0);return{longQty:t,shortQty:n,netQty:t-n}},u=n.map(e=>({transaction:e,originalQty:Math.abs(e.quantity),remainingQty:Math.abs(e.quantity)})),m=new Set,h=e=>(e||"").trim().replace(/[\s.]/g,"").toUpperCase(),g=e=>{const t=(e||"").trim().split(/\s+/)[0]||"";return h(t)},f=e=>e?e.substring(0,10):"",p=(e,t)=>{const n=new Date(f(e)),s=new Date(f(t)).getTime()-n.getTime();return Math.floor(s/864e5)},y=(t,n,r,a,d,f,y,b)=>{const x=b?.multiplier||100,v=Math.abs(a),w=v*x,C=((e,t)=>{const n=(e||"").match(/\s+([0-9]{6})([CP])/);if(n)return"C"===n[2]?"CALL":"PUT";if(t){const e=t.toUpperCase();if(e.includes(" CALL "))return"CALL";if(e.includes(" PUT "))return"PUT";if(e.endsWith(" CALL"))return"CALL";if(e.endsWith(" PUT"))return"PUT"}return"UNKNOWN"})(n,b?.description);let S;"UNKNOWN"!==C&&(d?S="CALL"===C?"SELL":"BUY":f&&(S="CALL"===C?"BUY":"SELL"));const T=u.filter(e=>{if(e.remainingQty<=0)return!1;if(S&&e.transaction.type!==S)return!1;const s=p(t,e.transaction.date);if(s<0||s>7)return!1;const i=h(e.transaction.symbol||""),r=g(n);return!(!i||!r)&&i===r});T.sort((e,s)=>{const i=e.transaction.isAssignment||e.transaction.isExercise||e.transaction.code&&(e.transaction.code.includes("A")||e.transaction.code.includes("Ex"))?1:0,r=s.transaction.isAssignment||s.transaction.isExercise||s.transaction.code&&(s.transaction.code.includes("A")||s.transaction.code.includes("Ex"))?1:0;if(i!==r)return r-i;let o;if(b&&b.tradePrice&&b.transactionType&&["Assignment","Exercise","Delivery"].includes(b.transactionType)&&(o=b.tradePrice),void 0===o){const e=n.match(/[CP](\d{8})$/);e&&(o=parseInt(e[1],10)/1e3)}if(void 0!==o){const t=Math.abs(e.transaction.price),n=Math.abs(s.transaction.price),i=Math.abs(t-o),r=Math.abs(n-o),a=.05;if(Math.abs(i-r)>a)return i-r}return p(t,e.transaction.date)-p(t,s.transaction.date)});const I=g(n),D=["SPX","SPXW","NDX","RUT","VIX","XSP","XND","DJX","OEX","XAU","XAG","ESTX50"].includes(I),E=b&&(Math.abs(b.amount||0)>1e-7||Math.abs(b.proceeds||0)>1e-7),_=D||E;if(D)return void(b&&(b.notes=(b.notes||"")+" [Cash-settled disposal]"));if(0===T.length){if(_)return void(b&&(b.notes=(b.notes||"")+" [Cash-settled disposal]"));throw new Error(`CRITICAL COMPLIANCE ERROR: Option Assignment/Exercise cannot be linked to stock trade (TCGA s.144 violation).\nSymbol: ${n}\nDate: ${t}\nContracts: ${v}\nExpected Stock Quantity: ${w} shares\nIssue: No matching stock trade found within 7-day settlement window (${t} to 7 days after).\n\nPossible causes:\n1. Stock trade is missing from input data (check CSV completeness)\n2. Stock trade is more than 7 days after assignment (unusual settlement delay)\n3. Cash-settled option (no stock delivery) - these should be handled separately (but auto-detection failed)\n4. Symbol mismatch between option and stock (e.g., corporate action)\n\nAction required:\n- Verify stock trade exists in your broker statements\n- If cash-settled, ensure it's marked correctly or recognized by the calculator\n- If settlement was delayed beyond 7 days, contact support\n- If stock trade is under different symbol, add corporate action record\n`)}const R=o(n,r),k=b&&(void 0!==b.amount||void 0!==b.proceeds&&Math.abs(b.proceeds||0)>1e-7),O=l(t,!k);c(R,O);const A=d||y?R.openShort:R.openLong;let M=0,N=0,P=v,$=0;const F=[];for(const e of A){if(P<=0)break;const t=Math.min(e.remainingContracts,P);if(t<=0)continue;const n=e.transaction,s=Math.abs(n.quantity);if(s<=1e-7)continue;const i=n.amount/s,r=n.commission/s;M+=ji(i*t,n.currency,n.date,n.fxRateToBase,`option premium for ${n.symbol}`),N+=ji(r*t,n.currency,n.date,n.fxRateToBase,`option commission for ${n.symbol}`),e.remainingContracts-=t,P-=t,$+=t,F.push({lot:e,contractsUsed:t})}if(A.length>0){const e=A.filter(e=>e.remainingContracts>1e-7);A.length=0,A.push(...e)}if(k){const e=void 0!==b.proceeds?b.proceeds:void 0!==b.amount?b.amount:0,s=void 0!==b.commTax?b.commTax:void 0!==b.commission?b.commission:0,i=b.currency,r=b.fxRateToBase||0;M+=ji(e,i,t,r,`option event premium for ${n}`),N+=ji(s,i,t,r,`option event commission for ${n}`)}const L=[];if(!k)for(const o of e)s(o)&&i(o)&&(m.has(o)||r&&o.conid!==r||(r||o.symbol===n)&&(new Date(o.date)>O||0===o.amount&&0===o.commission||L.push(o)));for(const e of L){const t=e;M+=ji(e.amount,e.currency,e.date,t.fxRateToBase,`option assignment premium for ${e.symbol}`),N+=ji(e.commission,e.currency,e.date,t.fxRateToBase,`option assignment commission for ${e.symbol}`)}if(!($>0||k||L.length>0))return;const B=$>0?$*x:v*x;if(0===B)return;let U=Math.min(w,B);for(const e of T){if(U<=0)break;const n=Math.min(e.remainingQty,U),s=B>0?n/B:0,i=M*s,r=N*s,o=e.transaction;if(o.date.substring(0,10)!==t.substring(0,10)){o.notes=(o.notes||"")+` (Date corrected from ${o.date} to ${t} per TCGA s.144)`;try{const e=Mi(o.currency,t,"DAILY_REQUIRED");o.fxRateToBase=1/e,o.notes+=` [FX Rate updated to ${o.fxRateToBase.toFixed(4)} for assignment date ${t.substring(0,10)}]`}catch(G){throw new Error(`CRITICAL HMRC COMPLIANCE ERROR (CG78310): Cannot retarget stock trade FX rate for option assignment/exercise.\\nSymbol: ${o.symbol}\\nAssignment/Exercise Date: ${t}\\nOriginal Stock Date: ${o.date}\\nIssue: ${G.message}\\n\\nHMRC requires spot exchange rates (daily rates) for CGT calculations (CG78310).\\nWhen an option is assigned/exercised, the stock trade date is retargeted to the assignment date,\\nand the FX rate MUST be updated to the spot rate on that date.\\nYearly averages are NOT acceptable for this calculation.\\n\\nAction required:\\n- Ensure your IBKR CSV includes 'FxRateToBase' for all transactions, OR\\n- Ensure the Bank of England daily rates CSV contains a rate for ${t.substring(0,10)}\\n`)}o.date=t}"GBP"!==o.currency&&(void 0===o.originalAmount&&(o.originalPrice=o.price,o.originalAmount=o.amount,o.originalCurrency=o.currency,o.originalCommission=o.commission),o.price=ji(o.price,o.currency,o.date,o.fxRateToBase,`stock price for ${o.symbol}`),o.amount=ji(o.amount,o.currency,o.date,o.fxRateToBase,`stock amount for ${o.symbol}`),o.commission=ji(o.commission,o.currency,o.date,o.fxRateToBase,`stock commission for ${o.symbol}`),o.currency="GBP"),o.commission+=r,d?"BUY"===o.type?o.amount>0?(o.amount-=i,o.notes=(o.notes||"")+` (Assigned Put: ${n} shares, -£${i.toFixed(2)} Premium)`):(o.amount+=i,o.notes=(o.notes||"")+` (Assigned Put: ${n} shares, +£${i.toFixed(2)} Premium)`):"SELL"===o.type&&(o.amount+=i,o.notes=(o.notes||"")+` (Assigned Call: ${n} shares, +£${i.toFixed(2)} Premium)`):f&&("BUY"===o.type?(o.amount+=i,o.notes=(o.notes||"")+` (Exercised Call: ${n} shares, +£${i.toFixed(2)} Premium)`):"SELL"===o.type&&(o.amount+=i,o.notes=(o.notes||"")+` (Exercised Put: ${n} shares, +£${i.toFixed(2)} Premium)`)),e.remainingQty-=n,U-=n}if(0===T.length&&_)b&&(b.notes=(b.notes||"")+" [Cash-settled disposal]");else{for(const e of F){const t=e.lot.transaction,n=Math.abs(t.quantity);if(n<=1e-7)continue;const s=e.contractsUsed/n;t.amount=t.amount*(1-s),t.commission=t.commission*(1-s),t.quantity=t.quantity*(1-s),$>0&&(t.notes=(t.notes||"")+` [Pro-rata premium (£${(M*(e.contractsUsed/$)).toFixed(2)}) moved to Stock]`)}if(b&&void 0!==b.amount){const e=b;e.amount=0,e.commission=0,e.quantity=0,e.notes=(e.notes||"")+" [Linked to Stock]",m.add(e)}for(const e of L)e.amount=0,e.commission=0,e.quantity=0,e.notes=(e.notes||"")+" [Linked to Stock]",m.add(e)}};if(t.length>0)for(const b of t){if("Expiration"===b.transactionType){const t=b.conid?String(b.conid):void 0,n=o(b.symbol,t),s=l(b.date,!0);c(n,s);const{netQty:i}=d(n),r=Math.abs(b.quantity),a=r>0?r:Math.abs(i);if(a<=1e-7){qs((b.symbol,b.date),b.date);continue}const u=i>0?"SELL":i<0||b.quantity<0?"BUY":"SELL",m={date:b.date,type:u,symbol:b.symbol,quantity:a,price:0,amount:0,commission:0,currency:b.currency,description:b.description||"Option Expiration (Generated from Option Events)",conid:b.conid,multiplier:b.multiplier||100,assetCategory:b.assetCategory,code:"Ep",codes:["Ep"],isExpired:!0,isClose:!0,source:{file:"Preprocessor (OptionEvents)",line:0}};e.some(e=>(e.symbol===m.symbol||e.conid&&e.conid===m.conid)&&e.date.substring(0,10)===m.date.substring(0,10)&&(e.isExpired||e.code&&e.code.includes("Ep")||e.description?.toLowerCase().includes("expir")||e.description?.toLowerCase().includes("worthless")))||e.push(m);continue}const t="Assignment"===b.transactionType,n="Exercise"===b.transactionType,s="Delivery"===b.transactionType;y(b.date,b.symbol,b.conid?String(b.conid):void 0,b.quantity,t,n,s,b)}else{const t=e.filter(e=>(e.assetCategory.includes("Option")||e.assetCategory.includes("Future"))&&(e.isAssignment||e.isExercise||e.code&&(e.code.includes("A")||e.code.includes("Ex"))));for(const e of t){if(m.has(e))continue;const t=e.isAssignment||e.code&&e.code.includes("A"),n=e.isExercise||e.code&&e.code.includes("Ex");y(e.date,e.symbol,e.conid?String(e.conid):void 0,e.quantity,!!t,!!n,!1,e)}}return e}(o,a),d=function(e,t,n,s=[],i={}){const r=[],o=new Map;for(const a of e){if(!a.assetCategory||!a.assetCategory.includes("Option")&&!a.assetCategory.includes("OPT"))continue;const e=a.conid?a.conid.toString():a.symbol;if(!o.has(e)){const t=Yi(a.symbol);if(!t)continue;const n=!1!==i.shiftWeekendExpirationToFriday,{adjustedDate:s,didAdjust:r}=n?Hi(t):{adjustedDate:t,didAdjust:!1};o.set(e,{symbol:a.symbol,conid:a.conid,netQuantity:0,originalExpirationDate:t,adjustedExpirationDate:s,didAdjustExpirationDate:r,latestTransaction:a,currency:a.currency,multiplier:a.multiplier||100,assetCategory:a.assetCategory})}const t=o.get(e),n=Math.abs(a.quantity);"BUY"===a.type?t.netQuantity+=n:t.netQuantity-=n,t.currency=a.currency,t.multiplier=a.multiplier||100,t.assetCategory=a.assetCategory,new Date(a.date)>new Date(t.latestTransaction.date)&&(t.latestTransaction=a)}for(const a of t){const e=a.conid?a.conid.toString():a.symbol;if(o.has(e)){const t=o.get(e);t.netQuantity+=a.quantityChange,new Date(a.date)>new Date(t.latestTransaction.date)&&(t.latestTransaction=a)}}for(const[a,l]of o){if(Math.abs(l.netQuantity)<1e-4)continue;if(!l.adjustedExpirationDate)continue;if(zi(l.adjustedExpirationDate)>n)continue;const e=s.find(e=>{if(!["Expiration","Delivery","Assignment","Exercise"].includes(e.transactionType))return!1;if(Math.abs(new Date(e.date).getTime()-l.adjustedExpirationDate.getTime())>=2592e5)return!1;if(e.conid&&(String(e.conid)===String(a)||e.conid===a))return!0;const t=e=>(e||"").replace(/\s/g,"");return t(e.symbol)===t(l.symbol)});if(e){const t=l.didAdjustExpirationDate?` [Expiry adjusted from ${zi(l.originalExpirationDate)} to ${zi(l.adjustedExpirationDate)} due to OCC convention]`:"";r.push({date:e.date,type:l.netQuantity>0?"SELL":"BUY",symbol:l.symbol,quantity:Math.abs(l.netQuantity),price:0,amount:0,commission:0,currency:l.currency,fxRateToBase:l.latestTransaction.fxRateToBase,description:(e.description||"Option Expiration (Restored from Option Events)")+t,assetCategory:l.assetCategory,conid:l.conid,code:"Ep",multiplier:l.multiplier,isExpired:!0,isClose:!0,isRestored:!0,originalExpirationDate:zi(l.originalExpirationDate),adjustedExpirationDate:zi(l.adjustedExpirationDate),source:{file:"OptionEvents Match",line:e.source.line}})}else{const e=zi(l.adjustedExpirationDate),t=l.didAdjustExpirationDate?` [Expiry adjusted from ${zi(l.originalExpirationDate)} to ${e} due to OCC convention]`:"";r.push({date:e,type:l.netQuantity>0?"SELL":"BUY",symbol:l.symbol,quantity:Math.abs(l.netQuantity),price:0,amount:0,commission:0,currency:l.currency,fxRateToBase:l.latestTransaction.fxRateToBase,description:"Option expired or assigned, but no completion record found in CSV"+t,assetCategory:l.assetCategory,conid:l.conid,code:"Ep",multiplier:l.multiplier,isExpired:!0,isClose:!0,isRestored:!1,originalExpirationDate:zi(l.originalExpirationDate),adjustedExpirationDate:zi(l.adjustedExpirationDate),source:{file:"Synthetic Generator",line:0}})}}return r}(c,l,r||(new Date).toISOString().split("T")[0],a,{shiftWeekendExpirationToFriday:s.shiftWeekendOptionExpiryToFriday});let u=[];s.cashTransactions&&(u=function(e,t,n){const s=[],i=new Set;for(const o of t)if("Forex"===o.assetCategory){let e=o.symbol;e&&e.includes(".")&&(e=e.split(".")[0]);const t=`${o.date.substring(0,10)}|${e}|${Math.abs(o.quantity).toFixed(4)}|${o.type}`;i.add(t)}if(!e)return s;for(const o of e){if(!o.currency||"GBP"===o.currency||Math.abs(o.amount)<1e-6)continue;if("USD"!==o.currency){if(n?.enforceSpotRates)throw new Error(`CRITICAL COMPLIANCE ERROR (CG78310): Cannot synthesize chargeable forex transaction for ${o.currency} on ${o.date}. This calculator only ships daily spot rates for USD/GBP. Cash Transactions do not include FxRateToBase for non-USD currencies, so a compliant spot conversion cannot be derived. Provide explicit broker spot rates for these events (FxRateToBase on Trades/Corporate Actions), or extend the daily-rate dataset to cover ${o.currency}.`);qs((o.currency,o.date),o.date);continue}const e=o.date,t=o.amount>0?"BUY":"SELL",a=Math.abs(o.amount),l=`${e.substring(0,10)}|${o.currency}|${a.toFixed(4)}|${t}`;if(i.has(l))continue;let c;try{c=Mi(o.currency,e,"DAILY_REQUIRED")}catch(r){throw new Error(`CRITICAL COMPLIANCE ERROR: Missing spot exchange rate for Chargeable Forex transaction.\nTransaction: ${o.type} ${o.currency} on ${e}\nIssue: ${r.message}\nHMRC rules (CG78310) require daily spot rates for Forex pooling. Yearly averages are illegal here.`)}if(!c||0===c)throw new Error(`CRITICAL COMPLIANCE ERROR: Exchange rate returned 0 for ${o.currency} on ${e} (Strict Mode).`);const d=a/c;s.push({date:e,type:t,symbol:o.currency,quantity:a,price:1/c,amount:d,currency:"GBP",commission:0,description:`Auto-FX: ${o.type} (${o.description})`,assetCategory:"Forex",source:o.source,notes:`Synthesized from Cash Transaction: ${o.type}`})}return s}(s.cashTransactions,c,{enforceSpotRates:!!s.includeForexInTotals}));const m=[...c];d.length>0&&m.push(...d),u.length>0&&m.push(...u),m.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),function(e){for(const t of e)if("GBP"!==t.currency){const e=t,n=t.currency;void 0===e.originalAmount&&(e.originalPrice=t.price,e.originalAmount=t.amount,e.originalCurrency=n,e.originalCommission=t.commission),void 0!==t.price&&Math.abs(t.price)>1e-7&&(t.price=ji(t.price,n,t.date,e.fxRateToBase,`price for ${t.symbol}`)),void 0!==t.amount&&Math.abs(t.amount)>1e-7&&(t.amount=ji(t.amount,n,t.date,e.fxRateToBase,`amount for ${t.symbol}`)),void 0!==t.commission&&Math.abs(t.commission)>1e-7&&(t.commission=ji(t.commission,n,t.date,e.fxRateToBase,`commission for ${t.symbol}`)),t.currency="GBP"}}(m);let h=m,g=l;if(r){const e=new Date(r);e.setDate(e.getDate()+30);const t=e.toISOString().split("T")[0];h=Zi(m,t),g=Zi(l,t)}const f=new Map,p=(e,t,n,s,i)=>{const r=Ji(t),o=Ni(n,s,t,i,"DAILY_REQUIRED");f.has(e)||f.set(e,new Map),f.get(e)?.set(r,o)};if(s.openPositions)for(const S of s.openPositions)S.markPrice&&p(S.symbol,S.date,S.markPrice,S.currency);for(const S of e)if(S.price){const e=S.type;"DEP"!==e&&"WITHDRAW"!==e&&p(S.symbol,S.date,S.price,S.currency,S.fxRateToBase)}const y={getPrice:(e,t,n)=>{const s=Ji(t),i=f.get(e);if(i){if(i.has(s))return{price:i.get(s),date:s};if(n?.strict)return;const e=e=>{const[t,n,s]=e.split("-").map(Number);return Date.UTC(t,n-1,s)},t=e(s),r=864e5,o=14;let a,l;for(const[n,s]of i.entries()){const i=e(n),c=i-t;c>=0&&c<=o*r&&(void 0===l||i<e(l))&&(a=s,l=n)}if(void 0!==a&&void 0!==l)return{price:a,date:l}}}},b=Ci(h,g,y),x=b.disposalResults;let v=b.openPositions;if(r){const e=Zi(m,r),t=Zi(l,r);(e.length!==h.length||t.length!==g.length)&&(v=Ci(e,t,y).openPositions)}let w=x;if(i||r){const e=i?Ji(i):"1900-01-01",t=r?Ji(r):"9999-12-31";w=x.filter(n=>{const s=Ji(n.date);return s>=e&&s<=t})}const C=[];if(r){let e;o.length>0&&(e=o.reduce((e,t)=>t.date>e?t.date:e,o[0].date));const t=function(e,t){if(!e||!t)return null;const n=As.fromISO(t),s=As.fromISO(e);if(!n.isValid||!s.isValid)return null;const i=n.plus({days:30});return s<i?`[Compliance: Data Coverage Risk] Your provided data ends on ${e}, which is less than 30 days after the report end date (${t}). The calculator cannot check for "Bed and Breakfast" repurchases (30-day matching rule) occurring after ${e}. Ensure no repurchases occurred between ${e} and ${i.toISODate()} to prevent incorrect tax calculations.`:null}(e?Ji(e):void 0,r);t&&C.push(t)}return{disposalResults:w,openPositions:v,transactionsForCalculator:h,warnings:C}}function er(e,t,n,s,i,r,o,a=!1){const l=[],c=e.reduce((e,t)=>{if((e=>"forex"===(e.assetCategory||"").toLowerCase()&&!(!e.notes||!e.notes.includes("Synthesized from")))(t))return e;const n=t.assetCategory||"Unknown",s=t.gain>=0?"Gain":"Loss",i=`${n}|${s}`;return e[i]=e[i]||{category:n,type:s,count:0,proceeds:0,cost:0,gain:0},e[i].count++,e[i].proceeds+=t.proceeds,e[i].cost+=t.allowableCost,e[i].gain+=t.gain,e},{}),d=[],u=Object.keys(c).sort();for(const x of u){const e=c[x],t="Gain"===e.type?" (Gains)":" (Losses)";d.push({Section:"CGT",Category:e.category+t,Description:`${e.count} Trades`,"Gross / Proceeds (GBP)":e.proceeds.toFixed(2),"Cost / Expense (GBP)":e.cost.toFixed(2),"Net Gain / Income (GBP)":e.gain.toFixed(2),Notes:""})}const m=Object.keys(c).some(e=>e.startsWith("Forex|"));let h=0,g=0,f=0;if(t&&t.length>0){const e=function(e,t,n){let s=0,i=0;const r=t?Xi(t):null,o=n?Xi(n):null;return e.forEach(e=>{const t=e.date.substring(0,10);if(r&&t<r)return;if(o&&t>o)return;const n=e.description?.toLowerCase()||"";if(n.includes("total")||n.includes("summary")||n.includes("forex (bank accounts/incidental)")||n.includes("bank accounts/incidental"))return;const a=e.realizedPnL;a>0?s+=a:i+=Math.abs(a)}),{totalGain:s,totalLoss:i,netResult:s-i}}(t,r,o);h=e.totalGain,g=e.totalLoss,f=e.netResult}if(0!==h||0!==g){const e=m?"Forex (Bank Accounts/Incidental)":"Forex (Exempt for Individuals)",t=m?"Incidental fluctuations on personal bank accounts/trades. Informational only.":"Usually non-chargeable under TCGA 1992 s.252. Included for transparency.";d.push({Section:"CGT",Category:e,Description:"Realized FX (IBKR Source)","Gross / Proceeds (GBP)":h.toFixed(2),"Cost / Expense (GBP)":g.toFixed(2),"Net Gain / Income (GBP)":f.toFixed(2),Notes:t})}const p=["Stocks","Equity and Index Options","Forex"];d.sort((e,t)=>{const n=e.Category.replace(" (Gains)","").replace(" (Losses)",""),s=t.Category.replace(" (Gains)","").replace(" (Losses)",""),i=p.indexOf(n),r=p.indexOf(s);return-1!==i&&-1!==r?i===r?e.Category.localeCompare(t.Category):i-r:-1!==i?-1:-1!==r?1:e.Category.localeCompare(t.Category)}),l.push(...d);const y=function(e,t,n){const s=t?Xi(t):null,i=n?Xi(n):null,r=e.filter(e=>{const t=e.date.substring(0,10);return!(s&&t<s||i&&t>i)});let o=0,a=0;const l=[];return r.forEach(e=>{let t=e.amount,n=!1;if("GBP"!==e.currency){const s=Mi(e.currency,e.date,"YEARLY_PREFERRED");t=e.amount/s,n=!0}t>=0?o+=t:a+=Math.abs(t),l.push({...e,amountGBP:t,isConverted:n})}),{summaries:l,totalIncome:o,totalExpense:a,netResult:o-a}}(n,r,o);if(y.summaries.length>0){const e=y.summaries.reduce((e,t)=>{const n=t.currency||"Unknown";return e[n]=e[n]||{income:0,expense:0,incomeOriginal:0,expenseOriginal:0},t.amountGBP>=0?(e[n].income+=t.amountGBP,e[n].incomeOriginal+=t.amount):(e[n].expense+=Math.abs(t.amountGBP),e[n].expenseOriginal+=Math.abs(t.amount)),e},{}),t=Object.keys(e).sort();for(const n of t){const t=e[n],s="GBP"!==n,i=`Interest (${n})`;let r=s?"Foreign Interest":"UK Interest";if(t.income>0){let e="Gross Interest Received";if(s&&t.incomeOriginal>0){e+=` (${n} ${a?Qi(t.incomeOriginal,n):t.incomeOriginal.toFixed(2)})`;r+=` @ ${(t.incomeOriginal/t.income).toFixed(4)} ${n}/GBP`}l.push({Section:"INCOME",Category:i,Description:e,"Gross / Proceeds (GBP)":t.income.toFixed(2),"Cost / Expense (GBP)":"0.00","Net Gain / Income (GBP)":t.income.toFixed(2),Notes:r})}if(t.expense>0){let e="Margin Interest Paid";if(s&&t.expenseOriginal>0){e+=` (${n} ${a?Qi(t.expenseOriginal,n):t.expenseOriginal.toFixed(2)})`}l.push({Section:"INCOME",Category:`${i} Expense`,Description:e,"Gross / Proceeds (GBP)":"0.00","Cost / Expense (GBP)":t.expense.toFixed(2),"Net Gain / Income (GBP)":(-t.expense).toFixed(2),Notes:"Non-Deductible usually"})}}}const b=function(e,t,n,s){const i=e=>{const t=n?Xi(n):null,i=s?Xi(s):null;return e.filter(e=>{const n=e.date.substring(0,10);return!(t&&n<t||i&&n>i)})},r=i(e),o=i(t);let a=0,l=0;const c=r.map(e=>{let t=e.amount,n=!1;if("GBP"!==e.currency){const s=Mi(e.currency,e.date,"YEARLY_PREFERRED");t=e.amount/s,n=!0}return"PAYMENT_IN_LIEU"===e.type?(t>=0?a+=t:l+=Math.abs(t),{...e,amountGBP:t,isConverted:n}):t>=0?(a+=t,{...e,type:e.type||"DIVIDEND_INCOME",amountGBP:t,isConverted:n}):(l+=Math.abs(t),{...e,type:e.type||"PAYMENT_IN_LIEU",amountGBP:t,isConverted:n})});let d=0;const u=o.map(e=>{let t=e.amount,n=!1;if("GBP"!==e.currency){const s=Mi(e.currency,e.date,"YEARLY_PREFERRED");t=e.amount/s,n=!0}return d+=Math.abs(t),{...e,type:"WITHHOLDING_TAX",amountGBP:t,isConverted:n}});return{summaries:[...c,...u].sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),dividendSummaries:c,taxSummaries:u,totalGross:a,totalExpense:l,totalTax:d,netResult:a-l-d}}(s,i,r,o);if(b.summaries.length>0){const e=b.dividendSummaries.reduce((e,t)=>{const n=t.currency||"Unknown";e[n]=e[n]||{gross:0,grossOriginal:0,expense:0,expenseOriginal:0,pid:0,pidOriginal:0,pilIncome:0,pilIncomeOriginal:0,pilExpense:0,pilExpenseOriginal:0};const s=t.amountGBP||0;return"DIVIDEND_INCOME"===t.type?(e[n].gross+=s,e[n].grossOriginal+=t.amount):"PROPERTY_INCOME_DIVIDEND"===t.type?(e[n].pid+=s,e[n].pidOriginal+=t.amount):"PAYMENT_IN_LIEU"===t.type&&(s>=0?(e[n].pilIncome+=s,e[n].pilIncomeOriginal+=t.amount):(e[n].pilExpense+=Math.abs(s),e[n].pilExpenseOriginal+=Math.abs(t.amount))),e},{}),t=Object.keys(e).sort();for(const i of t){const t=e[i],n="GBP"!==i,s=`Dividends (${i})`;if(t.gross>0){let e="Gross Dividends",r="";if(n&&t.grossOriginal>0){e+=` (${i} ${a?Qi(t.grossOriginal,i):t.grossOriginal.toFixed(2)})`;r=`Foreign Income @ ${(t.grossOriginal/t.gross).toFixed(4)} ${i}/GBP`}l.push({Section:"INCOME",Category:s,Description:e,"Gross / Proceeds (GBP)":t.gross.toFixed(2),"Cost / Expense (GBP)":"0.00","Net Gain / Income (GBP)":t.gross.toFixed(2),Notes:r})}if(t.pilIncome>0){let e="Payments in Lieu (PIL) Income";if(n&&t.pilIncomeOriginal>0){e+=` (${i} ${a?Qi(t.pilIncomeOriginal,i):t.pilIncomeOriginal.toFixed(2)})`}l.push({Section:"INCOME",Category:s,Description:e,"Gross / Proceeds (GBP)":t.pilIncome.toFixed(2),"Cost / Expense (GBP)":"0.00","Net Gain / Income (GBP)":t.pilIncome.toFixed(2),Notes:"Taxable Income (Stock Lending/Manufactured)"})}if(t.pilExpense>0){let e="Payments in Lieu (PIL) Expense";if(n&&t.pilExpenseOriginal>0){e+=` (${i} ${a?Qi(t.pilExpenseOriginal,i):t.pilExpenseOriginal.toFixed(2)})`}l.push({Section:"INCOME",Category:s,Description:e,"Gross / Proceeds (GBP)":"0.00","Cost / Expense (GBP)":t.pilExpense.toFixed(2),"Net Gain / Income (GBP)":(-t.pilExpense).toFixed(2),Notes:"Expense"})}if(t.pid>0){const e=`Property Income Dividends (${i})`;let s="Gross PIDs",r="Property Income Dividends";if(n&&t.pidOriginal>0){s+=` (${i} ${a?Qi(t.pidOriginal,i):t.pidOriginal.toFixed(2)})`;r+=` @ ${(t.pidOriginal/t.pid).toFixed(4)} ${i}/GBP`}l.push({Section:"INCOME",Category:e,Description:s,"Gross / Proceeds (GBP)":t.pid.toFixed(2),"Cost / Expense (GBP)":"0.00","Net Gain / Income (GBP)":t.pid.toFixed(2),Notes:r})}}const n=b.taxSummaries.reduce((e,t)=>{const n=t.currency||"Unknown";e[n]=e[n]||{tax:0,taxOriginal:0};const s=t.amountGBP||0;return e[n].tax+=Math.abs(s),e[n].taxOriginal+=Math.abs(t.amount),e},{}),s=Object.keys(n).sort();for(const i of s){const e=n[i],t="GBP"!==i,s=`Dividends (${i})`;if(e.tax>0){let n="Withholding Tax",r="Foreign Tax Credit Relief";if(t&&e.taxOriginal>0){n+=` (${i} ${a?Qi(e.taxOriginal,i):e.taxOriginal.toFixed(2)})`;r+=` @ ${(e.taxOriginal/e.tax).toFixed(4)} ${i}/GBP`}l.push({Section:"INCOME",Category:s,Description:n,"Gross / Proceeds (GBP)":"0.00","Cost / Expense (GBP)":e.tax.toFixed(2),"Net Gain / Income (GBP)":(-e.tax).toFixed(2),Notes:r})}}}return l}const tr={"2026-01-15":1.3387,"2026-01-14":1.3457,"2026-01-13":1.3442,"2026-01-12":1.3475,"2026-01-09":1.3419,"2026-01-08":1.3442,"2026-01-07":1.3481,"2026-01-06":1.3507,"2026-01-05":1.3503,"2026-01-02":1.3497,"2025-12-31":1.3451,"2025-12-30":1.3473,"2025-12-29":1.35,"2025-12-24":1.3507,"2025-12-23":1.3484,"2025-12-22":1.3454,"2025-12-19":1.3362,"2025-12-18":1.3395,"2025-12-17":1.34,"2025-12-16":1.3417,"2025-12-15":1.3394,"2025-12-12":1.3355,"2025-12-11":1.3435,"2025-12-10":1.3321,"2025-12-09":1.3297,"2025-12-08":1.3312,"2025-12-05":1.3343,"2025-12-04":1.3373,"2025-12-03":1.3331,"2025-12-02":1.3201,"2025-12-01":1.3252,"2025-11-28":1.3252,"2025-11-27":1.3252,"2025-11-26":1.3226,"2025-11-25":1.3177,"2025-11-24":1.3098,"2025-11-21":1.3085,"2025-11-20":1.3096,"2025-11-19":1.308,"2025-11-18":1.3144,"2025-11-17":1.3177,"2025-11-14":1.314,"2025-11-13":1.3199,"2025-11-12":1.313,"2025-11-11":1.3173,"2025-11-10":1.3148,"2025-11-07":1.3152,"2025-11-06":1.3102,"2025-11-05":1.3042,"2025-11-04":1.3046,"2025-11-03":1.3146,"2025-10-31":1.3139,"2025-10-30":1.3147,"2025-10-29":1.3241,"2025-10-28":1.3278,"2025-10-27":1.3329,"2025-10-24":1.3301,"2025-10-23":1.3322,"2025-10-22":1.3355,"2025-10-21":1.3373,"2025-10-20":1.3416,"2025-10-17":1.3392,"2025-10-16":1.3434,"2025-10-15":1.3365,"2025-10-14":1.3297,"2025-10-13":1.3327,"2025-10-10":1.3302,"2025-10-09":1.3333,"2025-10-08":1.3421,"2025-10-07":1.3431,"2025-10-06":1.348,"2025-10-03":1.3472,"2025-10-02":1.3421,"2025-10-01":1.3507,"2025-09-30":1.3462,"2025-09-29":1.3419,"2025-09-26":1.3402,"2025-09-25":1.3348,"2025-09-24":1.3451,"2025-09-23":1.3525,"2025-09-22":1.3495,"2025-09-19":1.3483,"2025-09-18":1.3552,"2025-09-17":1.3659,"2025-09-16":1.3657,"2025-09-15":1.359,"2025-09-12":1.3559,"2025-09-11":1.3557,"2025-09-10":1.3551,"2025-09-09":1.354,"2025-09-08":1.3535,"2025-09-05":1.352,"2025-09-04":1.3427,"2025-09-03":1.3434,"2025-09-02":1.3397,"2025-09-01":1.3548,"2025-08-29":1.3509,"2025-08-28":1.3511,"2025-08-27":1.346,"2025-08-26":1.3479,"2025-08-22":1.3525,"2025-08-21":1.3427,"2025-08-20":1.3472,"2025-08-19":1.3503,"2025-08-18":1.3516,"2025-08-15":1.356,"2025-08-14":1.3556,"2025-08-13":1.3572,"2025-08-12":1.3489,"2025-08-11":1.3408,"2025-08-08":1.3439,"2025-08-07":1.3404,"2025-08-06":1.3331,"2025-08-05":1.329,"2025-08-04":1.3294,"2025-08-01":1.3263,"2025-07-31":1.3232,"2025-07-30":1.3291,"2025-07-29":1.3328,"2025-07-28":1.3412,"2025-07-25":1.343,"2025-07-24":1.3542,"2025-07-23":1.356,"2025-07-22":1.3501,"2025-07-21":1.3493,"2025-07-18":1.3442,"2025-07-17":1.341,"2025-07-16":1.3392,"2025-07-15":1.3397,"2025-07-14":1.3447,"2025-07-11":1.3505,"2025-07-10":1.3555,"2025-07-09":1.3588,"2025-07-08":1.3545,"2025-07-07":1.3636,"2025-07-04":1.3643,"2025-07-03":1.3646,"2025-07-02":1.3594,"2025-07-01":1.3718,"2025-06-30":1.3703,"2025-06-27":1.3715,"2025-06-26":1.3733,"2025-06-25":1.3624,"2025-06-24":1.3623,"2025-06-23":1.3489,"2025-06-20":1.3465,"2025-06-19":1.3427,"2025-06-18":1.3452,"2025-06-17":1.3512,"2025-06-16":1.3596,"2025-06-13":1.3576,"2025-06-12":1.3595,"2025-06-11":1.3538,"2025-06-10":1.3515,"2025-06-09":1.3545,"2025-06-06":1.3527,"2025-06-05":1.3591,"2025-06-04":1.3577,"2025-06-03":1.3529,"2025-06-02":1.3553,"2025-05-30":1.3482,"2025-05-29":1.3483,"2025-05-28":1.3471,"2025-05-27":1.3521,"2025-05-23":1.3496,"2025-05-22":1.3424,"2025-05-21":1.3437,"2025-05-20":1.3369,"2025-05-19":1.3367,"2025-05-16":1.3265,"2025-05-15":1.3279,"2025-05-14":1.3305,"2025-05-13":1.326,"2025-05-12":1.3202,"2025-05-09":1.3305,"2025-05-08":1.331,"2025-05-07":1.3366,"2025-05-06":1.3372,"2025-05-02":1.3321,"2025-05-01":1.3296,"2025-04-30":1.3356,"2025-04-29":1.3389,"2025-04-28":1.3393,"2025-04-25":1.3309,"2025-04-24":1.3315,"2025-04-23":1.3275,"2025-04-22":1.3379,"2025-04-17":1.3233,"2025-04-16":1.3257,"2025-04-15":1.3245,"2025-04-14":1.3187,"2025-04-11":1.3059,"2025-04-10":1.296,"2025-04-09":1.2757,"2025-04-08":1.2757,"2025-04-07":1.2755,"2025-04-04":1.294,"2025-04-03":1.3168,"2025-04-02":1.2966,"2025-04-01":1.2923,"2025-03-31":1.291,"2025-03-28":1.2941,"2025-03-27":1.2963,"2025-03-26":1.2887,"2025-03-25":1.2948,"2025-03-24":1.2911,"2025-03-21":1.2893,"2025-03-20":1.2972,"2025-03-19":1.2967,"2025-03-18":1.2985,"2025-03-17":1.2985,"2025-03-14":1.2915,"2025-03-13":1.2943,"2025-03-12":1.2968,"2025-03-11":1.2946,"2025-03-10":1.2904,"2025-03-07":1.2924,"2025-03-06":1.2891,"2025-03-05":1.2868,"2025-03-04":1.2716,"2025-03-03":1.2699,"2025-02-28":1.2592,"2025-02-27":1.2628,"2025-02-26":1.2695,"2025-02-25":1.2655,"2025-02-24":1.2621,"2025-02-21":1.2638,"2025-02-20":1.2641,"2025-02-19":1.259,"2025-02-18":1.2615,"2025-02-17":1.2607,"2025-02-14":1.2618,"2025-02-13":1.2523,"2025-02-12":1.2434,"2025-02-11":1.2406,"2025-02-10":1.239,"2025-02-07":1.2424,"2025-02-06":1.2414,"2025-02-05":1.2518,"2025-02-04":1.2477,"2025-02-03":1.2412,"2025-01-31":1.2426,"2025-01-30":1.2467,"2025-01-29":1.2434,"2025-01-28":1.2432,"2025-01-27":1.2473,"2025-01-24":1.2484,"2025-01-23":1.2324,"2025-01-22":1.2318,"2025-01-21":1.2299,"2025-01-20":1.2293,"2025-01-17":1.2198,"2025-01-16":1.2235,"2025-01-15":1.2258,"2025-01-14":1.2201,"2025-01-13":1.2152,"2025-01-10":1.223,"2025-01-09":1.2303,"2025-01-08":1.2342,"2025-01-07":1.2498,"2025-01-06":1.2508,"2025-01-03":1.2404,"2025-01-02":1.2375,"2024-12-31":1.2529,"2024-12-30":1.2511,"2024-12-27":1.2577,"2024-12-24":1.2539,"2024-12-23":1.2519,"2024-12-20":1.2541,"2024-12-19":1.2551,"2024-12-18":1.2693,"2024-12-17":1.2711,"2024-12-16":1.2691,"2024-12-13":1.2614,"2024-12-12":1.269,"2024-12-11":1.2744,"2024-12-10":1.2738,"2024-12-09":1.2796,"2024-12-06":1.2743,"2024-12-05":1.2757,"2024-12-04":1.2708,"2024-12-03":1.2662,"2024-12-02":1.2629,"2024-11-29":1.2708,"2024-11-28":1.2682,"2024-11-27":1.2677,"2024-11-26":1.2563,"2024-11-25":1.2551,"2024-11-22":1.2527,"2024-11-21":1.2618,"2024-11-20":1.2653,"2024-11-19":1.2665,"2024-11-18":1.264,"2024-11-15":1.2629,"2024-11-14":1.2708,"2024-11-13":1.2724,"2024-11-12":1.2764,"2024-11-11":1.287,"2024-11-08":1.2939,"2024-11-07":1.2996,"2024-11-06":1.289,"2024-11-05":1.3002,"2024-11-04":1.2981,"2024-11-01":1.296,"2024-10-31":1.2856,"2024-10-30":1.3012,"2024-10-29":1.3005,"2024-10-28":1.2981,"2024-10-25":1.2991,"2024-10-24":1.2961,"2024-10-23":1.2948,"2024-10-22":1.2975,"2024-10-21":1.3002,"2024-10-18":1.3036,"2024-10-17":1.2997,"2024-10-16":1.3009,"2024-10-15":1.3094,"2024-10-14":1.3057,"2024-10-11":1.3075,"2024-10-10":1.3049,"2024-10-09":1.3072,"2024-10-08":1.3093,"2024-10-07":1.3079,"2024-10-04":1.3113,"2024-10-03":1.3108,"2024-10-02":1.3251,"2024-10-01":1.3289,"2024-09-30":1.3413,"2024-09-27":1.3408,"2024-09-26":1.3396,"2024-09-25":1.3375,"2024-09-24":1.339,"2024-09-23":1.335,"2024-09-20":1.3281,"2024-09-19":1.325,"2024-09-18":1.3212,"2024-09-17":1.3188,"2024-09-16":1.32,"2024-09-13":1.3155,"2024-09-12":1.3079,"2024-09-11":1.3015,"2024-09-10":1.3057,"2024-09-09":1.3079,"2024-09-06":1.316,"2024-09-05":1.3158,"2024-09-04":1.3161,"2024-09-03":1.3095,"2024-09-02":1.3152,"2024-08-30":1.3144,"2024-08-29":1.3155,"2024-08-28":1.3213,"2024-08-27":1.3235,"2024-08-23":1.3189,"2024-08-22":1.3103,"2024-08-21":1.3061,"2024-08-20":1.3031,"2024-08-19":1.2986,"2024-08-16":1.289,"2024-08-15":1.2853,"2024-08-14":1.2856,"2024-08-13":1.2824,"2024-08-12":1.2785,"2024-08-09":1.2764,"2024-08-08":1.2715,"2024-08-07":1.2721,"2024-08-06":1.2706,"2024-08-05":1.2759,"2024-08-02":1.2807,"2024-08-01":1.2793,"2024-07-31":1.2844,"2024-07-30":1.2828,"2024-07-29":1.2847,"2024-07-26":1.2853,"2024-07-25":1.2877,"2024-07-24":1.2918,"2024-07-23":1.2908,"2024-07-22":1.2913,"2024-07-19":1.2917,"2024-07-18":1.2978,"2024-07-17":1.3014,"2024-07-16":1.2948,"2024-07-15":1.2984,"2024-07-12":1.2989,"2024-07-11":1.2924,"2024-07-10":1.283,"2024-07-09":1.2797,"2024-07-08":1.2833,"2024-07-05":1.2798,"2024-07-04":1.2762,"2024-07-03":1.2762,"2024-07-02":1.2676,"2024-07-01":1.2647,"2024-06-28":1.2642,"2024-06-27":1.2651,"2024-06-26":1.2623,"2024-06-25":1.2672,"2024-06-24":1.2688,"2024-06-21":1.2626,"2024-06-20":1.2686,"2024-06-19":1.2732,"2024-06-18":1.269,"2024-06-17":1.268,"2024-06-14":1.2667,"2024-06-13":1.2767,"2024-06-12":1.2843,"2024-06-11":1.2712,"2024-06-10":1.2717,"2024-06-07":1.2724,"2024-06-06":1.2773,"2024-06-05":1.276,"2024-06-04":1.278,"2024-06-03":1.2772,"2024-05-31":1.2731,"2024-05-30":1.2739,"2024-05-29":1.2715,"2024-05-28":1.2777,"2024-05-24":1.2738,"2024-05-23":1.2712,"2024-05-22":1.2724,"2024-05-21":1.2723,"2024-05-20":1.2708,"2024-05-17":1.2698,"2024-05-16":1.2668,"2024-05-15":1.2649,"2024-05-14":1.2589,"2024-05-13":1.2563,"2024-05-10":1.2508,"2024-05-09":1.2512,"2024-05-08":1.2493,"2024-05-07":1.2554,"2024-05-03":1.2546,"2024-05-02":1.2485,"2024-05-01":1.2492,"2024-04-30":1.252,"2024-04-29":1.2548,"2024-04-26":1.2462,"2024-04-25":1.2489,"2024-04-24":1.2433,"2024-04-23":1.2433,"2024-04-22":1.2331,"2024-04-19":1.2434,"2024-04-18":1.2444,"2024-04-17":1.245,"2024-04-16":1.2442,"2024-04-15":1.2451,"2024-04-12":1.2435,"2024-04-11":1.252,"2024-04-10":1.2566,"2024-04-09":1.2675,"2024-04-08":1.2647,"2024-04-05":1.2615,"2024-04-04":1.2668,"2024-04-03":1.2619,"2024-04-02":1.2567,"2024-03-28":1.2632,"2024-03-27":1.2629,"2024-03-26":1.2628,"2024-03-25":1.2645,"2024-03-22":1.2601,"2024-03-21":1.2668,"2024-03-20":1.2711,"2024-03-19":1.2711,"2024-03-18":1.2733,"2024-03-15":1.274,"2024-03-14":1.2747,"2024-03-13":1.2797,"2024-03-12":1.2784,"2024-03-11":1.2805,"2024-03-08":1.2881,"2024-03-07":1.2789,"2024-03-06":1.2743,"2024-03-05":1.2732,"2024-03-04":1.2698,"2024-03-01":1.2652,"2024-02-29":1.265,"2024-02-28":1.2653,"2024-02-27":1.2683,"2024-02-26":1.2684,"2024-02-23":1.2677,"2024-02-22":1.2621,"2024-02-21":1.2612,"2024-02-20":1.2662,"2024-02-19":1.2587,"2024-02-16":1.2584,"2024-02-15":1.2585,"2024-02-14":1.2549,"2024-02-13":1.2601,"2024-02-12":1.2615,"2024-02-09":1.2632,"2024-02-08":1.2605,"2024-02-07":1.2632,"2024-02-06":1.2577,"2024-02-05":1.2521,"2024-02-02":1.2657,"2024-02-01":1.2682,"2024-01-31":1.2733,"2024-01-30":1.2666,"2024-01-29":1.2678,"2024-01-26":1.2723,"2024-01-25":1.27,"2024-01-24":1.2753,"2024-01-23":1.2666,"2024-01-22":1.2721,"2024-01-19":1.268,"2024-01-18":1.2672,"2024-01-17":1.2658,"2024-01-16":1.2665,"2024-01-15":1.2731,"2024-01-12":1.2761,"2024-01-11":1.2714,"2024-01-10":1.2736,"2024-01-09":1.2704,"2024-01-08":1.275,"2024-01-05":1.2752,"2024-01-04":1.2699,"2024-01-03":1.2628,"2024-01-02":1.2625,"2023-12-29":1.2747,"2023-12-28":1.277,"2023-12-27":1.2789,"2023-12-22":1.2716,"2023-12-21":1.2656,"2023-12-20":1.2668,"2023-12-19":1.2739,"2023-12-18":1.2645,"2023-12-15":1.2699,"2023-12-14":1.276,"2023-12-13":1.2526,"2023-12-12":1.2561,"2023-12-11":1.2551,"2023-12-08":1.2547,"2023-12-07":1.2574,"2023-12-06":1.2593,"2023-12-05":1.2613,"2023-12-04":1.2612,"2023-12-01":1.2635,"2023-11-30":1.2656,"2023-11-29":1.2697,"2023-11-28":1.2683,"2023-11-27":1.2607,"2023-11-24":1.2608,"2023-11-23":1.2531,"2023-11-22":1.246,"2023-11-21":1.2533,"2023-11-20":1.2493,"2023-11-17":1.2433,"2023-11-16":1.2444,"2023-11-15":1.2444,"2023-11-14":1.2455,"2023-11-13":1.2253,"2023-11-10":1.2198,"2023-11-09":1.2287,"2023-11-08":1.2296,"2023-11-07":1.2305,"2023-11-06":1.2397,"2023-11-03":1.2373,"2023-11-02":1.2173,"2023-11-01":1.2126,"2023-10-31":1.2134,"2023-10-30":1.2156,"2023-10-27":1.2141,"2023-10-26":1.2121,"2023-10-25":1.2144,"2023-10-24":1.2178,"2023-10-23":1.2208,"2023-10-20":1.215,"2023-10-19":1.2143,"2023-10-18":1.2146,"2023-10-17":1.2182,"2023-10-16":1.2189,"2023-10-13":1.2141,"2023-10-12":1.2214,"2023-10-11":1.2312,"2023-10-10":1.2257,"2023-10-09":1.221,"2023-10-06":1.2188,"2023-10-05":1.216,"2023-10-04":1.2115,"2023-10-03":1.208,"2023-10-02":1.2122,"2023-09-29":1.2207,"2023-09-28":1.2198,"2023-09-27":1.213,"2023-09-26":1.2168,"2023-09-25":1.2198,"2023-09-22":1.2265,"2023-09-21":1.2288,"2023-09-20":1.2398,"2023-09-19":1.2402,"2023-09-18":1.238,"2023-09-15":1.2395,"2023-09-14":1.2415,"2023-09-13":1.249,"2023-09-12":1.2466,"2023-09-11":1.2529,"2023-09-08":1.2485,"2023-09-07":1.2476,"2023-09-06":1.2491,"2023-09-05":1.2554,"2023-09-04":1.2618,"2023-09-01":1.2619,"2023-08-31":1.2673,"2023-08-30":1.2727,"2023-08-29":1.2589,"2023-08-25":1.2554,"2023-08-24":1.2648,"2023-08-23":1.2683,"2023-08-22":1.2732,"2023-08-21":1.2727,"2023-08-18":1.2716,"2023-08-17":1.2757,"2023-08-16":1.2753,"2023-08-15":1.2745,"2023-08-14":1.2661,"2023-08-11":1.2713,"2023-08-10":1.2735,"2023-08-09":1.2732,"2023-08-08":1.2722,"2023-08-07":1.2772,"2023-08-04":1.2757,"2023-08-03":1.2697,"2023-08-02":1.2689,"2023-08-01":1.2762,"2023-07-31":1.2863,"2023-07-28":1.2864,"2023-07-27":1.2849,"2023-07-26":1.2923,"2023-07-25":1.2856,"2023-07-24":1.2817,"2023-07-21":1.2845,"2023-07-20":1.2851,"2023-07-19":1.2885,"2023-07-18":1.3081,"2023-07-17":1.3082,"2023-07-14":1.3116,"2023-07-13":1.3114,"2023-07-12":1.2997,"2023-07-11":1.2897,"2023-07-10":1.2815,"2023-07-07":1.2825,"2023-07-06":1.2696,"2023-07-05":1.2716,"2023-07-04":1.2726,"2023-07-03":1.2689,"2023-06-30":1.2714,"2023-06-29":1.2618,"2023-06-28":1.2614,"2023-06-27":1.2746,"2023-06-26":1.2709,"2023-06-23":1.2711,"2023-06-22":1.2738,"2023-06-21":1.2731,"2023-06-20":1.2735,"2023-06-19":1.2796,"2023-06-16":1.2812,"2023-06-15":1.2743,"2023-06-14":1.2696,"2023-06-13":1.2604,"2023-06-12":1.251,"2023-06-09":1.258,"2023-06-08":1.2535,"2023-06-07":1.2462,"2023-06-06":1.2408,"2023-06-05":1.241,"2023-06-02":1.2485,"2023-06-01":1.2524,"2023-05-31":1.2394,"2023-05-30":1.2411,"2023-05-26":1.2332,"2023-05-25":1.2357,"2023-05-24":1.2367,"2023-05-23":1.242,"2023-05-22":1.2423,"2023-05-19":1.2436,"2023-05-18":1.2409,"2023-05-17":1.2466,"2023-05-16":1.2494,"2023-05-15":1.251,"2023-05-12":1.2477,"2023-05-11":1.2523,"2023-05-10":1.2618,"2023-05-09":1.2612,"2023-05-05":1.2627,"2023-05-04":1.2572,"2023-05-03":1.2533,"2023-05-02":1.2472,"2023-04-28":1.2566,"2023-04-27":1.2494,"2023-04-26":1.2472,"2023-04-25":1.2402,"2023-04-24":1.2456,"2023-04-21":1.2398,"2023-04-20":1.2458,"2023-04-19":1.245,"2023-04-18":1.2428,"2023-04-17":1.2365,"2023-04-14":1.2444,"2023-04-13":1.251,"2023-04-12":1.2466,"2023-04-11":1.2431,"2023-04-06":1.2434,"2023-04-05":1.245,"2023-04-04":1.2516,"2023-04-03":1.2397,"2023-03-31":1.2364,"2023-03-30":1.238,"2023-03-29":1.2311,"2023-03-28":1.2327,"2023-03-27":1.2274,"2023-03-24":1.2224,"2023-03-23":1.2316,"2023-03-22":1.2232,"2023-03-21":1.2196,"2023-03-20":1.2255,"2023-03-17":1.214,"2023-03-16":1.2109,"2023-03-15":1.2028,"2023-03-14":1.2146,"2023-03-13":1.2159,"2023-03-10":1.2102,"2023-03-09":1.1892,"2023-03-08":1.1837,"2023-03-07":1.1872,"2023-03-06":1.2002,"2023-03-03":1.1977,"2023-03-02":1.1954,"2023-03-01":1.2007,"2023-02-28":1.2107,"2023-02-27":1.2031,"2023-02-24":1.1941,"2023-02-23":1.2023,"2023-02-22":1.2067,"2023-02-21":1.2139,"2023-02-20":1.2028,"2023-02-17":1.1998,"2023-02-16":1.2011,"2023-02-15":1.2003,"2023-02-14":1.2156,"2023-02-13":1.2137,"2023-02-10":1.2074,"2023-02-09":1.2169,"2023-02-08":1.2077,"2023-02-07":1.2015,"2023-02-06":1.2013,"2023-02-03":1.2105,"2023-02-02":1.2298,"2023-02-01":1.2326,"2023-01-31":1.2307,"2023-01-30":1.2379,"2023-01-27":1.2358,"2023-01-26":1.2356,"2023-01-25":1.2358,"2023-01-24":1.2315,"2023-01-23":1.2368,"2023-01-20":1.2369,"2023-01-19":1.2359,"2023-01-18":1.2394,"2023-01-17":1.228,"2023-01-16":1.2206,"2023-01-13":1.2215,"2023-01-12":1.2177,"2023-01-11":1.213,"2023-01-10":1.2148,"2023-01-09":1.2193,"2023-01-06":1.2047,"2023-01-05":1.1879,"2023-01-04":1.2041,"2023-01-03":1.2008,"2022-12-30":1.2039,"2022-12-29":1.2055,"2022-12-28":1.2037,"2022-12-23":1.207,"2022-12-22":1.203,"2022-12-21":1.2109,"2022-12-20":1.2139,"2022-12-19":1.213,"2022-12-16":1.2153,"2022-12-15":1.222,"2022-12-14":1.2404,"2022-12-13":1.2395,"2022-12-12":1.2253,"2022-12-09":1.2295,"2022-12-08":1.2219,"2022-12-07":1.2198,"2022-12-06":1.2223,"2022-12-05":1.2218,"2022-12-02":1.2216,"2022-12-01":1.2267,"2022-11-30":1.1912,"2022-11-29":1.2002,"2022-11-28":1.204,"2022-11-25":1.2095,"2022-11-24":1.2142,"2022-11-23":1.2065,"2022-11-22":1.188,"2022-11-21":1.1786,"2022-11-18":1.1927,"2022-11-17":1.1778,"2022-11-16":1.1889,"2022-11-15":1.1895,"2022-11-14":1.1729,"2022-11-11":1.1774,"2022-11-10":1.1678,"2022-11-09":1.1374,"2022-11-08":1.1564,"2022-11-07":1.1466,"2022-11-04":1.1277,"2022-11-03":1.1179,"2022-11-02":1.1463,"2022-11-01":1.146,"2022-10-31":1.1514,"2022-10-28":1.1592,"2022-10-27":1.1581,"2022-10-26":1.16,"2022-10-25":1.1458,"2022-10-24":1.1314,"2022-10-21":1.1126,"2022-10-20":1.1319,"2022-10-19":1.126,"2022-10-18":1.1322,"2022-10-17":1.1434,"2022-10-14":1.1251,"2022-10-13":1.1237,"2022-10-12":1.1072,"2022-10-11":1.1083,"2022-10-10":1.1048,"2022-10-07":1.1117,"2022-10-06":1.1199,"2022-10-05":1.1245,"2022-10-04":1.1404,"2022-10-03":1.128,"2022-09-30":1.117,"2022-09-29":1.1034,"2022-09-28":1.0745,"2022-09-27":1.0774,"2022-09-26":1.0787,"2022-09-23":1.0897,"2022-09-22":1.1265,"2022-09-21":1.1333,"2022-09-20":1.1415,"2022-09-16":1.1431,"2022-09-15":1.149,"2022-09-14":1.158,"2022-09-13":1.1541,"2022-09-12":1.1704,"2022-09-09":1.1583,"2022-09-08":1.1491,"2022-09-07":1.1467,"2022-09-06":1.1529,"2022-09-05":1.1507,"2022-09-02":1.1584,"2022-09-01":1.1526,"2022-08-31":1.1638,"2022-08-30":1.1631,"2022-08-26":1.1792,"2022-08-25":1.1826,"2022-08-24":1.1818,"2022-08-23":1.1852,"2022-08-22":1.179,"2022-08-19":1.1805,"2022-08-18":1.2003,"2022-08-17":1.2044,"2022-08-16":1.2095,"2022-08-15":1.208,"2022-08-12":1.2118,"2022-08-11":1.2226,"2022-08-10":1.2259,"2022-08-09":1.2088,"2022-08-08":1.2119,"2022-08-05":1.206,"2022-08-04":1.2111,"2022-08-03":1.2112,"2022-08-02":1.2218,"2022-08-01":1.2283,"2022-07-29":1.2162,"2022-07-28":1.2114,"2022-07-27":1.2031,"2022-07-26":1.2044,"2022-07-25":1.2045,"2022-07-22":1.204,"2022-07-21":1.1947,"2022-07-20":1.1998,"2022-07-19":1.2027,"2022-07-18":1.2026,"2022-07-15":1.1855,"2022-07-14":1.1785,"2022-07-13":1.1954,"2022-07-12":1.1888,"2022-07-11":1.1885,"2022-07-08":1.2025,"2022-07-07":1.2001,"2022-07-06":1.1912,"2022-07-05":1.1916,"2022-07-04":1.2117,"2022-07-01":1.2005,"2022-06-30":1.2143,"2022-06-29":1.2121,"2022-06-28":1.2201,"2022-06-27":1.2303,"2022-06-24":1.2288,"2022-06-23":1.2242,"2022-06-22":1.2254,"2022-06-21":1.2282,"2022-06-20":1.2255,"2022-06-17":1.2182,"2022-06-16":1.2274,"2022-06-15":1.2066,"2022-06-14":1.2001,"2022-06-13":1.2131,"2022-06-10":1.2342,"2022-06-09":1.254,"2022-06-08":1.2549,"2022-06-07":1.258,"2022-06-06":1.2557,"2022-06-01":1.2496,"2022-05-31":1.2601,"2022-05-30":1.2648,"2022-05-27":1.2615,"2022-05-26":1.2573,"2022-05-25":1.2545,"2022-05-24":1.2525,"2022-05-23":1.2571,"2022-05-20":1.2466,"2022-05-19":1.2489,"2022-05-18":1.2413,"2022-05-17":1.247,"2022-05-16":1.225,"2022-05-13":1.222,"2022-05-12":1.2228,"2022-05-11":1.234,"2022-05-10":1.2313,"2022-05-09":1.2306,"2022-05-06":1.235,"2022-05-05":1.2374,"2022-05-04":1.2499,"2022-05-03":1.2514,"2022-04-29":1.2556,"2022-04-28":1.2439,"2022-04-27":1.2503,"2022-04-26":1.2621,"2022-04-25":1.2717,"2022-04-22":1.2843,"2022-04-21":1.3031,"2022-04-20":1.3048,"2022-04-19":1.299,"2022-04-14":1.3048,"2022-04-13":1.3038,"2022-04-12":1.3038,"2022-04-11":1.3041,"2022-04-08":1.3007,"2022-04-07":1.3066,"2022-04-06":1.3094,"2022-04-05":1.3114,"2022-04-04":1.3116,"2022-04-01":1.3109,"2022-03-31":1.3162,"2022-03-30":1.3173,"2022-03-29":1.3136,"2022-03-28":1.3089,"2022-03-25":1.3192,"2022-03-24":1.3184,"2022-03-23":1.3211,"2022-03-22":1.326,"2022-03-21":1.3202,"2022-03-18":1.3173,"2022-03-17":1.3157,"2022-03-16":1.3095,"2022-03-15":1.3067,"2022-03-14":1.3047,"2022-03-11":1.3085,"2022-03-10":1.313,"2022-03-09":1.3158,"2022-03-08":1.3111,"2022-03-07":1.3135,"2022-03-04":1.3215,"2022-03-03":1.3341,"2022-03-02":1.3315,"2022-03-01":1.3352,"2022-02-28":1.3419,"2022-02-25":1.3416,"2022-02-24":1.3275,"2022-02-23":1.356,"2022-02-22":1.3591,"2022-02-21":1.3607,"2022-02-18":1.3584,"2022-02-17":1.362,"2022-02-16":1.3578,"2022-02-15":1.3522,"2022-02-14":1.3513,"2022-02-11":1.3603,"2022-02-10":1.3616,"2022-02-09":1.3546,"2022-02-08":1.3553,"2022-02-07":1.353,"2022-02-04":1.353,"2022-02-03":1.361,"2022-02-02":1.3572,"2022-02-01":1.3506,"2022-01-31":1.3418,"2022-01-28":1.3415,"2022-01-27":1.339,"2022-01-26":1.3513,"2022-01-25":1.3486,"2022-01-24":1.3464,"2022-01-21":1.3559,"2022-01-20":1.3659,"2022-01-19":1.359,"2022-01-18":1.3582,"2022-01-17":1.365,"2022-01-14":1.3683,"2022-01-13":1.3734,"2022-01-12":1.3687,"2022-01-11":1.3605,"2022-01-10":1.3561,"2022-01-07":1.3572,"2022-01-06":1.3527,"2022-01-05":1.3565,"2022-01-04":1.3553,"2021-12-31":1.3477,"2021-12-30":1.3499,"2021-12-29":1.3486,"2021-12-24":1.3413,"2021-12-23":1.341,"2021-12-22":1.3345,"2021-12-21":1.3233,"2021-12-20":1.3221,"2021-12-17":1.3263,"2021-12-16":1.3327,"2021-12-15":1.3214,"2021-12-14":1.3233,"2021-12-13":1.3231,"2021-12-10":1.3228,"2021-12-09":1.3206,"2021-12-08":1.3216,"2021-12-07":1.3235,"2021-12-06":1.3236,"2021-12-03":1.3219,"2021-12-02":1.3307,"2021-12-01":1.3315,"2021-11-30":1.3233,"2021-11-29":1.3295,"2021-11-26":1.3336,"2021-11-25":1.3319,"2021-11-24":1.333,"2021-11-23":1.337,"2021-11-22":1.3402,"2021-11-19":1.3462,"2021-11-18":1.3477,"2021-11-17":1.3465,"2021-11-16":1.3421,"2021-11-15":1.3431,"2021-11-12":1.3394,"2021-11-11":1.3392,"2021-11-10":1.3475,"2021-11-09":1.3551,"2021-11-08":1.3563,"2021-11-05":1.3492,"2021-11-04":1.3492,"2021-11-03":1.3659,"2021-11-02":1.3611,"2021-11-01":1.3678,"2021-10-29":1.3706,"2021-10-28":1.38,"2021-10-27":1.3713,"2021-10-26":1.3784,"2021-10-25":1.3771,"2021-10-22":1.3772,"2021-10-21":1.3821,"2021-10-20":1.3816,"2021-10-19":1.3799,"2021-10-18":1.372,"2021-10-15":1.3769,"2021-10-14":1.3683,"2021-10-13":1.3633,"2021-10-12":1.3601,"2021-10-11":1.3626,"2021-10-08":1.3637,"2021-10-07":1.3622,"2021-10-06":1.3569,"2021-10-05":1.3624,"2021-10-04":1.3605,"2021-10-01":1.354,"2021-09-30":1.3484,"2021-09-29":1.3425,"2021-09-28":1.3537,"2021-09-27":1.3708,"2021-09-24":1.3672,"2021-09-23":1.3745,"2021-09-22":1.3645,"2021-09-21":1.3644,"2021-09-20":1.3665,"2021-09-17":1.3749,"2021-09-16":1.3782,"2021-09-15":1.3828,"2021-09-14":1.385,"2021-09-13":1.3848,"2021-09-10":1.3855,"2021-09-09":1.3844,"2021-09-08":1.3737,"2021-09-07":1.3783,"2021-09-06":1.3827,"2021-09-03":1.3871,"2021-09-02":1.3833,"2021-09-01":1.3786,"2021-08-31":1.3761,"2021-08-27":1.3747,"2021-08-26":1.3715,"2021-08-25":1.3731,"2021-08-24":1.3732,"2021-08-23":1.3714,"2021-08-20":1.3613,"2021-08-19":1.3661,"2021-08-18":1.3756,"2021-08-17":1.3738,"2021-08-16":1.3858,"2021-08-13":1.3853,"2021-08-12":1.3835,"2021-08-11":1.3868,"2021-08-10":1.3847,"2021-08-09":1.3848,"2021-08-06":1.3868,"2021-08-05":1.3933,"2021-08-04":1.3908,"2021-08-03":1.3892,"2021-08-02":1.3898,"2021-07-30":1.3907,"2021-07-29":1.3975,"2021-07-28":1.3871,"2021-07-27":1.3881,"2021-07-26":1.3824,"2021-07-23":1.375,"2021-07-22":1.3756,"2021-07-21":1.3675,"2021-07-20":1.3605,"2021-07-19":1.367,"2021-07-16":1.379,"2021-07-15":1.3863,"2021-07-14":1.3869,"2021-07-13":1.3842,"2021-07-12":1.3894,"2021-07-09":1.3839,"2021-07-08":1.3761,"2021-07-07":1.3777,"2021-07-06":1.3807,"2021-07-05":1.384,"2021-07-02":1.3783,"2021-07-01":1.377,"2021-06-30":1.3819,"2021-06-29":1.3837,"2021-06-28":1.3885,"2021-06-25":1.3914,"2021-06-24":1.3895,"2021-06-23":1.3969,"2021-06-22":1.3916,"2021-06-21":1.3905,"2021-06-18":1.3807,"2021-06-17":1.3951,"2021-06-16":1.4104,"2021-06-15":1.4083,"2021-06-14":1.4115,"2021-06-11":1.4123,"2021-06-10":1.4142,"2021-06-09":1.4127,"2021-06-08":1.415,"2021-06-07":1.4168,"2021-06-04":1.4172,"2021-06-03":1.418,"2021-06-02":1.4165,"2021-06-01":1.4173,"2021-05-28":1.4176,"2021-05-27":1.4181,"2021-05-26":1.4124,"2021-05-25":1.4133,"2021-05-24":1.4158,"2021-05-21":1.4162,"2021-05-20":1.4155,"2021-05-19":1.4145,"2021-05-18":1.4211,"2021-05-17":1.4118,"2021-05-14":1.4088,"2021-05-13":1.4046,"2021-05-12":1.4096,"2021-05-11":1.4144,"2021-05-10":1.4138,"2021-05-07":1.3979,"2021-05-06":1.3888,"2021-05-05":1.391,"2021-05-04":1.3883,"2021-04-30":1.3845,"2021-04-29":1.3945,"2021-04-28":1.3906,"2021-04-27":1.3915,"2021-04-26":1.3894,"2021-04-23":1.3841,"2021-04-22":1.3846,"2021-04-21":1.3929,"2021-04-20":1.395,"2021-04-19":1.3984,"2021-04-16":1.3817,"2021-04-15":1.3795,"2021-04-14":1.3781,"2021-04-13":1.3732,"2021-04-12":1.3744,"2021-04-09":1.3729,"2021-04-08":1.3731,"2021-04-07":1.3788,"2021-04-06":1.3858,"2021-04-01":1.3819,"2021-03-31":1.3796,"2021-03-30":1.3711,"2021-03-29":1.3772,"2021-03-26":1.3792,"2021-03-25":1.3722,"2021-03-24":1.3722,"2021-03-23":1.3793,"2021-03-22":1.3855,"2021-03-19":1.3872,"2021-03-18":1.3939,"2021-03-17":1.3889,"2021-03-16":1.3892,"2021-03-15":1.3862,"2021-03-12":1.3893,"2021-03-11":1.3969,"2021-03-10":1.3904,"2021-03-09":1.3893,"2021-03-08":1.3812,"2021-03-05":1.3817,"2021-03-04":1.3991,"2021-03-03":1.3974,"2021-03-02":1.3948,"2021-03-01":1.3938,"2021-02-26":1.3976,"2021-02-25":1.4134,"2021-02-24":1.4103,"2021-02-23":1.4106,"2021-02-22":1.4052,"2021-02-19":1.4022,"2021-02-18":1.3947,"2021-02-17":1.3853,"2021-02-16":1.3926,"2021-02-15":1.3912,"2021-02-12":1.3849,"2021-02-11":1.3826,"2021-02-10":1.3845,"2021-02-09":1.3796,"2021-02-08":1.374,"2021-02-05":1.3724,"2021-02-04":1.3659,"2021-02-03":1.3644,"2021-02-02":1.3629,"2021-02-01":1.3663,"2021-01-29":1.3728,"2021-01-28":1.3719,"2021-01-27":1.3704,"2021-01-26":1.3742,"2021-01-25":1.3671,"2021-01-22":1.367,"2021-01-21":1.372,"2021-01-20":1.363,"2021-01-19":1.3618,"2021-01-18":1.3575,"2021-01-15":1.3585,"2021-01-14":1.3691,"2021-01-13":1.3634,"2021-01-12":1.3624,"2021-01-11":1.3492,"2021-01-08":1.359,"2021-01-07":1.3544,"2021-01-06":1.355,"2021-01-05":1.3593,"2021-01-04":1.3579,"2020-12-31":1.3649,"2020-12-30":1.3608,"2020-12-29":1.3494,"2020-12-24":1.3588,"2020-12-23":1.3522,"2020-12-22":1.3322,"2020-12-21":1.3314,"2020-12-18":1.3485,"2020-12-17":1.3591,"2020-12-16":1.3495,"2020-12-15":1.3448,"2020-12-14":1.333,"2020-12-11":1.3216,"2020-12-10":1.3275,"2020-12-09":1.3396,"2020-12-08":1.3361,"2020-12-07":1.3313,"2020-12-04":1.3473,"2020-12-03":1.3497,"2020-12-02":1.3326,"2020-12-01":1.3364,"2020-11-30":1.3353,"2020-11-27":1.3344,"2020-11-26":1.333,"2020-11-25":1.3379,"2020-11-24":1.3355,"2020-11-23":1.3294,"2020-11-20":1.3286,"2020-11-19":1.3226,"2020-11-18":1.3302,"2020-11-17":1.326,"2020-11-16":1.3176,"2020-11-13":1.3159,"2020-11-12":1.3129,"2020-11-11":1.3197,"2020-11-10":1.325,"2020-11-09":1.315,"2020-11-06":1.316,"2020-11-05":1.3022,"2020-11-04":1.2994,"2020-11-03":1.3071,"2020-11-02":1.2904,"2020-10-30":1.2933,"2020-10-29":1.2905,"2020-10-28":1.2994,"2020-10-27":1.3066,"2020-10-26":1.302,"2020-10-23":1.3047,"2020-10-22":1.3095,"2020-10-21":1.3163,"2020-10-20":1.2962,"2020-10-19":1.2997,"2020-10-16":1.293,"2020-10-15":1.2906,"2020-10-14":1.3041,"2020-10-13":1.2987,"2020-10-12":1.307,"2020-10-09":1.2994,"2020-10-08":1.2928,"2020-10-07":1.2895,"2020-10-06":1.2963,"2020-10-05":1.2974,"2020-10-02":1.2932,"2020-10-01":1.287,"2020-09-30":1.2924,"2020-09-29":1.2842,"2020-09-28":1.2842,"2020-09-25":1.2705,"2020-09-24":1.2714,"2020-09-23":1.2765,"2020-09-22":1.2721,"2020-09-21":1.2795,"2020-09-18":1.2962,"2020-09-17":1.2952,"2020-09-16":1.3006,"2020-09-15":1.2854,"2020-09-14":1.2883,"2020-09-11":1.2782,"2020-09-10":1.2867,"2020-09-09":1.2996,"2020-09-08":1.3023,"2020-09-07":1.3177,"2020-09-04":1.3199,"2020-09-03":1.3271,"2020-09-02":1.3303,"2020-09-01":1.345,"2020-08-28":1.333,"2020-08-27":1.3189,"2020-08-26":1.3193,"2020-08-25":1.3118,"2020-08-24":1.3071,"2020-08-21":1.3073,"2020-08-20":1.3144,"2020-08-19":1.3182,"2020-08-18":1.3223,"2020-08-17":1.3099,"2020-08-14":1.311,"2020-08-13":1.3096,"2020-08-12":1.3058,"2020-08-11":1.3087,"2020-08-10":1.3089,"2020-08-07":1.3051,"2020-08-06":1.3143,"2020-08-05":1.3143,"2020-08-04":1.3079,"2020-08-03":1.3032,"2020-07-31":1.3126,"2020-07-30":1.3046,"2020-07-29":1.2966,"2020-07-28":1.2947,"2020-07-27":1.2895,"2020-07-24":1.2789,"2020-07-23":1.2746,"2020-07-22":1.2732,"2020-07-21":1.2749,"2020-07-20":1.2647,"2020-07-17":1.2536,"2020-07-16":1.2597,"2020-07-15":1.2623,"2020-07-14":1.253,"2020-07-13":1.2619,"2020-07-10":1.2662,"2020-07-09":1.2615,"2020-07-08":1.2596,"2020-07-07":1.2575,"2020-07-06":1.2509,"2020-07-03":1.2468,"2020-07-02":1.2466,"2020-07-01":1.2458,"2020-06-30":1.2359,"2020-06-29":1.2268,"2020-06-26":1.232,"2020-06-25":1.2406,"2020-06-24":1.245,"2020-06-23":1.252,"2020-06-22":1.2448,"2020-06-19":1.2361,"2020-06-18":1.242,"2020-06-17":1.2545,"2020-06-16":1.2583,"2020-06-15":1.2559,"2020-06-12":1.2539,"2020-06-11":1.2645,"2020-06-10":1.2755,"2020-06-09":1.2722,"2020-06-08":1.2698,"2020-06-05":1.2725,"2020-06-04":1.2607,"2020-06-03":1.2597,"2020-06-02":1.2557,"2020-06-01":1.2481,"2020-05-29":1.2368,"2020-05-28":1.2323,"2020-05-27":1.2217,"2020-05-26":1.2363,"2020-05-22":1.219,"2020-05-21":1.2212,"2020-05-20":1.227,"2020-05-19":1.2251,"2020-05-18":1.2192,"2020-05-15":1.2126,"2020-05-14":1.2199,"2020-05-13":1.2226,"2020-05-12":1.233,"2020-05-11":1.2358,"2020-05-07":1.2287,"2020-05-06":1.2362,"2020-05-05":1.2454,"2020-05-04":1.2421,"2020-05-01":1.2547,"2020-04-30":1.2613,"2020-04-29":1.2436,"2020-04-28":1.2436,"2020-04-27":1.2409,"2020-04-24":1.2338,"2020-04-23":1.2386,"2020-04-22":1.2329,"2020-04-21":1.2273,"2020-04-20":1.2473,"2020-04-17":1.2504,"2020-04-16":1.2451,"2020-04-15":1.2498,"2020-04-14":1.2594,"2020-04-09":1.247,"2020-04-08":1.2379,"2020-04-07":1.2304,"2020-04-06":1.2255,"2020-04-03":1.2258,"2020-04-02":1.2377,"2020-04-01":1.2424,"2020-03-31":1.2403,"2020-03-30":1.2416,"2020-03-27":1.2359,"2020-03-26":1.2135,"2020-03-25":1.1761,"2020-03-24":1.1772,"2020-03-23":1.1492,"2020-03-20":1.1741,"2020-03-19":1.1658,"2020-03-18":1.1763,"2020-03-17":1.2016,"2020-03-16":1.2277,"2020-03-13":1.2406,"2020-03-12":1.254,"2020-03-11":1.2887,"2020-03-10":1.2932,"2020-03-09":1.311,"2020-03-06":1.3029,"2020-03-05":1.2922,"2020-03-04":1.2821,"2020-03-03":1.2819,"2020-03-02":1.2748,"2020-02-28":1.2776,"2020-02-27":1.2873,"2020-02-26":1.2917,"2020-02-25":1.3016,"2020-02-24":1.2924,"2020-02-21":1.2962,"2020-02-20":1.2881,"2020-02-19":1.2951,"2020-02-18":1.3037,"2020-02-17":1.3006,"2020-02-14":1.3016,"2020-02-13":1.3055,"2020-02-12":1.2975,"2020-02-11":1.2945,"2020-02-10":1.2923,"2020-02-07":1.2939,"2020-02-06":1.2929,"2020-02-05":1.2984,"2020-02-04":1.3025,"2020-02-03":1.3013,"2020-01-31":1.3179,"2020-01-30":1.31,"2020-01-29":1.3,"2020-01-28":1.2983,"2020-01-27":1.3056,"2020-01-24":1.3067,"2020-01-23":1.3118,"2020-01-22":1.3141,"2020-01-21":1.3058,"2020-01-20":1.2998,"2020-01-17":1.3029,"2020-01-16":1.3067,"2020-01-15":1.3023,"2020-01-14":1.301,"2020-01-13":1.2979,"2020-01-10":1.3062,"2020-01-09":1.3049,"2020-01-08":1.3099,"2020-01-07":1.3122,"2020-01-06":1.3159,"2020-01-03":1.3072,"2020-01-02":1.3189,"2019-12-31":1.321,"2019-12-30":1.3115,"2019-12-27":1.3094,"2019-12-24":1.2948,"2019-12-23":1.2926,"2019-12-20":1.3049,"2019-12-19":1.3029,"2019-12-18":1.3073,"2019-12-17":1.3139,"2019-12-16":1.3334,"2019-12-13":1.3343,"2019-12-12":1.3119,"2019-12-11":1.3177,"2019-12-10":1.3171,"2019-12-09":1.3155,"2019-12-06":1.3105,"2019-12-05":1.3155,"2019-12-04":1.3107,"2019-12-03":1.2993,"2019-12-02":1.2922,"2019-11-29":1.2936,"2019-11-28":1.2903,"2019-11-27":1.2875,"2019-11-26":1.2838,"2019-11-25":1.2907,"2019-11-22":1.2834,"2019-11-21":1.2925,"2019-11-20":1.2911,"2019-11-19":1.2932,"2019-11-18":1.2966,"2019-11-15":1.2896,"2019-11-14":1.2857,"2019-11-13":1.2839,"2019-11-12":1.2839,"2019-11-11":1.2872,"2019-11-08":1.2792,"2019-11-07":1.2822,"2019-11-06":1.2874,"2019-11-05":1.2866,"2019-11-04":1.2906,"2019-11-01":1.2947,"2019-10-31":1.2939,"2019-10-30":1.2871,"2019-10-29":1.2904,"2019-10-28":1.2858,"2019-10-25":1.2832,"2019-10-24":1.2848,"2019-10-23":1.2882,"2019-10-22":1.2908,"2019-10-21":1.2983,"2019-10-18":1.2899,"2019-10-17":1.2842,"2019-10-16":1.2804,"2019-10-15":1.2777,"2019-10-14":1.2586,"2019-10-11":1.2683,"2019-10-10":1.2282,"2019-10-09":1.2218,"2019-10-08":1.2214,"2019-10-07":1.2321,"2019-10-04":1.2294,"2019-10-03":1.2407,"2019-10-02":1.2304,"2019-10-01":1.2223,"2019-09-30":1.232,"2019-09-27":1.2309,"2019-09-26":1.2334,"2019-09-25":1.2379,"2019-09-24":1.2479,"2019-09-23":1.243,"2019-09-20":1.2501,"2019-09-19":1.2488,"2019-09-18":1.2484,"2019-09-17":1.2482,"2019-09-16":1.242,"2019-09-13":1.246,"2019-09-12":1.2332,"2019-09-11":1.2343,"2019-09-10":1.2354,"2019-09-09":1.2344,"2019-09-06":1.2313,"2019-09-05":1.2325,"2019-09-04":1.2192,"2019-09-03":1.2092,"2019-09-02":1.2062,"2019-08-30":1.2183,"2019-08-29":1.2205,"2019-08-28":1.2221,"2019-08-27":1.2278,"2019-08-23":1.2276,"2019-08-22":1.2253,"2019-08-21":1.2131,"2019-08-20":1.2132,"2019-08-19":1.2135,"2019-08-16":1.2145,"2019-08-15":1.2114,"2019-08-14":1.2069,"2019-08-13":1.2072,"2019-08-12":1.2082,"2019-08-09":1.208,"2019-08-08":1.2134,"2019-08-07":1.2153,"2019-08-06":1.2167,"2019-08-05":1.2142,"2019-08-02":1.2127,"2019-08-01":1.2152,"2019-07-31":1.2246,"2019-07-30":1.2152,"2019-07-29":1.2232,"2019-07-26":1.2387,"2019-07-25":1.2495,"2019-07-24":1.2499,"2019-07-23":1.2438,"2019-07-22":1.2498,"2019-07-19":1.2502,"2019-07-18":1.2483,"2019-07-17":1.2428,"2019-07-16":1.2419,"2019-07-15":1.2517,"2019-07-12":1.256,"2019-07-11":1.2553,"2019-07-10":1.2496,"2019-07-09":1.2466,"2019-07-08":1.2515,"2019-07-05":1.2506,"2019-07-04":1.2577,"2019-07-03":1.2564,"2019-07-02":1.26,"2019-07-01":1.2652,"2019-06-28":1.2728,"2019-06-27":1.2676,"2019-06-26":1.2676,"2019-06-25":1.272,"2019-06-24":1.2722,"2019-06-21":1.2696,"2019-06-20":1.2701,"2019-06-19":1.263,"2019-06-18":1.2539,"2019-06-17":1.2556,"2019-06-14":1.2606,"2019-06-13":1.2684,"2019-06-12":1.2725,"2019-06-11":1.2719,"2019-06-10":1.269,"2019-06-07":1.2757,"2019-06-06":1.2712,"2019-06-05":1.2732,"2019-06-04":1.2677,"2019-06-03":1.2631,"2019-05-31":1.2602,"2019-05-30":1.2589,"2019-05-29":1.2631,"2019-05-28":1.2675,"2019-05-24":1.2691,"2019-05-23":1.2667,"2019-05-22":1.2657,"2019-05-21":1.2786,"2019-05-20":1.2734,"2019-05-17":1.2733,"2019-05-16":1.2792,"2019-05-15":1.2868,"2019-05-14":1.2919,"2019-05-13":1.2984,"2019-05-10":1.3033,"2019-05-09":1.302,"2019-05-08":1.3004,"2019-05-07":1.3047,"2019-05-03":1.3116,"2019-05-02":1.3033,"2019-05-01":1.3083,"2019-04-30":1.3036,"2019-04-29":1.2922,"2019-04-26":1.2934,"2019-04-25":1.2907,"2019-04-24":1.2959,"2019-04-23":1.2937,"2019-04-18":1.3009,"2019-04-17":1.3046,"2019-04-16":1.3054,"2019-04-15":1.3116,"2019-04-12":1.3103,"2019-04-11":1.3087,"2019-04-10":1.309,"2019-04-09":1.3045,"2019-04-08":1.3048,"2019-04-05":1.3012,"2019-04-04":1.3083,"2019-04-03":1.3156,"2019-04-02":1.3031,"2019-04-01":1.3141,"2019-03-29":1.303,"2019-03-28":1.3088,"2019-03-27":1.3192,"2019-03-26":1.3215,"2019-03-25":1.3197,"2019-03-22":1.322,"2019-03-21":1.3073,"2019-03-20":1.3192,"2019-03-19":1.3264,"2019-03-18":1.322,"2019-03-15":1.3279,"2019-03-14":1.3282,"2019-03-13":1.3228,"2019-03-12":1.3097,"2019-03-11":1.3095,"2019-03-08":1.3005,"2019-03-07":1.3115,"2019-03-06":1.315,"2019-03-05":1.3114,"2019-03-04":1.3173,"2019-03-01":1.3243,"2019-02-28":1.33,"2019-02-27":1.3336,"2019-02-26":1.324,"2019-02-25":1.3067,"2019-02-22":1.3058,"2019-02-21":1.307,"2019-02-20":1.3061,"2019-02-19":1.3031,"2019-02-18":1.2928,"2019-02-15":1.2847,"2019-02-14":1.2781,"2019-02-13":1.2878,"2019-02-12":1.2883,"2019-02-11":1.2866,"2019-02-08":1.2942,"2019-02-07":1.2975,"2019-02-06":1.2963,"2019-02-05":1.294,"2019-02-04":1.3085,"2019-02-01":1.3093,"2019-01-31":1.3152,"2019-01-30":1.3072,"2019-01-29":1.3149,"2019-01-28":1.3156,"2019-01-25":1.3167,"2019-01-24":1.3042,"2019-01-23":1.3067,"2019-01-22":1.2957,"2019-01-21":1.2895,"2019-01-18":1.2906,"2019-01-17":1.2909,"2019-01-16":1.2861,"2019-01-15":1.281,"2019-01-14":1.2912,"2019-01-11":1.2818,"2019-01-10":1.2779,"2019-01-09":1.2743,"2019-01-08":1.2731,"2019-01-07":1.2772,"2019-01-04":1.2724,"2019-01-03":1.2601,"2019-01-02":1.2608,"2018-12-31":1.2769,"2018-12-28":1.2688,"2018-12-27":1.2637,"2018-12-24":1.2649,"2018-12-21":1.2676,"2018-12-20":1.2636,"2018-12-19":1.2643,"2018-12-18":1.2632,"2018-12-17":1.261,"2018-12-14":1.2561,"2018-12-13":1.2616,"2018-12-12":1.2661,"2018-12-11":1.2527,"2018-12-10":1.2536,"2018-12-07":1.2759,"2018-12-06":1.2778,"2018-12-05":1.2738,"2018-12-04":1.2727,"2018-12-03":1.2737,"2018-11-30":1.276,"2018-11-29":1.2778,"2018-11-28":1.2753,"2018-11-27":1.2739,"2018-11-26":1.2826,"2018-11-23":1.2802,"2018-11-22":1.2869,"2018-11-21":1.2784,"2018-11-20":1.2823,"2018-11-19":1.2864,"2018-11-16":1.284,"2018-11-15":1.2782,"2018-11-14":1.3004,"2018-11-13":1.2997,"2018-11-12":1.2866,"2018-11-09":1.3029,"2018-11-08":1.3128,"2018-11-07":1.3135,"2018-11-06":1.308,"2018-11-05":1.3018,"2018-11-02":1.2965,"2018-11-01":1.2974,"2018-10-31":1.2779,"2018-10-30":1.2731,"2018-10-29":1.2806,"2018-10-26":1.2821,"2018-10-25":1.2815,"2018-10-24":1.291,"2018-10-23":1.2975,"2018-10-22":1.2974,"2018-10-19":1.3046,"2018-10-18":1.3071,"2018-10-17":1.3135,"2018-10-16":1.321,"2018-10-15":1.3144,"2018-10-12":1.3158,"2018-10-11":1.321,"2018-10-10":1.32,"2018-10-09":1.3089,"2018-10-08":1.3071,"2018-10-05":1.3071,"2018-10-04":1.3027,"2018-10-03":1.3005,"2018-10-02":1.2978,"2018-10-01":1.3043,"2018-09-28":1.3041,"2018-09-27":1.3116,"2018-09-26":1.3185,"2018-09-25":1.3163,"2018-09-24":1.3139,"2018-09-21":1.3099,"2018-09-20":1.3256,"2018-09-19":1.3152,"2018-09-18":1.3155,"2018-09-17":1.3151,"2018-09-14":1.3074,"2018-09-13":1.3093,"2018-09-12":1.3021,"2018-09-11":1.2999,"2018-09-10":1.3019,"2018-09-07":1.2951,"2018-09-06":1.2947,"2018-09-05":1.2958,"2018-09-04":1.2832,"2018-09-03":1.2885,"2018-08-31":1.2994,"2018-08-30":1.3004,"2018-08-29":1.2999,"2018-08-28":1.2884,"2018-08-24":1.2858,"2018-08-23":1.2835,"2018-08-22":1.291,"2018-08-21":1.2868,"2018-08-20":1.2759,"2018-08-17":1.2741,"2018-08-16":1.2724,"2018-08-15":1.2669,"2018-08-14":1.2753,"2018-08-13":1.2777,"2018-08-10":1.2776,"2018-08-09":1.2869,"2018-08-08":1.2882,"2018-08-07":1.2954,"2018-08-06":1.294,"2018-08-03":1.3019,"2018-08-02":1.3032,"2018-08-01":1.3122,"2018-07-31":1.3117,"2018-07-30":1.3145,"2018-07-27":1.3128,"2018-07-26":1.315,"2018-07-25":1.3149,"2018-07-24":1.3156,"2018-07-23":1.3113,"2018-07-20":1.3102,"2018-07-19":1.3004,"2018-07-18":1.305,"2018-07-17":1.3161,"2018-07-16":1.3231,"2018-07-13":1.3201,"2018-07-12":1.3223,"2018-07-11":1.3248,"2018-07-10":1.3265,"2018-07-09":1.326,"2018-07-06":1.3277,"2018-07-05":1.3223,"2018-07-04":1.3208,"2018-07-03":1.3176,"2018-07-02":1.3124,"2018-06-29":1.3203,"2018-06-28":1.3098,"2018-06-27":1.3147,"2018-06-26":1.3233,"2018-06-25":1.3269,"2018-06-22":1.3272,"2018-06-21":1.3257,"2018-06-20":1.3176,"2018-06-19":1.3173,"2018-06-18":1.3241,"2018-06-15":1.3286,"2018-06-14":1.3333,"2018-06-13":1.3367,"2018-06-12":1.3352,"2018-06-11":1.3394,"2018-06-08":1.3395,"2018-06-07":1.342,"2018-06-06":1.3428,"2018-06-05":1.3341,"2018-06-04":1.3332,"2018-06-01":1.3331,"2018-05-31":1.3308,"2018-05-30":1.3275,"2018-05-29":1.3269,"2018-05-25":1.3316,"2018-05-24":1.3374,"2018-05-23":1.3341,"2018-05-22":1.3421,"2018-05-21":1.341,"2018-05-18":1.3475,"2018-05-17":1.3504,"2018-05-16":1.3483,"2018-05-15":1.3495,"2018-05-14":1.3593,"2018-05-11":1.3553,"2018-05-10":1.3467,"2018-05-09":1.3577,"2018-05-08":1.3518,"2018-05-04":1.3517,"2018-05-03":1.3546,"2018-05-02":1.3599,"2018-05-01":1.3596,"2018-04-30":1.3776,"2018-04-27":1.3795,"2018-04-26":1.3936,"2018-04-25":1.3935,"2018-04-24":1.3964,"2018-04-23":1.395,"2018-04-20":1.4025,"2018-04-19":1.4221,"2018-04-18":1.4235,"2018-04-17":1.431,"2018-04-16":1.4328,"2018-04-13":1.4247,"2018-04-12":1.4232,"2018-04-11":1.4207,"2018-04-10":1.4173,"2018-04-09":1.4129,"2018-04-06":1.4083,"2018-04-05":1.3999,"2018-04-04":1.4085,"2018-04-03":1.4038,"2018-03-29":1.4033,"2018-03-28":1.4098,"2018-03-27":1.4144,"2018-03-26":1.4223,"2018-03-23":1.415,"2018-03-22":1.4099,"2018-03-21":1.4062,"2018-03-20":1.4011,"2018-03-19":1.4029,"2018-03-16":1.3918,"2018-03-15":1.3947,"2018-03-14":1.3945,"2018-03-13":1.3987,"2018-03-12":1.3898,"2018-03-09":1.3868,"2018-03-08":1.383,"2018-03-07":1.3896,"2018-03-06":1.3883,"2018-03-05":1.3848,"2018-03-02":1.3769,"2018-03-01":1.3725,"2018-02-28":1.378,"2018-02-27":1.3882,"2018-02-26":1.3941,"2018-02-23":1.3971,"2018-02-22":1.3937,"2018-02-21":1.3979,"2018-02-20":1.4005,"2018-02-19":1.3994,"2018-02-16":1.404,"2018-02-15":1.4056,"2018-02-14":1.3961,"2018-02-13":1.3881,"2018-02-12":1.3809,"2018-02-09":1.3806,"2018-02-08":1.4004,"2018-02-07":1.3883,"2018-02-06":1.3908,"2018-02-05":1.4016,"2018-02-02":1.4125,"2018-02-01":1.4237,"2018-01-31":1.4221,"2018-01-30":1.4112,"2018-01-29":1.4063,"2018-01-26":1.4181,"2018-01-25":1.4302,"2018-01-24":1.4222,"2018-01-23":1.402,"2018-01-22":1.3969,"2018-01-19":1.3845,"2018-01-18":1.3882,"2018-01-17":1.3834,"2018-01-16":1.3775,"2018-01-15":1.3802,"2018-01-12":1.3689,"2018-01-11":1.3535,"2018-01-10":1.3533,"2018-01-09":1.3525,"2018-01-08":1.3581,"2018-01-05":1.3563,"2018-01-04":1.3552,"2018-01-03":1.3514,"2018-01-02":1.3579,"2017-12-29":1.351,"2017-12-28":1.3436,"2017-12-27":1.3399,"2017-12-22":1.3387,"2017-12-21":1.3354,"2017-12-20":1.3406,"2017-12-19":1.3349,"2017-12-18":1.3398,"2017-12-15":1.3317,"2017-12-14":1.3424,"2017-12-13":1.3363,"2017-12-12":1.3323,"2017-12-11":1.3362,"2017-12-08":1.3376,"2017-12-07":1.3417,"2017-12-06":1.3382,"2017-12-05":1.3457,"2017-12-04":1.3479,"2017-12-01":1.349,"2017-11-30":1.353,"2017-11-29":1.3412,"2017-11-28":1.3233,"2017-11-27":1.334,"2017-11-24":1.3351,"2017-11-23":1.3297,"2017-11-22":1.3283,"2017-11-21":1.323,"2017-11-20":1.3262,"2017-11-17":1.3207,"2017-11-16":1.3196,"2017-11-15":1.3163,"2017-11-14":1.3118,"2017-11-13":1.3112,"2017-11-10":1.322,"2017-11-09":1.3118,"2017-11-08":1.31,"2017-11-07":1.3141,"2017-11-06":1.3121,"2017-11-03":1.3067,"2017-11-02":1.3068,"2017-11-01":1.3257,"2017-10-31":1.328,"2017-10-30":1.3195,"2017-10-27":1.3112,"2017-10-26":1.3171,"2017-10-25":1.3253,"2017-10-24":1.3119,"2017-10-23":1.3185,"2017-10-20":1.319,"2017-10-19":1.3203,"2017-10-18":1.3171,"2017-10-17":1.3169,"2017-10-16":1.3282,"2017-10-13":1.3305,"2017-10-12":1.3165,"2017-10-11":1.3189,"2017-10-10":1.3219,"2017-10-09":1.3132,"2017-10-06":1.3058,"2017-10-05":1.3139,"2017-10-04":1.3277,"2017-10-03":1.3245,"2017-10-02":1.3276,"2017-09-29":1.3416,"2017-09-28":1.3444,"2017-09-27":1.3386,"2017-09-26":1.3417,"2017-09-25":1.3484,"2017-09-22":1.3527,"2017-09-21":1.3543,"2017-09-20":1.3567,"2017-09-19":1.3523,"2017-09-18":1.3557,"2017-09-15":1.3596,"2017-09-14":1.335,"2017-09-13":1.323,"2017-09-12":1.3263,"2017-09-11":1.3183,"2017-09-08":1.3184,"2017-09-07":1.3112,"2017-09-06":1.3071,"2017-09-05":1.3027,"2017-09-04":1.2957,"2017-09-01":1.2973,"2017-08-31":1.2886,"2017-08-30":1.292,"2017-08-29":1.2952,"2017-08-25":1.2877,"2017-08-24":1.2798,"2017-08-23":1.2796,"2017-08-22":1.2835,"2017-08-21":1.2904,"2017-08-18":1.2857,"2017-08-17":1.2891,"2017-08-16":1.2869,"2017-08-15":1.2854,"2017-08-14":1.2987,"2017-08-11":1.2977,"2017-08-10":1.299,"2017-08-09":1.2993,"2017-08-08":1.296,"2017-08-07":1.3023,"2017-08-04":1.3038,"2017-08-03":1.3144,"2017-08-02":1.3223,"2017-08-01":1.3229,"2017-07-31":1.3183,"2017-07-28":1.3119,"2017-07-27":1.3087,"2017-07-26":1.3056,"2017-07-25":1.305,"2017-07-24":1.3047,"2017-07-21":1.299,"2017-07-20":1.2989,"2017-07-19":1.3043,"2017-07-18":1.3018,"2017-07-17":1.3066,"2017-07-14":1.3086,"2017-07-13":1.2933,"2017-07-12":1.289,"2017-07-11":1.2844,"2017-07-10":1.2862,"2017-07-07":1.288,"2017-07-06":1.2947,"2017-07-05":1.2925,"2017-07-04":1.2929,"2017-07-03":1.2937,"2017-06-30":1.299,"2017-06-29":1.2995,"2017-06-28":1.2942,"2017-06-27":1.2777,"2017-06-26":1.2738,"2017-06-23":1.2738,"2017-06-22":1.2661,"2017-06-21":1.2664,"2017-06-20":1.2618,"2017-06-19":1.2758,"2017-06-16":1.2801,"2017-06-15":1.2761,"2017-06-14":1.2789,"2017-06-13":1.273,"2017-06-12":1.2673,"2017-06-09":1.2742,"2017-06-08":1.2947,"2017-06-07":1.2959,"2017-06-06":1.2895,"2017-06-05":1.293,"2017-06-02":1.2882,"2017-06-01":1.2903,"2017-05-31":1.2912,"2017-05-30":1.2862,"2017-05-26":1.2791,"2017-05-25":1.2947,"2017-05-24":1.295,"2017-05-23":1.298,"2017-05-22":1.3016,"2017-05-19":1.3026,"2017-05-18":1.2999,"2017-05-17":1.2972,"2017-05-16":1.2918,"2017-05-15":1.2918,"2017-05-12":1.289,"2017-05-11":1.2876,"2017-05-10":1.2949,"2017-05-09":1.2951,"2017-05-08":1.2941,"2017-05-05":1.2958,"2017-05-04":1.2915,"2017-05-03":1.2896,"2017-05-02":1.292,"2017-04-28":1.2938,"2017-04-27":1.2895,"2017-04-26":1.2858,"2017-04-25":1.2829,"2017-04-24":1.2777,"2017-04-21":1.2777,"2017-04-20":1.2841,"2017-04-19":1.2811,"2017-04-18":1.2765,"2017-04-13":1.2517,"2017-04-12":1.251,"2017-04-11":1.2489,"2017-04-10":1.2426,"2017-04-07":1.2392,"2017-04-06":1.2495,"2017-04-05":1.2477,"2017-04-04":1.2448,"2017-04-03":1.2483,"2017-03-31":1.2507,"2017-03-30":1.2489,"2017-03-29":1.2411,"2017-03-28":1.2536,"2017-03-27":1.257,"2017-03-24":1.249,"2017-03-23":1.2526,"2017-03-22":1.2476,"2017-03-21":1.2479,"2017-03-20":1.2366,"2017-03-17":1.2371,"2017-03-16":1.2368,"2017-03-15":1.2222,"2017-03-14":1.2167,"2017-03-13":1.2234,"2017-03-10":1.2167,"2017-03-09":1.215,"2017-03-08":1.2168,"2017-03-07":1.2194,"2017-03-06":1.2255,"2017-03-03":1.2261,"2017-03-02":1.2285,"2017-03-01":1.2317,"2017-02-28":1.2445,"2017-02-27":1.247,"2017-02-24":1.2489,"2017-02-23":1.2548,"2017-02-22":1.2458,"2017-02-21":1.2468,"2017-02-20":1.2473,"2017-02-17":1.2432,"2017-02-16":1.25,"2017-02-15":1.2447,"2017-02-14":1.2463,"2017-02-13":1.2503,"2017-02-10":1.2482,"2017-02-09":1.2528,"2017-02-08":1.2533,"2017-02-07":1.2429,"2017-02-06":1.2444,"2017-02-03":1.2505,"2017-02-02":1.253,"2017-02-01":1.2647,"2017-01-31":1.2589,"2017-01-30":1.2515,"2017-01-27":1.2553,"2017-01-26":1.2589,"2017-01-25":1.2605,"2017-01-24":1.2513,"2017-01-23":1.2495,"2017-01-20":1.2323,"2017-01-19":1.2304,"2017-01-18":1.2345,"2017-01-17":1.2385,"2017-01-16":1.2065,"2017-01-13":1.2184,"2017-01-12":1.2219,"2017-01-11":1.2071,"2017-01-10":1.2184,"2017-01-09":1.2147,"2017-01-06":1.2318,"2017-01-05":1.2425,"2017-01-04":1.2296,"2017-01-03":1.224,"2016-12-30":1.2303,"2016-12-29":1.2226,"2016-12-28":1.2227,"2016-12-23":1.2256,"2016-12-22":1.2298,"2016-12-21":1.2376,"2016-12-20":1.2353,"2016-12-19":1.2392,"2016-12-16":1.2434,"2016-12-15":1.2409,"2016-12-14":1.2701,"2016-12-13":1.2684,"2016-12-12":1.2669,"2016-12-09":1.2564,"2016-12-08":1.2555,"2016-12-07":1.2609,"2016-12-06":1.2712,"2016-12-05":1.2707,"2016-12-02":1.2658,"2016-12-01":1.2622,"2016-11-30":1.2497,"2016-11-29":1.2507,"2016-11-28":1.2412,"2016-11-25":1.2453,"2016-11-24":1.2464,"2016-11-23":1.2399,"2016-11-22":1.2422,"2016-11-21":1.2474,"2016-11-18":1.2312,"2016-11-17":1.2437,"2016-11-16":1.2423,"2016-11-15":1.2384,"2016-11-14":1.2453,"2016-11-11":1.2579,"2016-11-10":1.2486,"2016-11-09":1.2444,"2016-11-08":1.2407,"2016-11-07":1.2393,"2016-11-04":1.2545,"2016-11-03":1.2455,"2016-11-02":1.2315,"2016-11-01":1.222,"2016-10-31":1.2214,"2016-10-28":1.2145,"2016-10-27":1.2179,"2016-10-26":1.2239,"2016-10-25":1.2133,"2016-10-24":1.2205,"2016-10-21":1.2195,"2016-10-20":1.2244,"2016-10-19":1.2288,"2016-10-18":1.2302,"2016-10-17":1.2155,"2016-10-14":1.2195,"2016-10-13":1.2193,"2016-10-12":1.2183,"2016-10-11":1.2227,"2016-10-10":1.2377,"2016-10-07":1.2465,"2016-10-06":1.2646,"2016-10-05":1.2742,"2016-10-04":1.2754,"2016-10-03":1.2834,"2016-09-30":1.2991,"2016-09-29":1.2982,"2016-09-28":1.299,"2016-09-27":1.2987,"2016-09-26":1.2976,"2016-09-23":1.296,"2016-09-22":1.3094,"2016-09-21":1.2958,"2016-09-20":1.2949,"2016-09-19":1.3061,"2016-09-16":1.3079,"2016-09-15":1.3192,"2016-09-14":1.3176,"2016-09-13":1.3181,"2016-09-12":1.3303,"2016-09-09":1.3259,"2016-09-08":1.3316,"2016-09-07":1.334,"2016-09-06":1.343,"2016-09-05":1.3293,"2016-09-02":1.3309,"2016-09-01":1.3299,"2016-08-31":1.3099,"2016-08-30":1.3096,"2016-08-26":1.32,"2016-08-25":1.3189,"2016-08-24":1.325,"2016-08-23":1.3186,"2016-08-22":1.3146,"2016-08-19":1.3056,"2016-08-18":1.3162,"2016-08-17":1.3009,"2016-08-16":1.2967,"2016-08-15":1.2875,"2016-08-12":1.2935,"2016-08-11":1.2966,"2016-08-10":1.3014,"2016-08-09":1.2992,"2016-08-08":1.3038,"2016-08-05":1.3059,"2016-08-04":1.3128,"2016-08-03":1.3322,"2016-08-02":1.3306,"2016-08-01":1.3206,"2016-07-29":1.3267,"2016-07-28":1.312,"2016-07-27":1.3114,"2016-07-26":1.3116,"2016-07-25":1.3122,"2016-07-22":1.3085,"2016-07-21":1.3211,"2016-07-20":1.3175,"2016-07-19":1.3136,"2016-07-18":1.3286,"2016-07-15":1.3231,"2016-07-14":1.3323,"2016-07-13":1.3215,"2016-07-12":1.3186,"2016-07-11":1.2987,"2016-07-08":1.296,"2016-07-07":1.2932,"2016-07-06":1.2885,"2016-07-05":1.3048,"2016-07-04":1.3287,"2016-07-01":1.327,"2016-06-30":1.3429,"2016-06-29":1.3523,"2016-06-28":1.3322,"2016-06-27":1.3152,"2016-06-24":1.3621,"2016-06-23":1.4798,"2016-06-22":1.4687,"2016-06-21":1.467,"2016-06-20":1.4694,"2016-06-17":1.4293,"2016-06-16":1.4064,"2016-06-15":1.4196,"2016-06-14":1.4114,"2016-06-13":1.4282,"2016-06-10":1.4334,"2016-06-09":1.4465,"2016-06-08":1.4552,"2016-06-07":1.456,"2016-06-06":1.4464,"2016-06-03":1.4517,"2016-06-02":1.4447,"2016-06-01":1.4414,"2016-05-31":1.4557,"2016-05-27":1.4616,"2016-05-26":1.4682,"2016-05-25":1.4714,"2016-05-24":1.4609,"2016-05-23":1.4461,"2016-05-20":1.4515,"2016-05-19":1.4585,"2016-05-18":1.4617,"2016-05-17":1.4467,"2016-05-16":1.4405,"2016-05-13":1.4351,"2016-05-12":1.4503,"2016-05-11":1.4465,"2016-05-10":1.4462,"2016-05-09":1.4398,"2016-05-06":1.4432,"2016-05-05":1.4497,"2016-05-04":1.4482,"2016-05-03":1.4551,"2016-04-29":1.465,"2016-04-28":1.4571,"2016-04-27":1.4537,"2016-04-26":1.4584,"2016-04-25":1.45,"2016-04-22":1.4409,"2016-04-21":1.4338,"2016-04-20":1.4401,"2016-04-19":1.4402,"2016-04-18":1.4274,"2016-04-15":1.4178,"2016-04-14":1.414,"2016-04-13":1.4207,"2016-04-12":1.4208,"2016-04-11":1.4263,"2016-04-08":1.4106,"2016-04-07":1.4094,"2016-04-06":1.4086,"2016-04-05":1.4133,"2016-04-04":1.4291,"2016-04-01":1.4185,"2016-03-31":1.4378,"2016-03-30":1.4448,"2016-03-29":1.4266,"2016-03-24":1.4143,"2016-03-23":1.4111,"2016-03-22":1.4217,"2016-03-21":1.4402,"2016-03-18":1.4514,"2016-03-17":1.449,"2016-03-16":1.4099,"2016-03-15":1.4165,"2016-03-14":1.4323,"2016-03-11":1.4395,"2016-03-10":1.4307,"2016-03-09":1.4222,"2016-03-08":1.4211,"2016-03-07":1.4205,"2016-03-04":1.4216,"2016-03-03":1.4156,"2016-03-02":1.4064,"2016-03-01":1.3925,"2016-02-29":1.3929,"2016-02-26":1.3862,"2016-02-25":1.3949,"2016-02-24":1.3932,"2016-02-23":1.4105,"2016-02-22":1.4135,"2016-02-19":1.4266,"2016-02-18":1.4366,"2016-02-17":1.4314,"2016-02-16":1.4307,"2016-02-15":1.4455,"2016-02-12":1.4458,"2016-02-11":1.4435,"2016-02-10":1.446,"2016-02-09":1.4484,"2016-02-08":1.4368,"2016-02-05":1.4482,"2016-02-04":1.4578,"2016-02-03":1.4592,"2016-02-02":1.4376,"2016-02-01":1.4366,"2016-01-29":1.4187,"2016-01-28":1.4388,"2016-01-27":1.4258,"2016-01-26":1.4325,"2016-01-25":1.4267,"2016-01-22":1.4331,"2016-01-21":1.4135,"2016-01-20":1.4186,"2016-01-19":1.4144,"2016-01-18":1.427,"2016-01-15":1.4307,"2016-01-14":1.4393,"2016-01-13":1.4441,"2016-01-12":1.4366,"2016-01-11":1.4531,"2016-01-08":1.454,"2016-01-07":1.4566,"2016-01-06":1.4607,"2016-01-05":1.4647,"2016-01-04":1.4689,"2015-12-31":1.4819,"2015-12-30":1.4833,"2015-12-29":1.4795,"2015-12-24":1.4921,"2015-12-23":1.4868,"2015-12-22":1.4825,"2015-12-21":1.4886,"2015-12-18":1.4893,"2015-12-17":1.4882,"2015-12-16":1.5005,"2015-12-15":1.5048,"2015-12-14":1.5116,"2015-12-11":1.5211,"2015-12-10":1.5163,"2015-12-09":1.5182,"2015-12-08":1.4984,"2015-12-07":1.5071,"2015-12-04":1.5101,"2015-12-03":1.5036,"2015-12-02":1.4942,"2015-12-01":1.5054,"2015-11-30":1.5053,"2015-11-27":1.5053,"2015-11-26":1.5126,"2015-11-25":1.5068,"2015-11-24":1.5069,"2015-11-23":1.5131,"2015-11-20":1.5217,"2015-11-19":1.5295,"2015-11-18":1.5211,"2015-11-17":1.5217,"2015-11-16":1.5198,"2015-11-13":1.5196,"2015-11-12":1.5194,"2015-11-11":1.5201,"2015-11-10":1.511,"2015-11-09":1.5108,"2015-11-06":1.5077,"2015-11-05":1.525,"2015-11-04":1.5384,"2015-11-03":1.5399,"2015-11-02":1.5428,"2015-10-30":1.5443,"2015-10-29":1.5294,"2015-10-28":1.532,"2015-10-27":1.5312,"2015-10-26":1.5361,"2015-10-23":1.5352,"2015-10-22":1.5411,"2015-10-21":1.5459,"2015-10-20":1.546,"2015-10-19":1.548,"2015-10-16":1.5446,"2015-10-15":1.5459,"2015-10-14":1.5436,"2015-10-13":1.5224,"2015-10-12":1.5343,"2015-10-09":1.5308,"2015-10-08":1.5295,"2015-10-07":1.5313,"2015-10-06":1.5212,"2015-10-05":1.5179,"2015-10-02":1.52,"2015-10-01":1.5155,"2015-09-30":1.5147,"2015-09-29":1.5138,"2015-09-28":1.5175,"2015-09-25":1.5174,"2015-09-24":1.5284,"2015-09-23":1.5225,"2015-09-22":1.5344,"2015-09-21":1.5484,"2015-09-18":1.5585,"2015-09-17":1.552,"2015-09-16":1.5516,"2015-09-15":1.5357,"2015-09-14":1.5383,"2015-09-11":1.5402,"2015-09-10":1.5429,"2015-09-09":1.5368,"2015-09-08":1.5359,"2015-09-07":1.5267,"2015-09-04":1.5174,"2015-09-03":1.5228,"2015-09-02":1.5293,"2015-09-01":1.5325,"2015-08-28":1.5354,"2015-08-27":1.5373,"2015-08-26":1.5541,"2015-08-25":1.5697,"2015-08-24":1.5738,"2015-08-21":1.567,"2015-08-20":1.5663,"2015-08-19":1.5641,"2015-08-18":1.5653,"2015-08-17":1.5599,"2015-08-14":1.5607,"2015-08-13":1.5584,"2015-08-12":1.5638,"2015-08-11":1.5569,"2015-08-10":1.5544,"2015-08-07":1.5471,"2015-08-06":1.5503,"2015-08-05":1.5606,"2015-08-04":1.5598,"2015-08-03":1.5619,"2015-07-31":1.5606,"2015-07-30":1.5609,"2015-07-29":1.565,"2015-07-28":1.558,"2015-07-27":1.5578,"2015-07-24":1.5505,"2015-07-23":1.5528,"2015-07-22":1.5631,"2015-07-21":1.5561,"2015-07-20":1.5592,"2015-07-17":1.5633,"2015-07-16":1.5592,"2015-07-15":1.5616,"2015-07-14":1.557,"2015-07-13":1.5526,"2015-07-10":1.5508,"2015-07-09":1.5387,"2015-07-08":1.5353,"2015-07-07":1.5419,"2015-07-06":1.5602,"2015-07-03":1.5605,"2015-07-02":1.5605,"2015-07-01":1.5633,"2015-06-30":1.5729,"2015-06-29":1.5744,"2015-06-26":1.5729,"2015-06-25":1.5724,"2015-06-24":1.572,"2015-06-23":1.5729,"2015-06-22":1.5819,"2015-06-19":1.5884,"2015-06-18":1.5881,"2015-06-17":1.571,"2015-06-16":1.5627,"2015-06-15":1.5542,"2015-06-12":1.5568,"2015-06-11":1.5493,"2015-06-10":1.5541,"2015-06-09":1.5317,"2015-06-08":1.5274,"2015-06-05":1.5241,"2015-06-04":1.5365,"2015-06-03":1.5331,"2015-06-02":1.5329,"2015-06-01":1.5207,"2015-05-29":1.5261,"2015-05-28":1.5292,"2015-05-27":1.5332,"2015-05-26":1.5384,"2015-05-22":1.5501,"2015-05-21":1.5666,"2015-05-20":1.5556,"2015-05-19":1.5507,"2015-05-18":1.5682,"2015-05-15":1.5789,"2015-05-14":1.5759,"2015-05-13":1.5729,"2015-05-12":1.5663,"2015-05-11":1.5562,"2015-05-08":1.5422,"2015-05-07":1.52,"2015-05-06":1.5248,"2015-05-05":1.5193,"2015-05-01":1.5177,"2015-04-30":1.5368,"2015-04-29":1.5454,"2015-04-28":1.5324,"2015-04-27":1.5211,"2015-04-24":1.5165,"2015-04-23":1.5054,"2015-04-22":1.5036,"2015-04-21":1.4933,"2015-04-20":1.4915,"2015-04-17":1.4961,"2015-04-16":1.4899,"2015-04-15":1.4766,"2015-04-14":1.479,"2015-04-13":1.4642,"2015-04-10":1.4651,"2015-04-09":1.4737,"2015-04-08":1.4924,"2015-04-07":1.4868,"2015-04-02":1.4828,"2015-04-01":1.4816,"2015-03-31":1.4847,"2015-03-30":1.4806,"2015-03-27":1.4878,"2015-03-26":1.4843,"2015-03-25":1.4915,"2015-03-24":1.4868,"2015-03-23":1.4936,"2015-03-20":1.4922,"2015-03-19":1.4727,"2015-03-18":1.4686,"2015-03-17":1.4743,"2015-03-16":1.48,"2015-03-13":1.4755,"2015-03-12":1.4905,"2015-03-11":1.4945,"2015-03-10":1.5085,"2015-03-09":1.5096,"2015-03-06":1.5061,"2015-03-05":1.5237,"2015-03-04":1.5269,"2015-03-03":1.5372,"2015-03-02":1.5362,"2015-02-27":1.5451,"2015-02-26":1.541,"2015-02-25":1.5488,"2015-02-24":1.5459,"2015-02-23":1.5449,"2015-02-20":1.5374,"2015-02-19":1.5439,"2015-02-18":1.5447,"2015-02-17":1.5336,"2015-02-16":1.5379,"2015-02-13":1.5393,"2015-02-12":1.5363,"2015-02-11":1.5266,"2015-02-10":1.526,"2015-02-09":1.524,"2015-02-06":1.5269,"2015-02-05":1.5286,"2015-02-04":1.5215,"2015-02-03":1.5114,"2015-02-02":1.5035,"2015-01-30":1.5018,"2015-01-29":1.5077,"2015-01-28":1.5179,"2015-01-27":1.5205,"2015-01-26":1.5051,"2015-01-23":1.5026,"2015-01-22":1.5086,"2015-01-21":1.5116,"2015-01-20":1.5195,"2015-01-19":1.5158,"2015-01-16":1.5113};console.log("Initializing exchange rates..."),ui({yearlyAverages:{"2025_2026":{USD:1.339226,EUR:1.1543,GBP:1},"2024_2025":{USD:1.276869,EUR:1.1543,GBP:1},"2023_2024":{USD:1.257033,EUR:1.1543,GBP:1},"2022_2023":{USD:1.203732,EUR:1.1543,GBP:1},"2021_2022":{USD:1.365519,EUR:1.1543,GBP:1},"2020_2021":{USD:1.309788,EUR:1.1543,GBP:1},"2019_2020":{USD:1.26959,EUR:1.1543,GBP:1},"2018_2019":{USD:1.311875,EUR:1.1543,GBP:1},"2017_2018":{USD:1.329196,EUR:1.1543,GBP:1},"2016_2017":{USD:1.304676,EUR:1.1543,GBP:1},"2015_2016":{USD:1.507353,EUR:1.1543,GBP:1},"2014_2015":{USD:1.511998,EUR:1.1543,GBP:1}}}),console.log(`Loading ${Object.keys(tr).length} daily exchange rates...`);for(const[dr,ur]of Object.entries(tr))wi(dr,"USD",ur);console.log("Exchange rates initialized successfully");class nr{constructor(e){t(this,"onFilesSelected"),t(this,"selectedFiles",[]),this.onFilesSelected=e}render(){return'\n      <div id="file-upload-container" class="bg-white rounded-lg shadow-md p-6 mb-2 animate-fade-in">\n        <div \n          id="drop-zone"\n          class="border-2 border-dashed border-gray-300 rounded-lg p-12 text-center\n                 hover:border-primary-500 hover:bg-primary-50 transition-all duration-200\n                 cursor-pointer"\n        >\n          <svg class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" \n                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />\n          </svg>\n          <p class="mt-4 text-lg font-medium text-gray-900">\n            Drop IBKR CSV or Corp Actions JSON\n          </p>\n          <p class="mt-2 text-sm text-gray-500">\n            or click to browse\n          </p>\n          <p class="mt-4 text-xs text-gray-400">\n            Supports IBKR Activity Flex Query CSV and Corp Actions JSON\n          </p>\n          <input \n            type="file" \n            id="file-input" \n            multiple \n            multiple \n            accept=".csv,.json"\n            class="hidden"\n          >\n        </div>\n        \n        <div id="file-list" class="mt-4"></div>\n      </div>\n    '}attachEventListeners(){const e=document.getElementById("drop-zone"),t=document.getElementById("file-input");e&&t&&(e.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),e.classList.add("drop-zone-active")}),e.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("drop-zone-active")}),e.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("drop-zone-active");const n=Array.from(t.dataTransfer?.files||[]);this.handleFiles(n)}),e.addEventListener("click",()=>t.click()),t.addEventListener("change",()=>{const e=Array.from(t.files||[]);this.handleFiles(e)}))}handleFiles(e){const t=e.filter(e=>{const t=e.name.toLowerCase();return t.endsWith(".csv")||t.endsWith(".json")});0!==t.length?(this.selectedFiles=t,this.onFilesSelected(t)):this.showError("Please select valid files (.csv or .json)")}displayFileList(){const e=document.getElementById("file-list"),t=document.getElementById("drop-zone");if(!e||!t)return;if(0===this.selectedFiles.length)return e.innerHTML="",t.classList.remove("hidden"),void e.classList.add("mt-4");t.classList.add("hidden"),e.classList.remove("mt-4"),e.innerHTML=`\n      <h2 class="text-xl font-bold text-gray-900 mb-4">Uploaded Files</h2>\n      <div class="bg-gray-50 rounded-lg p-4">\n        <div class="flex items-center justify-between">\n            <button \n                id="toggle-files-btn"\n                class="flex items-center text-sm font-medium text-gray-900 hover:text-gray-700 focus:outline-none"\n            >\n                <svg \n                    id="files-chevron"\n                    class="h-4 w-4 mr-2 text-gray-500 transform -rotate-90 transition-transform duration-200" \n                    fill="none" \n                    viewBox="0 0 24 24" \n                    stroke="currentColor"\n                >\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />\n                </svg>\n                Selected files (${this.selectedFiles.length})\n            </button>\n            \n            <button \n              id="clear-files-btn"\n              class="inline-flex items-center px-2 py-1 border border-transparent text-xs font-medium rounded text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors"\n            >\n              Clear files\n            </button>\n        </div>\n        \n        <div id="file-list-content" class="hidden mt-3 pl-6 border-l-2 border-gray-200">\n            <ul class="space-y-2">\n              ${this.selectedFiles.map(e=>`\n                <li class="text-sm text-gray-600 flex items-center">\n                  <svg class="h-4 w-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">\n                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>\n                  </svg>\n                  ${e.name} <span class="text-gray-400 ml-2">(${this.formatFileSize(e.size)})</span>\n                </li>\n              `).join("")}\n            </ul>\n        </div>\n      </div>\n    `;const n=document.getElementById("toggle-files-btn"),s=document.getElementById("file-list-content"),i=document.getElementById("files-chevron");n?.addEventListener("click",()=>{const e=s?.classList.contains("hidden");e?(s?.classList.remove("hidden"),s?.classList.add("animate-slide-down"),i?.classList.remove("-rotate-90")):(s?.classList.add("hidden"),i?.classList.add("-rotate-90"))}),document.getElementById("clear-files-btn")?.addEventListener("click",()=>{this.selectedFiles=[],this.displayFileList(),this.onFilesSelected([]).catch(console.error);const e=document.getElementById("file-input");e&&(e.value="")})}showFileList(){this.displayFileList()}hideDropZone(){const e=document.getElementById("file-upload-container");e&&e.classList.add("hidden")}showDropZone(){const e=document.getElementById("file-upload-container");e&&0===this.selectedFiles.length&&e.classList.remove("hidden")}formatFileSize(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}showError(e){const t=document.getElementById("file-list");t&&(t.innerHTML=`\n      <div class="bg-red-50 border border-red-200 rounded-lg p-4">\n        <p class="text-sm text-red-800">${e}</p>\n      </div>\n    `)}}class sr{constructor(){t(this,"isVisible",!1),t(this,"message",""),t(this,"progress",0)}render(){return'<div id="progress-container"></div>'}show(e="Processing..."){this.isVisible=!0,this.message=e,this.progress=0,this.update(0)}update(e,t){this.progress=Math.min(100,Math.max(0,e)),t&&(this.message=t);const n=document.getElementById("progress-container");if(!n)return;if(!this.isVisible)return void(n.innerHTML="");const s=document.getElementById("progress-bar-fill"),i=document.getElementById("progress-message"),r=document.getElementById("progress-percent");s&&i&&r?(s.style.width=`${this.progress}%`,i.textContent=this.message,r.textContent=`${Math.round(this.progress)}%`):this.renderContent(n)}renderContent(e){e.innerHTML=`\n      <div class="mb-2 bg-white rounded-lg shadow-md p-6 animate-slide-up">\n        <div class="flex items-center justify-between mb-2">\n          <span id="progress-message" class="text-sm font-medium text-gray-700">${this.message}</span>\n          <span id="progress-percent" class="text-sm text-gray-500">${Math.round(this.progress)}%</span>\n        </div>\n        <div class="w-full bg-gray-200 rounded-full h-2.5">\n          <div \n            id="progress-bar-fill"\n            class="bg-brand-blue h-2.5 rounded-full transition-all duration-300"\n            style="width: ${this.progress}%"\n          ></div>\n        </div>\n        <div class="mt-4 flex justify-center">\n          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"></div>\n        </div>\n      </div>\n    `}hide(){this.isVisible=!1;const e=document.getElementById("progress-container");e&&(e.innerHTML="")}}class ir{constructor(){t(this,"results",null)}formatCurrency(e){return("string"==typeof e?parseFloat(e):e).toLocaleString("en-GB",{minimumFractionDigits:2,maximumFractionDigits:2})}formatDescription(e){return e.replace(/\((\w{3})\s+([\d.]+)\)/g,(e,t,n)=>`(${t} ${parseFloat(n).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})})`)}formatDate(e){return new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}render(){return'<div id="results-container"></div>'}display(e){this.results=e;const t=document.getElementById("results-container");t&&(t.innerHTML=`\n      <div class="mt-2 space-y-6 animate-fade-in">\n        ${this.renderSummary()}\n      </div>\n    `)}clear(){this.results=null;const e=document.getElementById("results-container");e&&(e.innerHTML="")}displayError(e){const t=document.getElementById("results-container");t&&(t.innerHTML=`\n      <div class="bg-red-50 border border-red-200 rounded-lg p-6 animate-slide-up">\n        <div class="flex items-start">\n          <svg class="h-6 w-6 text-red-600 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" \n                  d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n          </svg>\n          <div class="ml-3">\n            <h3 class="text-lg font-medium text-red-800">Error Processing Files</h3>\n            <p class="mt-2 text-sm text-red-700">${e.message}</p>\n            <p class="mt-2 text-xs text-red-600">\n              Please ensure you're using valid IBKR Activity Flex Query CSV files.\n            </p>\n          </div>\n        </div>\n      </div>\n    `)}renderSummary(){if(!this.results)return"";const{summary:e,dateRange:t,actualDateRange:n,warnings:s}=this.results,i=s&&s.length>0?`<div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">\n            <div class="flex">\n                <div class="flex-shrink-0">\n                    <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">\n                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />\n                    </svg>\n                </div>\n                <div class="ml-3">\n                    <h3 class="text-sm font-medium text-yellow-800">Compliance Warning</h3>\n                    <div class="mt-2 text-sm text-yellow-700">\n                        <ul class="list-disc list-inside space-y-1">\n                            ${s.map(e=>`<li>${e}</li>`).join("")}\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </div>`:"",r=t&&t.fromDate&&t.toDate?`Period: ${t.fromDate} to ${t.toDate}`:n?`Period: All Transactions (${this.formatDate(n.fromDate)} - ${this.formatDate(n.toDate)})`:"Period: All Transactions",{totalGains:o,totalLosses:a,netCGT:l}=e;return`\n      <div class="bg-white rounded-lg shadow-md p-6 mb-2">\n        <h2 class="text-2xl font-bold text-gray-900 mb-2">Summary Report</h2>\n        ${i}\n        <p class="text-sm text-gray-500 mb-6">${r}</p>\n        \n        \x3c!-- Totals Cards --\x3e\n        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">\n            <div class="bg-green-50 border border-green-200 rounded p-4">\n                <div class="text-xs font-semibold text-green-800 uppercase tracking-wide">Total Gains (Tax Return)</div>\n                <div class="text-xl font-bold text-green-700 mt-1">£${this.formatCurrency(o)}</div>\n                <div class="text-xs text-green-600 mt-1">Gross Gains</div>\n            </div>\n            \n             <div class="bg-red-50 border border-red-200 rounded p-4">\n                <div class="text-xs font-semibold text-red-800 uppercase tracking-wide">Total Losses (Tax Return)</div>\n                <div class="text-xl font-bold text-red-700 mt-1">£${this.formatCurrency(a)}</div>\n                <div class="text-xs text-red-600 mt-1">Gross Losses</div>\n            </div>\n\n            <div class="bg-blue-50 border border-blue-200 rounded p-4">\n                <div class="text-xs font-semibold text-blue-800 uppercase tracking-wide">Net CGT Result</div>\n                <div class="text-xl font-bold ${l>=0?"text-blue-700":"text-red-700"} mt-1">£${this.formatCurrency(l)}</div>\n                <div class="text-xs text-blue-600 mt-1">Net Result</div>\n            </div>\n        </div>\n\n        <div class="overflow-x-auto">\n          <table class="min-w-full divide-y divide-gray-200">\n            <thead class="bg-brand-blue">\n              <tr>\n                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Section</th>\n                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Category</th>\n                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Description</th>\n                <th class="px-6 py-3 text-right text-xs font-medium text-white uppercase tracking-wider">Proceeds</th>\n                <th class="px-6 py-3 text-right text-xs font-medium text-white uppercase tracking-wider">Cost</th>\n                <th class="px-6 py-3 text-right text-xs font-medium text-white uppercase tracking-wider">Net</th>\n              </tr>\n            </thead>\n            <tbody class="bg-white divide-y divide-gray-200">\n              ${e.rows.map(e=>{const t=parseFloat(e["Net Gain / Income (GBP)"]),n=t>=0?"text-green-600":"text-red-600";return`\n                <tr class="hover:bg-gray-50">\n                  <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900">${e.Section}</td>\n                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${e.Category}</td>\n                  <td class="px-6 py-4 text-sm text-gray-700">${this.formatDescription(e.Description)}</td>\n                  <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">£${this.formatCurrency(e["Gross / Proceeds (GBP)"])}</td>\n                  <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">£${this.formatCurrency(e["Cost / Expense (GBP)"])}</td>\n                  <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-medium ${n}">\n                    £${this.formatCurrency(t)}\n                  </td>\n                </tr>\n              `}).join("")}\n            </tbody>\n          </table>\n        </div>\n\n      </div>\n    `}}class rr{constructor(e){t(this,"dateRange",{fromDate:null,toDate:null,taxYear:null}),t(this,"onDateRangeChange"),t(this,"actualDateRange"),this.onDateRangeChange=e}render(){return`\n      <div class="bg-white rounded-lg shadow-md p-6 mb-8 animate-fade-in">\n        <h2 class="text-2xl font-bold text-gray-900 mb-4">Select Tax Period</h2>\n        \n        <div>\n          \x3c!-- Tax Year Selector --\x3e\n          <div>\n            <label class="block text-sm font-medium text-gray-700 mb-2">\n              UK Tax Year\n            </label>\n            <select \n              id="tax-year-select" \n              class="w-full pl-4 pr-12 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"\n            >\n              <option value=""${null===this.dateRange.taxYear||""===this.dateRange.taxYear?" selected":""}>${this.actualDateRange?`All Transactions (${this.formatDate(this.actualDateRange.fromDate)} - ${this.formatDate(this.actualDateRange.toDate)})`:"All Transactions"}</option>\n              ${this.generateTaxYearOptions()}\n            </select>\n          </div>\n        </div>\n\n        <div class="mt-4 p-3 bg-blue-50 rounded-lg">\n          <p class="text-sm text-blue-800">\n            <strong>Note:</strong> UK tax year runs from 6 April to 5 April of the following year. Select a tax year to filter your transactions.\n          </p>\n        </div>\n      </div>\n    `}attachEventListeners(){const e=document.getElementById("tax-year-select");e&&e.addEventListener("change",()=>{const t=e.value;if(this.dateRange.taxYear=t||null,this.dateRange.fromDate=null,this.dateRange.toDate=null,t){const e=this.getTaxYearDates(t);this.dateRange.fromDate=e.from,this.dateRange.toDate=e.toDate}this.onDateRangeChange(this.dateRange)})}getTaxYearDates(e){const[t]=e.split("_").map(Number);return{from:`${t}-04-06`,toDate:`${t+1}-04-05`}}getDateRange(){return this.dateRange}setActualDateRange(e){this.actualDateRange=e}formatDate(e){return new Date(e).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})}generateTaxYearOptions(){if(!this.actualDateRange)return this.getAllTaxYearOptions();const e=new Date(this.actualDateRange.fromDate),t=new Date(this.actualDateRange.toDate),n=this.getTaxYearFromDate(e),s=[];for(let i=this.getTaxYearFromDate(t);i>=n;i--){const e=`${i}_${i+1}`,t=`${i}-${i+1} (6 Apr ${i} - 5 Apr ${i+1})`,n=this.dateRange.taxYear===e?" selected":"";s.push(`<option value="${e}"${n}>${t}</option>`)}return s.join("\n              ")}getAllTaxYearOptions(){const e=[];for(let t=2025;t>=2018;t--){const n=`${t}_${t+1}`,s=`${t}-${t+1} (6 Apr ${t} - 5 Apr ${t+1})`,i=this.dateRange.taxYear===n?" selected":"";e.push(`<option value="${n}"${i}>${s}</option>`)}return e.join("\n              ")}getTaxYearFromDate(e){const t=e.getFullYear(),n=e.getMonth(),s=e.getDate();return n<3||3===n&&s<6?t-1:t}}class or{constructor(e){t(this,"activeTab","quick"),t(this,"activeHowItWorksSection","faq"),t(this,"onClose"),this.onClose=e}render(){return`\n      <div class="documentation-container bg-white shadow-sm rounded-lg">\n        <div class="sticky top-0 bg-white border-b border-gray-200 z-10">\n          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">\n            <div class="flex items-center justify-between">\n              <h2 class="text-2xl font-bold text-gray-900">Documentation</h2>\n              <button id="close-docs" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-uk-red hover:bg-uk-red-light focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-uk-red transition-colors">\n                ← Back to Calculator\n              </button>\n            </div>\n            <div class="mt-4 border-b border-gray-200">\n              <nav class="-mb-px flex space-x-8">\n                <button id="tab-quick" class="doc-tab ${"quick"===this.activeTab?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-brand-blue hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">\n                  Quick Setup Guide\n                </button>\n                <button id="tab-detailed" class="doc-tab ${"detailed"===this.activeTab?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-brand-blue hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">\n                  Detailed Configuration\n                </button>\n                <button id="tab-how-it-works" class="doc-tab ${"howItWorks"===this.activeTab?"border-brand-blue text-brand-blue":"border-transparent text-gray-500 hover:text-brand-blue hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">\n                  How It Works\n                </button>\n              </nav>\n            </div>\n          </div>\n        </div>\n\n        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">\n          <div id="tab-content-quick" class="${"quick"===this.activeTab?"":"hidden"}">\n            ${this.renderQuickGuide()}\n          </div>\n          <div id="tab-content-detailed" class="${"detailed"===this.activeTab?"":"hidden"}">\n            ${this.renderDetailedGuide()}\n          </div>\n          <div id="tab-content-how-it-works" class="${"howItWorks"===this.activeTab?"":"hidden"}">\n            ${this.renderHowItWorks()}\n          </div>\n        </div>\n      </div>\n    `}renderQuickGuide(){return`\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-xl font-semibold text-gray-900 mb-4">Overview</h3>\n        <p class="text-gray-700 mb-6">\n          To use this calculator, you need to generate a CSV file from Interactive Brokers using an <strong>Activity Flex Query</strong>. \n          This guide will walk you through the exact configuration required.\n        </p>\n\n        ${this.renderCallout("error","COMPLIANCE WARNING: GBP BASE CURRENCY REQUIRED","\n          This calculator is designed for users with a <strong>GBP primary functional currency</strong> on their IBKR account. \n          HMRC rules require reporting in Sterling. The calculator relies on IBKR's <code>FxRateToBase</code> to convert trades. \n          If your base currency is USD/EUR, these rates will be incorrect.\n        ")}\n\n        ${this.renderCallout("info","IMPORTANT: ENABLE ALL SECTIONS","\n          The parser supports <strong>9 distinct sections</strong> from the Flex Query. \n          To ensure 100% data accuracy for tax calculations, you must enable all relevant sections.\n        ")}\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Step 1: Create a New Flex Query</h3>\n        <ol class="list-decimal list-inside space-y-2 text-gray-700 mb-6">\n          <li>Log in to your IBKR Client Portal</li>\n          <li>Navigate to <strong>Reports</strong> → <strong>Flex Queries</strong></li>\n          <li>Click <strong>Create</strong> → <strong>Activity Flex Query</strong></li>\n          <li>Give it a name (e.g., "UK Tax Compliance")</li>\n        </ol>\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Step 2: General Settings</h3>\n        <div class="bg-gray-50 rounded-lg p-4 mb-6">\n          <ul class="space-y-2 text-gray-700">\n            <li><strong>Format:</strong> CSV</li>\n            <li><strong>Period:</strong> Last Business Day (or specific date range)</li>\n            <li><strong>Include header and trailer records:</strong> No</li>\n            <li><strong>Include column headers:</strong> Yes</li>\n            <li><strong>Section code and line descriptor:</strong> No</li>\n            <li><strong>Date Format:</strong> yyyy-MM-dd (or dd-MMM-yy)</li>\n            <li><strong>Time Format:</strong> HH:mm:ss</li>\n            <li><strong>Date/Time Separator:</strong> ; (semi-colon) or space</li>\n          </ul>\n        </div>\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Step 3: Enable Required Sections</h3>\n        <p class="text-gray-700 mb-4">\n          You must enable the following sections and check <strong>ALL</strong> listed fields for each:\n        </p>\n\n        <div class="space-y-6">\n          ${this.renderSectionCard("1. Trades","Essential for all buy/sell transactions",["ClientAccountID","Symbol","Date/Time","Quantity","TradePrice","Proceeds","Buy/Sell","TransactionType","Asset Class","IBCommission","IBCommissionCurrency","NetCash","Code (or Notes/Codes)","Open/CloseIndicator","Multiplier","Strike","Expiry","Put/Call","Conid"],"required")}\n\n          ${this.renderSectionCard("2. Corporate Actions","Handles splits, spinoffs, and mergers",["ClientAccountID","ActionDescription","ActionID","LevelOfDetail","Type","Quantity","Value","Proceeds","Date/Time","Symbol","Asset Class","Conid"],"required")}\n\n          ${this.renderSectionCard("3. Forex P/L Details","Primary source for accurate Realized Forex P/L",["ClientAccountID","FXCurrency","ActivityDescription","DateTime (or Date)","Quantity","Proceeds","Cost","RealizedP/L","Code","LevelOfDetail"],"required")}\n\n          ${this.renderSectionCard("4. Option Exercises, Assignments & Expirations","Critical for accurately closing option positions",["ClientAccountID","Date (or Date/Time)","Symbol","TransactionType","Quantity","TradePrice","Proceeds","Comm/Tax","Basis","FifoPnlRealized","CurrencyPrimary","AssetClass","Conid"],"required-options")}\n\n          ${this.renderSectionCard("5. Cash Transactions","Dividends, Interest, and Withholding Tax",["ClientAccountID","Type","Amount","Description","Date/Time","SettleDate","CurrencyPrimary","Conid","TransactionID","ActionID (Optional)"],"required")}\n\n          ${this.renderSectionCard("6. Open Positions","Critical for Spin-off Pricing. Required for auto-calculation of corporate action costs.",["ClientAccountID","Symbol","ReportDate","Quantity","MarkPrice","PositionValue","CostBasisPrice","CostBasisMoney","FifoPnlUnrealized","CurrencyPrimary","AssetClass","Conid"],"required")}\n\n          ${this.renderSectionCard("7. Transaction Fees","For capturing separate fee records",["ClientAccountID","Date","TaxDescription","TaxAmount","CurrencyPrimary","AssetClass"],"recommended")}\n\n          ${this.renderSectionCard("8. Complex Positions","For multi-leg option strategy details",["ClientAccountID","Symbol","ReportDate","Quantity","ClosePrice","MtmPnl","Value"],"optional")}\n\n          ${this.renderSectionCard("9. Pending Exercises","For forward-looking exercise data",["ClientAccountID","Symbol","ReportDate","TradeDate","Quantity","Type"],"optional")}\n        </div>\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Step 4: Generate and Download CSV</h3>\n        <ol class="list-decimal list-inside space-y-2 text-gray-700 mb-6">\n          <li>Save your Flex Query configuration</li>\n          <li>Run the query for your desired date range</li>\n          <li>Download the CSV file</li>\n          <li>Upload it to this calculator</li>\n        </ol>\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Screenshots</h3>\n        <div class="space-y-4">\n          <div>\n            <img src="/docs/Activity_Flex_Query_Details_1.png" alt="IBKR Activity Flex Query Configuration - Part 1" class="border border-gray-300 rounded-lg shadow-sm w-full">\n            <p class="text-base text-gray-600 mt-2 text-center">Activity Flex Query Configuration - Part 1</p>\n          </div>\n          <div>\n            <img src="/docs/Activity_Flex_Query_Details_2.png" alt="IBKR Activity Flex Query Configuration - Part 2" class="border border-gray-300 rounded-lg shadow-sm w-full">\n            <p class="text-base text-gray-600 mt-2 text-center">Activity Flex Query Configuration - Part 2</p>\n          </div>\n        </div>\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Troubleshooting</h3>\n        ${this.renderCallout("warning","UNSUPPORTED CSV FORMAT ERROR?","\n          Ensure <code>ClientAccountID</code> is the first column in every section.\n        ")}\n\n        ${this.renderCallout("info","MISSING SECTIONS",'\n          If a section is empty in the CSV, the parser will simply skip it. \n          However, if you trade options, you <em>must</em> enable the "Option Exercises..." section.\n        ')}\n      </div>\n    `}renderSectionCard(e,t,n,s){return`\n      <div class="border border-gray-200 rounded-lg p-4">\n        <div class="flex items-start justify-between mb-2">\n          <h4 class="text-lg font-semibold text-gray-900">${e}</h4>\n          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${{required:"bg-red-100 text-red-800","required-options":"bg-orange-100 text-orange-800",recommended:"bg-blue-100 text-blue-800",optional:"bg-gray-100 text-gray-800"}[s]}">\n            ${{required:"Required","required-options":"Required for Options",recommended:"Recommended",optional:"Optional"}[s]}\n          </span>\n        </div>\n        <p class="text-base text-gray-600 mb-3">${t}</p>\n        <div class="bg-gray-50 rounded p-3">\n          <p class="text-sm font-semibold text-gray-700 mb-2">Required Fields:</p>\n          <ul class="grid grid-cols-1 sm:grid-cols-2 gap-1 text-sm text-gray-600">\n            ${n.map(e=>`<li class="flex items-center"><span class="text-green-600 mr-1">✓</span>${e}</li>`).join("")}\n          </ul>\n        </div>\n      </div>\n    `}renderDetailedGuide(){return`\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-xl font-semibold text-gray-900 mb-4">IBKR Flex Query Configuration Analysis</h3>\n        \n        ${this.renderCallout("note","Technical Reference","\n          This document provides a comprehensive analysis of the IBKR Activity Flex Query configuration based on actual CSV file examination. \n          This is the complete technical reference for advanced users.\n        ")}\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Flex Query Configuration Overview</h3>\n        <div class="bg-white border border-gray-200 rounded-lg p-4 mb-6">\n          <dl class="grid grid-cols-1 gap-x-4 gap-y-3 sm:grid-cols-2">\n            <div>\n              <dt class="text-sm font-medium text-gray-500">Query Name</dt>\n              <dd class="mt-1 text-sm text-gray-900">For calculating Capital Gains Tax</dd>\n            </div>\n            <div>\n              <dt class="text-sm font-medium text-gray-500">Format</dt>\n              <dd class="mt-1 text-sm text-gray-900">CSV</dd>\n            </div>\n            <div>\n              <dt class="text-sm font-medium text-gray-500">Period</dt>\n              <dd class="mt-1 text-sm text-gray-900">Last Business Day</dd>\n            </div>\n            <div>\n              <dt class="text-sm font-medium text-gray-500">Date Format</dt>\n              <dd class="mt-1 text-sm text-gray-900">dd-MMM-yy</dd>\n            </div>\n            <div>\n              <dt class="text-sm font-medium text-gray-500">Time Format</dt>\n              <dd class="mt-1 text-sm text-gray-900">HH:mm:ss TimeZone</dd>\n            </div>\n            <div>\n              <dt class="text-sm font-medium text-gray-500">Date/Time Separator</dt>\n              <dd class="mt-1 text-sm text-gray-900">; (semi-colon)</dd>\n            </div>\n          </dl>\n        </div>\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">General Settings</h3>\n        <ul class="list-disc list-inside space-y-1 text-gray-700 mb-6">\n          <li>Include header and trailer records: <strong>No</strong></li>\n          <li>Include column headers: <strong>Yes</strong></li>\n          <li>Display single column header row: <strong>No</strong></li>\n          <li>Include section code and line descriptor: <strong>No</strong></li>\n          <li>Profit and Loss: <strong>Default</strong></li>\n          <li>Include Canceled Trades: <strong>No</strong></li>\n          <li>Include Currency Rates: <strong>Yes</strong></li>\n          <li>Include Audit Trail Fields: <strong>No</strong></li>\n          <li>Display Account Alias in Place of Account ID: <strong>No</strong></li>\n          <li>Breakout by Day: <strong>No</strong></li>\n        </ul>\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Enabled Sections (9 Total)</h3>\n        <p class="text-gray-700 mb-6">\n          The Flex Query exports <strong>9 distinct sections</strong>, each with its own header row. \n          Below is the complete field list for each section.\n        </p>\n\n        ${this.renderDetailedSection("1. Open Positions",50,["Account ID","Account Alias","Model","Currency","FXRateToBase","Asset Class","Sub Category","Symbol","Description","Conid","Security ID","Security ID Type","CUSIP","ISIN","FIGI","Listing Exchange","Underlying Conid","Underlying Symbol","Underlying Security ID","Underlying Listing Exchange","Issuer","Issuer Country Code","Multiplier","Strike","Expiry","Put/Call","Principal Adjust Factor","Report Date","Quantity","Mark Price","Position Value","Open Price","Cost Basis Price","Cost Basis Money","Percent of NAV","Unrealized P/L","Side","Level of Detail","Open Date Time","Holding Period Date Time (Wash Sales)","Vesting Date","Code","Originating Order ID","Originating Transaction ID","Accrued Interest","Serial Number","Delivery Type","Commodity Type","Fineness","Weight"])}\n\n        ${this.renderDetailedSection("2. Complex Positions",34,["Account ID","Account Alias","Asset Class","Sub Category","Symbol","Description","Conid","Security ID","Security ID Type","CUSIP","ISIN","FIGI","Listing Exchange","Underlying Conid","Underlying Symbol","Underlying Security ID","Underlying Listing Exchange","Issuer","Issuer Country Code","Multiplier","Strike","Expiry","Put/Call","Principal Adjust Factor","Quantity","Close Price","Value","MTM PNL","Level of Detail","Serial Number","Delivery Type","Commodity Type","Fineness","Weight"])}\n\n        ${this.renderDetailedSection("3. Trades",85,["Account ID","Account Alias","Model","Currency","FXRateToBase","Asset Class","Sub Category","Symbol","Description","Conid","Security ID","Security ID Type","CUSIP","ISIN","FIGI","Listing Exchange","Underlying Conid","Underlying Symbol","Underlying Security ID","Underlying Listing Exchange","Issuer","Issuer Country Code","Trade ID","Multiplier","Related Trade ID","Strike","Report Date","Expiry","Date/Time","Put/Call","Trade Date","Principal Adjust Factor","Settle Date Target","Transaction Type","Exchange","Quantity","TradePrice","Trade Money","Proceeds","Taxes","IB Commission","IB Commission Currency","Net Cash","Close Price","Open/Close Indicator","Notes/Codes","Cost Basis","Realized P/L","MTM P/L","Orig Trade Price","Orig Trade Date","Orig Trade ID","Orig Order ID","Orig Transaction ID","Buy/Sell","Clearing Firm ID","IB Order ID","Transaction ID","IB Execution ID","Related Transaction ID","RTN","Brokerage Order ID","Order Reference","Volatility Order Link","Exch Order ID","External Execution ID","Order Time","Open Date Time","Holding Period Date Time (Wash Sales)","When Realized (Wash Sales)","When Reopened (Wash Sales)","Level Of Detail","Change In Price","Change In Quantity","Order Type","Trader ID","Is API Order","Accrued Interest","Initial Investment","Position Action ID","Serial Number","Delivery Type","Commodity Type","Fineness","Weight"])}\n\n        ${this.renderDetailedSection("4. Corporate Actions",47,["Account ID","Account Alias","Model","Currency","FXRateToBase","Asset Class","Sub Category","Symbol","Description","Conid","Security ID","Security ID Type","CUSIP","ISIN","FIGI","Listing Exchange","Underlying Conid","Underlying Symbol","Underlying Security ID","Underlying Listing Exchange","Issuer","Issuer Country Code","Multiplier","Strike","Expiry","Put/Call","Principal Adjust Factor","Report Date","Date/Time","Action Description","Amount","Proceeds","Value","Quantity","Cost Basis","Realized P/L","MTM PNL","Code","Type","Transaction ID","Action ID","Level of Detail","Serial Number","Delivery Type","Commodity Type","Fineness","Weight"],"Summary, Detail, Closed Lots, Wash Sales enabled")}\n\n        ${this.renderDetailedSection("5. Option Exercises, Assignments and Expirations",44,["Account ID","Account Alias","Model","Currency","FXRateToBase","Asset Class","Sub Category","Symbol","Description","Conid","Security ID","Security ID Type","CUSIP","ISIN","FIGI","Listing Exchange","Underlying Conid","Underlying Symbol","Underlying Security ID","Underlying Listing Exchange","Issuer","Issuer Country Code","Multiplier","Strike","Expiry","Put/Call","Principal Adjust Factor","Date","Transaction Type","Quantity","Trade Price","Close Price","Proceeds","Comm/Tax","Basis","Realized P/L","FX P/L","MTM P/L","Trade ID","Serial Number","Delivery Type","Commodity Type","Fineness","Weight"])}\n\n        ${this.renderDetailedSection("6. Pending Exercises",36,["Account ID","Account Alias","Model","Currency","FXRateToBase","Asset Class","Sub Category","Symbol","Description","Conid","Security ID","Security ID Type","CUSIP","ISIN","FIGI","Listing Exchange","Underlying Conid","Underlying Symbol","Underlying Security ID","Underlying Listing Exchange","Issuer","Issuer Country Code","Multiplier","Strike","Expiry","Put/Call","Principal Adjust Factor","Report Date","Trade Date","Quantity","Type","Serial Number","Delivery Type","Commodity Type","Fineness","Weight"])}\n\n        ${this.renderDetailedSection("7. Transaction Fees",44,["Account ID","Account Alias","Model","Currency","FXRateToBase","Asset Class","Sub Category","Symbol","Description","Conid","Security ID","Security ID Type","CUSIP","ISIN","FIGI","Listing Exchange","Underlying Conid","Underlying Symbol","Underlying Security ID","Underlying Listing Exchange","Issuer","Issuer Country Code","Multiplier","Strike","Expiry","Put/Call","Principal Adjust Factor","Date","Report Date","Settle Date","Tax Description","Quantity","Tax Amount","Order ID","Trade ID","Trade Price","Source","Code","Level of Detail","Serial Number","Delivery Type","Commodity Type","Fineness","Weight"],"Summary, Detail, and Execution enabled")}\n\n        ${this.renderDetailedSection("8. Cash Transactions",45,["Account ID","Account Alias","Model","Currency","FXRateToBase","Asset Class","Sub Category","Symbol","Description","Conid","Security ID","Security ID Type","CUSIP","ISIN","FIGI","Listing Exchange","Underlying Conid","Underlying Symbol","Underlying Security ID","Underlying Listing Exchange","Issuer","Issuer Country Code","Multiplier","Strike","Expiry","Put/Call","Principal Adjust Factor","Date/Time","Settle Date","Available For Trading Date","Amount","Type","Trade ID","Code","Transaction ID","Report Date","Ex Date","Client Reference","Action ID","Level of Detail","Serial Number","Delivery Type","Commodity Type","Fineness","Weight"],"Dividends, Payment in Lieu, Withholding Tax, 871(m), Advisor Fees, Other Fees, Other Income, Deposits & Withdrawals, Carbon Credits, Bill Pay, Broker Interest Paid/Received, Broker Fees, Bond Interest Paid/Received, Price Adjustments, Commission Adjustments, Detail (Summary NOT enabled)")}\n\n        ${this.renderDetailedSection("9. Forex P/L Details",12,["Account ID","Account Alias","Model","FX Currency","Activity Description","Date/Time","Quantity","Proceeds","Cost","Realized P/L","Code","Level of Detail"])}\n\n        <h3 class="text-xl font-semibold text-gray-900 mb-4 mt-8">CSV File Structure</h3>\n        <p class="text-gray-700 mb-4">\n          Based on examination of actual CSV files, the structure is:\n        </p>\n        <div class="bg-gray-50 text-gray-800 rounded-lg p-4 mb-6 overflow-x-auto border border-gray-200">\n          <pre class="text-sm"><code>[Open Positions Header Row]\n[Open Positions Data Rows...]\n[Complex Positions Header Row]\n[Complex Positions Data Rows...]\n[Trades Header Row]\n[Trades Data Rows...]\n[Corporate Actions Header Row]\n[Corporate Actions Data Rows...]\n[Forex P/L Details Header Row]\n[Forex P/L Details Data Rows...]\n[Option Exercises Header Row]\n[Option Exercises Data Rows...]\n[Pending Exercises Header Row]\n[Pending Exercises Data Rows...]\n[Transaction Fees Header Row]\n[Transaction Fees Data Rows...]\n[Cash Transactions Header Row]\n[Cash Transactions Data Rows...]</code></pre>\n        </div>\n        <p class="text-base text-gray-600">\n          Each section starts with a header row beginning with <code class="bg-gray-100 px-1 rounded">ClientAccountID</code> followed by section-specific columns.\n        </p>\n      </div>\n    `}renderDetailedSection(e,t,n,s){return`\n      <div class="border border-gray-200 rounded-lg p-4 mb-6">\n        <h4 class="text-lg font-semibold text-gray-900 mb-2">${e}</h4>\n        <p class="text-base text-gray-600 mb-3"><strong>${t} fields</strong>${s?` - ${s}`:""}</p>\n        <div class="bg-gray-50 rounded p-3">\n          <p class="text-sm font-semibold text-gray-700 mb-2">Enabled Fields:</p>\n          <ol class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-4 gap-y-1 text-sm text-gray-600 list-decimal list-inside">\n            ${n.map(e=>`<li>${e}</li>`).join("")}\n          </ol>\n        </div>\n      </div>\n    `}renderHowItWorks(){return`\n      <div class="how-it-works-container">\n        \x3c!-- Sub-navigation --\x3e\n        <div class="mb-6 flex flex-wrap gap-2">\n          <button class="how-it-works-nav ${"faq"===this.activeHowItWorksSection?"bg-brand-blue text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"} px-4 py-2 rounded-md text-sm font-medium" data-section="faq">\n            FAQ\n          </button>\n          <button class="how-it-works-nav ${"stocks"===this.activeHowItWorksSection?"bg-brand-blue text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"} px-4 py-2 rounded-md text-sm font-medium" data-section="stocks">\n            Stocks\n          </button>\n          <button class="how-it-works-nav ${"options"===this.activeHowItWorksSection?"bg-brand-blue text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"} px-4 py-2 rounded-md text-sm font-medium" data-section="options">\n            Options\n          </button>\n          <button class="how-it-works-nav ${"forex"===this.activeHowItWorksSection?"bg-brand-blue text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"} px-4 py-2 rounded-md text-sm font-medium" data-section="forex">\n            Forex\n          </button>\n          <button class="how-it-works-nav ${"premiums"===this.activeHowItWorksSection?"bg-brand-blue text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"} px-4 py-2 rounded-md text-sm font-medium" data-section="premiums">\n            Option Premiums\n          </button>\n          <button class="how-it-works-nav ${"income"===this.activeHowItWorksSection?"bg-brand-blue text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"} px-4 py-2 rounded-md text-sm font-medium" data-section="income">\n            Interest & Dividends\n          </button>\n          <button class="how-it-works-nav ${"compliance"===this.activeHowItWorksSection?"bg-brand-blue text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"} px-4 py-2 rounded-md text-sm font-medium" data-section="compliance">\n            HMRC Compliance\n          </button>\n        </div>\n\n        \x3c!-- Content sections --\x3e\n        <div id="how-it-works-faq" class="${"faq"===this.activeHowItWorksSection?"":"hidden"}">\n          ${this.renderFAQ()}\n        </div>\n        <div id="how-it-works-stocks" class="${"stocks"===this.activeHowItWorksSection?"":"hidden"}">\n          ${this.renderStocks()}\n        </div>\n        <div id="how-it-works-options" class="${"options"===this.activeHowItWorksSection?"":"hidden"}">\n          ${this.renderOptions()}\n        </div>\n        <div id="how-it-works-forex" class="${"forex"===this.activeHowItWorksSection?"":"hidden"}">\n          ${this.renderForex()}\n        </div>\n        <div id="how-it-works-premiums" class="${"premiums"===this.activeHowItWorksSection?"":"hidden"}">\n          ${this.renderPremiums()}\n        </div>\n        <div id="how-it-works-income" class="${"income"===this.activeHowItWorksSection?"":"hidden"}">\n          ${this.renderIncome()}\n        </div>\n        <div id="how-it-works-compliance" class="${"compliance"===this.activeHowItWorksSection?"":"hidden"}">\n          ${this.renderCompliance()}\n        </div>\n      </div>\n    `}renderFAQ(){return'\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-2xl font-bold text-gray-900 mb-6">Frequently Asked Questions</h3>\n\n        <div class="space-y-6">\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Why do the figures differ from my own manual calculations?</h4>\n            <p class="text-gray-700 mb-3">Discrepancies often arise from:</p>\n            <ul class="list-disc list-inside space-y-2 text-gray-700">\n              <li><strong>Exchange Rates:</strong> The calculator uses the spot <code>FxRateToBase</code> from IBKR when present. If missing, it uses Bank of England daily spot rates (CGT) or HMRC yearly averages (Income).</li>\n              <li><strong>Matching Rule Precision:</strong> The calculator strictly applies "Same Day" (Rule 1), then "Bed & Breakfast" (Rule 2), then "Section 104 Pool" (Rule 3).</li>\n              <li><strong>Commission Handling:</strong> Commissions are automatically included in cost basis (added for purchases) and deducted from proceeds (for sales).</li>\n              <li><strong>Rounding:</strong> Prices and amounts are handled with high precision internally but rounded to 2 decimal places for reporting.</li>\n            </ul>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">How are "Wash Sales" handled?</h4>\n            <p class="text-gray-700 mb-2">The calculator <strong>ignores</strong> US "Wash Sale" flags found in the IBKR CSV. Instead, it applies the UK\'s own <strong>Bed and Breakfasting rule</strong> (matching a sale to purchases made within the following 30 days).</p>\n            <p class="text-gray-700">It enforces a strict 30-day look-ahead beyond the year end to ensure compliance across tax years.</p>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Why are there separate "Income" and "CGT" sections?</h4>\n            <p class="text-gray-700">The calculator presents a <strong>Unified Summary Report</strong>. CGT rows (Stocks, Options, Forex) and Income rows (Interest, Dividends) are grouped to match the CSV export layout, making it easier to copy figures to your tax return.</p>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">I see "[Info: Ghost Split]" messages. Is something wrong?</h4>\n            <p class="text-gray-700"><strong>No.</strong> IBKR Flex Queries often include stock split details for all series of a symbol. The calculator detects these but notes your holding is "0", so it safely ignores them.</p>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Why use Flex Queries instead of Standard Statements?</h4>\n            <p class="text-gray-700">Flex Queries provide raw execution data (like <code>Ex</code> and <code>A</code> codes) required for accurate tax processing. Standard statements often aggregate these or omit them, leading to errors in matching Options to Stocks and handling Corporate Actions.</p>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Why is "Margin Interest" marked "Non-Deductible"?</h4>\n            <p class="text-gray-700">For individual investors, margin interest is generally not an allowable deduction against Capital Gains or Savings Income. We report it for verification but label it clearly.</p>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">How are Options treated if they expire?</h4>\n            <ul class="list-disc list-inside space-y-2 text-gray-700">\n              <li><strong>Long Options (Bought):</strong> Treated as a disposal for £0 proceeds. The cost is an Allowable Loss.</li>\n              <li><strong>Short Options (Sold):</strong> Treated as a disposal for £0 cost. The premium is a Chargeable Gain.</li>\n              <li><strong>Stock Delivery:</strong> If an assignment/exercise usually results in stock delivery, the calculator links the two. No separate gain/loss is reported for the option itself.</li>\n            </ul>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Does this handle Stock Splits or Mergers?</h4>\n            <ul class="list-disc list-inside space-y-2 text-gray-700">\n              <li><strong>Stock Splits:</strong> Automatically detected. Historical holdings quantities are adjusted while total cost remains the same.</li>\n              <li><strong>Spinoffs:</strong> Supported via Auto-Calculation using "Open Positions" MarkPrice for apportionment.</li>\n              <li><strong>Return of Capital:</strong> Handled as Cost Basis Reductions if they qualify as a Small Capital Distribution (≤ 5% of market value OR ≤ £3,000). Otherwise triggers a critical error requiring manual part-disposal.</li>\n            </ul>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Why did the parser reject "cash-in-lieu"?</h4>\n            <p class="text-gray-700">Cash-in-lieu is generally a part-disposal requiring apportionment. The calculator fails closed unless valid small-distribution logic applies.</p>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Why is Forex P/L a single aggregated figure?</h4>\n            <p class="text-gray-700">We rely on detailed "Corporate Actions" and "Cash Transactions" to synthesize the Section 104 Forex pool. Aggregated rows from IBKR are often double-counted or include non-cash items, so we filter them out in Strict Mode.</p>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Why is the "Forex" figure lower than on my IBKR Statement?</h4>\n            <p class="text-gray-700 mb-3">This is intentional to prevent <strong>double taxation</strong>.</p>\n            <ul class="list-disc list-inside space-y-2 text-gray-700">\n              <li><strong>IBKR\'s Method:</strong> Splits gains into "Price" and "Forex" components.</li>\n              <li><strong>HMRC\'s Method:</strong> Capital Gains are calculated in Sterling (Proceeds - Cost). This automatically captures both price and currency movement.</li>\n              <li><strong>Result:</strong> Reporting IBKR\'s forex figure would tax the currency gain twice. Our figure only represents actual currency events (cash holdings) not captured in stock trades.</li>\n            </ul>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">How are short positions handled?</h4>\n            <p class="text-gray-700">Short sales create a negative holding tracked FIFO. The disposal date is the original sale date. Closes > 30 days later use the "Short Match" rule.</p>\n          </div>\n\n          <div class="bg-white border border-gray-200 rounded-lg p-6">\n            <h4 class="text-lg font-semibold text-gray-900 mb-3">Unsupported Currencies?</h4>\n            <p class="text-gray-700">The calculator supports GBP/USD out of the box. For others, you must add rates to a <code>config.json</code> file or ensure <code>FxRateToBase</code> is present in the CSV.</p>\n          </div>\n        </div>\n      </div>\n    '}renderStocks(){return`\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-2xl font-bold text-gray-900 mb-6">Capital Gains Tax: Stocks</h3>\n\n        ${this.renderCallout("info","Methodology","\n          This section outlines the methodology used to calculate UK Capital Gains Tax for Stock transactions, adhering to HMRC Share Matching Rules.\n        ")}\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4">1. Matching Rules Application</h4>\n        <p class="text-gray-700 mb-4">The calculator processes all stock transactions chronologically and applies HMRC's matching rules in strict priority order:</p>\n\n        <div class="space-y-4 mb-6">\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">Priority 1: "Same Day" Rule (Section 105 TCGA 1992)</h5>\n            <p class="text-gray-700 mb-2">Shares sold are first matched with shares acquired on the <strong>same day</strong>.</p>\n            <p class="text-base text-gray-600 mb-2">The cost of shares bought (including commissions) is deducted from the proceeds of shares sold (net of commissions) to calculate the Gain/Loss.</p>\n            ${this.renderCallout("warning","Strict Reservation","\n              Same Day matches are reserved <strong>unconditionally</strong> before Bed & Breakfast matching runs.\n            ")}\n            <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg51560" target="_blank" class="text-base text-brand-blue hover:underline mt-1 inline-block">HMRC Manual CG51560 ↗</a>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">Priority 2: "Bed and Breakfast" Rule (Section 106A TCGA 1992)</h5>\n            <p class="text-gray-700 mb-2">Shares sold are next matched with shares acquired in the <strong>following 30 days</strong>.</p>\n            <p class="text-base text-gray-600">This prevents "Bed and Breakfasting" (selling to crystallize a loss/gain and immediately repurchasing). Matches are applied chronologically (FIFO).</p>\n            <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg51560" target="_blank" class="text-base text-brand-blue hover:underline mt-1 inline-block">HMRC Manual CG51560 ↗</a>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">Priority 3: Section 104 Pool (Average Cost)</h5>\n            <p class="text-gray-700 mb-2">Any remaining unmatched shares are matched against the "Section 104 Holding" (the Pool).</p>\n            <p class="text-base text-gray-600">Allowable Cost is calculated as the average cost of all shares in the pool at the time of disposal.</p>\n            <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg51600" target="_blank" class="text-base text-brand-blue hover:underline mt-1 inline-block">HMRC Manual CG51600 ↗</a>\n          </div>\n        </div>\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4 mt-8">2. Key Features</h4>\n\n        <div class="space-y-4">\n          <div class="bg-gray-50 rounded-lg p-4">\n            <h5 class="font-semibold text-gray-900 mb-2">Cost Basis Adjustments from Options</h5>\n            <p class="text-base text-gray-700">If a stock transaction resulted from Assignment or Exercise of an option, the cost basis or proceeds are adjusted by the option premium:</p>\n            <ul class="list-disc list-inside text-base text-gray-700 mt-2 space-y-1">\n              <li><strong>Assigned Put (Buying Stock):</strong> Premium received is deducted from stock purchase cost.</li>\n              <li><strong>Assigned Call (Selling Stock):</strong> Premium received is added to stock sale proceeds.</li>\n              <li><strong>Exercised Call (Buying Stock):</strong> Premium paid is added to stock purchase cost.</li>\n              <li><strong>Exercised Put (Selling Stock):</strong> Premium paid is deducted from stock sale proceeds.</li>\n            </ul>\n             <p class="text-base text-gray-700 mt-2">The calculator uses fuzzy matching (up to 7 days) to link assignments to the correct stock trade.</p>\n             <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg55536" target="_blank" class="text-base text-brand-blue hover:underline mt-1 inline-block">HMRC Manual CG55536 ↗</a>\n          </div>\n\n          <div class="bg-gray-50 rounded-lg p-4">\n            <h5 class="font-semibold text-gray-900 mb-2">Corporate Actions</h5>\n            <ul class="list-disc list-inside text-base text-gray-700 mt-2 space-y-1">\n              <li><strong>Stock Splits:</strong> Automatically detected. Ratios applied retroactively to historical lots.</li>\n              <li><strong>Spinoffs:</strong> Auto-calculated using "Open Positions" MarkPrice for apportionment (CG57800). <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg57800" target="_blank" class="text-base text-brand-blue hover:underline ml-1">CG57800 ↗</a></li>\n              <li><strong>Small Distributions:</strong> Return of Capital treated as cost reduction if ≤ 5% of MV AND ≤ £3,000. Else Critical Error (CG57835). <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg57835" target="_blank" class="text-base text-brand-blue hover:underline ml-1">CG57835 ↗</a></li>\n            </ul>\n          </div>\n\n          <div class="bg-gray-50 rounded-lg p-4">\n             <h5 class="font-semibold text-gray-900 mb-2">Currency Conversion</h5>\n             <p class="text-base text-gray-700">Non-GBP amounts are converted to GBP using <strong>spot rates on the transaction date</strong> (CG78310). We prioritize IBKR's <code>FxRateToBase</code>, then Bank of England daily rates.</p>\n             <p class="text-base text-gray-700 mt-1"><strong>Fees:</strong> Transaction fees are converted using the <strong>same spot rate</strong> as the trade.</p>\n             <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg78310" target="_blank" class="text-base text-brand-blue hover:underline mt-1 inline-block">HMRC Manual CG78310 ↗</a>\n          </div>\n\n          <div class="bg-gray-50 rounded-lg p-4">\n            <h5 class="font-semibold text-gray-900 mb-2">Short Positions</h5>\n            <p class="text-base text-gray-700">When a sale cannot be matched against existing holdings, it creates a short position. Short positions are tracked in a FIFO queue. The disposal date for tax purposes is the original sale date.</p>\n          </div>\n        </div>\n      </div>\n    `}renderOptions(){return`\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-2xl font-bold text-gray-900 mb-6">Capital Gains Tax: Options</h3>\n\n        ${this.renderCallout("info","HMRC Classification",'\n          Options are treated as <strong>Chargeable Assets</strong> (TCGA 1992, s.144). Tax treatment depends on outcome.\n          <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg55400" target="_blank" class="text-base text-blue-800 hover:underline ml-2">HMRC Manual CG55400 ↗</a>\n        ')}\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4">Treatment by Outcome</h4>\n\n        <div class="space-y-6">\n          <div class="border border-gray-200 rounded-lg p-6">\n            <h5 class="text-lg font-semibold text-gray-900 mb-3">A. Trading (Closed Position)</h5>\n            <p class="text-gray-700 mb-2"><strong>Scenario:</strong> You buy/sell an option and close it before expiration.</p>\n            <p class="text-base text-gray-700"><strong>Treatment:</strong> Standard CGT. Gain/Loss = Proceeds - Cost.</p>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-6">\n            <h5 class="text-lg font-semibold text-gray-900 mb-3">B. Expiry (Abandonment)</h5>\n            <p class="text-gray-700 mb-3"><strong>Scenario:</strong> Option expires worthless.</p>\n            <ul class="list-disc list-inside text-gray-700 space-y-1">\n              <li><strong>Long (Bought):</strong> Allowable Loss equal to cost. (Proceeds £0).</li>\n              <li><strong>Short (Sold):</strong> Chargeable Gain equal to premium. (Cost £0).</li>\n            </ul>\n             <p class="text-base text-gray-600 mt-2"><strong>Note:</strong> Standard US monthly options expiring on Saturday are shifted to Friday for UK tax tax year compliance.</p>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-6">\n            <h5 class="text-lg font-semibold text-gray-900 mb-3">C. Exercise and Assignment</h5>\n             <p class="text-gray-700 mb-2">The option transaction is <strong>merged</strong> with the underlying stock transaction. No separate gain/loss is reported for the option.</p>\n             <p class="text-gray-700 mb-3"><strong>Strict Linking Logic:</strong></p>\n             <ul class="list-disc list-inside text-gray-700 space-y-1">\n               <li><strong>Window:</strong> Up to 7 days lookahead for settlement lags.</li>\n               <li><strong>Fx Rate:</strong> The stock trade is retargeted to the assignment date. A spot rate for that date is <strong>strictly required</strong> (CG78310).</li>\n               <li><strong>Direction:</strong> Strict check (Call Assign -> Sell Stock) to prevent mis-linking.</li>\n             </ul>\n             <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg78310" target="_blank" class="text-base text-brand-blue hover:underline mt-2 inline-block">HMRC Manual CG78310 ↗</a>\n            ${this.renderCallout("warning","Cash Settlement","\n              Options identified as Cash Settled (e.g. SPX) are treated as standalone disposals and not linked to stock.\n            ")}\n          </div>\n        </div>\n      </div>\n    `}renderForex(){return`\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-2xl font-bold text-gray-900 mb-6">Foreign Exchange (Forex)</h3>\n\n        ${this.renderCallout("info","Forex Strategy","\n          The calculator acts to capture all Forex activity, synthesizing Section 104 pools where chargeable, and isolating exempt individual withdrawals.\n        ")}\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4">Methodology</h4>\n\n        <div class="space-y-4">\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">A. Section 104 Pooling (Chargeable)</h5>\n            <p class="text-gray-700 mb-2"><strong>Source:</strong> Synthesized from Cash Transactions and Explicit Forex Trades.</p>\n            <p class="text-base text-gray-600">The calculator tracks foreign currency as a Section 104 asset. It tracks acquisitions and disposals of currency (including settling stock trades). It enforces <strong>daily spot rates</strong> for all currency events.</p>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">B. Forex P/L Details (Incidental)</h5>\n            <p class="text-gray-700 mb-2"><strong>Source:</strong> Forex P/L Details section.</p>\n            <p class="text-base text-gray-600">These are IBKR's internal realized P/L figures. The calculator filters out SUMMARY rows to prevent double-counting. For individuals, these are typically exempt (Bank Accounts).</p>\n          </div>\n        </div>\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Reporting</h4>\n        <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">\n          <h5 class="text-lg font-semibold text-gray-900 mb-2">Synthesized vs Explicit</h5>\n          <ul class="list-disc list-inside space-y-2 text-gray-700">\n            <li><strong>Synthesized (Exempt):</strong> Currency movements from settling stock trades are synthesized but hidden from summary totals by default (s.252 exemption).</li>\n            <li><strong>Explicit Forex (Chargeable):</strong> Active currency pair trading (e.g. EUR.USD) is chargeable and reported as "Forex (Gains/Losses)".</li>\n          </ul>\n        </div>\n        \n        ${this.renderCallout("warning","HMRC COMPLIANCE NOTE (INDIVIDUALS)",'\n           Foreign currency bank accounts held by individuals are generally <strong>exempt from CGT</strong> (TCGA 1992 s.252).\n           The calculator identifies these as exempt and excludes them from "Total Gains" unless configured otherwise.\n           <br><a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg78300" target="_blank" class="text-sm text-yellow-800 hover:underline mt-1 inline-block">HMRC Manual CG78300 ↗</a>\n        ')}\n      </div>\n    `}renderPremiums(){return`\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-2xl font-bold text-gray-900 mb-6">Option Premiums</h3>\n\n        ${this.renderCallout("info","Overview","\n          This section explains how Option Premiums are handled from collection to final tax treatment.\n        ")}\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4">Lifecycle of an Option Premium</h4>\n\n        <div class="space-y-6">\n          <div class="border border-gray-200 rounded-lg p-6">\n            <h5 class="text-lg font-semibold text-gray-900 mb-3">1. Collection (Opening Position)</h5>\n            <p class="text-gray-700 mb-2">When you trade an option, the premium is the price you pay (Long) or receive (Short).</p>\n            <p class="text-base text-gray-600 mt-2">At this stage, the premium is part of an Open Position. It is not yet a realized gain or loss.</p>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-6">\n            <h5 class="text-lg font-semibold text-gray-900 mb-3">2. Trading (Closing Position)</h5>\n            <p class="text-gray-700 mb-2">If you close the position by buying or selling the option back before expiration, Standard Capital Gains Tax applies.</p>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-6">\n            <h5 class="text-lg font-semibold text-gray-900 mb-3">3. Option Expires Worthless</h5>\n            <p class="text-gray-700 mb-3">If the option reaches its expiration date without being exercised or assigned:</p>\n            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n              <div class="bg-green-50 border border-green-200 rounded p-3">\n                <p class="font-semibold text-gray-900 mb-2">Short Position</p>\n                <p class="text-base text-gray-700">Proceeds (Premium) - £0 Cost = <strong>Realized Gain</strong></p>\n              </div>\n              <div class="bg-red-50 border border-red-200 rounded p-3">\n                <p class="font-semibold text-gray-900 mb-2">Long Position</p>\n                <p class="text-base text-gray-700">£0 Proceeds - Cost (Premium) = <strong>Allowable Loss</strong></p>\n              </div>\n            </div>\n            <p class="text-base text-gray-600 mt-3">The calculator automatically generates a Synthetic Closing Transaction/Expired status if IBKR data is missing the closing record.</p>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-6">\n            <h5 class="text-lg font-semibold text-gray-900 mb-3">4. Assignment and Exercise (The Merger)</h5>\n            <p class="text-gray-700 mb-3">The premium is <strong>merged</strong> into the cost basis or proceeds of the underlying stock transaction.</p>\n            \n            <div class="bg-gray-50 rounded p-4 mb-4">\n              <p class="font-semibold text-gray-900 mb-2">Process:</p>\n              <ol class="list-decimal list-inside text-base text-gray-700 space-y-1">\n                <li>Identify the Assignment (A) or Exercise (Ex) event</li>\n                <li>Match to the resulting Stock Trade occurring within 7 days</li>\n                <li>Transfer the accumulated premium and commissions to the stock trade</li>\n                <li>Zero out the original option trade to prevent double-counting</li>\n              </ol>\n            </div>\n\n            <div class="overflow-x-auto">\n              <table class="min-w-full divide-y divide-gray-200 text-base">\n                <thead class="bg-gray-50">\n                  <tr>\n                    <th class="px-4 py-2 text-left font-semibold text-gray-900">Scenario</th>\n                    <th class="px-4 py-2 text-left font-semibold text-gray-900">Action</th>\n                    <th class="px-4 py-2 text-left font-semibold text-gray-900">Tax Treatment</th>\n                  </tr>\n                </thead>\n                <tbody class="divide-y divide-gray-200">\n                  <tr>\n                    <td class="px-4 py-2 text-gray-700">Put (Short)</td>\n                    <td class="px-4 py-2 text-gray-700">Assigned</td>\n                    <td class="px-4 py-2 text-gray-700">Premium reduces Cost Basis of bought stock.</td>\n                  </tr>\n                  <tr>\n                    <td class="px-4 py-2 text-gray-700">Call (Short)</td>\n                    <td class="px-4 py-2 text-gray-700">Assigned</td>\n                    <td class="px-4 py-2 text-gray-700">Premium increases Proceeds of sold stock.</td>\n                  </tr>\n                  <tr>\n                    <td class="px-4 py-2 text-gray-700">Call (Long)</td>\n                    <td class="px-4 py-2 text-gray-700">Exercised</td>\n                    <td class="px-4 py-2 text-gray-700">Premium increases Cost Basis of bought stock.</td>\n                  </tr>\n                  <tr>\n                    <td class="px-4 py-2 text-gray-700">Put (Long)</td>\n                    <td class="px-4 py-2 text-gray-700">Exercised</td>\n                    <td class="px-4 py-2 text-gray-700">Premium reduces Proceeds of sold stock.</td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </div>\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4 mt-8">Example</h4>\n        <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">\n          <p class="text-gray-700 mb-2"><strong>Scenario:</strong> You sell a Put option for a £100 premium (Strike £50). You are assigned.</p>\n          <ol class="list-decimal list-inside text-gray-700 space-y-2 mt-3">\n            <li><strong>Cash Flow:</strong> You buy the shares for £5,000 (£50 × 100)</li>\n            <li><strong>Tax Calculation:</strong> The £100 premium is deducted from the purchase price</li>\n            <li><strong>Result:</strong> Your Cost Basis for the shares is £4,900</li>\n          </ol>\n        </div>\n      </div>\n    `}renderIncome(){return`\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-2xl font-bold text-gray-900 mb-6">Interest and Dividends</h3>\n\n        ${this.renderCallout("info","Tax Classification","\n          Interest and Dividends are classified as <strong>Income</strong>, separate from Capital Gains Tax calculations. They are subject to Income Tax.\n        ")}\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4">Classification</h4>\n        <ul class="list-disc list-inside text-gray-700 space-y-2 mb-6">\n          <li><strong>Income Tax vs CGT:</strong> Interest and Dividends are subject to Income Tax.</li>\n          <li><strong>Currency Conversion:</strong> All non-GBP income is converted to GBP using the HMRC Yearly Average Rate (preferred) or Daily Spot Rate (fallback).</li>\n        </ul>\n\n         <h4 class="text-xl font-semibold text-gray-900 mb-4">Data Source Priority</h4>\n         ${this.renderCallout("note","Data Source Priority","\n           The calculator prioritizes <strong>Cash Transactions</strong> over Corporate Actions for income data, as it provides settlement dates and full detail.\n           <br><br><strong>Note:</strong> It strictly validates completeness. If Cash Transactions has fewer records than Corporate Actions, a Critical Compliance Error is thrown to prevent under-reporting.\n         ")}\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4">Interest Reporting</h4>\n\n        <div class="space-y-4 mb-6">\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">Income (Taxable)</h5>\n            <p class="text-gray-700 mb-2">Rows with positive amounts in the "Interest" section.</p>\n            <p class="text-gray-700"><strong>Reported as:</strong> "Gross Interest Received"</p>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">Expense (Non-Deductible)</h5>\n            <p class="text-gray-700 mb-2">Rows with negative amounts (typically Margin Interest).</p>\n            <p class="text-gray-700"><strong>Reported as:</strong> "Interest Paid (Margin)"</p>\n            ${this.renderCallout("warning","Tax Nuance",'\n              Generally not an allowable deduction for individual investors. Marked as "Non-Deductible".\n            ')}\n          </div>\n        </div>\n\n        <h4 class="text-xl font-semibold text-gray-900 mb-4">Dividend Reporting</h4>\n\n        <div class="space-y-4">\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">Dividend Income</h5>\n            <p class="text-gray-700"><strong>Reported as:</strong> "Gross Dividends". Taxable as Dividend Income.</p>\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">Payments in Lieu (PIL)</h5>\n            <p class="text-gray-700 mb-2">Occurs when shares are lent out or you are short.</p>\n            <ul class="list-disc list-inside text-gray-700 space-y-1">\n               <li><strong>Income:</strong> Taxable, but may be "manufactured dividends" or property income.</li>\n               <li><strong>Expense:</strong> Generally not deductible against dividend income for individuals.</li>\n            </ul>\n             ${this.renderCallout("info","Note","\n               The calculator separates PIL from standard dividends so you can review tax treatment.\n             ")}\n          </div>\n\n          <div class="border border-gray-200 rounded-lg p-4">\n            <h5 class="text-lg font-semibold text-gray-900 mb-2">Withholding Tax</h5>\n            <p class="text-gray-700"><strong>Reported as:</strong> "Withholding Tax" (or Foreign Tax Paid).</p>\n            <p class="text-gray-700">May be claimable as Foreign Tax Credit Relief (FTCR).</p>\n          </div>\n        </div>\n        \n        <h4 class="text-xl font-semibold text-gray-900 mb-4 mt-8">HMRC Compliance: Date of Receipt</h4>\n        <p class="text-gray-700">The calculator strictly uses the <strong>Payment/Accrual Date</strong> for income attribution to the correct tax year, ensuring compliance even if settlement crosses year boundaries (SAIM5020).</p>\n      </div>\n    `}renderCompliance(){return`\n      <div class="prose prose-indigo max-w-none">\n        <h3 class="text-2xl font-bold text-gray-900 mb-6">HMRC Compliance Statement</h3>\n\n        ${this.renderCallout("info","Compliance Overview","\n          The calculator implements specific HMRC Capital Gains Tax and Income Tax regulations. Below are the key compliance decisions.\n        ")}\n\n        <div class="space-y-8">\n          \x3c!-- 1. Timezone --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">1. Timezone Handling (Strict UK Compliance)</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n              <ul class="list-disc list-inside text-gray-700 space-y-2">\n                <li><strong>Rule:</strong> Tax years and matching rules use strict UK dates (BST/GMT).</li>\n                <li><strong>Implementation:</strong> All timestamps (EST, JST, etc.) are converted to UK time.</li>\n                <li><strong>Impact:</strong> Prevents "Same Day" or "Bed & Breakfast" errors where a US trade might look like a different day.</li>\n                <li><strong>Strictness:</strong> Unknown timezones, missing timezones, or malformed dates trigger a critical error.</li>\n              </ul>\n              <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg14250" target="_blank" class="text-base text-brand-blue hover:underline mt-2 inline-block">HMRC Manual CG14250 ↗</a>\n            </div>\n          </div>\n\n          \x3c!-- 2. Share Matching --\x3e\n          <div>\n             <h4 class="text-xl font-semibold text-gray-900 mb-2">2. Share Matching Rules (s.104, s.105, s.106A)</h4>\n             <div class="bg-gray-50 p-4 rounded-lg">\n               <ol class="list-decimal list-inside text-gray-700 space-y-2">\n                 <li><strong>Same Day (s.105):</strong> Trades on the same day are matched first. Unconditionally reserved.</li>\n                 <li><strong>Bed & Breakfast (s.106A):</strong> Unmatched sales look for buys in the next 30 days.</li>\n                 <li><strong>Section 104 Pool:</strong> Remaining shares are pooled at average cost. <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg51600" target="_blank" class="text-brand-blue hover:underline ml-1">CG51600 ↗</a></li>\n               </ol>\n               <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg51560" target="_blank" class="text-base text-brand-blue hover:underline mt-2 inline-block">HMRC Manual CG51560 ↗</a>\n             </div>\n          </div>\n\n          \x3c!-- 3. Options --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">3. Options Handling (TCGA 1992 s.144)</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n              <ul class="list-disc list-inside text-gray-700 space-y-2">\n                <li><strong>Pooling:</strong> Options are pooled by specific series (Expiry + Strike + Type).</li>\n                <li><strong>Expiry:</strong> Saturday expiry dates are shifted to Friday to match UK tax years correctly.</li>\n                <li><strong>Linking:</strong> Assignment/Exercise merges the option with the stock trade. The Stock trade is retargeted to the Assignment date and uses its FX rate (Compliance with CG78310).</li>\n                <li><strong>Cash Settlement:</strong> Index options (SPX, NDX) are detected and treated as standalone cash disposals.</li>\n              </ul>\n              <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg55590" target="_blank" class="text-base text-brand-blue hover:underline mt-2 inline-block">HMRC Manual CG55590 ↗</a>\n            </div>\n          </div>\n\n           \x3c!-- 4. Allowable Costs --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">4. Allowable Costs (Section 38)</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n              <p class="text-gray-700 mb-2">Commissions are allowable costs.</p>\n              <ul class="list-disc list-inside text-gray-700 space-y-1">\n                <li><strong>Purchases:</strong> Cost = Price + Commission.</li>\n                <li><strong>Sales:</strong> Proceeds = Price - Commission.</li>\n                <li><strong>FX:</strong> Fees are converted using the same spot rate as the trade (Consistency Principle).</li>\n              </ul>\n              <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg15160" target="_blank" class="text-base text-brand-blue hover:underline mt-2 inline-block">HMRC Manual CG15160 ↗</a>\n            </div>\n          </div>\n\n          \x3c!-- 5. Forex --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">5. Foreign Currency (Forex)</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n              <ul class="list-disc list-inside text-gray-700 space-y-2">\n                <li><strong>Spot Rates (CG78310):</strong> All CGT calculations use spot rates on the date of transaction. Yearly averages are forbidden for CGT.</li>\n                <li><strong>Section 104 Pooling:</strong> Chargeable currency (if applicable) is pooled using daily spot rates.</li>\n                <li><strong>Exemption (s.252):</strong> For individuals, foreign currency bank accounts are exempt. The calculator excludes these from "Total Gains" by default. <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg78300" target="_blank" class="text-brand-blue hover:underline ml-1">CG78300 ↗</a></li>\n              </ul>\n              <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg78310" target="_blank" class="text-base text-brand-blue hover:underline mt-2 inline-block">HMRC Manual CG78310 ↗</a>\n            </div>\n          </div>\n\n          \x3c!-- 6. Corporate Actions --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">6. Corporate Actions</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n              <ul class="list-disc list-inside text-gray-700 space-y-2">\n                <li><strong>Stock Splits:</strong> Quantity adjusted retroactively. Total cost preserved.</li>\n                <li><strong>Spinoffs (Demergers):</strong> Cost basis apportioned based on market value at distribution (CG57800).</li>\n                <li><strong>Return of Capital:</strong> Treated as cost reduction if ≤ 5% of MV AND ≤ £3,000. Strict compliance enforced. <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg57835" target="_blank" class="text-brand-blue hover:underline ml-1">CG57835 ↗</a></li>\n              </ul>\n              <a href="https://www.gov.uk/hmrc-internal-manuals/capital-gains-manual/cg57800" target="_blank" class="text-base text-brand-blue hover:underline mt-2 inline-block">HMRC Manual CG57800 ↗</a>\n            </div>\n          </div>\n          \n          \x3c!-- 7. Dividends and Income --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">7. Dividends and Income</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n               <ul class="list-disc list-inside text-gray-700 space-y-2">\n                 <li><strong>Date:</strong> Payment/Accrual date used strictly (SAIM5020).</li>\n                 <li><strong>Gross:</strong> Tax is on Gross amount. Withholding tax is reported separately for FTCR.</li>\n               </ul>\n               <a href="https://www.gov.uk/hmrc-internal-manuals/savings-and-investment-manual/saim5020" target="_blank" class="text-base text-brand-blue hover:underline mt-2 inline-block">HMRC Manual SAIM5020 ↗</a>\n            </div>\n          </div>\n\n          \x3c!-- 8. Date Range Filtering --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">8. Report Period Boundaries</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n              <p class="text-gray-700">The calculator filters based on <strong>inclusive calendar days</strong>. This ensures trades on April 5th/6th are never lost due to timezone offsets.</p>\n            </div>\n          </div>\n\n          \x3c!-- 9. Reporting Totals --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">9. Reporting Totals</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n              <p class="text-gray-700">Total Gains and Total Losses are summed separately before netting, as required for Tax Return Boxes 4 and 7.</p>\n            </div>\n          </div>\n          \n          \x3c!-- 10. Data Integrity --\x3e\n          <div>\n            <h4 class="text-xl font-semibold text-gray-900 mb-2">10. Data Integrity</h4>\n            <div class="bg-gray-50 p-4 rounded-lg">\n              <p class="text-gray-700">The calculator dedupes overlapping reports using Transaction IDs to prevent double-counting of trades.</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}attachEventListeners(){const e=document.getElementById("close-docs"),t=document.getElementById("tab-quick"),n=document.getElementById("tab-detailed"),s=document.getElementById("tab-how-it-works");e&&e.addEventListener("click",()=>this.onClose()),t&&t.addEventListener("click",()=>this.switchTab("quick")),n&&n.addEventListener("click",()=>this.switchTab("detailed")),s&&s.addEventListener("click",()=>this.switchTab("howItWorks"));document.querySelectorAll(".how-it-works-nav").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.getAttribute("data-section");t&&this.switchHowItWorksSection(t)})})}switchTab(e){this.activeTab=e;const t=document.getElementById("tab-quick"),n=document.getElementById("tab-detailed"),s=document.getElementById("tab-how-it-works"),i=document.getElementById("tab-content-quick"),r=document.getElementById("tab-content-detailed"),o=document.getElementById("tab-content-how-it-works"),a="doc-tab border-brand-blue text-brand-blue whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm",l="doc-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm";t&&(t.className="quick"===e?a:l),n&&(n.className="detailed"===e?a:l),s&&(s.className="howItWorks"===e?a:l),i&&i.classList.toggle("hidden","quick"!==e),r&&r.classList.toggle("hidden","detailed"!==e),o&&o.classList.toggle("hidden","howItWorks"!==e)}switchHowItWorksSection(e){this.activeHowItWorksSection=e;document.querySelectorAll(".how-it-works-nav").forEach(t=>{const n=t.getAttribute("data-section");t.className=n===e?"how-it-works-nav bg-brand-blue text-white px-4 py-2 rounded-md text-sm font-medium":"how-it-works-nav bg-gray-100 text-gray-700 hover:bg-gray-200 px-4 py-2 rounded-md text-sm font-medium"});["faq","stocks","options","forex","premiums","income","compliance"].forEach(t=>{const n=document.getElementById(`how-it-works-${t}`);n&&n.classList.toggle("hidden",t!==e)})}renderCallout(e,t,n){const s={info:{background:"bg-blue-50",border:"border-blue-400",title:"text-blue-800",text:"text-blue-700"},warning:{background:"bg-yellow-50",border:"border-yellow-400",title:"text-yellow-800",text:"text-yellow-700"},error:{background:"bg-red-50",border:"border-red-400",title:"text-red-800",text:"text-red-700"},note:{background:"bg-gray-50",border:"border-gray-400",title:"text-gray-800",text:"text-gray-700"}}[e];return`\n      <div class="${s.background} border-l-4 ${s.border} p-4 mb-6">\n        <h3 class="text-sm font-medium ${s.title}">${t}</h3>\n        <div class="mt-2 text-sm ${s.text}">\n          <p>${n}</p>\n        </div>\n      </div>\n    `}}class ar{constructor(e){t(this,"onClose"),this.onClose=e}render(){return'\n      <div class="contact-container bg-white shadow-sm rounded-lg">\n        <div class="sticky top-0 bg-white border-b border-gray-200 z-10">\n          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">\n            <div class="flex items-center justify-between">\n              <h2 class="text-2xl font-bold text-gray-900">Contact Us</h2>\n              <button id="close-contact" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-uk-red hover:bg-uk-red-light focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-uk-red transition-colors">\n                ← Back to Calculator\n              </button>\n            </div>\n          </div>\n        </div>\n\n        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-12">\n          <div class="bg-gradient-to-br from-brand-blue to-blue-600 rounded-2xl shadow-xl p-8 text-white mb-8">\n            <div class="flex items-center mb-6">\n              <svg class="h-12 w-12 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />\n              </svg>\n              <div>\n                <h3 class="text-2xl font-bold">Get in Touch</h3>\n                <p class="text-blue-100 mt-1">We\'re here to help with your questions</p>\n              </div>\n            </div>\n            \n            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-6">\n              <p class="text-lg mb-4">For support, questions, or feedback, please email us at:</p>\n              <a href="mailto:contact@brokertaxcalculator.com" class="inline-flex items-center text-2xl font-semibold hover:text-blue-100 transition-colors">\n                contact@brokertaxcalculator.com\n              </a>\n            </div>\n          </div>\n\n          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">\n            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">\n              <div class="flex items-start">\n                <svg class="h-6 w-6 text-brand-blue mr-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />\n                </svg>\n                <div>\n                  <h4 class="text-lg font-semibold text-gray-900 mb-2">General Inquiries</h4>\n                  <p class="text-gray-600">Questions about how the calculator works, supported features, or general tax calculation queries.</p>\n                </div>\n              </div>\n            </div>\n\n            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">\n              <div class="flex items-start">\n                <svg class="h-6 w-6 text-brand-blue mr-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />\n                </svg>\n                <div>\n                  <h4 class="text-lg font-semibold text-gray-900 mb-2">Technical Support</h4>\n                  <p class="text-gray-600">Issues with CSV uploads, calculation errors, or technical problems with the application.</p>\n                </div>\n              </div>\n            </div>\n\n            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">\n              <div class="flex items-start">\n                <svg class="h-6 w-6 text-brand-blue mr-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />\n                </svg>\n                <div>\n                  <h4 class="text-lg font-semibold text-gray-900 mb-2">Feature Requests</h4>\n                  <p class="text-gray-600">Suggestions for new features, improvements, or additional functionality you\'d like to see.</p>\n                </div>\n              </div>\n            </div>\n\n            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">\n              <div class="flex items-start">\n                <svg class="h-6 w-6 text-brand-blue mr-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />\n                </svg>\n                <div>\n                  <h4 class="text-lg font-semibold text-gray-900 mb-2">Feedback</h4>\n                  <p class="text-gray-600">Share your experience, report bugs, or let us know how we can improve the calculator.</p>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div class="mt-8 bg-blue-50 border-l-4 border-blue-400 p-6 rounded">\n            <div class="flex">\n              <div class="flex-shrink-0">\n                <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">\n                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />\n                </svg>\n              </div>\n              <div class="ml-3">\n                <p class="text-sm text-blue-700">\n                  <strong>Response Time:</strong> We typically respond within 24-48 hours during business days. For urgent tax-related questions, please consult with a qualified tax professional or accountant.\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    '}attachEventListeners(){const e=document.getElementById("close-contact");e&&e.addEventListener("click",()=>this.onClose())}}function lr(e){return new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=()=>{n(new Error(`Failed to read file: ${e.name}`))},s.readAsText(e)})}function cr(e,t){const{disposalResults:n,warnings:s}=Ki(e.transactions,e.optionEvents,e.corporateActions,{fromDate:t?.fromDate??void 0,toDate:t?.toDate??void 0,openPositions:e.openPositions}),i=function(e,t,n){const s=n?.fromDate?new Date(n.fromDate):void 0,i=n?.toDate?new Date(n.toDate):void 0,r=er(e,t.forexPLDetailRecords,t.interestRecords,t.dividendRecords,t.withholdingTaxRecords,s,i,!1);let o=0,a=0;for(const l of e){const e=(l.assetCategory||"").toLowerCase();"forex"!==e&&"currency"!==e&&"cash"!==e&&(l.gain>0?o+=l.gain:a+=Math.abs(l.gain))}return{totalGains:o,totalLosses:a,netCGT:o-a,rows:r}}(n,e,t);return{summary:i,disposals:n.map(e=>({date:e.date,symbol:e.symbol,assetCategory:e.assetCategory||"Unknown",quantity:e.quantity,proceeds:e.proceeds,cost:e.allowableCost,gainLoss:e.proceeds-e.allowableCost,matchingRule:e.rule})),dateRange:t,actualDateRange:e.actualDateRange,warnings:s}}(new class{constructor(){t(this,"fileUpload"),t(this,"progress"),t(this,"results"),t(this,"dateRangeSelector"),t(this,"documentation"),t(this,"contact"),t(this,"container",null),t(this,"currentFiles",null),t(this,"currentDateRange",{fromDate:null,toDate:null,taxYear:null}),t(this,"currentResults",null),t(this,"currentParsedData",null),t(this,"showDocumentation",!1),t(this,"showContact",!1),this.fileUpload=new nr(this.handleFiles.bind(this)),this.progress=new sr,this.results=new ir,this.dateRangeSelector=new rr(this.handleDateRangeChange.bind(this)),this.documentation=new or(this.toggleDocumentation.bind(this)),this.contact=new ar(this.toggleContact.bind(this))}mount(e){this.container=document.querySelector(e),this.container&&(this.initializeRoute(),this.container.innerHTML=this.render(),this.attachComponents(),window.addEventListener("popstate",()=>{this.initializeRoute(),this.container&&(this.container.innerHTML=this.render(),this.attachComponents())}))}initializeRoute(){const e=window.location.pathname;this.showDocumentation="/documentation"===e,this.showContact="/contact"===e}async handleFiles(e){this.currentFiles=e,0!==e.length?await this.processAndCalculate():this.results.clear()}handleDateRangeChange(e){this.currentDateRange=e,this.currentFiles&&this.processAndCalculate()}toggleDocumentation(){this.showDocumentation=!this.showDocumentation,this.showContact=!1;const e=this.showDocumentation?"/documentation":"/";window.history.pushState({},"",e),this.container&&(this.container.innerHTML=this.render(),this.attachComponents())}toggleContact(){this.showContact=!this.showContact,this.showDocumentation=!1;const e=this.showContact?"/contact":"/";window.history.pushState({},"",e),this.container&&(this.container.innerHTML=this.render(),this.attachComponents())}async processAndCalculate(){if(this.currentFiles)try{this.results.clear(),this.fileUpload.hideDropZone(),this.progress.show("Processing CSV files...");const e=await async function(e,t){const n=[],s=[],i=[],r=[],o=[],a=[],l=[],c=[],d=[],u=[],m=[],h=[],g=e.length;for(let b=0;b<e.length;b++){const f=e[b];t&&t(b/g*100);try{const e=await lr(f);if(f.name.toLowerCase().endsWith(".json")){try{const t=JSON.parse(e);t.actions&&Array.isArray(t.actions)?(Ws(t),console.log(`[FileProcessor] Loaded Corporate Actions Config from ${f.name}`)):console.warn(`[FileProcessor] JSON file ${f.name} does not look like a corporate actions config.`)}catch(p){console.warn(`[FileProcessor] Failed to parse JSON ${f.name}: ${p}`)}continue}const t=await Wi(e,f.name);n.push(...t.transactions),t.optionEvents&&s.push(...t.optionEvents),t.corporateActionRecords&&i.push(...t.corporateActionRecords),t.forexSummaries&&r.push(...t.forexSummaries),t.interestRecords&&o.push(...t.interestRecords),t.dividendRecords&&a.push(...t.dividendRecords),t.withholdingTaxRecords&&l.push(...t.withholdingTaxRecords),t.forexDetailRecords&&c.push(...t.forexDetailRecords),t.forexPLDetailRecords&&d.push(...t.forexPLDetailRecords),t.transactionFees&&u.push(...t.transactionFees),t.cashTransactions&&m.push(...t.cashTransactions),t.openPositions&&h.push(...t.openPositions)}catch(y){throw new Error(`Error processing ${f.name}: ${y.message}`)}}let f;if(t&&t(100),n.sort((e,t)=>{const n=new Date(e.date),s=new Date(t.date);return n.getTime()-s.getTime()}),console.log(`[FileProcessor] Parsed ${n.length} transactions, ${s.length} option events, ${i.length} corporate actions, ${h.length} open positions`),n.length>0){const e=n.map(e=>new Date(e.date)),t=new Date(Math.min(...e.map(e=>e.getTime()))),s=new Date(Math.max(...e.map(e=>e.getTime())));f={fromDate:t.toISOString().split("T")[0],toDate:s.toISOString().split("T")[0]}}return{transactions:n,optionEvents:s,corporateActions:i,forexSummaries:r,interestRecords:o,dividendRecords:a,withholdingTaxRecords:l,forexDetailRecords:c,forexPLDetailRecords:d,transactionFees:u,cashTransactions:m,openPositions:h,actualDateRange:f}}(this.currentFiles,e=>{this.progress.update(e)});this.currentParsedData=e,this.dateRangeSelector.setActualDateRange(e.actualDateRange),this.progress.show("Calculating tax...");const t=await cr(e,this.currentDateRange);this.progress.hide(),this.currentResults=t,this.results.display(t),this.fileUpload.showFileList();const n=document.getElementById("date-range");n&&(n.innerHTML=this.dateRangeSelector.render(),this.dateRangeSelector.attachEventListeners(),n.classList.remove("hidden"))}catch(e){this.progress.hide(),this.results.displayError(e),this.fileUpload.showFileList(),this.fileUpload.showDropZone();const t=document.getElementById("date-range");t&&t.classList.add("hidden")}}attachComponents(){if(this.showDocumentation){const e=document.getElementById("documentation");return void(e&&(e.innerHTML=this.documentation.render(),this.documentation.attachEventListeners()))}if(this.showContact){const e=document.getElementById("contact");return void(e&&(e.innerHTML=this.contact.render(),this.contact.attachEventListeners()))}const e=document.getElementById("docs-link");e&&e.addEventListener("click",e=>{e.preventDefault(),this.toggleDocumentation()});const t=document.getElementById("contact-link");t&&t.addEventListener("click",e=>{e.preventDefault(),this.toggleContact()});const n=document.getElementById("date-range"),s=document.getElementById("file-upload"),i=document.getElementById("progress"),r=document.getElementById("results");if(n&&(this.currentParsedData?.actualDateRange&&this.dateRangeSelector.setActualDateRange(this.currentParsedData.actualDateRange),n.innerHTML=this.dateRangeSelector.render(),this.dateRangeSelector.attachEventListeners(),this.currentFiles&&this.currentFiles.length>0))if(n.classList.remove("hidden"),this.currentDateRange.taxYear){const e=document.getElementById("tax-year-select");e&&(e.value=this.currentDateRange.taxYear)}else if(this.currentDateRange.fromDate||this.currentDateRange.toDate){const e=document.getElementById("tax-year-select"),t=document.getElementById("custom-date-range"),n=document.getElementById("from-date"),s=document.getElementById("to-date");e&&(e.value="custom"),t&&t.classList.remove("hidden"),n&&this.currentDateRange.fromDate&&(n.value=this.currentDateRange.fromDate),s&&this.currentDateRange.toDate&&(s.value=this.currentDateRange.toDate)}s&&(s.innerHTML=this.fileUpload.render(),this.fileUpload.attachEventListeners(),this.currentFiles&&this.currentFiles.length>0&&(this.fileUpload.hideDropZone(),this.fileUpload.showFileList())),i&&(i.innerHTML=this.progress.render()),r&&(r.innerHTML=this.results.render(),this.currentResults&&this.results.display(this.currentResults))}render(){return this.showDocumentation?`\n        <header class="bg-brand-blue shadow-lg">\n          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">\n            <h1 class="text-3xl font-bold text-white">\n              UK Tax Calculator for Interactive Brokers (IBKR)\n            </h1>\n            <p class="mt-2 text-gray-100">\n              Calculate Capital Gains Tax & Income for HMRC Self Assessment\n            </p>\n          </div>\n        </header>\n        \n        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-8">\n          <div id="documentation"></div>\n        </main>\n        \n        ${this.renderFooter()}\n      `:this.showContact?`\n        <header class="bg-brand-blue shadow-lg">\n          <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">\n            <h1 class="text-3xl font-bold text-white">\n              UK Tax Calculator for Interactive Brokers (IBKR)\n            </h1>\n            <p class="mt-2 text-gray-100">\n              Calculate Capital Gains Tax & Income for HMRC Self Assessment\n            </p>\n          </div>\n        </header>\n        \n        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-8">\n          <div id="contact"></div>\n        </main>\n        \n        ${this.renderFooter()}\n      `:`\n      <header class="bg-brand-blue shadow-lg">\n        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">\n          <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">\n            <div>\n              <h1 class="text-3xl font-bold text-white">\n                UK Tax Calculator for Interactive Brokers (IBKR)\n              </h1>\n              <p class="mt-2 text-gray-100">\n                Calculate Capital Gains Tax & Income for HMRC Self Assessment\n              </p>\n            </div>\n            <div class="flex flex-col sm:flex-row gap-3 lg:flex-shrink-0">\n              <a href="/documentation" id="docs-link" class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-uk-red hover:bg-uk-red-light focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-uk-red transition-colors">\n                <svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />\n                </svg>\n                Documentation\n              </a>\n              <a href="/contact" id="contact-link" class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-uk-red hover:bg-uk-red-light focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-uk-red transition-colors">\n                <svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />\n                </svg>\n                Contact\n              </a>\n            </div>\n          </div>\n        </div>\n      </header>\n      \n      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-8">\n        <div id="date-range" class="hidden"></div>\n        <div id="progress"></div>\n        <div id="file-upload"></div>\n        <div id="results"></div>\n      </main>\n      \n      ${this.renderFooter()}\n    `}renderFooter(){return`\n      <footer class="bg-gray-100 py-8">\n        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">\n          <div class="text-center max-w-4xl mx-auto">\n            <p class="text-lg font-semibold text-gray-900">⚠️ Use at your own risk</p>\n            <p class="mt-3 text-sm text-gray-600">\n              This tool is provided for informational purposes only and does not constitute professional tax, legal, or financial advice. \n              The calculations and reports generated by this tool should not be relied upon as the sole basis for filing your tax return.\n            </p>\n            <p class="mt-2 text-sm text-gray-600">\n              <strong>Important:</strong> You are solely responsible for verifying all calculations, ensuring accuracy, and complying with HMRC regulations. \n              Tax laws are complex and subject to change. We strongly recommend consulting with a qualified tax professional or accountant \n              before submitting any tax returns to HMRC.\n            </p>\n            <p class="mt-2 text-sm text-gray-600">\n              All calculations are performed locally in your browser - your data never leaves your device and is not stored or transmitted anywhere.\n            </p>\n            <p class="mt-3 text-sm text-gray-600">\n              By using this tool, you acknowledge that you understand these limitations and accept full responsibility for your tax filings. \n              The developers and contributors of this tool accept no liability for any errors, omissions, or consequences arising from its use.\n            </p>\n            <p class="mt-3 text-sm text-gray-600">\n              IBKR is a trademark of Interactive Brokers LLC. This tool is not affiliated with, sponsored by, or endorsed by Interactive Brokers.\n            </p>\n            <p class="mt-3 text-sm text-gray-600">\n              © ${(new Date).getFullYear()} Broker Tax Calculator. All rights reserved.\n            </p>\n            <p class="mt-3 text-sm text-gray-600">\n              Contact: <a href="mailto:contact@brokertaxcalculator.com">contact@brokertaxcalculator.com</a>\n            </p>\n          </div>\n        </div>\n      </footer>\n    `}}).mount("#app");
